!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(){S.text(0),M.text(1),y.velocity({opacity:0},c,function(){y.hide(),v.velocity({opacity:0},c,function(){v.hide(),w.fadeIn(c),T.toggle()})})}var r=function(e){return e&&e.__esModule?e:{"default":e}},o=e(7),s=r(o),a=e(52),l=r(a),h=e(55),u=r(h);window.jQuery=window.$=s["default"],e(51),u["default"]();var c=300,p=s["default"]("#main-menu"),d=s["default"]("#main-menu #start"),f=s["default"]("#main-menu .content"),m=s["default"]("#flash"),v=s["default"]("#game-over-menu"),y=s["default"]("#game-over-menu .content"),g=s["default"]("#game-over-menu #score"),x=s["default"]("#game-over-menu #high-score"),b=s["default"]("#game-over-menu #next-level span"),_=s["default"]("#game-over-menu #retry"),w=s["default"]("#hud"),S=s["default"]("#hud #score"),M=s["default"]("#hud #level span"),T=new l["default"](s["default"](".container")[0]);d.on("click",function(){T.running||T.emit("start",!1)}),_.on("click",function(){T.running||i()}),T.on("start",function(e){e||T.toggle(),f.fadeOut(c,function(){w.fadeIn(c),p.fadeOut(c)})}),T.on("score",function(e){return S.text(e.toLocaleString())}),T.on("level",function(){return M.text(parseInt(M.text())+1)}),T.on("end",function(e){T.running=!1,w.hide(),m.show().delay(c).velocity({opacity:0},c,function(){m.hide().css("opacity",1),g.html(e.toLocaleString()+'<span id="L">L'+M.text()+"</span>");var t=localStorage.highScore;void 0===t||e>parseInt(t)?(x.text("NEW RECORD!"),localStorage.highScore=e,localStorage.highLevel=M.text()):x.html("PERSONAL BEST: "+parseInt(t).toLocaleString()+'<span id="L">L'+localStorage.highLevel+"</span>"),b.text((T.getNextScore(parseInt(M.text(),10))+1e3).toLocaleString()),v.show().velocity({opacity:1},c,function(){y.show().velocity({opacity:1},c)})})})},{51:51,52:52,55:55,7:7}],2:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,l,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),l=1;i>l;l++)o[l-1]=arguments[l];n.apply(this,o)}else if(s(n)){for(i=arguments.length,o=new Array(i-1),l=1;i>l;l++)o[l-1]=arguments[l];for(h=n.slice(),i=h.length,l=0;i>l;l++)h[l].apply(this,o)}return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],3:[function(e,t,n){(function(i){!function(e){if("object"==typeof n&&"undefined"!=typeof t)t.exports=e();else if("function"==typeof define,1){var r;"undefined"!=typeof window?r=window:"undefined"!=typeof i?r=i:"undefined"!=typeof self&&(r=self),r.CANNON=e()}else define([],e)}(function(){return function t(n,i,r){function o(a,l){if(!i[a]){if(!n[a]){var h="function"==typeof e&&e;if(!l&&h)return h(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=i[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return o(t?t:e)},u,u.exports,t,n,i,r)}return i[a].exports}for(var s="function"==typeof e&&e,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){t.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(e,t,n){t.exports={version:e("../package.json").version,AABB:e("./collision/AABB"),ArrayCollisionMatrix:e("./collision/ArrayCollisionMatrix"),Body:e("./objects/Body"),Box:e("./shapes/Box"),Broadphase:e("./collision/Broadphase"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),Narrowphase:e("./world/Narrowphase"),ConeTwistConstraint:e("./constraints/ConeTwistConstraint"),ContactMaterial:e("./material/ContactMaterial"),ConvexPolyhedron:e("./shapes/ConvexPolyhedron"),Cylinder:e("./shapes/Cylinder"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventTarget:e("./utils/EventTarget"),FrictionEquation:e("./equations/FrictionEquation"),GSSolver:e("./solver/GSSolver"),GridBroadphase:e("./collision/GridBroadphase"),Heightfield:e("./shapes/Heightfield"),HingeConstraint:e("./constraints/HingeConstraint"),LockConstraint:e("./constraints/LockConstraint"),Mat3:e("./math/Mat3"),Material:e("./material/Material"),NaiveBroadphase:e("./collision/NaiveBroadphase"),ObjectCollisionMatrix:e("./collision/ObjectCollisionMatrix"),Pool:e("./utils/Pool"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),PointToPointConstraint:e("./constraints/PointToPointConstraint"),Quaternion:e("./math/Quaternion"),Ray:e("./collision/Ray"),RaycastVehicle:e("./objects/RaycastVehicle"),RaycastResult:e("./collision/RaycastResult"),RigidVehicle:e("./objects/RigidVehicle"),RotationalEquation:e("./equations/RotationalEquation"),RotationalMotorEquation:e("./equations/RotationalMotorEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),SPHSystem:e("./objects/SPHSystem"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Sphere:e("./shapes/Sphere"),SplitSolver:e("./solver/SplitSolver"),Spring:e("./objects/Spring"),Trimesh:e("./shapes/Trimesh"),Vec3:e("./math/Vec3"),Vec3Pool:e("./utils/Vec3Pool"),World:e("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(e,t,n){function i(e){e=e||{},this.lowerBound=new r,e.lowerBound&&this.lowerBound.copy(e.lowerBound),this.upperBound=new r,e.upperBound&&this.upperBound.copy(e.upperBound)}{var r=e("../math/Vec3");e("../utils/Utils")}t.exports=i;var o=new r;i.prototype.setFromPoints=function(e,t,n,i){var r=this.lowerBound,s=this.upperBound,a=n;r.copy(e[0]),a&&a.vmult(r,r),s.copy(r);for(var l=1;l<e.length;l++){var h=e[l];a&&(a.vmult(h,o),h=o),h.x>s.x&&(s.x=h.x),h.x<r.x&&(r.x=h.x),h.y>s.y&&(s.y=h.y),h.y<r.y&&(r.y=h.y),h.z>s.z&&(s.z=h.z),h.z<r.z&&(r.z=h.z)}return t&&(t.vadd(r,r),t.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this},i.prototype.copy=function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this},i.prototype.clone=function(){return(new i).copy(this)},i.prototype.extend=function(e){var t=e.lowerBound.x;this.lowerBound.x>t&&(this.lowerBound.x=t);var n=e.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n);var t=e.lowerBound.y;this.lowerBound.y>t&&(this.lowerBound.y=t);var n=e.upperBound.y;this.upperBound.y<n&&(this.upperBound.y=n);var t=e.lowerBound.z;this.lowerBound.z>t&&(this.lowerBound.z=t);var n=e.upperBound.z;this.upperBound.z<n&&(this.upperBound.z=n)},i.prototype.overlaps=function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return(i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x)&&(i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y)&&(i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z)},i.prototype.contains=function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z},i.prototype.getCorners=function(e,t,n,i,r,o,s,a){var l=this.lowerBound,h=this.upperBound;e.copy(l),t.set(h.x,l.y,l.z),n.set(h.x,h.y,l.z),i.set(l.x,h.y,h.z),r.set(h.x,l.y,l.z),o.set(l.x,h.y,l.z),s.set(l.x,l.y,h.z),a.copy(h)};var s=[new r,new r,new r,new r,new r,new r,new r,new r];i.prototype.toLocalFrame=function(e,t){var n=s,i=n[0],r=n[1],o=n[2],a=n[3],l=n[4],h=n[5],u=n[6],c=n[7];this.getCorners(i,r,o,a,l,h,u,c);for(var p=0;8!==p;p++){var d=n[p];e.pointToLocal(d,d)}return t.setFromPoints(n)},i.prototype.toWorldFrame=function(e,t){var n=s,i=n[0],r=n[1],o=n[2],a=n[3],l=n[4],h=n[5],u=n[6],c=n[7];this.getCorners(i,r,o,a,l,h,u,c);for(var p=0;8!==p;p++){var d=n[p];e.pointToWorld(d,d)}return t.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(e,t,n){function i(){this.matrix=[]}t.exports=i,i.prototype.get=function(e,t){if(e=e.index,t=t.index,t>e){var n=t;t=e,e=n}return this.matrix[(e*(e+1)>>1)+t-1]},i.prototype.set=function(e,t,n){if(e=e.index,t=t.index,t>e){var i=t;t=e,e=i}this.matrix[(e*(e+1)>>1)+t-1]=n?1:0},i.prototype.reset=function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0},i.prototype.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1}},{}],5:[function(e,t,n){function i(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}{var r=e("../objects/Body"),o=e("../math/Vec3"),s=e("../math/Quaternion");e("../shapes/Shape"),e("../shapes/Plane")}t.exports=i,i.prototype.collisionPairs=function(e,t,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=r.STATIC|r.KINEMATIC;i.prototype.needBroadphaseCollision=function(e,t){return 0===(e.collisionFilterGroup&t.collisionFilterMask)||0===(t.collisionFilterGroup&e.collisionFilterMask)?!1:0===(e.type&a)&&e.sleepState!==r.SLEEPING||0===(t.type&a)&&t.sleepState!==r.SLEEPING?!0:!1},i.prototype.intersectionTest=function(e,t,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,n,i):this.doBoundingSphereBroadphase(e,t,n,i)};{var l=new o;new o,new s,new o}i.prototype.doBoundingSphereBroadphase=function(e,t,n,i){var r=l;t.position.vsub(e.position,r);var o=Math.pow(e.boundingRadius+t.boundingRadius,2),s=r.norm2();o>s&&(n.push(e),i.push(t))},i.prototype.doBoundingBoxBroadphase=function(e,t,n,i){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(n.push(e),i.push(t))};var h={keys:[]},u=[],c=[];i.prototype.makePairsUnique=function(e,t){for(var n=h,i=u,r=c,o=e.length,s=0;s!==o;s++)i[s]=e[s],r[s]=t[s];e.length=0,t.length=0;for(var s=0;s!==o;s++){var a=i[s].id,l=r[s].id,p=l>a?a+","+l:l+","+a;n[p]=s,n.keys.push(p)}for(var s=0;s!==n.keys.length;s++){var p=n.keys.pop(),d=n[p];e.push(i[d]),t.push(r[d]),delete n[p]}},i.prototype.setWorld=function(e){};var p=new o;i.boundingSphereCheck=function(e,t){var n=p;return e.position.vsub(t.position,n),Math.pow(e.shape.boundingSphereRadius+t.shape.boundingSphereRadius,2)>n.norm2()},i.prototype.aabbQuery=function(e,t,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(e,t,n){function i(e,t,n,i,s){r.apply(this),this.nx=n||10,this.ny=i||10,this.nz=s||10,this.aabbMin=e||new o(100,100,100),this.aabbMax=t||new o(-100,-100,-100);var a=this.nx*this.ny*this.nz;if(0>=a)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(var l=0;a>l;l++)this.bins[l]=[],this.binLengths[l]=0}t.exports=i;var r=e("./Broadphase"),o=e("../math/Vec3"),s=e("../shapes/Shape");i.prototype=new r,i.prototype.constructor=i;{var a=new o;new o}i.prototype.collisionPairs=function(e,t,n){function i(e,t,n,i,r,o,s){var a=(e-x)*w|0,l=(t-b)*S|0,h=(n-_)*M|0,v=N((i-x)*w),y=N((r-b)*S),g=N((o-_)*M);0>a?a=0:a>=u&&(a=u-1),0>l?l=0:l>=c&&(l=c-1),0>h?h=0:h>=p&&(h=p-1),0>v?v=0:v>=u&&(v=u-1),0>y?y=0:y>=c&&(y=c-1),0>g?g=0:g>=p&&(g=p-1),a*=d,l*=f,h*=m,v*=d,y*=f,g*=m;for(var T=a;v>=T;T+=d)for(var E=l;y>=E;E+=f)for(var C=h;g>=C;C+=m){var A=T+E+C;R[A][B[A]++]=s}}for(var r=e.numObjects(),o=e.bodies,l=this.aabbMax,h=this.aabbMin,u=this.nx,c=this.ny,p=this.nz,d=c*p,f=p,m=1,v=l.x,y=l.y,g=l.z,x=h.x,b=h.y,_=h.z,w=u/(v-x),S=c/(y-b),M=p/(g-_),T=(v-x)/u,E=(y-b)/c,C=(g-_)/p,A=.5*Math.sqrt(T*T+E*E+C*C),P=s.types,F=P.SPHERE,L=P.PLANE,R=(P.BOX,P.COMPOUND,P.CONVEXPOLYHEDRON,this.bins),B=this.binLengths,k=this.bins.length,D=0;D!==k;D++)B[D]=0;for(var N=Math.ceil,h=Math.min,l=Math.max,D=0;D!==r;D++){var O=o[D],V=O.shape;switch(V.type){case F:var z=O.position.x,U=O.position.y,I=O.position.z,j=V.radius;i(z-j,U-j,I-j,z+j,U+j,I+j,O);break;case L:V.worldNormalNeedsUpdate&&V.computeWorldNormal(O.quaternion);var G=V.worldNormal,q=x+.5*T-O.position.x,H=b+.5*E-O.position.y,W=_+.5*C-O.position.z,X=a;X.set(q,H,W);for(var Y=0,Q=0;Y!==u;Y++,Q+=d,X.y=H,X.x+=T)for(var K=0,Z=0;K!==c;K++,Z+=f,X.z=W,X.y+=E)for(var $=0,J=0;$!==p;$++,J+=m,X.z+=C)if(X.dot(G)<A){var ee=Q+Z+J;R[ee][B[ee]++]=O}break;default:O.aabbNeedsUpdate&&O.computeAABB(),i(O.aabb.lowerBound.x,O.aabb.lowerBound.y,O.aabb.lowerBound.z,O.aabb.upperBound.x,O.aabb.upperBound.y,O.aabb.upperBound.z,O)}}for(var D=0;D!==k;D++){var te=B[D];if(te>1)for(var ne=R[D],Y=0;Y!==te;Y++)for(var O=ne[Y],K=0;K!==Y;K++){var ie=ne[K];this.needBroadphaseCollision(O,ie)&&this.intersectionTest(O,ie,t,n)}}this.makePairsUnique(t,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(e,t,n){function i(){r.apply(this)}t.exports=i;var r=e("./Broadphase"),o=e("./AABB");i.prototype=new r,i.prototype.constructor=i,i.prototype.collisionPairs=function(e,t,n){var i,r,o,s,a=e.bodies,l=a.length;for(i=0;i!==l;i++)for(r=0;r!==i;r++)o=a[i],s=a[r],this.needBroadphaseCollision(o,s)&&this.intersectionTest(o,s,t,n)};new o;i.prototype.aabbQuery=function(e,t,n){n=n||[];for(var i=0;i<e.bodies.length;i++){var r=e.bodies[i];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(t)&&n.push(r)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(e,t,n){function i(){this.matrix={}}t.exports=i,i.prototype.get=function(e,t){if(e=e.id,t=t.id,t>e){var n=t;t=e,e=n}return e+"-"+t in this.matrix},i.prototype.set=function(e,t,n){if(e=e.id,t=t.id,t>e){var i=t;t=e,e=i}n?this.matrix[e+"-"+t]=!0:delete this.matrix[e+"-"+t]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(e){}},{}],9:[function(e,t,n){function i(e,t){this.from=e?e.clone():new s,this.to=t?t.clone():new s,this._direction=new s,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=i.ANY,this.result=new h,this.hasHit=!1,this.callback=function(e){}}function r(e,t,n,i){i.vsub(t,D),n.vsub(t,f),e.vsub(t,m);var r,o,s=D.dot(D),a=D.dot(f),l=D.dot(m),h=f.dot(f),u=f.dot(m);return(r=h*l-a*u)>=0&&(o=s*u-a*l)>=0&&s*h-a*a>r+o}function o(e,t,n){n.vsub(e,D);var i=D.dot(t);t.mult(i,N),N.vadd(e,N);var r=n.distanceTo(N);return r}t.exports=i;var s=e("../math/Vec3"),a=e("../math/Quaternion"),l=e("../math/Transform"),h=(e("../shapes/ConvexPolyhedron"),e("../shapes/Box"),e("../collision/RaycastResult")),u=e("../shapes/Shape"),c=e("../collision/AABB");i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4;var p=new c,d=[];i.prototype.intersectWorld=function(e,t){return this.mode=t.mode||i.ANY,this.result=t.result||new h,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!=typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!=typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(p),d.length=0,e.broadphase.aabbQuery(e,p,d),this.intersectBodies(d),this.hasHit};var f=new s,m=new s;i.pointInTriangle=r;var v=new s,y=new a;i.prototype.intersectBody=function(e,t){t&&(this.result=t,this._updateDirection());var n=this.checkCollisionResponse;if((!n||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var i=v,r=y,o=0,s=e.shapes.length;s>o;o++){var a=e.shapes[o];if((!n||a.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],r),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(a,r,i,e),this.result._shouldStop))break}},i.prototype.intersectBodies=function(e,t){t&&(this.result=t,this._updateDirection());for(var n=0,i=e.length;!this.result._shouldStop&&i>n;n++)this.intersectBody(e[n])},i.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},i.prototype.intersectShape=function(e,t,n,i){var r=this.from,s=o(r,this._direction,n);if(!(s>e.boundingSphereRadius)){var a=this[e.type];a&&a.call(this,e,t,n,i)}};{var g=(new s,new s,new s),x=new s,b=new s,_=new s;new s,new h}i.prototype.intersectBox=function(e,t,n,i){return this.intersectConvex(e.convexPolyhedronRepresentation,t,n,i)},i.prototype[u.types.BOX]=i.prototype.intersectBox,i.prototype.intersectPlane=function(e,t,n,i){var r=this.from,o=this.to,a=this._direction,l=new s(0,0,1);t.vmult(l,l);var h=new s;r.vsub(n,h);var u=h.dot(l);o.vsub(n,h);var c=h.dot(l);if(!(u*c>0||r.distanceTo(o)<u)){var p=l.dot(a);if(!(Math.abs(p)<this.precision)){var d=new s,f=new s,m=new s;r.vsub(n,d);var v=-l.dot(d)/p;a.scale(v,f),r.vadd(f,m),this.reportIntersection(l,m,e,i,-1)}}},i.prototype[u.types.PLANE]=i.prototype.intersectPlane,i.prototype.getAABB=function(e){var t=this.to,n=this.from;e.lowerBound.x=Math.min(t.x,n.x),e.lowerBound.y=Math.min(t.y,n.y),e.lowerBound.z=Math.min(t.z,n.z),e.upperBound.x=Math.max(t.x,n.x),e.upperBound.y=Math.max(t.y,n.y),e.upperBound.z=Math.max(t.z,n.z)};var w={faceList:[0]};i.prototype.intersectHeightfield=function(e,t,n,r){var o=(e.data,e.elementSize,new s),a=new i(this.from,this.to);l.pointToLocalFrame(n,t,a.from,a.from),l.pointToLocalFrame(n,t,a.to,a.to);var h=[],u=null,c=null,p=null,d=null,f=e.getIndexOfPosition(a.from.x,a.from.y,h,!1);if(f&&(u=h[0],c=h[1],p=h[0],d=h[1]),f=e.getIndexOfPosition(a.to.x,a.to.y,h,!1),f&&((null===u||h[0]<u)&&(u=h[0]),(null===p||h[0]>p)&&(p=h[0]),(null===c||h[1]<c)&&(c=h[1]),(null===d||h[1]>d)&&(d=h[1])),null!==u){var m=[];e.getRectMinMax(u,c,p,d,m);for(var v=(m[0],m[1],u);p>=v;v++)for(var y=c;d>=y;y++){if(this.result._shouldStop)return;if(e.getConvexTrianglePillar(v,y,!1),l.pointToWorldFrame(n,t,e.pillarOffset,o),this.intersectConvex(e.pillarConvex,t,o,r,w),this.result._shouldStop)return;e.getConvexTrianglePillar(v,y,!0),l.pointToWorldFrame(n,t,e.pillarOffset,o),this.intersectConvex(e.pillarConvex,t,o,r,w)}}},i.prototype[u.types.HEIGHTFIELD]=i.prototype.intersectHeightfield;var S=new s,M=new s;i.prototype.intersectSphere=function(e,t,n,i){var r=this.from,o=this.to,s=e.radius,a=Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)+Math.pow(o.z-r.z,2),l=2*((o.x-r.x)*(r.x-n.x)+(o.y-r.y)*(r.y-n.y)+(o.z-r.z)*(r.z-n.z)),h=Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)+Math.pow(r.z-n.z,2)-Math.pow(s,2),u=Math.pow(l,2)-4*a*h,c=S,p=M;if(!(0>u))if(0===u)r.lerp(o,u,c),c.vsub(n,p),p.normalize(),this.reportIntersection(p,c,e,i,-1);else{var d=(-l-Math.sqrt(u))/(2*a),f=(-l+Math.sqrt(u))/(2*a);if(d>=0&&1>=d&&(r.lerp(o,d,c),c.vsub(n,p),p.normalize(),this.reportIntersection(p,c,e,i,-1)),this.result._shouldStop)return;f>=0&&1>=f&&(r.lerp(o,f,c),c.vsub(n,p),p.normalize(),this.reportIntersection(p,c,e,i,-1))}},i.prototype[u.types.SPHERE]=i.prototype.intersectSphere;var T=new s,E=(new s,new s,new s);i.prototype.intersectConvex=function(e,t,n,i,o){for(var s=T,a=E,l=o&&o.faceList||null,h=e.faces,u=e.vertices,c=e.faceNormals,p=this._direction,d=this.from,f=this.to,m=d.distanceTo(f),v=l?l.length:h.length,y=this.result,w=0;!y._shouldStop&&v>w;w++){var S=l?l[w]:w,M=h[S],C=c[S],A=t,P=n;a.copy(u[M[0]]),A.vmult(a,a),a.vadd(P,a),a.vsub(d,a),A.vmult(C,s);var F=p.dot(s);if(!(Math.abs(F)<this.precision)){var L=s.dot(a)/F;if(!(0>L)){p.mult(L,g),g.vadd(d,g),x.copy(u[M[0]]),A.vmult(x,x),P.vadd(x,x);for(var R=1;!y._shouldStop&&R<M.length-1;R++){b.copy(u[M[R]]),_.copy(u[M[R+1]]),A.vmult(b,b),A.vmult(_,_),P.vadd(b,b),P.vadd(_,_);var B=g.distanceTo(d);!r(g,x,b,_)&&!r(g,b,x,_)||B>m||this.reportIntersection(s,g,e,i,S)}}}}},i.prototype[u.types.CONVEXPOLYHEDRON]=i.prototype.intersectConvex;var C=new s,A=new s,P=new s,F=new s,L=new s,R=new s,B=(new c,[]),k=new l;i.prototype.intersectTrimesh=function(e,t,n,i,o){var s=C,a=B,h=k,u=E,c=A,p=P,d=F,f=R,m=L,v=(o&&o.faceList||null,e.indices),y=(e.vertices,e.faceNormals,this.from),w=this.to,S=this._direction;h.position.copy(n),h.quaternion.copy(t),l.vectorToLocalFrame(n,t,S,c),l.pointToLocalFrame(n,t,y,p),l.pointToLocalFrame(n,t,w,d);var M=p.distanceSquared(d);e.tree.rayQuery(this,h,a);for(var T=0,D=a.length;!this.result._shouldStop&&T!==D;T++){var N=a[T];e.getNormal(N,s),e.getVertex(v[3*N],x),x.vsub(p,u);var O=c.dot(s),V=s.dot(u)/O;if(!(0>V)){c.scale(V,g),g.vadd(p,g),e.getVertex(v[3*N+1],b),e.getVertex(v[3*N+2],_);var z=g.distanceSquared(p);!r(g,b,x,_)&&!r(g,x,b,_)||z>M||(l.vectorToWorldFrame(t,s,m),l.pointToWorldFrame(n,t,g,f),this.reportIntersection(m,f,e,i,N))}}a.length=0},i.prototype[u.types.TRIMESH]=i.prototype.intersectTrimesh,i.prototype.reportIntersection=function(e,t,n,r,o){var s=this.from,a=this.to,l=s.distanceTo(t),h=this.result;if(!(this.skipBackfaces&&e.dot(this._direction)>0))switch(h.hitFaceIndex="undefined"!=typeof o?o:-1,this.mode){case i.ALL:this.hasHit=!0,h.set(s,a,e,t,n,r,l),h.hasHit=!0,this.callback(h);break;case i.CLOSEST:(l<h.distance||!h.hasHit)&&(this.hasHit=!0,h.hasHit=!0,h.set(s,a,e,t,n,r,l));break;case i.ANY:this.hasHit=!0,h.hasHit=!0,h.set(s,a,e,t,n,r,l),h._shouldStop=!0}};var D=new s,N=new s},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(e,t,n){function i(){this.rayFromWorld=new r,this.rayToWorld=new r,this.hitNormalWorld=new r,this.hitPointWorld=new r,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var r=e("../math/Vec3");t.exports=i,i.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},i.prototype.abort=function(){this._shouldStop=!0},i.prototype.set=function(e,t,n,i,r,o,s){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=o,this.distance=s}},{"../math/Vec3":30}],11:[function(e,t,n){function i(e){r.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){var n=t.indexOf(e.body);-1!==n&&t.splice(n,1)},e&&this.setWorld(e)}var r=(e("../shapes/Shape"),e("../collision/Broadphase"));t.exports=i,i.prototype=new r,i.prototype.setWorld=function(e){this.axisList.length=0;for(var t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0},i.insertionSortX=function(e){for(var t=1,n=e.length;n>t;t++){for(var i=e[t],r=t-1;r>=0&&!(e[r].aabb.lowerBound.x<=i.aabb.lowerBound.x);r--)e[r+1]=e[r];e[r+1]=i}return e},i.insertionSortY=function(e){for(var t=1,n=e.length;n>t;t++){for(var i=e[t],r=t-1;r>=0&&!(e[r].aabb.lowerBound.y<=i.aabb.lowerBound.y);r--)e[r+1]=e[r];e[r+1]=i}return e},i.insertionSortZ=function(e){for(var t=1,n=e.length;n>t;t++){for(var i=e[t],r=t-1;r>=0&&!(e[r].aabb.lowerBound.z<=i.aabb.lowerBound.z);r--)e[r+1]=e[r];e[r+1]=i}return e},i.prototype.collisionPairs=function(e,t,n){var r,o,s=this.axisList,a=s.length,l=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),r=0;r!==a;r++){var h=s[r];for(o=r+1;a>o;o++){var u=s[o];if(this.needBroadphaseCollision(h,u)){if(!i.checkBounds(h,u,l))break;this.intersectionTest(h,u,t,n)}}}},i.prototype.sortList=function(){for(var e=this.axisList,t=this.axisIndex,n=e.length,r=0;r!==n;r++){var o=e[r];o.aabbNeedsUpdate&&o.computeAABB()}0===t?i.insertionSortX(e):1===t?i.insertionSortY(e):2===t&&i.insertionSortZ(e)},i.checkBounds=function(e,t,n){var i,r;0===n?(i=e.position.x,r=t.position.x):1===n?(i=e.position.y,r=t.position.y):2===n&&(i=e.position.z,r=t.position.z);var o=e.boundingRadius,s=t.boundingRadius,a=i+o,l=r-s;return a>l},i.prototype.autoDetectAxis=function(){for(var e=0,t=0,n=0,i=0,r=0,o=0,s=this.axisList,a=s.length,l=1/a,h=0;h!==a;h++){var u=s[h],c=u.position.x;e+=c,t+=c*c;var p=u.position.y;n+=p,i+=p*p;var d=u.position.z;r+=d,o+=d*d}var f=t-e*e*l,m=i-n*n*l,v=o-r*r*l;this.axisIndex=f>m?f>v?0:2:m>v?1:2},i.prototype.aabbQuery=function(e,t,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);var i=this.axisIndex,r="x";1===i&&(r="y"),2===i&&(r="z");for(var o=this.axisList,s=(t.lowerBound[r],t.upperBound[r],0);s<o.length;s++){var a=o[s];a.aabbNeedsUpdate&&a.computeAABB(),a.aabb.overlaps(t)&&n.push(a)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(e,t,n){function i(e,t,n){n=n||{};var i="undefined"!=typeof n.maxForce?n.maxForce:1e6,l=n.pivotA?n.pivotA.clone():new a,h=n.pivotB?n.pivotB.clone():new a;this.axisA=n.axisA?n.axisA.clone():new a,this.axisB=n.axisB?n.axisB.clone():new a,r.call(this,e,l,t,h,i),this.collideConnected=!!n.collideConnected,this.angle="undefined"!=typeof n.angle?n.angle:0;var u=this.coneEquation=new o(e,t,n),c=this.twistEquation=new s(e,t,n);this.twistAngle="undefined"!=typeof n.twistAngle?n.twistAngle:0,u.maxForce=0,u.minForce=-i,c.maxForce=0,c.minForce=-i,this.equations.push(u,c)}t.exports=i;var r=(e("./Constraint"),e("./PointToPointConstraint")),o=e("../equations/ConeEquation"),s=e("../equations/RotationalEquation"),a=(e("../equations/ContactEquation"),e("../math/Vec3"));i.prototype=new r,i.constructor=i;new a,new a;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.coneEquation,i=this.twistEquation;r.prototype.update.call(this),e.vectorToWorldFrame(this.axisA,n.axisA),t.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(i.axisA,i.axisA),e.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),t.vectorToWorldFrame(i.axisB,i.axisB),n.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(e,t,n){function i(e,t,n){n=r.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=i.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}t.exports=i;var r=e("../utils/Utils");i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.prototype.enable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0},i.prototype.disable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1},i.idCounter=0},{"../utils/Utils":53}],14:[function(e,t,n){function i(e,t,n,i){r.call(this,e,t),"undefined"==typeof n&&(n=e.position.distanceTo(t.position)),"undefined"==typeof i&&(i=1e6),this.distance=n;var s=this.distanceEquation=new o(e,t);this.equations.push(s),s.minForce=-i,s.maxForce=i}t.exports=i;var r=e("./Constraint"),o=e("../equations/ContactEquation");i.prototype=new r,i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.distanceEquation,i=.5*this.distance,r=n.ni;t.position.vsub(e.position,r),r.normalize(),r.mult(i,n.ri),r.mult(-i,n.rj)}},{"../equations/ContactEquation":19,
"./Constraint":13}],15:[function(e,t,n){function i(e,t,n){n=n||{};var i="undefined"!=typeof n.maxForce?n.maxForce:1e6,l=n.pivotA?n.pivotA.clone():new a,h=n.pivotB?n.pivotB.clone():new a;r.call(this,e,l,t,h,i);var u=this.axisA=n.axisA?n.axisA.clone():new a(1,0,0);u.normalize();var c=this.axisB=n.axisB?n.axisB.clone():new a(1,0,0);c.normalize();var p=this.rotationalEquation1=new o(e,t,n),d=this.rotationalEquation2=new o(e,t,n),f=this.motorEquation=new s(e,t,i);f.enabled=!1,this.equations.push(p,d,f)}t.exports=i;var r=(e("./Constraint"),e("./PointToPointConstraint")),o=e("../equations/RotationalEquation"),s=e("../equations/RotationalMotorEquation"),a=(e("../equations/ContactEquation"),e("../math/Vec3"));i.prototype=new r,i.constructor=i,i.prototype.enableMotor=function(){this.motorEquation.enabled=!0},i.prototype.disableMotor=function(){this.motorEquation.enabled=!1},i.prototype.setMotorSpeed=function(e){this.motorEquation.targetVelocity=e},i.prototype.setMotorMaxForce=function(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e};var l=new a,h=new a;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.motorEquation,i=this.rotationalEquation1,o=this.rotationalEquation2,s=l,a=h,u=this.axisA,c=this.axisB;r.prototype.update.call(this),e.quaternion.vmult(u,s),t.quaternion.vmult(c,a),s.tangents(i.axisA,o.axisA),i.axisB.copy(a),o.axisB.copy(a),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,n.axisA),t.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(e,t,n){function i(e,t,n){n=n||{};var i="undefined"!=typeof n.maxForce?n.maxForce:1e6,a=new s,l=new s,h=new s;e.position.vadd(t.position,h),h.scale(.5,h),t.pointToLocalFrame(h,l),e.pointToLocalFrame(h,a),r.call(this,e,a,t,l,i);var u=this.rotationalEquation1=new o(e,t,n),c=this.rotationalEquation2=new o(e,t,n),p=this.rotationalEquation3=new o(e,t,n);this.equations.push(u,c,p)}t.exports=i;var r=(e("./Constraint"),e("./PointToPointConstraint")),o=e("../equations/RotationalEquation"),s=(e("../equations/RotationalMotorEquation"),e("../equations/ContactEquation"),e("../math/Vec3"));i.prototype=new r,i.constructor=i;new s,new s;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,o=this.rotationalEquation3;r.prototype.update.call(this),e.vectorToWorldFrame(s.UNIT_X,n.axisA),t.vectorToWorldFrame(s.UNIT_Y,n.axisB),e.vectorToWorldFrame(s.UNIT_Y,i.axisA),t.vectorToWorldFrame(s.UNIT_Z,i.axisB),e.vectorToWorldFrame(s.UNIT_Z,o.axisA),t.vectorToWorldFrame(s.UNIT_X,o.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(e,t,n){function i(e,t,n,i,a){r.call(this,e,n),a="undefined"!=typeof a?a:1e6,this.pivotA=t?t.clone():new s,this.pivotB=i?i.clone():new s;var l=this.equationX=new o(e,n),h=this.equationY=new o(e,n),u=this.equationZ=new o(e,n);this.equations.push(l,h,u),l.minForce=h.minForce=u.minForce=-a,l.maxForce=h.maxForce=u.maxForce=a,l.ni.set(1,0,0),h.ni.set(0,1,0),u.ni.set(0,0,1)}t.exports=i;var r=e("./Constraint"),o=e("../equations/ContactEquation"),s=e("../math/Vec3");i.prototype=new r,i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;e.quaternion.vmult(this.pivotA,n.ri),t.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(e,t,n){function i(e,t,n){n=n||{};var i="undefined"!=typeof n.maxForce?n.maxForce:1e6;o.call(this,e,t,-i,i),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.angle="undefined"!=typeof n.angle?n.angle:0}t.exports=i;var r=e("../math/Vec3"),o=(e("../math/Mat3"),e("./Equation"));i.prototype=new o,i.prototype.constructor=i;var s=new r,a=new r;i.prototype.computeB=function(e){var t=this.a,n=this.b,i=this.axisA,r=this.axisB,o=s,l=a,h=this.jacobianElementA,u=this.jacobianElementB;i.cross(r,o),r.cross(i,l),h.rotational.copy(l),u.rotational.copy(o);var c=Math.cos(this.angle)-i.dot(r),p=this.computeGW(),d=this.computeGiMf(),f=-c*t-p*n-e*d;return f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(e,t,n){function i(e,t,n){n="undefined"!=typeof n?n:1e6,r.call(this,e,t,0,n),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}t.exports=i;{var r=e("./Equation"),o=e("../math/Vec3");e("../math/Mat3")}i.prototype=new r,i.prototype.constructor=i;var s=new o,a=new o,l=new o;i.prototype.computeB=function(e){var t=this.a,n=this.b,i=this.bi,r=this.bj,o=this.ri,h=this.rj,u=s,c=a,p=i.velocity,d=i.angularVelocity,f=(i.force,i.torque,r.velocity),m=r.angularVelocity,v=(r.force,r.torque,l),y=this.jacobianElementA,g=this.jacobianElementB,x=this.ni;o.cross(x,u),h.cross(x,c),x.negate(y.spatial),u.negate(y.rotational),g.spatial.copy(x),g.rotational.copy(c),v.copy(r.position),v.vadd(h,v),v.vsub(i.position,v),v.vsub(o,v);var b=x.dot(v),_=this.restitution+1,w=_*f.dot(x)-_*p.dot(x)+m.dot(c)-d.dot(u),S=this.computeGiMf(),M=-b*t-w*n-e*S;return M};var h=new o,u=new o,c=new o,p=new o,d=new o;i.prototype.getImpactVelocityAlongNormal=function(){var e=h,t=u,n=c,i=p,r=d;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,e),this.bj.getVelocityAtWorldPoint(i,t),e.vsub(t,r),this.ni.dot(r)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(e,t,n){function i(e,t,n,o){this.id=i.id++,this.minForce="undefined"==typeof n?-1e6:n,this.maxForce="undefined"==typeof o?1e6:o,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}t.exports=i;var r=e("../math/JacobianElement"),o=e("../math/Vec3");i.prototype.constructor=i,i.id=0,i.prototype.setSpookParams=function(e,t,n){var i=t,r=e,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*r*(1+4*i))},i.prototype.computeB=function(e,t,n){var i=this.computeGW(),r=this.computeGq(),o=this.computeGiMf();return-r*e-i*t-o*n},i.prototype.computeGq=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,o=i.position;return e.spatial.dot(r)+t.spatial.dot(o)};var s=new o;i.prototype.computeGW=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,o=i.velocity,a=n.angularVelocity||s,l=i.angularVelocity||s;return e.multiplyVectors(r,a)+t.multiplyVectors(o,l)},i.prototype.computeGWlambda=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,o=i.vlambda,a=n.wlambda||s,l=i.wlambda||s;return e.multiplyVectors(r,a)+t.multiplyVectors(o,l)};var a=new o,l=new o,h=new o,u=new o;i.prototype.computeGiMf=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,o=n.torque,s=i.force,c=i.torque,p=n.invMassSolve,d=i.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(o,h):h.set(0,0,0),i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(c,u):u.set(0,0,0),r.mult(p,a),s.mult(d,l),e.multiplyVectors(a,h)+t.multiplyVectors(l,u)};var c=new o;i.prototype.computeGiMGt=function(){var e=this.jacobianElementA,t=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,o=i.invMassSolve,s=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve,l=r+o;return s&&(s.vmult(e.rotational,c),l+=c.dot(e.rotational)),a&&(a.vmult(t.rotational,c),l+=c.dot(t.rotational)),l};{var p=new o;new o,new o,new o,new o,new o}i.prototype.addToWlambda=function(e){var t=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,o=p;t.spatial.mult(i.invMassSolve*e,o),i.vlambda.vadd(o,i.vlambda),n.spatial.mult(r.invMassSolve*e,o),r.vlambda.vadd(o,r.vlambda),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(t.rotational,o),o.mult(e,o),i.wlambda.vadd(o,i.wlambda)),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(n.rotational,o),o.mult(e,o),r.wlambda.vadd(o,r.wlambda))},i.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(e,t,n){function i(e,t,n){r.call(this,e,t,-n,n),this.ri=new o,this.rj=new o,this.t=new o}t.exports=i;{var r=e("./Equation"),o=e("../math/Vec3");e("../math/Mat3")}i.prototype=new r,i.prototype.constructor=i;var s=new o,a=new o;i.prototype.computeB=function(e){var t=(this.a,this.b),n=(this.bi,this.bj,this.ri),i=this.rj,r=s,o=a,l=this.t;n.cross(l,r),i.cross(l,o);var h=this.jacobianElementA,u=this.jacobianElementB;l.negate(h.spatial),r.negate(h.rotational),u.spatial.copy(l),u.rotational.copy(o);var c=this.computeGW(),p=this.computeGiMf(),d=-c*t-e*p;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(e,t,n){function i(e,t,n){n=n||{};var i="undefined"!=typeof n.maxForce?n.maxForce:1e6;o.call(this,e,t,-i,i),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}t.exports=i;var r=e("../math/Vec3"),o=(e("../math/Mat3"),e("./Equation"));i.prototype=new o,i.prototype.constructor=i;var s=new r,a=new r;i.prototype.computeB=function(e){var t=this.a,n=this.b,i=this.axisA,r=this.axisB,o=s,l=a,h=this.jacobianElementA,u=this.jacobianElementB;i.cross(r,o),r.cross(i,l),h.rotational.copy(l),u.rotational.copy(o);var c=Math.cos(this.maxAngle)-i.dot(r),p=this.computeGW(),d=this.computeGiMf(),f=-c*t-p*n-e*d;return f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(e,t,n){function i(e,t,n){n="undefined"!=typeof n?n:1e6,o.call(this,e,t,-n,n),this.axisA=new r,this.axisB=new r,this.targetVelocity=0}t.exports=i;var r=e("../math/Vec3"),o=(e("../math/Mat3"),e("./Equation"));i.prototype=new o,i.prototype.constructor=i,i.prototype.computeB=function(e){var t=(this.a,this.b),n=(this.bi,this.bj,this.axisA),i=this.axisB,r=this.jacobianElementA,o=this.jacobianElementB;r.rotational.copy(n),i.negate(o.rotational);var s=this.computeGW()-this.targetVelocity,a=this.computeGiMf(),l=-s*t-e*a;return l}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(e,t,n){function i(e,t,n){n=r.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=i.idCounter++,this.materials=[e,t],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}var r=e("../utils/Utils");t.exports=i,i.idCounter=0},{"../utils/Utils":53}],25:[function(e,t,n){function i(e){var t="";e=e||{},"string"==typeof e?(t=e,e={}):"object"==typeof e&&(t=""),this.name=t,this.id=i.idCounter++,this.friction="undefined"!=typeof e.friction?e.friction:-1,this.restitution="undefined"!=typeof e.restitution?e.restitution:-1}t.exports=i,i.idCounter=0},{}],26:[function(e,t,n){function i(){this.spatial=new r,this.rotational=new r}t.exports=i;var r=e("./Vec3");i.prototype.multiplyElement=function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)},i.prototype.multiplyVectors=function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},{"./Vec3":30}],27:[function(e,t,n){function i(e){this.elements=e?e:[0,0,0,0,0,0,0,0,0]}t.exports=i;var r=e("./Vec3");i.prototype.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},i.prototype.setZero=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0},i.prototype.setTrace=function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z},i.prototype.getTrace=function(e){var e=e||new r,t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]},i.prototype.vmult=function(e,t){t=t||new r;var n=this.elements,i=e.x,o=e.y,s=e.z;return t.x=n[0]*i+n[1]*o+n[2]*s,t.y=n[3]*i+n[4]*o+n[5]*s,t.z=n[6]*i+n[7]*o+n[8]*s,t},i.prototype.smult=function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e},i.prototype.mmult=function(e,t){for(var n=t||new i,r=0;3>r;r++)for(var o=0;3>o;o++){for(var s=0,a=0;3>a;a++)s+=e.elements[r+3*a]*this.elements[a+3*o];n.elements[r+3*o]=s}return n},i.prototype.scale=function(e,t){t=t||new i;for(var n=this.elements,r=t.elements,o=0;3!==o;o++)r[3*o+0]=e.x*n[3*o+0],r[3*o+1]=e.y*n[3*o+1],r[3*o+2]=e.z*n[3*o+2];return t},i.prototype.solve=function(e,t){t=t||new r;for(var n=3,i=4,o=[],s=0;n*i>s;s++)o.push(0);var s,a;for(s=0;3>s;s++)for(a=0;3>a;a++)o[s+i*a]=this.elements[s+3*a];o[3]=e.x,o[7]=e.y,o[11]=e.z;var l,h,u=3,c=u,p=4;do{if(s=c-u,0===o[s+i*s])for(a=s+1;c>a;a++)if(0!==o[s+i*a]){l=p;do h=p-l,o[h+i*s]+=o[h+i*a];while(--l);break}if(0!==o[s+i*s])for(a=s+1;c>a;a++){var d=o[s+i*a]/o[s+i*s];l=p;do h=p-l,o[h+i*a]=s>=h?0:o[h+i*a]-o[h+i*s]*d;while(--l)}}while(--u);if(t.z=o[2*i+3]/o[2*i+2],t.y=(o[1*i+3]-o[1*i+2]*t.z)/o[1*i+1],t.x=(o[0*i+3]-o[0*i+2]*t.z-o[0*i+1]*t.y)/o[0*i+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t},i.prototype.e=function(e,t,n){return void 0===n?this.elements[t+3*e]:void(this.elements[t+3*e]=n)},i.prototype.copy=function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this},i.prototype.toString=function(){for(var e="",t=",",n=0;9>n;n++)e+=this.elements[n]+t;return e},i.prototype.reverse=function(e){e=e||new i;for(var t=3,n=6,r=[],o=0;t*n>o;o++)r.push(0);var o,s;for(o=0;3>o;o++)for(s=0;3>s;s++)r[o+n*s]=this.elements[o+3*s];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;var a,l,h=3,u=h,c=n;do{if(o=u-h,0===r[o+n*o])for(s=o+1;u>s;s++)if(0!==r[o+n*s]){a=c;do l=c-a,r[l+n*o]+=r[l+n*s];while(--a);break}if(0!==r[o+n*o])for(s=o+1;u>s;s++){var p=r[o+n*s]/r[o+n*o];a=c;do l=c-a,r[l+n*s]=o>=l?0:r[l+n*s]-r[l+n*o]*p;while(--a)}}while(--h);o=2;do{s=o-1;do{var p=r[o+n*s]/r[o+n*o];a=n;do l=n-a,r[l+n*s]=r[l+n*s]-r[l+n*o]*p;while(--a)}while(s--)}while(--o);o=2;do{var p=1/r[o+n*o];a=n;do l=n-a,r[l+n*o]=r[l+n*o]*p;while(--a)}while(o--);o=2;do{s=2;do{if(l=r[t+s+n*o],isNaN(l)||l===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(o,s,l)}while(s--)}while(o--);return e},i.prototype.setRotationFromQuaternion=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,s=n+n,a=i+i,l=t*o,h=t*s,u=t*a,c=n*s,p=n*a,d=i*a,f=r*o,m=r*s,v=r*a,y=this.elements;return y[0]=1-(c+d),y[1]=h-v,y[2]=u+m,y[3]=h+v,y[4]=1-(l+d),y[5]=p-f,y[6]=u-m,y[7]=p+f,y[8]=1-(l+c),this},i.prototype.transpose=function(e){e=e||new i;for(var t=e.elements,n=this.elements,r=0;3!==r;r++)for(var o=0;3!==o;o++)t[3*r+o]=n[3*o+r];return e}},{"./Vec3":30}],28:[function(e,t,n){function i(e,t,n,i){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==n?n:0,this.w=void 0!==i?i:1}t.exports=i;var r=e("./Vec3");i.prototype.set=function(e,t,n,i){this.x=e,this.y=t,this.z=n,this.w=i},i.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},i.prototype.setFromAxisAngle=function(e,t){var n=Math.sin(.5*t);this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t)},i.prototype.toAxisAngle=function(e){e=e||new r,this.normalize();var t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return.001>n?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]};var o=new r,s=new r;i.prototype.setFromVectors=function(e,t){if(e.isAntiparallelTo(t)){var n=o,i=s;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{var r=e.cross(t);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(Math.pow(e.norm(),2)*Math.pow(t.norm(),2))+e.dot(t),this.normalize()}};var a=new r,l=new r,h=new r;i.prototype.mult=function(e,t){t=t||new i;var n=this.w,r=a,o=l,s=h;return r.set(this.x,this.y,this.z),o.set(e.x,e.y,e.z),t.w=n*e.w-r.dot(o),r.cross(o,s),t.x=n*o.x+e.w*r.x+s.x,t.y=n*o.y+e.w*r.y+s.y,t.z=n*o.z+e.w*r.z+s.z,t},i.prototype.inverse=function(e){var t=this.x,n=this.y,r=this.z,o=this.w;e=e||new i,this.conjugate(e);var s=1/(t*t+n*n+r*r+o*o);return e.x*=s,e.y*=s,e.z*=s,e.w*=s,e},i.prototype.conjugate=function(e){return e=e||new i,e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},i.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e)},i.prototype.normalizeFast=function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e)},i.prototype.vmult=function(e,t){t=t||new r;var n=e.x,i=e.y,o=e.z,s=this.x,a=this.y,l=this.z,h=this.w,u=h*n+a*o-l*i,c=h*i+l*n-s*o,p=h*o+s*i-a*n,d=-s*n-a*i-l*o;return t.x=u*h+d*-s+c*-l-p*-a,t.y=c*h+d*-a+p*-s-u*-l,t.z=p*h+d*-l+u*-a-c*-s,t},i.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},i.prototype.toEuler=function(e,t){t=t||"YZX";var n,i,r,o=this.x,s=this.y,a=this.z,l=this.w;switch(t){case"YZX":var h=o*s+a*l;if(h>.499&&(n=2*Math.atan2(o,l),i=Math.PI/2,r=0),-.499>h&&(n=-2*Math.atan2(o,l),i=-Math.PI/2,r=0),isNaN(n)){var u=o*o,c=s*s,p=a*a;n=Math.atan2(2*s*l-2*o*a,1-2*c-2*p),i=Math.asin(2*h),r=Math.atan2(2*o*l-2*s*a,1-2*u-2*p)}break;default:throw new Error("Euler order "+t+" not supported yet.")}e.y=n,e.z=i,e.x=r},i.prototype.setFromEuler=function(e,t,n,i){i=i||"XYZ";var r=Math.cos(e/2),o=Math.cos(t/2),s=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),h=Math.sin(n/2);return"XYZ"===i?(this.x=a*o*s+r*l*h,this.y=r*l*s-a*o*h,this.z=r*o*h+a*l*s,this.w=r*o*s-a*l*h):"YXZ"===i?(this.x=a*o*s+r*l*h,this.y=r*l*s-a*o*h,this.z=r*o*h-a*l*s,this.w=r*o*s+a*l*h):"ZXY"===i?(this.x=a*o*s-r*l*h,this.y=r*l*s+a*o*h,this.z=r*o*h+a*l*s,this.w=r*o*s-a*l*h):"ZYX"===i?(this.x=a*o*s-r*l*h,this.y=r*l*s+a*o*h,this.z=r*o*h-a*l*s,this.w=r*o*s+a*l*h):"YZX"===i?(this.x=a*o*s+r*l*h,this.y=r*l*s+a*o*h,this.z=r*o*h-a*l*s,this.w=r*o*s-a*l*h):"XZY"===i&&(this.x=a*o*s-r*l*h,this.y=r*l*s-a*o*h,this.z=r*o*h+a*l*s,this.w=r*o*s+a*l*h),this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(e,t,n){function i(e){e=e||{},this.position=new r,e.position&&this.position.copy(e.position),this.quaternion=new o,e.quaternion&&this.quaternion.copy(e.quaternion)}var r=e("./Vec3"),o=e("./Quaternion");t.exports=i;var s=new o;i.pointToLocalFrame=function(e,t,n,i){var i=i||new r;return n.vsub(e,i),t.conjugate(s),s.vmult(i,i),i},i.prototype.pointToLocal=function(e,t){return i.pointToLocalFrame(this.position,this.quaternion,e,t)},i.pointToWorldFrame=function(e,t,n,i){var i=i||new r;return t.vmult(n,i),i.vadd(e,i),i},i.prototype.pointToWorld=function(e,t){return i.pointToWorldFrame(this.position,this.quaternion,e,t)},i.prototype.vectorToWorldFrame=function(e,t){var t=t||new r;return this.quaternion.vmult(e,t),t},i.vectorToWorldFrame=function(e,t,n){return e.vmult(t,n),n},i.vectorToLocalFrame=function(e,t,n,i){var i=i||new r;return t.w*=-1,t.vmult(n,i),t.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(e,t,n){function i(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}t.exports=i;var r=e("./Mat3");i.ZERO=new i(0,0,0),i.UNIT_X=new i(1,0,0),i.UNIT_Y=new i(0,1,0),i.UNIT_Z=new i(0,0,1),i.prototype.cross=function(e,t){var n=e.x,r=e.y,o=e.z,s=this.x,a=this.y,l=this.z;return t=t||new i,t.x=a*o-l*r,t.y=l*n-s*o,t.z=s*r-a*n,t},i.prototype.set=function(e,t,n){return this.x=e,this.y=t,this.z=n,this},i.prototype.setZero=function(){this.x=this.y=this.z=0},i.prototype.vadd=function(e,t){return t?(t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z,void 0):new i(this.x+e.x,this.y+e.y,this.z+e.z)},i.prototype.vsub=function(e,t){return t?(t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,void 0):new i(this.x-e.x,this.y-e.y,this.z-e.z)},i.prototype.crossmat=function(){return new r([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},i.prototype.normalize=function(){var e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){var r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i},i.prototype.unit=function(e){e=e||new i;var t=this.x,n=this.y,r=this.z,o=Math.sqrt(t*t+n*n+r*r);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=r*o):(e.x=1,e.y=0,e.z=0),e},i.prototype.norm=function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)},i.prototype.length=i.prototype.norm,i.prototype.norm2=function(){return this.dot(this)},i.prototype.lengthSquared=i.prototype.norm2,i.prototype.distanceTo=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z;return Math.sqrt((r-t)*(r-t)+(o-n)*(o-n)+(s-i)*(s-i))},i.prototype.distanceSquared=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z;return(r-t)*(r-t)+(o-n)*(o-n)+(s-i)*(s-i)},i.prototype.mult=function(e,t){t=t||new i;var n=this.x,r=this.y,o=this.z;return t.x=e*n,t.y=e*r,t.z=e*o,t},i.prototype.scale=i.prototype.mult,i.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},i.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},i.prototype.negate=function(e){return e=e||new i,e.x=-this.x,e.y=-this.y,e.z=-this.z,e};var o=new i,s=new i;i.prototype.tangents=function(e,t){var n=this.norm();if(n>0){var i=o,r=1/n;i.set(this.x*r,this.y*r,this.z*r);var a=s;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,e)):(a.set(0,1,0),i.cross(a,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)},i.prototype.toString=function(){return this.x+","+this.y+","+this.z},i.prototype.toArray=function(){return[this.x,this.y,this.z]},i.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},i.prototype.lerp=function(e,t,n){var i=this.x,r=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=o+(e.z-o)*t},i.prototype.almostEquals=function(e,t){return void 0===t&&(t=1e-6),Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t?!1:!0},i.prototype.almostZero=function(e){return void 0===e&&(e=1e-6),Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e?!1:!0};var a=new i;i.prototype.isAntiparallelTo=function(e,t){return this.negate(a),a.almostEquals(e,t)},i.prototype.clone=function(){return new i(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(e,t,n){function i(e){e=e||{},r.apply(this),this.id=i.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new o,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:1,this.collisionResponse=!0,this.position=new o,e.position&&this.position.copy(e.position),this.previousPosition=new o,this.initPosition=new o,this.velocity=new o,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new o,this.force=new o;var t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=0>=t?i.STATIC:i.DYNAMIC,typeof e.type==typeof i.STATIC&&(this.type=e.type),this.allowSleep="undefined"!=typeof e.allowSleep?e.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit="undefined"!=typeof e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit="undefined"!=typeof e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new a,e.quaternion&&this.quaternion.copy(e.quaternion),this.initQuaternion=new a,this.angularVelocity=new o,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new o,this.interpolatedPosition=new o,this.interpolatedQuaternion=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new s,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new s,this.fixedRotation="undefined"!=typeof e.fixedRotation?e.fixedRotation:!1,this.angularDamping="undefined"!=typeof e.angularDamping?e.angularDamping:.01,this.aabb=new l,this.aabbNeedsUpdate=!0,this.wlambda=new o,e.shape&&this.addShape(e.shape),this.updateMassProperties()}t.exports=i;var r=e("../utils/EventTarget"),o=(e("../shapes/Shape"),e("../math/Vec3")),s=e("../math/Mat3"),a=e("../math/Quaternion"),l=(e("../material/Material"),e("../collision/AABB")),h=e("../shapes/Box");i.prototype=new r,i.prototype.constructor=i,i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4,i.AWAKE=0,i.SLEEPY=1,i.SLEEPING=2,i.idCounter=0,i.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=0,e===i.SLEEPING&&this.dispatchEvent({type:"wakeup"})},i.prototype.sleep=function(){this.sleepState=i.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},i.sleepyEvent={type:"sleepy"},i.sleepEvent={type:"sleep"},i.prototype.sleepTick=function(e){if(this.allowSleep){var t=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),r=Math.pow(this.sleepSpeedLimit,2);t===i.AWAKE&&r>n?(this.sleepState=i.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(i.sleepyEvent)):t===i.SLEEPY&&n>r?this.wakeUp():t===i.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(i.sleepEvent))}},i.prototype.updateSolveMassProperties=function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},i.prototype.pointToLocalFrame=function(e,t){var t=t||new o;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t},i.prototype.vectorToLocalFrame=function(e,t){var t=t||new o;return this.quaternion.conjugate().vmult(e,t),t},i.prototype.pointToWorldFrame=function(e,t){var t=t||new o;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t},i.prototype.vectorToWorldFrame=function(e,t){var t=t||new o;return this.quaternion.vmult(e,t),t};var u=new o,c=new a;i.prototype.addShape=function(e,t,n){var i=new o,r=new a;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},i.prototype.updateBoundingRadius=function(){for(var e=this.shapes,t=this.shapeOffsets,n=e.length,i=0,r=0;r!==n;r++){var o=e[r];o.updateBoundingSphereRadius();var s=t[r].norm(),a=o.boundingSphereRadius;s+a>i&&(i=s+a)}this.boundingRadius=i};var p=new l;i.prototype.computeAABB=function(){for(var e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=u,o=c,s=this.quaternion,a=this.aabb,l=p,h=0;h!==i;h++){var d=e[h];n[h].mult(s,o),o.vmult(t[h],r),r.vadd(this.position,r),d.calculateWorldAABB(r,o,l.lowerBound,l.upperBound),0===h?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1};{var d=new s,f=new s;new s}i.prototype.updateInertiaWorld=function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var n=d,i=f;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}else;};var m=new o,v=new o;i.prototype.applyForce=function(e,t){if(this.type===i.DYNAMIC){var n=m;t.vsub(this.position,n);var r=v;n.cross(e,r),this.force.vadd(e,this.force),this.torque.vadd(r,this.torque)}};var y=new o,g=new o;i.prototype.applyLocalForce=function(e,t){if(this.type===i.DYNAMIC){var n=y,r=g;this.vectorToWorldFrame(e,n),this.pointToWorldFrame(t,r),this.applyForce(n,r)}};var x=new o,b=new o,_=new o;i.prototype.applyImpulse=function(e,t){if(this.type===i.DYNAMIC){var n=x;t.vsub(this.position,n);var r=b;r.copy(e),r.mult(this.invMass,r),this.velocity.vadd(r,this.velocity);var o=_;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}};var w=new o,S=new o;i.prototype.applyLocalImpulse=function(e,t){if(this.type===i.DYNAMIC){var n=w,r=S;this.vectorToWorldFrame(e,n),this.pointToWorldFrame(t,r),this.applyImpulse(n,r)}};var M=new o;i.prototype.updateMassProperties=function(){var e=M;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,n=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),h.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)},i.prototype.getVelocityAtWorldPoint=function(e,t){var n=new o;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(e,t,n){function i(e){this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis="undefined"!=typeof e.indexRightAxis?e.indexRightAxis:1,this.indexForwardAxis="undefined"!=typeof e.indexForwardAxis?e.indexForwardAxis:0,this.indexUpAxis="undefined"!=typeof e.indexUpAxis?e.indexUpAxis:2}function r(e,t,n,i,r){var s=0,a=n,l=_,h=w,u=S;e.getVelocityAtWorldPoint(a,l),t.getVelocityAtWorldPoint(a,h),l.vsub(h,u);var c=i.dot(u),p=o(e,n,i),d=o(t,n,i),f=1,m=f/(p+d);return s=-c*m,s>r&&(s=r),-r>s&&(s=-r),s}function o(e,t,n){var i=M,r=T,o=E,s=C;return t.vsub(e.position,i),i.cross(n,r),e.invInertiaWorld.vmult(r,s),s.cross(i,o),e.invMass+n.dot(o)}function s(e,t,n,i,r,o){var s=r.norm2();if(s>1.1)return 0;var a=A,l=P,h=F;e.getVelocityAtWorldPoint(t,a),n.getVelocityAtWorldPoint(i,l),a.vsub(l,h);var u=r.dot(h),c=.2,p=1/(e.invMass+n.invMass),o=-c*u*p;return o}var a=(e("./Body"),e("../math/Vec3")),l=e("../math/Quaternion"),h=(e("../collision/RaycastResult"),e("../collision/Ray")),u=e("../objects/WheelInfo");t.exports=i;{var c=(new a,new a,new a,new a),p=new a,d=new a;new h}i.prototype.addWheel=function(e){e=e||{};var t=new u(e),n=this.wheelInfos.length;return this.wheelInfos.push(t),n},i.prototype.setSteeringValue=function(e,t){var n=this.wheelInfos[t];n.steering=e};new a;i.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},i.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},i.prototype.addToWorld=function(e){this.constraints;e.add(this.chassisBody);var t=this;this.preStepCallback=function(){t.updateVehicle(e.dt)},e.addEventListener("preStep",this.preStepCallback),this.world=e},i.prototype.getVehicleAxisWorld=function(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.chassisBody.vectorToWorldFrame(t,t)},i.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,n=t.length,i=this.chassisBody,r=0;n>r;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var o=new a;this.getVehicleAxisWorld(this.indexForwardAxis,o),o.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var r=0;n>r;r++)this.castRay(t[r]);this.updateSuspension(e);for(var s=new a,l=new a,r=0;n>r;r++){var h=t[r],u=h.suspensionForce;u>h.maxSuspensionForce&&(u=h.maxSuspensionForce),h.raycastResult.hitNormalWorld.scale(u*e,s),h.raycastResult.hitPointWorld.vsub(i.position,l),i.applyImpulse(s,h.raycastResult.hitPointWorld)}this.updateFriction(e);var c=new a,p=new a,d=new a;for(r=0;n>r;r++){var h=t[r];i.getVelocityAtWorldPoint(h.chassisConnectionPointWorld,d);var f=1;switch(this.indexUpAxis){case 1:f=-1}if(h.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,p);var m=p.dot(h.raycastResult.hitNormalWorld);h.raycastResult.hitNormalWorld.scale(m,c),p.vsub(c,p);var v=p.dot(d);h.deltaRotation=f*v*e/h.radius}!h.sliding&&h.isInContact||0===h.engineForce||!h.useCustomSlidingRotationalSpeed||(h.deltaRotation=(h.engineForce>0?1:-1)*h.customSlidingRotationalSpeed*e),Math.abs(h.brake)>Math.abs(h.engineForce)&&(h.deltaRotation=0),h.rotation+=h.deltaRotation,h.deltaRotation*=.99;

}},i.prototype.updateSuspension=function(e){for(var t=this.chassisBody,n=t.mass,i=this.wheelInfos,r=i.length,o=0;r>o;o++){var s=i[o];if(s.isInContact){var a,l=s.suspensionRestLength,h=s.suspensionLength,u=l-h;a=s.suspensionStiffness*u*s.clippedInvContactDotSuspension;var c,p=s.suspensionRelativeVelocity;c=0>p?s.dampingCompression:s.dampingRelaxation,a-=c*p,s.suspensionForce=a*n,s.suspensionForce<0&&(s.suspensionForce=0)}else s.suspensionForce=0}},i.prototype.removeFromWorld=function(e){this.constraints;e.remove(this.chassisBody),e.removeEventListener("preStep",this.preStepCallback),this.world=null};var f=new a,m=new a;i.prototype.castRay=function(e){var t=f,n=m;this.updateWheelTransformWorld(e);var i=this.chassisBody,r=-1,o=e.suspensionRestLength+e.radius;e.directionWorld.scale(o,t);var s=e.chassisConnectionPointWorld;s.vadd(t,n);var l=e.raycastResult;l.reset();var h=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(s,n,l),i.collisionResponse=h;var u=l.body;if(e.raycastResult.groundObject=0,u){r=l.distance,e.raycastResult.hitNormalWorld=l.hitNormalWorld,e.isInContact=!0;var c=l.distance;e.suspensionLength=c-e.radius;var p=e.suspensionRestLength-e.maxSuspensionTravel,d=e.suspensionRestLength+e.maxSuspensionTravel;e.suspensionLength<p&&(e.suspensionLength=p),e.suspensionLength>d&&(e.suspensionLength=d,e.raycastResult.reset());var v=e.raycastResult.hitNormalWorld.dot(e.directionWorld),y=new a;i.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,y);var g=e.raycastResult.hitNormalWorld.dot(y);if(v>=-.1)e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10;else{var x=-1/v;e.suspensionRelativeVelocity=g*x,e.clippedInvContactDotSuspension=x}}else e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1;return r},i.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody;t.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld),t.vectorToWorldFrame(e.directionLocal,e.directionWorld),t.vectorToWorldFrame(e.axleLocal,e.axleWorld)},i.prototype.updateWheelTransform=function(e){var t=c,n=p,i=d,r=this.wheelInfos[e];this.updateWheelTransformWorld(r),r.directionLocal.scale(-1,t),n.copy(r.axleLocal),t.cross(n,i),i.normalize(),n.normalize();var o=r.steering,s=new l;s.setFromAxisAngle(t,o);var a=new l;a.setFromAxisAngle(n,r.rotation);var h=r.worldTransform.quaternion;this.chassisBody.quaternion.mult(s,h),h.mult(a,h),h.normalize();var u=r.worldTransform.position;u.copy(r.directionWorld),u.scale(r.suspensionLength,u),u.vadd(r.chassisConnectionPointWorld,u)};var v=[new a(1,0,0),new a(0,1,0),new a(0,0,1)];i.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform};var y=new a,g=[],x=[],b=1;i.prototype.updateFriction=function(e){for(var t=y,n=this.wheelInfos,i=n.length,o=this.chassisBody,l=x,h=g,u=0,c=0;i>c;c++){var p=n[c],d=p.raycastResult.body;d&&u++,p.sideImpulse=0,p.forwardImpulse=0,l[c]||(l[c]=new a),h[c]||(h[c]=new a)}for(var c=0;i>c;c++){var p=n[c],d=p.raycastResult.body;if(d){var f=h[c],m=this.getWheelTransformWorld(c);m.vectorToWorldFrame(v[this.indexRightAxis],f);var _=p.raycastResult.hitNormalWorld,w=f.dot(_);_.scale(w,t),f.vsub(t,f),f.normalize(),_.cross(f,l[c]),l[c].normalize(),p.sideImpulse=s(o,p.raycastResult.hitPointWorld,d,p.raycastResult.hitPointWorld,f),p.sideImpulse*=b}}var S=1,M=.5;this.sliding=!1;for(var c=0;i>c;c++){var p=n[c],d=p.raycastResult.body,T=0;if(p.slipInfo=1,d){var E=0,C=p.brake?p.brake:E;T=r(o,d,p.raycastResult.hitPointWorld,l[c],C),T+=p.engineForce*e;var A=C/T;p.slipInfo*=A}if(p.forwardImpulse=0,p.skidInfo=1,d){p.skidInfo=1;var P=p.suspensionForce*e*p.frictionSlip,F=P,L=P*F;p.forwardImpulse=T;var R=p.forwardImpulse*M,B=p.sideImpulse*S,k=R*R+B*B;if(p.sliding=!1,k>L){this.sliding=!0,p.sliding=!0;var A=P/Math.sqrt(k);p.skidInfo*=A}}}if(this.sliding)for(var c=0;i>c;c++){var p=n[c];0!==p.sideImpulse&&p.skidInfo<1&&(p.forwardImpulse*=p.skidInfo,p.sideImpulse*=p.skidInfo)}for(var c=0;i>c;c++){var p=n[c],D=new a;if(D.copy(p.raycastResult.hitPointWorld),0!==p.forwardImpulse){var N=new a;l[c].scale(p.forwardImpulse,N),o.applyImpulse(N,D)}if(0!==p.sideImpulse){var d=p.raycastResult.body,O=new a;O.copy(p.raycastResult.hitPointWorld);var V=new a;h[c].scale(p.sideImpulse,V),o.pointToLocalFrame(D,D),D["xyz"[this.indexUpAxis]]*=p.rollInfluence,o.pointToWorldFrame(D,D),o.applyImpulse(V,D),V.scale(-1,V),d.applyImpulse(V,O)}}};var _=new a,w=new a,S=new a,M=new a,T=new a,E=new a,C=new a,A=new a,P=new a,F=new a},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(e,t,n){function i(e){if(this.wheelBodies=[],this.coordinateSystem="undefined"==typeof e.coordinateSystem?new a(1,2,3):e.coordinateSystem.clone(),this.chassisBody=e.chassisBody,!this.chassisBody){var t=new s(new a(5,2,.5));this.chassisBody=new r(1,t)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var r=e("./Body"),o=e("../shapes/Sphere"),s=e("../shapes/Box"),a=e("../math/Vec3"),l=e("../constraints/HingeConstraint");t.exports=i,i.prototype.addWheel=function(e){e=e||{};var t=e.body;t||(t=new r(1,new o(1.2))),this.wheelBodies.push(t),this.wheelForces.push(0);var n=(new a,"undefined"!=typeof e.position?e.position.clone():new a),i=new a;this.chassisBody.pointToWorldFrame(n,i),t.position.set(i.x,i.y,i.z);var s="undefined"!=typeof e.axis?e.axis.clone():new a(0,1,0);this.wheelAxes.push(s);var h=new l(this.chassisBody,t,{pivotA:n,axisA:s,pivotB:a.ZERO,axisB:s,collideConnected:!1});return this.constraints.push(h),this.wheelBodies.length-1},i.prototype.setSteeringValue=function(e,t){var n=this.wheelAxes[t],i=Math.cos(e),r=Math.sin(e),o=n.x,s=n.y;this.constraints[t].axisA.set(i*o-r*s,r*o+i*s,0)},i.prototype.setMotorSpeed=function(e,t){var n=this.constraints[t];n.enableMotor(),n.motorTargetVelocity=e},i.prototype.disableMotor=function(e){var t=this.constraints[e];t.disableMotor()};var h=new a;i.prototype.setWheelForce=function(e,t){this.wheelForces[t]=e},i.prototype.applyWheelForce=function(e,t){var n=this.wheelAxes[t],i=this.wheelBodies[t],r=i.torque;n.scale(e,h),i.vectorToWorldFrame(h,h),r.vadd(h,r)},i.prototype.addToWorld=function(e){for(var t=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)e.add(n[i]);for(var i=0;i<t.length;i++)e.addConstraint(t[i]);e.addEventListener("preStep",this._update.bind(this))},i.prototype._update=function(){for(var e=this.wheelForces,t=0;t<e.length;t++)this.applyWheelForce(e[t],t)},i.prototype.removeFromWorld=function(e){for(var t=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)e.remove(n[i]);for(var i=0;i<t.length;i++)e.removeConstraint(t[i])};var u=new a;i.prototype.getWheelSpeed=function(e){var t=this.wheelAxes[e],n=this.wheelBodies[e],i=n.angularVelocity;return this.chassisBody.vectorToWorldFrame(t,u),i.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(e,t,n){function i(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t.exports=i;{var r=(e("../shapes/Shape"),e("../math/Vec3"));e("../math/Quaternion"),e("../shapes/Particle"),e("../objects/Body"),e("../material/Material")}i.prototype.add=function(e){this.particles.push(e),this.neighbors.length<this.particles.length&&this.neighbors.push([])},i.prototype.remove=function(e){var t=this.particles.indexOf(e);-1!==t&&(this.particles.splice(t,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var o=new r;i.prototype.getNeighbors=function(e,t){for(var n=this.particles.length,i=e.id,r=this.smoothingRadius*this.smoothingRadius,s=o,a=0;a!==n;a++){var l=this.particles[a];l.position.vsub(e.position,s),i!==l.id&&s.norm2()<r&&t.push(l)}};var s=new r,a=new r,l=new r,h=new r,u=new r,c=new r;i.prototype.update=function(){for(var e=this.particles.length,t=s,n=this.speedOfSound,i=this.eps,r=0;r!==e;r++){var o=this.particles[r],p=this.neighbors[r];p.length=0,this.getNeighbors(o,p),p.push(this.particles[r]);for(var d=p.length,f=0,m=0;m!==d;m++){o.position.vsub(p[m].position,t);var v=t.norm(),y=this.w(v);f+=p[m].mass*y}this.densities[r]=f,this.pressures[r]=n*n*(this.densities[r]-this.density)}for(var g=a,x=l,b=h,_=u,w=c,r=0;r!==e;r++){var S=this.particles[r];g.set(0,0,0),x.set(0,0,0);for(var M,T,p=this.neighbors[r],d=p.length,m=0;m!==d;m++){var E=p[m];S.position.vsub(E.position,_);var C=_.norm();M=-E.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+i)+this.pressures[m]/(this.densities[m]*this.densities[m]+i)),this.gradw(_,b),b.mult(M,b),g.vadd(b,g),E.velocity.vsub(S.velocity,w),w.mult(1/(1e-4+this.densities[r]*this.densities[m])*this.viscosity*E.mass,w),T=this.nablaw(C),w.mult(T,w),x.vadd(w,x)}x.mult(S.mass,x),g.mult(S.mass,g),S.force.vadd(x,S.force),S.force.vadd(g,S.force)}},i.prototype.w=function(e){var t=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(t,9))*Math.pow(t*t-e*e,3)},i.prototype.gradw=function(e,t){var n=e.norm(),i=this.smoothingRadius;e.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-n*n,2),t)},i.prototype.nablaw=function(e){var t=this.smoothingRadius,n=945/(32*Math.PI*Math.pow(t,9))*(t*t-e*e)*(7*e*e-3*t*t);return n}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(e,t,n){function i(e,t,n){n=n||{},this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new r,this.localAnchorB=new r,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}var r=e("../math/Vec3");t.exports=i,i.prototype.setWorldAnchorA=function(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)},i.prototype.setWorldAnchorB=function(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)},i.prototype.getWorldAnchorA=function(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)},i.prototype.getWorldAnchorB=function(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)};var o=new r,s=new r,a=new r,l=new r,h=new r,u=new r,c=new r,p=new r,d=new r,f=new r,m=new r;i.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,v=o,y=s,g=a,x=l,b=m,_=h,w=u,S=c,M=p,T=d,E=f;this.getWorldAnchorA(_),this.getWorldAnchorB(w),_.vsub(i.position,S),w.vsub(r.position,M),w.vsub(_,v);var C=v.norm();y.copy(v),y.normalize(),r.velocity.vsub(i.velocity,g),r.angularVelocity.cross(M,b),g.vadd(b,g),i.angularVelocity.cross(S,b),g.vsub(b,g),y.mult(-e*(C-n)-t*g.dot(y),x),i.force.vsub(x,i.force),r.force.vadd(x,r.force),S.cross(x,T),M.cross(x,E),i.torque.vsub(T,i.torque),r.torque.vadd(E,r.torque)}},{"../math/Vec3":30}],36:[function(e,t,n){function i(e){e=a.defaults(e,{chassisConnectionPointLocal:new r,chassisConnectionPointWorld:new r,directionLocal:new r,directionWorld:new r,axleLocal:new r,axleWorld:new r,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionWorld.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleWorld.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new s,this.worldTransform=new o,this.isInContact=!1}var r=e("../math/Vec3"),o=e("../math/Transform"),s=e("../collision/RaycastResult"),a=e("../utils/Utils");t.exports=i;var l=new r,h=new r,l=new r;i.prototype.updateWheel=function(e){var t=this.raycastResult;if(this.isInContact){var n=t.hitNormalWorld.dot(t.directionWorld);t.hitPointWorld.vsub(e.position,h),e.getVelocityAtWorldPoint(h,l);var i=t.hitNormalWorld.dot(l);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var r=-1/n;this.suspensionRelativeVelocity=i*r,this.clippedInvContactDotSuspension=r}}else t.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(e,t,n){function i(e){r.call(this),this.type=r.types.BOX,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3"),s=e("./ConvexPolyhedron");i.prototype=new r,i.prototype.constructor=i,i.prototype.updateConvexPolyhedronRepresentation=function(){var e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=o,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],a=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],l=([new i(0,0,1),new i(0,1,0),new i(1,0,0)],new s(r,a));this.convexPolyhedronRepresentation=l,l.material=this.material},i.prototype.calculateLocalInertia=function(e,t){return t=t||new o,i.calculateInertia(this.halfExtents,e,t),t},i.calculateInertia=function(e,t,n){var i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)},i.prototype.getSideNormals=function(e,t){var n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==t)for(var r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n},i.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};{var a=new o;new o}i.prototype.forEachWorldCorner=function(e,t,n){for(var i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],o=0;o<r.length;o++)a.set(r[o][0],r[o][1],r[o][2]),t.vmult(a,a),e.vadd(a,a),n(a.x,a.y,a.z)};var l=[new o,new o,new o,new o,new o,new o,new o,new o];i.prototype.calculateWorldAABB=function(e,t,n,i){var r=this.halfExtents;l[0].set(r.x,r.y,r.z),l[1].set(-r.x,r.y,r.z),l[2].set(-r.x,-r.y,r.z),l[3].set(-r.x,-r.y,-r.z),l[4].set(r.x,-r.y,-r.z),l[5].set(r.x,r.y,-r.z),l[6].set(-r.x,r.y,-r.z),l[7].set(r.x,-r.y,r.z);var o=l[0];t.vmult(o,o),e.vadd(o,o),i.copy(o),n.copy(o);for(var s=1;8>s;s++){var o=l[s];t.vmult(o,o),e.vadd(o,o);var a=o.x,h=o.y,u=o.z;a>i.x&&(i.x=a),h>i.y&&(i.y=h),u>i.z&&(i.z=u),a<n.x&&(n.x=a),h<n.y&&(n.y=h),u<n.z&&(n.z=u)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(e,t,n){function i(e,t,n){r.call(this),this.type=r.types.CONVEXPOLYHEDRON,this.vertices=e||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=t||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3"),s=(e("../math/Quaternion"),e("../math/Transform"));i.prototype=new r,i.prototype.constructor=i;var a=new o;i.prototype.computeEdges=function(){var e=this.faces,t=this.vertices,n=(t.length,this.uniqueEdges);n.length=0;for(var i=a,r=0;r!==e.length;r++)for(var o=e[r],s=o.length,l=0;l!==s;l++){var h=(l+1)%s;t[o[l]].vsub(t[o[h]],i),i.normalize();for(var u=!1,c=0;c!==n.length;c++)if(n[c].almostEquals(i)||n[c].almostEquals(i)){u=!0;break}u||n.push(i.clone())}},i.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var n=this.faceNormals[e]||new o;this.getFaceNormal(e,n),n.negate(n),this.faceNormals[e]=n;var i=this.vertices[this.faces[e][0]];if(n.dot(i)<0){console.error(".faceNormals["+e+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var t=0;t<this.faces[e].length;t++)console.warn(".vertices["+this.faces[e][t]+"] = Vec3("+this.vertices[this.faces[e][t]].toString()+")")}}};var l=new o,h=new o;i.computeNormal=function(e,t,n,i){t.vsub(e,h),n.vsub(t,l),l.cross(h,i),i.isZero()||i.normalize()},i.prototype.getFaceNormal=function(e,t){var n=this.faces[e],r=this.vertices[n[0]],o=this.vertices[n[1]],s=this.vertices[n[2]];return i.computeNormal(r,o,s,t)};var u=new o;i.prototype.clipAgainstHull=function(e,t,n,i,r,s,a,l,h){for(var c=u,p=-1,d=-Number.MAX_VALUE,f=0;f<n.faces.length;f++){c.copy(n.faceNormals[f]),r.vmult(c,c);var m=c.dot(s);m>d&&(d=m,p=f)}for(var v=[],y=n.faces[p],g=y.length,x=0;g>x;x++){var b=n.vertices[y[x]],_=new o;_.copy(b),r.vmult(_,_),i.vadd(_,_),v.push(_)}p>=0&&this.clipFaceAgainstHull(s,e,t,v,a,l,h)};var c=new o,p=new o,d=new o,f=new o,m=new o,v=new o;i.prototype.findSeparatingAxis=function(e,t,n,i,r,o,s,a){var l=c,h=p,u=d,y=f,g=m,x=v,b=Number.MAX_VALUE,_=this,w=0;if(_.uniqueAxes)for(var S=0;S!==_.uniqueAxes.length;S++){n.vmult(_.uniqueAxes[S],l);var M=_.testSepAxis(l,e,t,n,i,r);if(M===!1)return!1;b>M&&(b=M,o.copy(l))}else for(var T=s?s.length:_.faces.length,S=0;T>S;S++){var E=s?s[S]:S;l.copy(_.faceNormals[E]),n.vmult(l,l);var M=_.testSepAxis(l,e,t,n,i,r);if(M===!1)return!1;b>M&&(b=M,o.copy(l))}if(e.uniqueAxes)for(var S=0;S!==e.uniqueAxes.length;S++){r.vmult(e.uniqueAxes[S],h),w++;var M=_.testSepAxis(h,e,t,n,i,r);if(M===!1)return!1;b>M&&(b=M,o.copy(h))}else for(var C=a?a.length:e.faces.length,S=0;C>S;S++){var E=a?a[S]:S;h.copy(e.faceNormals[E]),r.vmult(h,h),w++;var M=_.testSepAxis(h,e,t,n,i,r);if(M===!1)return!1;b>M&&(b=M,o.copy(h))}for(var A=0;A!==_.uniqueEdges.length;A++){n.vmult(_.uniqueEdges[A],y);for(var P=0;P!==e.uniqueEdges.length;P++)if(r.vmult(e.uniqueEdges[P],g),y.cross(g,x),!x.almostZero()){x.normalize();var F=_.testSepAxis(x,e,t,n,i,r);if(F===!1)return!1;b>F&&(b=F,o.copy(x))}}return i.vsub(t,u),u.dot(o)>0&&o.negate(o),!0};var y=[],g=[];i.prototype.testSepAxis=function(e,t,n,r,o,s){var a=this;i.project(a,e,n,r,y),i.project(t,e,o,s,g);var l=y[0],h=y[1],u=g[0],c=g[1];if(c>l||h>u)return!1;var p=l-c,d=u-h,f=d>p?p:d;return f};var x=new o,b=new o;i.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(x,b);var n=b.x-x.x,i=b.y-x.y,r=b.z-x.z;t.x=1/12*e*(2*i*2*i+2*r*2*r),t.y=1/12*e*(2*n*2*n+2*r*2*r),t.z=1/12*e*(2*i*2*i+2*n*2*n)},i.prototype.getPlaneConstantOfFace=function(e){var t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]],r=-n.dot(i);return r};var _=new o,w=new o,S=new o,M=new o,T=new o,E=new o,C=new o,A=new o;i.prototype.clipFaceAgainstHull=function(e,t,n,i,r,o,s){for(var a=_,l=w,h=S,u=M,c=T,p=E,d=C,f=A,m=this,v=[],y=i,g=v,x=-1,b=Number.MAX_VALUE,P=0;P<m.faces.length;P++){a.copy(m.faceNormals[P]),n.vmult(a,a);var F=a.dot(e);b>F&&(b=F,x=P)}if(!(0>x)){var L=m.faces[x];L.connectedFaces=[];for(var R=0;R<m.faces.length;R++)for(var B=0;B<m.faces[R].length;B++)-1!==L.indexOf(m.faces[R][B])&&R!==x&&-1===L.connectedFaces.indexOf(R)&&L.connectedFaces.push(R);for(var k=(y.length,L.length),D=0;k>D;D++){var N=m.vertices[L[D]],O=m.vertices[L[(D+1)%k]];N.vsub(O,l),h.copy(l),n.vmult(h,h),t.vadd(h,h),u.copy(this.faceNormals[x]),n.vmult(u,u),t.vadd(u,u),h.cross(u,c),c.negate(c),p.copy(N),n.vmult(p,p),t.vadd(p,p);var V,z=(-p.dot(c),L.connectedFaces[D]);d.copy(this.faceNormals[z]);var U=this.getPlaneConstantOfFace(z);f.copy(d),n.vmult(f,f);var V=U-f.dot(t);for(this.clipFaceAgainstPlane(y,g,f,V);y.length;)y.shift();for(;g.length;)y.push(g.shift())}d.copy(this.faceNormals[x]);var U=this.getPlaneConstantOfFace(x);f.copy(d),n.vmult(f,f);for(var V=U-f.dot(t),R=0;R<y.length;R++){var I=f.dot(y[R])+V;if(r>=I&&(console.log("clamped: depth="+I+" to minDist="+(r+"")),I=r),o>=I){var j=y[R];if(0>=I){var G={point:j,normal:f,depth:I};s.push(G)}}}}},i.prototype.clipFaceAgainstPlane=function(e,t,n,i){var r,s,a=e.length;if(2>a)return t;var l=e[e.length-1],h=e[0];r=n.dot(l)+i;for(var u=0;a>u;u++){if(h=e[u],s=n.dot(h)+i,0>r)if(0>s){var c=new o;c.copy(h),t.push(c)}else{var c=new o;l.lerp(h,r/(r-s),c),t.push(c)}else if(0>s){var c=new o;l.lerp(h,r/(r-s),c),t.push(c),t.push(h)}l=h,r=s}return t},i.prototype.computeWorldVertices=function(e,t){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new o);for(var i=this.vertices,r=this.worldVertices,s=0;s!==n;s++)t.vmult(i[s],r[s]),e.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1};new o;i.prototype.computeLocalAABB=function(e,t){var n=this.vertices.length,i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;n>r;r++){var o=i[r];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}},i.prototype.computeWorldFaceNormals=function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new o);for(var n=this.faceNormals,i=this.worldFaceNormals,r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1},i.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,n=0,i=t.length;n!==i;n++){var r=t[n].norm2();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)};var P=new o;i.prototype.calculateWorldAABB=function(e,t,n,i){for(var r,o,s,a,l,h,u=this.vertices.length,c=this.vertices,p=0;u>p;p++){P.copy(c[p]),t.vmult(P,P),e.vadd(P,P);var d=P;d.x<r||void 0===r?r=d.x:(d.x>a||void 0===a)&&(a=d.x),d.y<o||void 0===o?o=d.y:(d.y>l||void 0===l)&&(l=d.y),d.z<s||void 0===s?s=d.z:(d.z>h||void 0===h)&&(h=d.z)}n.set(r,o,s),i.set(a,l,h)},i.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},i.prototype.getAveragePointLocal=function(e){e=e||new o;for(var t=this.vertices.length,n=this.vertices,i=0;t>i;i++)e.vadd(n[i],e);return e.mult(1/t,e),e},i.prototype.transformAllPoints=function(e,t){var n=this.vertices.length,i=this.vertices;if(t){for(var r=0;n>r;r++){var o=i[r];t.vmult(o,o)}for(var r=0;r<this.faceNormals.length;r++){var o=this.faceNormals[r];t.vmult(o,o)}}if(e)for(var r=0;n>r;r++){var o=i[r];o.vadd(e,o)}};var F=new o,L=new o,R=new o;i.prototype.pointIsInside=function(e){var t=this.vertices.length,n=this.vertices,i=this.faces,r=this.faceNormals,o=null,s=this.faces.length,a=F;this.getAveragePointLocal(a);for(var l=0;s>l;l++){var t=(this.faces[l].length,r[l]),h=n[i[l][0]],u=L;e.vsub(h,u);var c=t.dot(u),p=R;a.vsub(h,p);var d=t.dot(p);if(0>c&&d>0||c>0&&0>d)return!1}return o?1:-1};var B=(new o,new o),k=new o;i.project=function(e,t,n,i,r){var o=e.vertices.length,a=B,l=0,h=0,u=k,c=e.vertices;u.setZero(),s.vectorToLocalFrame(n,i,t,a),s.pointToLocalFrame(n,i,u,u);var p=u.dot(a);h=l=c[0].dot(a);for(var d=1;o>d;d++){var f=c[d].dot(a);f>l&&(l=f),h>f&&(h=f)}if(h-=p,l-=p,h>l){var m=h;h=l,l=m}r[0]=l,r[1]=h}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(e,t,n){function i(e,t,n,i){var a=i,l=[],h=[],u=[],c=[],p=[],d=Math.cos,f=Math.sin;l.push(new o(t*d(0),t*f(0),.5*-n)),c.push(0),l.push(new o(e*d(0),e*f(0),.5*n)),p.push(1);for(var m=0;a>m;m++){var v=2*Math.PI/a*(m+1),y=2*Math.PI/a*(m+.5);a-1>m?(l.push(new o(t*d(v),t*f(v),.5*-n)),c.push(2*m+2),l.push(new o(e*d(v),e*f(v),.5*n)),p.push(2*m+3),u.push([2*m+2,2*m+3,2*m+1,2*m])):u.push([0,1,2*m+1,2*m]),(a%2===1||a/2>m)&&h.push(new o(d(y),f(y),0))}u.push(p),h.push(new o(0,0,1));for(var g=[],m=0;m<c.length;m++)g.push(c[c.length-m-1]);u.push(g),this.type=r.types.CONVEXPOLYHEDRON,s.call(this,l,u,h)}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3"),s=(e("../math/Quaternion"),e("./ConvexPolyhedron"));i.prototype=new s},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(e,t,n){function i(e,t){t=a.defaults(t,{maxValue:null,minValue:null,elementSize:1}),this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,r.call(this),this.pillarConvex=new o,this.pillarOffset=new s,this.type=r.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var r=e("./Shape"),o=e("./ConvexPolyhedron"),s=e("../math/Vec3"),a=e("../utils/Utils");t.exports=i,i.prototype=new r,i.prototype.update=function(){this._cachedPillars={}},i.prototype.updateMinValue=function(){for(var e=this.data,t=e[0][0],n=0;n!==e.length;n++)for(var i=0;i!==e[n].length;i++){var r=e[n][i];t>r&&(t=r)}this.minValue=t},i.prototype.updateMaxValue=function(){for(var e=this.data,t=e[0][0],n=0;n!==e.length;n++)for(var i=0;i!==e[n].length;i++){var r=e[n][i];r>t&&(t=r)}this.maxValue=t},i.prototype.setHeightValueAtIndex=function(e,t,n){var i=this.data;i[e][t]=n,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)},i.prototype.getRectMinMax=function(e,t,n,i,r){r=r||[];for(var o=this.data,s=this.minValue,a=e;n>=a;a++)for(var l=t;i>=l;l++){var h=o[a][l];h>s&&(s=h)}r[0]=this.minValue,r[1]=s},i.prototype.getIndexOfPosition=function(e,t,n,i){var r=this.elementSize,o=this.data,s=Math.floor(e/r),a=Math.floor(t/r);return n[0]=s,n[1]=a,i&&(0>s&&(s=0),0>a&&(a=0),s>=o.length-1&&(s=o.length-1),a>=o[0].length-1&&(a=o[0].length-1)),0>s||0>a||s>=o.length-1||a>=o[0].length-1?!1:!0},i.prototype.getHeightAt=function(e,t,n){var i=[];this.getIndexOfPosition(e,t,i,n);var r=[];return this.getRectMinMax(i[0],i[1]+1,i[0],i[1]+1,r),(r[0]+r[1])/2},i.prototype.getCacheConvexTrianglePillarKey=function(e,t,n){return e+"_"+t+"_"+(n?1:0)},i.prototype.getCachedConvexTrianglePillar=function(e,t,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]},i.prototype.setCachedConvexTrianglePillar=function(e,t,n,i,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]={convex:i,offset:r}},i.prototype.clearCachedConvexTrianglePillar=function(e,t,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,n)]},i.prototype.getConvexTrianglePillar=function(e,t,n){var i=this.pillarConvex,r=this.pillarOffset;if(this.cacheEnabled){var a=this.getCachedConvexTrianglePillar(e,t,n);if(a)return this.pillarConvex=a.convex,void(this.pillarOffset=a.offset);i=new o,r=new s,this.pillarConvex=i,this.pillarOffset=r}var a=this.data,l=this.elementSize,h=i.faces;i.vertices.length=6;for(var u=0;6>u;u++)i.vertices[u]||(i.vertices[u]=new s);h.length=5;for(var u=0;5>u;u++)h[u]||(h[u]=[]);var c=i.vertices,p=(Math.min(a[e][t],a[e+1][t],a[e][t+1],a[e+1][t+1])-this.minValue)/2+this.minValue;n?(r.set((e+.75)*l,(t+.75)*l,p),c[0].set(.25*l,.25*l,a[e+1][t+1]-p),c[1].set(-.75*l,.25*l,a[e][t+1]-p),c[2].set(.25*l,-.75*l,a[e+1][t]-p),c[3].set(.25*l,.25*l,-p-1),c[4].set(-.75*l,.25*l,-p-1),c[5].set(.25*l,-.75*l,-p-1),h[0][0]=0,h[0][1]=1,h[0][2]=2,h[1][0]=5,h[1][1]=4,h[1][2]=3,h[2][0]=2,h[2][1]=5,h[2][2]=3,h[2][3]=0,h[3][0]=3,h[3][1]=4,h[3][2]=1,h[3][3]=0,h[4][0]=1,h[4][1]=4,h[4][2]=5,h[4][3]=2):(r.set((e+.25)*l,(t+.25)*l,p),c[0].set(-.25*l,-.25*l,a[e][t]-p),c[1].set(.75*l,-.25*l,a[e+1][t]-p),c[2].set(-.25*l,.75*l,a[e][t+1]-p),c[3].set(-.25*l,-.25*l,-p-1),c[4].set(.75*l,-.25*l,-p-1),c[5].set(-.25*l,.75*l,-p-1),h[0][0]=0,h[0][1]=1,h[0][2]=2,h[1][0]=5,h[1][1]=4,h[1][2]=3,h[2][0]=0,h[2][1]=2,h[2][2]=5,h[2][3]=3,h[3][0]=1,h[3][1]=0,h[3][2]=3,h[3][3]=4,h[4][0]=4,h[4][1]=5,h[4][2]=2,h[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,n,i,r)},i.prototype.calculateLocalInertia=function(e,t){return t=t||new s,t.set(0,0,0),t},i.prototype.volume=function(){return Number.MAX_VALUE},i.prototype.calculateWorldAABB=function(e,t,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype.updateBoundingSphereRadius=function(){var e=this.data,t=this.elementSize;this.boundingSphereRadius=new s(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(e,t,n){function i(){r.call(this),this.type=r.types.PARTICLE}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3");i.prototype=new r,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(e,t){return t=t||new o,t.set(0,0,0),t},i.prototype.volume=function(){return 0},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},i.prototype.calculateWorldAABB=function(e,t,n,i){n.copy(e),i.copy(e)}},{"../math/Vec3":30,"./Shape":43}],42:[function(e,t,n){function i(){r.call(this),this.type=r.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3");i.prototype=new r,i.prototype.constructor=i,i.prototype.computeWorldNormal=function(e){var t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1},i.prototype.calculateLocalInertia=function(e,t){return t=t||new o},i.prototype.volume=function(){return Number.MAX_VALUE};var s=new o;i.prototype.calculateWorldAABB=function(e,t,n,i){s.set(0,0,1),t.vmult(s,s);var r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===s.x&&(i.x=e.x),1===s.y&&(i.y=e.y),1===s.z&&(i.z=e.z),-1===s.x&&(n.x=e.x),-1===s.y&&(n.y=e.y),-1===s.z&&(n.z=e.z)},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(e,t,n){function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t.exports=i;{var i=e("./Shape");e("../math/Vec3"),e("../math/Quaternion"),e("../material/Material")}i.prototype.constructor=i,i.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},i.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},i.prototype.calculateLocalInertia=function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,
"../math/Vec3":30,"./Shape":43}],44:[function(e,t,n){function i(e){if(r.call(this),this.radius=void 0!==e?Number(e):1,this.type=r.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3");i.prototype=new r,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(e,t){t=t||new o;var n=2*e*this.radius*this.radius/5;return t.x=n,t.y=n,t.z=n,t},i.prototype.volume=function(){return 4*Math.PI*this.radius/3},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},i.prototype.calculateWorldAABB=function(e,t,n,i){for(var r=this.radius,o=["x","y","z"],s=0;s<o.length;s++){var a=o[s];n[a]=e[a]-r,i[a]=e[a]+r}}},{"../math/Vec3":30,"./Shape":43}],45:[function(e,t,n){function i(e,t){r.call(this),this.type=r.types.TRIMESH,this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new a,this.edges=null,this.scale=new o(1,1,1),this.tree=new l,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}t.exports=i;var r=e("./Shape"),o=e("../math/Vec3"),s=(e("../math/Quaternion"),e("../math/Transform")),a=e("../collision/AABB"),l=e("../utils/Octree");i.prototype=new r,i.prototype.constructor=i;var h=new o;i.prototype.updateTree=function(){var e=this.tree;e.reset(),e.aabb.copy(this.aabb);var t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;for(var n=new a,i=new o,r=new o,s=new o,l=[i,r,s],h=0;h<this.indices.length/3;h++){var u=3*h;this._getUnscaledVertex(this.indices[u],i),this._getUnscaledVertex(this.indices[u+1],r),this._getUnscaledVertex(this.indices[u+2],s),n.setFromPoints(l),e.insert(n,h)}e.removeEmptyNodes()};var u=new a;i.prototype.getTrianglesInAABB=function(e,t){u.copy(e);var n=this.scale,i=n.x,r=n.y,o=n.z,s=u.lowerBound,a=u.upperBound;return s.x/=i,s.y/=r,s.z/=o,a.x/=i,a.y/=r,a.z/=o,this.tree.aabbQuery(u,t)},i.prototype.setScale=function(e){var t=this.scale.x===this.scale.y===this.scale.z,n=e.x===e.y===e.z;t&&n||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()},i.prototype.updateNormals=function(){for(var e=h,t=this.normals,n=0;n<this.indices.length/3;n++){var r=3*n,o=this.indices[r],s=this.indices[r+1],a=this.indices[r+2];this.getVertex(o,m),this.getVertex(s,v),this.getVertex(a,y),i.computeNormal(v,m,y,e),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z}},i.prototype.updateEdges=function(){for(var e={},t=function(t,n){var i=o>r?r+"_"+o:o+"_"+r;e[i]=!0},n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],o=this.indices[i+1],s=this.indices[i+2];t(r,o),t(o,s),t(s,r)}var a=Object.keys(e);this.edges=new Int16Array(2*a.length);for(var n=0;n<a.length;n++){var l=a[n].split("_");this.edges[2*n]=parseInt(l[0],10),this.edges[2*n+1]=parseInt(l[1],10)}},i.prototype.getEdgeVertex=function(e,t,n){var i=this.edges[2*e+(t?1:0)];this.getVertex(i,n)};var c=new o,p=new o;i.prototype.getEdgeVector=function(e,t){var n=c,i=p;this.getEdgeVertex(e,0,n),this.getEdgeVertex(e,1,i),i.vsub(n,t)};var d=new o,f=new o;i.computeNormal=function(e,t,n,i){t.vsub(e,f),n.vsub(t,d),d.cross(f,i),i.isZero()||i.normalize()};var m=new o,v=new o,y=new o;i.prototype.getVertex=function(e,t){var n=this.scale;return this._getUnscaledVertex(e,t),t.x*=n.x,t.y*=n.y,t.z*=n.z,t},i.prototype._getUnscaledVertex=function(e,t){var n=3*e,i=this.vertices;return t.set(i[n],i[n+1],i[n+2])},i.prototype.getWorldVertex=function(e,t,n,i){return this.getVertex(e,i),s.pointToWorldFrame(t,n,i,i),i},i.prototype.getTriangleVertices=function(e,t,n,i){var r=3*e;this.getVertex(this.indices[r],t),this.getVertex(this.indices[r+1],n),this.getVertex(this.indices[r+2],i)},i.prototype.getNormal=function(e,t){var n=3*e;return t.set(this.normals[n],this.normals[n+1],this.normals[n+2])};var g=new a;i.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(g);var n=g.upperBound.x-g.lowerBound.x,i=g.upperBound.y-g.lowerBound.y,r=g.upperBound.z-g.lowerBound.z;return t.set(1/12*e*(2*i*2*i+2*r*2*r),1/12*e*(2*n*2*n+2*r*2*r),1/12*e*(2*i*2*i+2*n*2*n))};var x=new o;i.prototype.computeLocalAABB=function(e){var t=e.lowerBound,n=e.upperBound,i=this.vertices.length,r=(this.vertices,x);this.getVertex(0,r),t.copy(r),n.copy(r);for(var o=0;o!==i;o++)this.getVertex(o,r),r.x<t.x?t.x=r.x:r.x>n.x&&(n.x=r.x),r.y<t.y?t.y=r.y:r.y>n.y&&(n.y=r.y),r.z<t.z?t.z=r.z:r.z>n.z&&(n.z=r.z)},i.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},i.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,n=new o,i=0,r=t.length/3;i!==r;i++){this.getVertex(i,n);var s=n.norm2();s>e&&(e=s)}this.boundingSphereRadius=Math.sqrt(e)};var b=(new o,new s),_=new a;i.prototype.calculateWorldAABB=function(e,t,n,i){var r=b,o=_;r.position=e,r.quaternion=t,this.aabb.toWorldFrame(r,o),n.copy(o.lowerBound),i.copy(o.upperBound)},i.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},i.createTorus=function(e,t,n,r,o){e=e||1,t=t||.5,n=n||8,r=r||6,o=o||2*Math.PI;for(var s=[],a=[],l=0;n>=l;l++)for(var h=0;r>=h;h++){var u=h/r*o,c=l/n*Math.PI*2,p=(e+t*Math.cos(c))*Math.cos(u),d=(e+t*Math.cos(c))*Math.sin(u),f=t*Math.sin(c);s.push(p,d,f)}for(var l=1;n>=l;l++)for(var h=1;r>=h;h++){var m=(r+1)*l+h-1,v=(r+1)*(l-1)+h-1,y=(r+1)*(l-1)+h,g=(r+1)*l+h;a.push(m,v,g),a.push(v,y,g)}return new i(s,a)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(e,t,n){function i(){r.call(this),this.iterations=10,this.tolerance=1e-7}t.exports=i;var r=(e("../math/Vec3"),e("../math/Quaternion"),e("./Solver"));i.prototype=new r;var o=[],s=[],a=[];i.prototype.solve=function(e,t){var n,i,r,l,h,u,c=0,p=this.iterations,d=this.tolerance*this.tolerance,f=this.equations,m=f.length,v=t.bodies,y=v.length,g=e;if(0!==m)for(var x=0;x!==y;x++)v[x].updateSolveMassProperties();var b=s,_=a,w=o;b.length=m,_.length=m,w.length=m;for(var x=0;x!==m;x++){var S=f[x];w[x]=0,_[x]=S.computeB(g),b[x]=1/S.computeC()}if(0!==m){for(var x=0;x!==y;x++){var M=v[x],T=M.vlambda,E=M.wlambda;T.set(0,0,0),E&&E.set(0,0,0)}for(c=0;c!==p;c++){l=0;for(var C=0;C!==m;C++){var S=f[C];n=_[C],i=b[C],u=w[C],h=S.computeGWlambda(),r=i*(n-h-S.eps*u),u+r<S.minForce?r=S.minForce-u:u+r>S.maxForce&&(r=S.maxForce-u),w[C]+=r,l+=r>0?r:-r,S.addToWlambda(r)}if(d>l*l)break}for(var x=0;x!==y;x++){var M=v[x],A=M.velocity,P=M.angularVelocity;A.vadd(M.vlambda,A),P&&P.vadd(M.wlambda,P)}}return c}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(e,t,n){function i(){this.equations=[]}t.exports=i,i.prototype.solve=function(e,t){return 0},i.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},i.prototype.removeEquation=function(e){var t=this.equations,n=t.indexOf(e);-1!==n&&t.splice(n,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,t,n){function i(e){for(l.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=e,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function r(e){for(var t=e.length,n=0;n!==t;n++){var i=e[n];if(!(i.visited||i.body.type&d))return i}return!1}function o(e,t,n,i){for(f.push(e),e.visited=!0,t(e,n,i);f.length;)for(var o,s=f.pop();o=r(s.children);)o.visited=!0,t(o,n,i),f.push(o)}function s(e,t,n){t.push(e.body);for(var i=e.eqs.length,r=0;r!==i;r++){var o=e.eqs[r];-1===n.indexOf(o)&&n.push(o)}}function a(e,t){return t.id-e.id}t.exports=i;var l=(e("../math/Vec3"),e("../math/Quaternion"),e("./Solver")),h=e("../objects/Body");i.prototype=new l;var u=[],c=[],p={bodies:[]},d=h.STATIC,f=[];i.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},i.prototype.solve=function(e,t){for(var n=u,i=this.nodePool,l=t.bodies,h=this.equations,d=h.length,f=l.length,m=this.subsolver;i.length<f;)i.push(this.createNode());n.length=f;for(var v=0;f>v;v++)n[v]=i[v];for(var v=0;v!==f;v++){var y=n[v];y.body=l[v],y.children.length=0,y.eqs.length=0,y.visited=!1}for(var g=0;g!==d;g++){var x=h[g],v=l.indexOf(x.bi),b=l.indexOf(x.bj),_=n[v],w=n[b];_.children.push(w),_.eqs.push(x),w.children.push(_),w.eqs.push(x)}var S,M=0,T=c;m.tolerance=this.tolerance,m.iterations=this.iterations;for(var E=p;S=r(n);){T.length=0,E.bodies.length=0,o(S,s,E.bodies,T);var C=T.length;T=T.sort(a);for(var v=0;v!==C;v++)m.addEquation(T[v]);{m.solve(e,E)}m.removeAllEquations(),M++}return M}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(e,t,n){var i=function(){};t.exports=i,i.prototype={constructor:i,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t),this},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[e])return this;var i=n[e].indexOf(t);return-1!==i&&n[e].splice(i,1),this},dispatchEvent:function(e){if(void 0===this._listeners)return this;var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var i=0,r=n.length;r>i;i++)n[i].call(this,e)}return this}}},{}],50:[function(e,t,n){function i(e){e=e||{},this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new o,this.data=[],this.children=[]}function r(e,t){t=t||{},t.root=null,t.aabb=e,i.call(this,t),this.maxDepth="undefined"!=typeof t.maxDepth?t.maxDepth:8}var o=e("../collision/AABB"),s=e("../math/Vec3");t.exports=r,r.prototype=new i,i.prototype.reset=function(e,t){this.children.length=this.data.length=0},i.prototype.insert=function(e,t,n){var i=this.data;if(n=n||0,!this.aabb.contains(e))return!1;var r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var o=!1;r.length||(this.subdivide(),o=!0);for(var s=0;8!==s;s++)if(r[s].insert(e,t,n+1))return!0;o&&(r.length=0)}return i.push(t),!0};var a=new s;i.prototype.subdivide=function(){var e=this.aabb,t=e.lowerBound,n=e.upperBound,r=this.children;r.push(new i({aabb:new o({lowerBound:new s(0,0,0)})}),new i({aabb:new o({lowerBound:new s(1,0,0)})}),new i({aabb:new o({lowerBound:new s(1,1,0)})}),new i({aabb:new o({lowerBound:new s(1,1,1)})}),new i({aabb:new o({lowerBound:new s(0,1,1)})}),new i({aabb:new o({lowerBound:new s(0,0,1)})}),new i({aabb:new o({lowerBound:new s(1,0,1)})}),new i({aabb:new o({lowerBound:new s(0,1,0)})})),n.vsub(t,a),a.scale(.5,a);for(var l=this.root||this,h=0;8!==h;h++){var u=r[h];u.root=l;var c=u.aabb.lowerBound;c.x*=a.x,c.y*=a.y,c.z*=a.z,c.vadd(t,c),c.vadd(a,u.aabb.upperBound)}},i.prototype.aabbQuery=function(e,t){for(var n=(this.data,this.children,[this]);n.length;){var i=n.pop();i.aabb.overlaps(e)&&Array.prototype.push.apply(t,i.data),Array.prototype.push.apply(n,i.children)}return t};var l=new o;i.prototype.rayQuery=function(e,t,n){return e.getAABB(l),l.toLocalFrame(t,l),this.aabbQuery(l,n),n},i.prototype.removeEmptyNodes=function(){for(var e=[this];e.length;){for(var t=e.pop(),n=t.children.length-1;n>=0;n--)t.children[n].data.length||t.children.splice(n,1);Array.prototype.push.apply(e,t.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(e,t,n){function i(){this.objects=[],this.type=Object}t.exports=i,i.prototype.release=function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(arguments[t])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(e,t,n){function i(){this.data={keys:[]}}t.exports=i,i.prototype.get=function(e,t){if(e>t){var n=t;t=e,e=n}return this.data[e+"-"+t]},i.prototype.set=function(e,t,n){if(e>t){var i=t;t=e,e=i}var r=e+"-"+t;this.get(e,t)||this.data.keys.push(r),this.data[r]=n},i.prototype.reset=function(){for(var e=this.data,t=e.keys;t.length>0;){var n=t.pop();delete e[n]}}},{}],53:[function(e,t,n){function i(){}t.exports=i,i.defaults=function(e,t){e=e||{};for(var n in t)n in e||(e[n]=t[n]);return e}},{}],54:[function(e,t,n){function i(){o.call(this),this.type=r}t.exports=i;var r=e("../math/Vec3"),o=e("./Pool");i.prototype=new o,i.prototype.constructObject=function(){return new r}},{"../math/Vec3":30,"./Pool":51}],55:[function(e,t,n){function i(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=e,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function r(e,t,n){for(var i=null,r=e.length,o=0;o!==r;o++){var s=e[o],a=I;e[(o+1)%r].vsub(s,a);var l=j;a.cross(t,l);var h=G;n.vsub(s,h);var u=l.dot(h);if(!(null===i||u>0&&i===!0||0>=u&&i===!1))return!1;null===i&&(i=u>0)}return!0}t.exports=i;var o=e("../collision/AABB"),s=e("../shapes/Shape"),a=e("../collision/Ray"),l=e("../math/Vec3"),h=e("../math/Transform"),u=(e("../shapes/ConvexPolyhedron"),e("../math/Quaternion")),c=(e("../solver/Solver"),e("../utils/Vec3Pool")),p=e("../equations/ContactEquation"),d=e("../equations/FrictionEquation");i.prototype.createContactEquation=function(e,t,n,i,r,o){var s;this.contactPointPool.length?(s=this.contactPointPool.pop(),s.bi=e,s.bj=t):s=new p(e,t),s.enabled=e.collisionResponse&&t.collisionResponse&&n.collisionResponse&&i.collisionResponse;var a=this.currentContactMaterial;s.restitution=a.restitution,s.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);var l=n.material||e.material,h=i.material||t.material;return l&&h&&l.restitution>=0&&h.restitution>=0&&(s.restitution=l.restitution*h.restitution),s.si=r||n,s.sj=o||i,s},i.prototype.createFrictionEquationsFromContact=function(e,t){var n=e.bi,i=e.bj,r=e.si,o=e.sj,s=this.world,a=this.currentContactMaterial,l=a.friction,h=r.material||n.material,u=o.material||i.material;if(h&&u&&h.friction>=0&&u.friction>=0&&(l=h.friction*u.friction),l>0){var c=l*s.gravity.length(),p=n.invMass+i.invMass;p>0&&(p=1/p);var f=this.frictionEquationPool,m=f.length?f.pop():new d(n,i,c*p),v=f.length?f.pop():new d(n,i,c*p);return m.bi=v.bi=n,m.bj=v.bj=i,m.minForce=v.minForce=-c*p,m.maxForce=v.maxForce=c*p,m.ri.copy(e.ri),m.rj.copy(e.rj),v.ri.copy(e.ri),v.rj.copy(e.rj),e.ni.tangents(m.t,v.t),m.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),v.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),m.enabled=v.enabled=e.enabled,t.push(m,v),!0}return!1};var f=new l,m=new l,v=new l;i.prototype.createFrictionFromAverage=function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];f.setZero(),m.setZero(),v.setZero();for(var r=t.bi,o=(t.bj,0);o!==e;o++)t=this.result[this.result.length-1-o],t.bodyA!==r?(f.vadd(t.ni,f),m.vadd(t.ri,m),v.vadd(t.rj,v)):(f.vsub(t.ni,f),m.vadd(t.rj,m),v.vadd(t.ri,v));var s=1/e;m.scale(s,n.ri),v.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),f.normalize(),f.tangents(n.t,i.t)}};var y=new l,g=new l,x=new u,b=new u;i.prototype.getContacts=function(e,t,n,i,r,o,s){this.contactPointPool=r,this.frictionEquationPool=s,this.result=i,this.frictionResult=o;for(var a=x,l=b,h=y,u=g,c=0,p=e.length;c!==p;c++){var d=e[c],f=t[c],m=null;d.material&&f.material&&(m=n.getContactMaterial(d.material,f.material)||null);for(var v=0;v<d.shapes.length;v++){d.quaternion.mult(d.shapeOrientations[v],a),d.quaternion.vmult(d.shapeOffsets[v],h),h.vadd(d.position,h);for(var _=d.shapes[v],w=0;w<f.shapes.length;w++){f.quaternion.mult(f.shapeOrientations[w],l),f.quaternion.vmult(f.shapeOffsets[w],u),u.vadd(f.position,u);var S=f.shapes[w];if(!(h.distanceTo(u)>_.boundingSphereRadius+S.boundingSphereRadius)){var M=null;_.material&&S.material&&(M=n.getContactMaterial(_.material,S.material)||null),this.currentContactMaterial=M||m||n.defaultContactMaterial;var T=this[_.type|S.type];T&&(_.type<S.type?T.call(this,_,S,h,u,a,l,d,f,_,S):T.call(this,S,_,u,h,l,a,f,d,_,S))}}}}};i.prototype[s.types.BOX|s.types.BOX]=i.prototype.boxBox=function(e,t,n,i,r,o,s,a){e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,n,i,r,o,s,a,e,t)},i.prototype[s.types.BOX|s.types.CONVEXPOLYHEDRON]=i.prototype.boxConvex=function(e,t,n,i,r,o,s,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,n,i,r,o,s,a,e,t)},i.prototype[s.types.BOX|s.types.PARTICLE]=i.prototype.boxParticle=function(e,t,n,i,r,o,s,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,n,i,r,o,s,a,e,t)},i.prototype[s.types.SPHERE]=i.prototype.sphereSphere=function(e,t,n,i,r,o,s,a){var l=this.createContactEquation(s,a,e,t);i.vsub(n,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(e.radius,l.ri),l.rj.mult(-t.radius,l.rj),l.ri.vadd(n,l.ri),l.ri.vsub(s.position,l.ri),l.rj.vadd(i,l.rj),l.rj.vsub(a.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var _=new l,w=new l,S=new l;i.prototype[s.types.PLANE|s.types.TRIMESH]=i.prototype.planeTrimesh=function(e,t,n,i,r,o,s,a){var u=new l,c=_;c.set(0,0,1),r.vmult(c,c);for(var p=0;p<t.vertices.length/3;p++){t.getVertex(p,u);var d=new l;d.copy(u),h.pointToWorldFrame(i,o,d,u);var f=w;u.vsub(n,f);var m=c.dot(f);if(0>=m){var v=this.createContactEquation(s,a,e,t);v.ni.copy(c);var y=S;c.scale(f.dot(c),y),u.vsub(y,y),v.ri.copy(y),v.ri.vsub(s.position,v.ri),v.rj.copy(u),v.rj.vsub(a.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var M=new l,T=new l,E=(new l,new l),C=new l,A=new l,P=new l,F=new l,L=new l,R=new l,B=new l,k=new l,D=new l,N=new l,O=new o,V=[];i.prototype[s.types.SPHERE|s.types.TRIMESH]=i.prototype.sphereTrimesh=function(e,t,n,i,r,o,s,l){var u=A,c=P,p=F,d=L,f=R,m=B,v=O,y=C,g=T,x=V;h.pointToLocalFrame(i,o,n,f);var b=e.radius;v.lowerBound.set(f.x-b,f.y-b,f.z-b),v.upperBound.set(f.x+b,f.y+b,f.z+b),t.getTrianglesInAABB(v,x);for(var _=E,w=e.radius*e.radius,S=0;S<x.length;S++)for(var z=0;3>z;z++)if(t.getVertex(t.indices[3*x[S]+z],_),_.vsub(f,g),g.norm2()<=w){y.copy(_),h.pointToWorldFrame(i,o,y,_),_.vsub(n,g);var U=this.createContactEquation(s,l,e,t);U.ni.copy(g),U.ni.normalize(),U.ri.copy(U.ni),U.ri.scale(e.radius,U.ri),U.ri.vadd(n,U.ri),U.ri.vsub(s.position,U.ri),U.rj.copy(_),U.rj.vsub(l.position,U.rj),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)}for(var S=0;S<x.length;S++)for(var z=0;3>z;z++){t.getVertex(t.indices[3*x[S]+z],u),t.getVertex(t.indices[3*x[S]+(z+1)%3],c),c.vsub(u,p),f.vsub(c,m);var I=m.dot(p);f.vsub(u,m);var j=m.dot(p);if(j>0&&0>I){f.vsub(u,m),d.copy(p),d.normalize(),j=m.dot(d),d.scale(j,m),m.vadd(u,m);var G=m.distanceTo(f);if(G<e.radius){var U=this.createContactEquation(s,l,e,t);m.vsub(f,U.ni),U.ni.normalize(),U.ni.scale(e.radius,U.ri),h.pointToWorldFrame(i,o,m,m),m.vsub(l.position,U.rj),h.vectorToWorldFrame(o,U.ni,U.ni),h.vectorToWorldFrame(o,U.ri,U.ri),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)}}}for(var q=k,H=D,W=N,X=M,S=0,Y=x.length;S!==Y;S++){t.getTriangleVertices(x[S],q,H,W),t.getNormal(x[S],X),f.vsub(q,m);var G=m.dot(X);if(X.scale(G,m),f.vsub(m,m),G=m.distanceTo(f),a.pointInTriangle(m,q,H,W)&&G<e.radius){var U=this.createContactEquation(s,l,e,t);m.vsub(f,U.ni),U.ni.normalize(),U.ni.scale(e.radius,U.ri),h.pointToWorldFrame(i,o,m,m),m.vsub(l.position,U.rj),h.vectorToWorldFrame(o,U.ni,U.ni),h.vectorToWorldFrame(o,U.ri,U.ri),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult)}}x.length=0};var z=new l,U=new l;i.prototype[s.types.SPHERE|s.types.PLANE]=i.prototype.spherePlane=function(e,t,n,i,r,o,s,a){var l=this.createContactEquation(s,a,e,t);if(l.ni.set(0,0,1),o.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.mult(e.radius,l.ri),n.vsub(i,z),l.ni.mult(l.ni.dot(z),U),z.vsub(U,l.rj),-z.dot(l.ni)<=e.radius){var h=l.ri,u=l.rj;h.vadd(n,h),h.vsub(s.position,h),u.vadd(i,u),u.vsub(a.position,u),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var I=new l,j=new l,G=new l,q=new l,H=new l,W=new l,X=new l,Y=[new l,new l,new l,new l,new l,new l],Q=new l,K=new l,Z=new l,$=new l;i.prototype[s.types.SPHERE|s.types.BOX]=i.prototype.sphereBox=function(e,t,n,i,r,o,s,a){var l=this.v3pool,h=Y;n.vsub(i,q),t.getSideNormals(h,o);for(var u=e.radius,c=!1,p=K,d=Z,f=$,m=null,v=0,y=0,g=0,x=null,b=0,_=h.length;b!==_&&c===!1;b++){var w=H;w.copy(h[b]);var S=w.norm();w.normalize();var M=q.dot(w);if(S+u>M&&M>0){var T=W,E=X;T.copy(h[(b+1)%3]),E.copy(h[(b+2)%3]);var C=T.norm(),A=E.norm();T.normalize(),E.normalize();var P=q.dot(T),F=q.dot(E);if(C>P&&P>-C&&A>F&&F>-A){var L=Math.abs(M-S-u);(null===x||x>L)&&(x=L,y=P,g=F,m=S,p.copy(w),d.copy(T),f.copy(E),v++)}}}if(v){c=!0;var R=this.createContactEquation(s,a,e,t);p.mult(-u,R.ri),R.ni.copy(p),R.ni.negate(R.ni),p.mult(m,p),d.mult(y,d),p.vadd(d,p),f.mult(g,f),p.vadd(f,R.rj),R.ri.vadd(n,R.ri),R.ri.vsub(s.position,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(a.position,R.rj),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}for(var B=l.get(),k=Q,D=0;2!==D&&!c;D++)for(var N=0;2!==N&&!c;N++)for(var O=0;2!==O&&!c;O++)if(B.set(0,0,0),D?B.vadd(h[0],B):B.vsub(h[0],B),N?B.vadd(h[1],B):B.vsub(h[1],B),O?B.vadd(h[2],B):B.vsub(h[2],B),i.vadd(B,k),k.vsub(n,k),k.norm2()<u*u){c=!0;var R=this.createContactEquation(s,a,e,t);R.ri.copy(k),R.ri.normalize(),R.ni.copy(R.ri),R.ri.mult(u,R.ri),R.rj.copy(B),R.ri.vadd(n,R.ri),R.ri.vsub(s.position,R.ri),R.rj.vadd(i,R.rj),R.rj.vsub(a.position,R.rj),this.result.push(R),this.createFrictionEquationsFromContact(R,this.frictionResult)}l.release(B),B=null;for(var V=l.get(),z=l.get(),R=l.get(),U=l.get(),L=l.get(),I=h.length,D=0;D!==I&&!c;D++)for(var N=0;N!==I&&!c;N++)if(D%3!==N%3){h[N].cross(h[D],V),V.normalize(),h[D].vadd(h[N],z),R.copy(n),R.vsub(z,R),R.vsub(i,R);var j=R.dot(V);V.mult(j,U);for(var O=0;O===D%3||O===N%3;)O++;L.copy(n),L.vsub(U,L),L.vsub(z,L),L.vsub(i,L);var G=Math.abs(j),J=L.norm();if(G<h[O].norm()&&u>J){c=!0;var ee=this.createContactEquation(s,a,e,t);z.vadd(U,ee.rj),ee.rj.copy(ee.rj),L.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(i,ee.ri),ee.ri.vsub(n,ee.ri),ee.ri.normalize(),ee.ri.mult(u,ee.ri),ee.ri.vadd(n,ee.ri),ee.ri.vsub(s.position,ee.ri),ee.rj.vadd(i,ee.rj),ee.rj.vsub(a.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}l.release(V,z,R,U,L)};var J=new l,ee=new l,te=new l,ne=new l,ie=new l,re=new l,oe=new l,se=new l,ae=new l,le=new l;i.prototype[s.types.SPHERE|s.types.CONVEXPOLYHEDRON]=i.prototype.sphereConvex=function(e,t,n,i,o,s,a,l){var h=this.v3pool;n.vsub(i,J);for(var u=t.faceNormals,c=t.faces,p=t.vertices,d=e.radius,f=0;f!==p.length;f++){var m=p[f],v=ie;s.vmult(m,v),i.vadd(v,v);var y=ne;if(v.vsub(n,y),y.norm2()<d*d){x=!0;var g=this.createContactEquation(a,l,e,t);return g.ri.copy(y),g.ri.normalize(),g.ni.copy(g.ri),g.ri.mult(d,g.ri),v.vsub(i,g.rj),g.ri.vadd(n,g.ri),g.ri.vsub(a.position,g.ri),g.rj.vadd(i,g.rj),g.rj.vsub(l.position,g.rj),this.result.push(g),void this.createFrictionEquationsFromContact(g,this.frictionResult)}}for(var x=!1,f=0,b=c.length;f!==b&&x===!1;f++){var _=u[f],w=c[f],S=re;s.vmult(_,S);var M=oe;s.vmult(p[w[0]],M),M.vadd(i,M);var T=se;S.mult(-d,T),n.vadd(T,T);var E=ae;T.vsub(M,E);var C=E.dot(S),A=le;if(n.vsub(M,A),0>C&&A.dot(S)>0){for(var P=[],F=0,L=w.length;F!==L;F++){var R=h.get();s.vmult(p[w[F]],R),i.vadd(R,R),P.push(R)}if(r(P,S,n)){x=!0;var g=this.createContactEquation(a,l,e,t);S.mult(-d,g.ri),S.negate(g.ni);var B=h.get();S.mult(-C,B);var k=h.get();S.mult(-d,k),n.vsub(i,g.rj),g.rj.vadd(k,g.rj),g.rj.vadd(B,g.rj),g.rj.vadd(i,g.rj),g.rj.vsub(l.position,g.rj),g.ri.vadd(n,g.ri),g.ri.vsub(a.position,g.ri),h.release(B),h.release(k),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult);for(var F=0,D=P.length;F!==D;F++)h.release(P[F]);return}for(var F=0;F!==w.length;F++){var N=h.get(),O=h.get();s.vmult(p[w[(F+1)%w.length]],N),s.vmult(p[w[(F+2)%w.length]],O),i.vadd(N,N),i.vadd(O,O);var V=ee;O.vsub(N,V);var z=te;V.unit(z);var U=h.get(),I=h.get();n.vsub(N,I);var j=I.dot(z);z.mult(j,U),U.vadd(N,U);var G=h.get();if(U.vsub(n,G),j>0&&j*j<V.norm2()&&G.norm2()<d*d){var g=this.createContactEquation(a,l,e,t);U.vsub(i,g.rj),U.vsub(n,g.ni),g.ni.normalize(),g.ni.mult(d,g.ri),g.rj.vadd(i,g.rj),g.rj.vsub(l.position,g.rj),g.ri.vadd(n,g.ri),g.ri.vsub(a.position,g.ri),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult);for(var F=0,D=P.length;F!==D;F++)h.release(P[F]);return h.release(N),h.release(O),h.release(U),h.release(G),void h.release(I)}h.release(N),h.release(O),h.release(U),h.release(G),h.release(I)}for(var F=0,D=P.length;F!==D;F++)h.release(P[F])}}};new l,new l;i.prototype[s.types.PLANE|s.types.BOX]=i.prototype.planeBox=function(e,t,n,i,r,o,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.planeConvex(e,t.convexPolyhedronRepresentation,n,i,r,o,s,a)};var he=new l,ue=new l,ce=new l,pe=new l;i.prototype[s.types.PLANE|s.types.CONVEXPOLYHEDRON]=i.prototype.planeConvex=function(e,t,n,i,r,o,s,a){var l=he,h=ue;h.set(0,0,1),r.vmult(h,h);for(var u=0,c=ce,p=0;p!==t.vertices.length;p++){l.copy(t.vertices[p]),o.vmult(l,l),i.vadd(l,l),l.vsub(n,c);var d=h.dot(c);if(0>=d){var f=this.createContactEquation(s,a,e,t),m=pe;h.mult(h.dot(c),m),l.vsub(m,m),m.vsub(n,f.ri),f.ni.copy(h),l.vsub(i,f.rj),f.ri.vadd(n,f.ri),f.ri.vsub(s.position,f.ri),f.rj.vadd(i,f.rj),f.rj.vsub(a.position,f.rj),this.result.push(f),u++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(f,this.frictionResult)}}this.enableFrictionReduction&&u&&this.createFrictionFromAverage(u)};var de=new l,fe=new l;i.prototype[s.types.CONVEXPOLYHEDRON]=i.prototype.convexConvex=function(e,t,n,i,r,o,s,a,l,h,u,c){var p=de;if(!(n.distanceTo(i)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,n,r,i,o,p,u,c)){var d=[],f=fe;e.clipAgainstHull(n,r,t,i,o,p,-100,100,d);for(var m=0,v=0;v!==d.length;v++){var y=this.createContactEquation(s,a,e,t,l,h),g=y.ri,x=y.rj;p.negate(y.ni),d[v].normal.negate(f),f.mult(d[v].depth,f),d[v].point.vadd(f,g),x.copy(d[v].point),g.vsub(n,g),x.vsub(i,x),g.vadd(n,g),g.vsub(s.position,g),x.vadd(i,x),x.vsub(a.position,x),this.result.push(y),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(y,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var me=new l,ve=new l,ye=new l;i.prototype[s.types.PLANE|s.types.PARTICLE]=i.prototype.planeParticle=function(e,t,n,i,r,o,s,a){var l=me;l.set(0,0,1),s.quaternion.vmult(l,l);var h=ve;i.vsub(s.position,h);var u=l.dot(h);if(0>=u){var c=this.createContactEquation(a,s,t,e);c.ni.copy(l),c.ni.negate(c.ni),c.ri.set(0,0,0);var p=ye;l.mult(l.dot(i),p),i.vsub(p,p),c.rj.copy(p),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var ge=new l;i.prototype[s.types.PARTICLE|s.types.SPHERE]=i.prototype.sphereParticle=function(e,t,n,i,r,o,s,a){var l=ge;l.set(0,0,1),i.vsub(n,l);var h=l.norm2();if(h<=e.radius*e.radius){var u=this.createContactEquation(a,s,t,e);l.normalize(),u.rj.copy(l),u.rj.mult(e.radius,u.rj),u.ni.copy(l),u.ni.negate(u.ni),u.ri.set(0,0,0),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}};var xe=new u,be=new l,_e=(new l,new l),we=new l,Se=new l;i.prototype[s.types.PARTICLE|s.types.CONVEXPOLYHEDRON]=i.prototype.convexParticle=function(e,t,n,i,r,o,s,a){var l=-1,h=_e,u=Se,c=null,p=0,d=be;if(d.copy(i),d.vsub(n,d),r.conjugate(xe),xe.vmult(d,d),e.pointIsInside(d)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(n,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(var f=0,m=e.faces.length;f!==m;f++){var v=[e.worldVertices[e.faces[f][0]]],y=e.worldFaceNormals[f];i.vsub(v[0],we);var g=-y.dot(we);(null===c||Math.abs(g)<Math.abs(c))&&(c=g,l=f,h.copy(y),p++)}if(-1!==l){var x=this.createContactEquation(a,s,t,e);h.mult(c,u),u.vadd(i,u),u.vsub(n,u),x.rj.copy(u),h.negate(x.ni),x.ri.set(0,0,0);var b=x.ri,_=x.rj;b.vadd(i,b),b.vsub(a.position,b),_.vadd(n,_),_.vsub(s.position,_),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},i.prototype[s.types.BOX|s.types.HEIGHTFIELD]=i.prototype.boxHeightfield=function(e,t,n,i,r,o,s,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,n,i,r,o,s,a)};var Me=new l,Te=new l,Ee=[0];i.prototype[s.types.CONVEXPOLYHEDRON|s.types.HEIGHTFIELD]=i.prototype.convexHeightfield=function(e,t,n,i,r,o,s,a){var l=t.data,u=t.elementSize,c=e.boundingSphereRadius,p=Te,d=Ee,f=Me;h.pointToLocalFrame(i,o,n,f);var m=Math.floor((f.x-c)/u)-1,v=Math.ceil((f.x+c)/u)+1,y=Math.floor((f.y-c)/u)-1,g=Math.ceil((f.y+c)/u)+1;if(!(0>v||0>g||m>l.length||y>l[0].length)){0>m&&(m=0),0>v&&(v=0),0>y&&(y=0),0>g&&(g=0),m>=l.length&&(m=l.length-1),v>=l.length&&(v=l.length-1),g>=l[0].length&&(g=l[0].length-1),y>=l[0].length&&(y=l[0].length-1);var x=[];t.getRectMinMax(m,y,v,g,x);var b=x[0],_=x[1];if(!(f.z-c>_||f.z+c<b))for(var w=m;v>w;w++)for(var S=y;g>S;S++)t.getConvexTrianglePillar(w,S,!1),h.pointToWorldFrame(i,o,t.pillarOffset,p),n.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,n,p,r,o,s,a,null,null,d,null),t.getConvexTrianglePillar(w,S,!0),h.pointToWorldFrame(i,o,t.pillarOffset,p),n.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,n,p,r,o,s,a,null,null,d,null)}};var Ce=new l,Ae=new l;i.prototype[s.types.SPHERE|s.types.HEIGHTFIELD]=i.prototype.sphereHeightfield=function(e,t,n,i,r,o,s,a){var l=t.data,u=e.radius,c=t.elementSize,p=Ae,d=Ce;h.pointToLocalFrame(i,o,n,d);var f=Math.floor((d.x-u)/c)-1,m=Math.ceil((d.x+u)/c)+1,v=Math.floor((d.y-u)/c)-1,y=Math.ceil((d.y+u)/c)+1;if(!(0>m||0>y||f>l.length||y>l[0].length)){0>f&&(f=0),0>m&&(m=0),0>v&&(v=0),0>y&&(y=0),f>=l.length&&(f=l.length-1),m>=l.length&&(m=l.length-1),y>=l[0].length&&(y=l[0].length-1),v>=l[0].length&&(v=l[0].length-1);var g=[];t.getRectMinMax(f,v,m,y,g);var x=g[0],b=g[1];if(!(d.z-u>b||d.z+u<x))for(var _=this.result,w=f;m>w;w++)for(var S=v;y>S;S++){var M=_.length;t.getConvexTrianglePillar(w,S,!1),h.pointToWorldFrame(i,o,t.pillarOffset,p),n.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,n,p,r,o,s,a),t.getConvexTrianglePillar(w,S,!0),h.pointToWorldFrame(i,o,t.pillarOffset,p),n.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,n,p,r,o,s,a);var T=_.length-M;if(T>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(e,t,n){function i(){h.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,
this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new g,this.bodies=[],this.solver=new a,this.constraints=[],this.narrowphase=new l(this),this.collisionMatrix=new u,this.collisionMatrixPrevious=new u,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new f,this.defaultMaterial=new c("default"),this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}t.exports=i;var r=e("../shapes/Shape"),o=e("../math/Vec3"),s=e("../math/Quaternion"),a=e("../solver/GSSolver"),l=(e("../utils/Vec3Pool"),e("../equations/ContactEquation"),e("../equations/FrictionEquation"),e("./Narrowphase")),h=e("../utils/EventTarget"),u=e("../collision/ArrayCollisionMatrix"),c=e("../material/Material"),p=e("../material/ContactMaterial"),d=e("../objects/Body"),f=e("../utils/TupleDictionary"),m=e("../collision/RaycastResult"),v=e("../collision/AABB"),y=e("../collision/Ray"),g=e("../collision/NaiveBroadphase");i.prototype=new h;var x=(new v,new y);if(i.prototype.getContactMaterial=function(e,t){return this.contactMaterialTable.get(e.id,t.id)},i.prototype.numObjects=function(){return this.bodies.length},i.prototype.collisionMatrixTick=function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset()},i.prototype.add=i.prototype.addBody=function(e){-1===this.bodies.indexOf(e)&&(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof d&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.dispatchEvent(this.addBodyEvent))},i.prototype.addConstraint=function(e){this.constraints.push(e)},i.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)},i.prototype.rayTest=function(e,t,n){n instanceof m?this.raycastClosest(e,t,{skipBackfaces:!0},n):this.raycastAll(e,t,{skipBackfaces:!0},n)},i.prototype.raycastAll=function(e,t,n,i){return n.mode=y.ALL,n.from=e,n.to=t,n.callback=i,x.intersectWorld(this,n)},i.prototype.raycastAny=function(e,t,n,i){return n.mode=y.ANY,n.from=e,n.to=t,n.result=i,x.intersectWorld(this,n)},i.prototype.raycastClosest=function(e,t,n,i){return n.mode=y.CLOSEST,n.from=e,n.to=t,n.result=i,x.intersectWorld(this,n)},i.prototype.remove=function(e){e.world=null;var t=this.bodies.length-1,n=this.bodies,i=n.indexOf(e);if(-1!==i){n.splice(i,1);for(var r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,this.dispatchEvent(this.removeBodyEvent)}},i.prototype.removeBody=i.prototype.remove,i.prototype.addMaterial=function(e){this.materials.push(e)},i.prototype.addContactMaterial=function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)},"undefined"==typeof performance&&(performance={}),!performance.now){var b=Date.now();performance.timing&&performance.timing.navigationStart&&(b=performance.timing.navigationStart),performance.now=function(){return Date.now()-b}}var _=new o;i.prototype.step=function(e,t,n){if(n=n||10,t=t||0,0===t)this.internalStep(e),this.time+=e;else{var i=Math.floor((this.time+t)/e)-Math.floor(this.time/e);i=Math.min(i,n);for(var r=performance.now(),o=0;o!==i&&(this.internalStep(e),!(performance.now()-r>1e3*e));o++);this.time+=t;for(var s=this.time%e,a=s/e,l=_,h=this.bodies,u=0;u!==h.length;u++){var c=h[u];c.type!==d.STATIC&&c.sleepState!==d.SLEEPING?(c.position.vsub(c.previousPosition,l),l.scale(a,l),c.position.vadd(l,c.interpolatedPosition)):(c.interpolatedPosition.copy(c.position),c.interpolatedQuaternion.copy(c.quaternion))}}};var w={type:"postStep"},S={type:"preStep"},M={type:"collide",body:null,contact:null},T=[],E=[],C=[],A=[],P=(new o,new o,new o,new o,new o,new o,new o,new o,new o,new s,new s),F=new s,L=new o;i.prototype.internalStep=function(e){this.dt=e;var t,n=this.contacts,i=C,o=A,s=this.numObjects(),a=this.bodies,l=this.solver,h=this.gravity,u=this.doProfiling,c=this.profile,p=d.DYNAMIC,f=this.constraints,m=E,v=(h.norm(),h.x),y=h.y,g=h.z,x=0;for(u&&(t=performance.now()),x=0;x!==s;x++){var b=a[x];if(b.type&p){var _=b.force,R=b.mass;_.x+=R*v,_.y+=R*y,_.z+=R*g}}for(var x=0,B=this.subsystems.length;x!==B;x++)this.subsystems[x].update();u&&(t=performance.now()),i.length=0,o.length=0,this.broadphase.collisionPairs(this,i,o),u&&(c.broadphase=performance.now()-t);var k=f.length;for(x=0;x!==k;x++){var D=f[x];if(!D.collideConnected)for(var N=i.length-1;N>=0;N-=1)(D.bodyA===i[N]&&D.bodyB===o[N]||D.bodyB===i[N]&&D.bodyA===o[N])&&(i.splice(N,1),o.splice(N,1))}this.collisionMatrixTick(),u&&(t=performance.now());var O=T,V=n.length;for(x=0;x!==V;x++)O.push(n[x]);n.length=0;var z=this.frictionEquations.length;for(x=0;x!==z;x++)m.push(this.frictionEquations[x]);this.frictionEquations.length=0,this.narrowphase.getContacts(i,o,this,n,O,this.frictionEquations,m),u&&(c.narrowphase=performance.now()-t),u&&(t=performance.now());for(var x=0;x<this.frictionEquations.length;x++)l.addEquation(this.frictionEquations[x]);for(var U=n.length,I=0;I!==U;I++){{var j,D=n[I],b=D.bi,G=D.bj;D.si,D.sj}j=b.material&&G.material?this.getContactMaterial(b.material,G.material)||this.defaultContactMaterial:this.defaultContactMaterial;var q=j.friction;if(b.material&&G.material&&(b.material.friction>=0&&G.material.friction>=0&&(q=b.material.friction*G.material.friction),b.material.restitution>=0&&G.material.restitution>=0&&(D.restitution=b.material.restitution*G.material.restitution)),l.addEquation(D),b.allowSleep&&b.type===d.DYNAMIC&&b.sleepState===d.SLEEPING&&G.sleepState===d.AWAKE&&G.type!==d.STATIC){var H=G.velocity.norm2()+G.angularVelocity.norm2(),W=Math.pow(G.sleepSpeedLimit,2);H>=2*W&&(b._wakeUpAfterNarrowphase=!0)}if(G.allowSleep&&G.type===d.DYNAMIC&&G.sleepState===d.SLEEPING&&b.sleepState===d.AWAKE&&b.type!==d.STATIC){var X=b.velocity.norm2()+b.angularVelocity.norm2(),Y=Math.pow(b.sleepSpeedLimit,2);X>=2*Y&&(G._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(b,G,!0),this.collisionMatrixPrevious.get(b,G)||(M.body=G,M.contact=D,b.dispatchEvent(M),M.body=b,G.dispatchEvent(M))}for(u&&(c.makeContactConstraints=performance.now()-t,t=performance.now()),x=0;x!==s;x++){var b=a[x];b._wakeUpAfterNarrowphase&&(b.wakeUp(),b._wakeUpAfterNarrowphase=!1)}var k=f.length;for(x=0;x!==k;x++){var D=f[x];D.update();for(var N=0,Q=D.equations.length;N!==Q;N++){var K=D.equations[N];l.addEquation(K)}}l.solve(e,this),u&&(c.solve=performance.now()-t),l.removeAllEquations();var Z=Math.pow;for(x=0;x!==s;x++){var b=a[x];if(b.type&p){var $=Z(1-b.linearDamping,e),J=b.velocity;J.mult($,J);var ee=b.angularVelocity;if(ee){var te=Z(1-b.angularDamping,e);ee.mult(te,ee)}}}for(this.dispatchEvent(S),x=0;x!==s;x++){var b=a[x];b.preStep&&b.preStep.call(b)}u&&(t=performance.now());{var ne=P,ie=F,re=this.stepnumber,oe=d.DYNAMIC|d.KINEMATIC,se=re%(this.quatNormalizeSkip+1)===0,ae=this.quatNormalizeFast,le=.5*e;r.types.PLANE,r.types.CONVEXPOLYHEDRON}for(x=0;x!==s;x++){var he=a[x],ue=he.force,ce=he.torque;if(he.type&oe&&he.sleepState!==d.SLEEPING){var pe=he.velocity,de=he.angularVelocity,fe=he.position,me=he.quaternion,ve=he.invMass,ye=he.invInertiaWorld;pe.x+=ue.x*ve*e,pe.y+=ue.y*ve*e,pe.z+=ue.z*ve*e,he.angularVelocity&&(ye.vmult(ce,L),L.mult(e,L),L.vadd(de,de)),fe.x+=pe.x*e,fe.y+=pe.y*e,fe.z+=pe.z*e,he.angularVelocity&&(ne.set(de.x,de.y,de.z,0),ne.mult(me,ie),me.x+=le*ie.x,me.y+=le*ie.y,me.z+=le*ie.z,me.w+=le*ie.w,se&&(ae?me.normalizeFast():me.normalize())),he.aabb&&(he.aabbNeedsUpdate=!0),he.updateInertiaWorld&&he.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,u&&(c.integrate=performance.now()-t),this.time+=e,this.stepnumber+=1,this.dispatchEvent(w),x=0;x!==s;x++){var b=a[x],ge=b.postStep;ge&&ge.call(b)}if(this.allowSleep)for(x=0;x!==s;x++)a[x].sleepTick(this.time)},i.prototype.clearForces=function(){for(var e=this.bodies,t=e.length,n=0;n!==t;n++){{var i=e[n];i.force,i.torque}i.force.set(0,0,0),i.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){t.exports=e(6),t.exports.color=e(5)},{5:5,6:6}],5:[function(e,t,n){var i=t.exports=i||{};i.color=i.color||{},i.utils=i.utils||{},i.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),i=e.length-1;i>=0;i--)n=[e[i].apply(this,n)];return n[0]}},each:function(t,n,i){if(e&&t.forEach===e)t.forEach(n,i);else if(t.length===t.length+0){for(var r=0,o=t.length;o>r;r++)if(r in t&&n.call(i,t[r],r)===this.BREAK)return}else for(var r in t)if(n.call(i,t[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),i.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(var n=t.hex.toString(16);n.length<6;)n="0"+n;return"#"+n}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(i.utils.common),i.Color=i.color.Color=function(e,t,n,i){function r(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(s(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(s(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(a(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV"),this.__state[t]=e}})}function s(e,n,r){if("HEX"===e.__state.space)e.__state[n]=t.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw"Corrupted color state";i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:n.s,v:n.v}),i.isNaN(n.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var l=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS=["r","g","b","h","s","v","hex","a"],i.extend(l.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),r(l.prototype,"r",2),r(l.prototype,"g",1),r(l.prototype,"b",0),o(l.prototype,"h"),o(l.prototype,"s"),o(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),l}(i.color.interpret=function(e,t){var n,i,r=function(){i=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(o,function(r){return r.litmus(e)?(t.each(r.conversions,function(r,o){return n=r.read(e),i===!1&&n!==!1?(i=n,n.conversionName=o,n.conversion=r,t.BREAK):void 0}),t.BREAK):void 0}),i},o=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===t?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null===t?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===t?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===t?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return r}(i.color.toString,i.utils.common),i.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),o=n*(1-t),s=n*(1-r*t),a=n*(1-(1-r)*t),l=[[n,a,o],[s,n,o],[o,n,a],[o,s,n],[a,o,n],[n,o,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var i,r,o=Math.min(e,t,n),s=Math.max(e,t,n),a=s-o;return 0==s?{h:0/0,s:0,v:0}:(r=a/s,i=e==s?(t-n)/a:t==s?2+(n-e)/a:4+(e-t)/a,i/=6,0>i&&(i+=1),{h:360*i,s:r,v:s/255})},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(t,n,i){return i<<(e=8*n)|t&~(255<<e)}}}(),i.color.toString,i.utils.common)},{}],6:[function(e,t,n){var i=t.exports=i||{};i.gui=i.gui||{},i.utils=i.utils||{},i.controllers=i.controllers||{},i.dom=i.dom||{},i.color=i.color||{},i.utils.css=function(){return{load:function(e,t){t=t||document;var n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,t){t=t||document;var n=document.createElement("style");n.type="text/css",n.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(n)}}}(),i.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(t[n])||(e[n]=t[n])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var n in t)this.isUndefined(e[n])&&(e[n]=t[n])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var n=t.call(arguments),i=e.length-1;i>=0;i--)n=[e[i].apply(this,n)];return n[0]}},each:function(t,n,i){if(e&&t.forEach===e)t.forEach(n,i);else if(t.length===t.length+0){for(var r=0,o=t.length;o>r;r++)if(r in t&&n.call(i,t[r],r)===this.BREAK)return}else for(var r in t)if(n.call(i,t[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),i.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(i.utils.common),i.dom.dom=function(e){function t(t){if("0"===t||e.isUndefined(t))return 0;var n=t.match(r);return e.isNull(n)?0:parseFloat(n[1])}var n={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},i={};e.each(n,function(t,n){e.each(t,function(e){i[e]=n})});var r=/(\d+(\.\d+)?)px/,o={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,n,i){e.isUndefined(n)&&(n=!0),e.isUndefined(i)&&(i=!0),t.style.position="absolute",n&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,n,r,o){r=r||{};var s=i[n];if(!s)throw new Error("Event type "+n+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":var l=r.x||r.clientX||0,h=r.y||r.clientY||0;a.initMouseEvent(n,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,h,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=a.initKeyboardEvent||a.initKeyEvent;e.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(n,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(n,r.bubbles||!1,r.cancelable||!0)}e.defaults(a,o),t.dispatchEvent(a)},bind:function(e,t,n,i){return i=i||!1,e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),o},unbind:function(e,t,n,i){return i=i||!1,e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),o},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1==n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return o},removeClass:function(e,t){if(t)if(void 0===e.className);else if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!=i&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return o},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return t(n["border-left-width"])+t(n["border-right-width"])+t(n["padding-left"])+t(n["padding-right"])+t(n.width)},getHeight:function(e){var n=getComputedStyle(e);return t(n["border-top-width"])+t(n["border-bottom-width"])+t(n["padding-top"])+t(n["padding-bottom"])+t(n.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return o}(i.utils.common),i.controllers.OptionController=function(e,t,n){var i=function(e,r,o){i.superclass.call(this,e,r);var s=this;if(this.__select=document.createElement("select"),n.isArray(o)){var a={};n.each(o,function(e){a[e]=e}),o=a}n.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),this.updateDisplay(),t.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),this.domElement.appendChild(this.__select)};return i.superclass=e,n.extend(i.prototype,e.prototype,{setValue:function(e){var t=i.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),t},updateDisplay:function(){return this.__select.value=this.getValue(),i.superclass.prototype.updateDisplay.call(this)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.NumberController=function(e,t){function n(e){return e=e.toString(),e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var i=function(e,r,o){i.superclass.call(this,e,r),o=o||{},this.__min=o.min,this.__max=o.max,this.__step=o.step,this.__impliedStep=t.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,this.__precision=n(this.__impliedStep)};return i.superclass=e,t.extend(i.prototype,e.prototype,{setValue:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),i.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),i}(i.controllers.Controller,i.utils.common),i.controllers.NumberControllerBox=function(e,t,n){function i(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var r=function(e,i,o){function s(){var e=parseFloat(p.__input.value);n.isNaN(e)||p.setValue(e)}function a(){s(),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}function l(e){t.bind(window,"mousemove",h),t.bind(window,"mouseup",u),c=e.clientY}function h(e){var t=c-e.clientY;p.setValue(p.getValue()+t*p.__impliedStep),c=e.clientY}function u(){t.unbind(window,"mousemove",h),t.unbind(window,"mouseup",u)}this.__truncationSuspended=!1,r.superclass.call(this,e,i,o);var c,p=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",s),t.bind(this.__input,"blur",a),t.bind(this.__input,"mousedown",l),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&(p.__truncationSuspended=!0,this.blur(),p.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return r.superclass=e,n.extend(r.prototype,e.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():i(this.getValue(),this.__precision),r.superclass.prototype.updateDisplay.call(this)}}),r}(i.controllers.NumberController,i.dom.dom,i.utils.common),i.controllers.NumberControllerSlider=function(e,t,n,i,r){function o(e,t,n,i,r){return i+(r-i)*((e-t)/(n-t))}var s=function(e,n,i,r,a){function l(e){t.bind(window,"mousemove",h),t.bind(window,"mouseup",u),h(e)}function h(e){e.preventDefault();var n=t.getOffset(c.__background),i=t.getWidth(c.__background);return c.setValue(o(e.clientX,n.left,n.left+i,c.__min,c.__max)),!1}function u(){t.unbind(window,"mousemove",h),t.unbind(window,"mouseup",u),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}s.superclass.call(this,e,n,{min:i,max:r,step:a});var c=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",l),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return s.superclass=e,s.useDefaultStyles=function(){n.inject(r)},i.extend(s.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",s.superclass.prototype.updateDisplay.call(this)}}),s}(i.controllers.NumberController,i.dom.dom,i.utils.css,i.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),i.controllers.FunctionController=function(e,t,n){var i=function(e,n,r){i.superclass.call(this,e,n);var o=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===r?"Fire":r,t.bind(this.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return i.superclass=e,n.extend(i.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.BooleanController=function(e,t,n){var i=function(e,n){function r(){o.setValue(!o.__prev)}i.superclass.call(this,e,n);var o=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",r,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return i.superclass=e,n.extend(i.prototype,e.prototype,{setValue:function(e){var t=i.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),t},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,i.superclass.prototype.updateDisplay.call(this)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(var n=t.hex.toString(16);n.length<6;)n="0"+n;return"#"+n}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(i.utils.common),i.color.interpret=function(e,t){var n,i,r=function(){i=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(o,function(r){return r.litmus(e)?(t.each(r.conversions,function(r,o){return n=r.read(e),i===!1&&n!==!1?(i=n,n.conversionName=o,n.conversion=r,t.BREAK):void 0}),t.BREAK):void 0}),i},o=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===t?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null===t?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString())}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===t?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===t?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return r}(i.color.toString,i.utils.common),i.GUI=i.gui.GUI=function(e,t,n,i,r,o,s,a,l,h,u,c,p,d,f){function m(e,t,n,o){if(void 0===t[n])throw new Error("Object "+t+' has no property "'+n+'"');var s;if(o.color)s=new u(t,n);else{var a=[t,n].concat(o.factoryArgs);s=i.apply(e,a)}o.before instanceof r&&(o.before=o.before.__li),g(e,s),d.addClass(s.domElement,"c");var l=document.createElement("span");d.addClass(l,"property-name"),l.innerHTML=s.property;var h=document.createElement("div");h.appendChild(l),h.appendChild(s.domElement);var c=v(e,h,o.before);return d.addClass(c,V.CLASS_CONTROLLER_ROW),d.addClass(c,typeof s.getValue()),y(e,c,s),e.__controllers.push(s),s}function v(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,params.before):e.__ul.appendChild(i),e.onResize(),i}function y(e,t,n){if(n.__li=t,n.__gui=e,f.extend(n,{options:function(t){return arguments.length>1?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[f.toArray(arguments)]})):f.isArray(t)||f.isObject(t)?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[t]})):void 0},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof l){var i=new a(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});f.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=n[e],r=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(n,e),r.apply(i,e)}}),d.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof a){var r=function(t){return f.isNumber(n.__min)&&f.isNumber(n.__max)?(n.remove(),m(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):t};n.min=f.compose(r,n.min),n.max=f.compose(r,n.max)}else n instanceof o?(d.bind(t,"click",function(){d.fakeEvent(n.__checkbox,"click")}),d.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof s?(d.bind(t,"click",function(){d.fakeEvent(n.__button,"click")}),d.bind(t,"mouseover",function(){d.addClass(n.__button,"hover")}),d.bind(t,"mouseout",function(){d.removeClass(n.__button,"hover")})):n instanceof u&&(d.addClass(t,"color"),
n.updateDisplay=f.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=f.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&E(e.getRoot(),!0),t},n.setValue)}function g(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!=i){var r=n.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r),r[t.property]=t,n.load&&n.load.remembered){var o,s=n.load.remembered;if(s[e.preset])o=s[e.preset];else{if(!s[B])return;o=s[B]}if(o[i]&&void 0!==o[i][t.property]){var a=o[i][t.property];t.initialValue=a,t.setValue(a)}}}}function x(e,t){return document.location.href+"."+t}function b(e){function t(){h.style.display=e.useLocalStorage?"block":"none"}var n=e.__save_row=document.createElement("li");d.addClass(e.domElement,"has-save"),e.__ul.insertBefore(n,e.__ul.firstChild),d.addClass(n,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",d.addClass(i,"button gears");var r=document.createElement("span");r.innerHTML="Save",d.addClass(r,"button"),d.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",d.addClass(o,"button"),d.addClass(o,"save-as");var s=document.createElement("span");s.innerHTML="Revert",d.addClass(s,"button"),d.addClass(s,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?f.each(e.load.remembered,function(t,n){M(e,n,n==e.preset)}):M(e,B,!1),d.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),n.appendChild(a),n.appendChild(i),n.appendChild(r),n.appendChild(o),n.appendChild(s),k){var l=document.getElementById("dg-save-locally"),h=document.getElementById("dg-local-explain");l.style.display="block";var u=document.getElementById("dg-local-storage");"true"===localStorage.getItem(x(e,"isLocal"))&&u.setAttribute("checked","checked"),t(),d.bind(u,"change",function(){e.useLocalStorage=!e.useLocalStorage,t()})}var c=document.getElementById("dg-new-constructor");d.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!=e.keyCode||A.hide()}),d.bind(i,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),A.show(),c.focus(),c.select()}),d.bind(r,"click",function(){e.save()}),d.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),d.bind(s,"click",function(){e.revert()})}function _(e){function t(t){return t.preventDefault(),r=t.clientX,d.addClass(e.__closeButton,V.CLASS_DRAG),d.bind(window,"mousemove",n),d.bind(window,"mouseup",i),!1}function n(t){return t.preventDefault(),e.width+=r-t.clientX,e.onResize(),r=t.clientX,!1}function i(){d.removeClass(e.__closeButton,V.CLASS_DRAG),d.unbind(window,"mousemove",n),d.unbind(window,"mouseup",i)}e.__resize_handle=document.createElement("div"),f.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var r;d.bind(e.__resize_handle,"mousedown",t),d.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function w(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function S(e,t){var n={};return f.each(e.__rememberedObjects,function(i,r){var o={},s=e.__rememberedObjectIndecesToControllers[r];f.each(s,function(e,n){o[n]=t?e.initialValue:e.getValue()}),n[r]=o}),n}function M(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function T(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value==e.preset&&(e.__preset_select.selectedIndex=t)}function E(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function C(e){0!=e.length&&c(function(){C(e)}),f.each(e,function(e){e.updateDisplay()})}e.inject(n);var A,P,F="dg",L=72,R=20,B="Default",k=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),D=!0,N=!1,O=[],V=function(e){function t(){localStorage.setItem(x(i,"gui"),JSON.stringify(i.getSaveObject()))}function n(){var e=i.getRoot();e.width+=1,f.defer(function(){e.width-=1})}var i=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),d.addClass(this.domElement,F),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=f.defaults(e,{autoPlace:!0,width:V.DEFAULT_WIDTH}),e=f.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),f.isUndefined(e.load)?e.load={preset:B}:e.preset&&(e.load.preset=e.preset),f.isUndefined(e.parent)&&e.hideable&&O.push(this),e.resizable=f.isUndefined(e.parent)&&e.resizable,e.autoPlace&&f.isUndefined(e.scrollable)&&(e.scrollable=!0);var r=k&&"true"===localStorage.getItem(x(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return i.parent?i.getRoot().preset:e.load.preset},set:function(t){i.parent?i.getRoot().preset=t:e.load.preset=t,T(this),i.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,w(i,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,s&&(s.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?d.addClass(i.__ul,V.CLASS_CLOSED):d.removeClass(i.__ul,V.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=t?V.TEXT_OPEN:V.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return r},set:function(e){k&&(r=e,e?d.bind(window,"unload",t):d.unbind(window,"unload",t),localStorage.setItem(x(i,"isLocal"),e))}}}),f.isUndefined(e.parent)){if(e.closed=!1,d.addClass(this.domElement,V.CLASS_MAIN),d.makeSelectable(this.domElement,!1),k&&r){i.useLocalStorage=!0;var o=localStorage.getItem(x(this,"gui"));o&&(e.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=V.TEXT_CLOSED,d.addClass(this.__closeButton,V.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),d.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===e.closed&&(e.closed=!0);var s=document.createTextNode(e.name);d.addClass(s,"controller-name");var a=v(i,s),l=function(e){return e.preventDefault(),i.closed=!i.closed,!1};d.addClass(this.__ul,V.CLASS_CLOSED),d.addClass(a,"title"),d.bind(a,"click",l),e.closed||(this.closed=!1)}e.autoPlace&&(f.isUndefined(e.parent)&&(D&&(P=document.createElement("div"),d.addClass(P,F),d.addClass(P,V.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(P),D=!1),P.appendChild(this.domElement),d.addClass(this.domElement,V.CLASS_AUTO_PLACE)),this.parent||w(i,e.width)),d.bind(window,"resize",function(){i.onResize()}),d.bind(this.__ul,"webkitTransitionEnd",function(){i.onResize()}),d.bind(this.__ul,"transitionend",function(){i.onResize()}),d.bind(this.__ul,"oTransitionEnd",function(){i.onResize()}),this.onResize(),e.resizable&&_(this);i.getRoot();e.parent||n()};return V.toggleHide=function(){N=!N,f.each(O,function(e){e.domElement.style.zIndex=N?-999:999,e.domElement.style.opacity=N?0:1})},V.CLASS_AUTO_PLACE="a",V.CLASS_AUTO_PLACE_CONTAINER="ac",V.CLASS_MAIN="main",V.CLASS_CONTROLLER_ROW="cr",V.CLASS_TOO_TALL="taller-than-window",V.CLASS_CLOSED="closed",V.CLASS_CLOSE_BUTTON="close-button",V.CLASS_DRAG="drag",V.DEFAULT_WIDTH=245,V.TEXT_CLOSED="Close Controls",V.TEXT_OPEN="Open Controls",d.bind(window,"keydown",function(e){"text"===document.activeElement.type||e.which!==L&&e.keyCode!=L||V.toggleHide()},!1),f.extend(V.prototype,{add:function(e,t){return m(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return m(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;f.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&P.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new V(t);this.__folders[e]=n;var i=v(this,n.domElement);return d.addClass(i,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=d.getOffset(e.__ul).top,n=0;f.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=d.getHeight(t))}),window.innerHeight-t-R<n?(d.addClass(e.domElement,V.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-R+"px"):(d.removeClass(e.domElement,V.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&f.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(f.isUndefined(A)&&(A=new p,A.domElement.innerHTML=t),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;f.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&b(e),-1==e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&w(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=S(this)),e.folders={},f.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=S(this),E(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[B]=S(this,!0)),this.load.remembered[e]=S(this),this.preset=e,M(this,e,!0)},revert:function(e){f.each(this.__controllers,function(t){this.getRoot().load.remembered?g(e||this.getRoot(),t):t.setValue(t.initialValue)},this),f.each(this.__folders,function(e){e.revert(e)}),e||E(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&C(this.__listening)}}),V}(i.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",i.controllers.factory=function(e,t,n,i,r,o,s){return function(a,l){var h=a[l];return s.isArray(arguments[2])||s.isObject(arguments[2])?new e(a,l,arguments[2]):s.isNumber(h)?s.isNumber(arguments[2])&&s.isNumber(arguments[3])?new n(a,l,arguments[2],arguments[3]):new t(a,l,{min:arguments[2],max:arguments[3]}):s.isString(h)?new i(a,l):s.isFunction(h)?new r(a,l,""):s.isBoolean(h)?new o(a,l):void 0}}(i.controllers.OptionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.StringController=function(e,t,n){var i=function(e,n){function r(){s.setValue(s.__input.value)}function o(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}i.superclass.call(this,e,n);var s=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",r),t.bind(this.__input,"change",r),t.bind(this.__input,"blur",o),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return i.superclass=e,n.extend(i.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),i.superclass.prototype.updateDisplay.call(this)}}),i}(i.controllers.Controller,i.dom.dom,i.utils.common),i.controllers.FunctionController,i.controllers.BooleanController,i.utils.common),i.controllers.Controller,i.controllers.BooleanController,i.controllers.FunctionController,i.controllers.NumberControllerBox,i.controllers.NumberControllerSlider,i.controllers.OptionController,i.controllers.ColorController=function(e,t,n,i,r){function o(e,t,n,i){e.style.background="",r.each(l,function(r){e.style.cssText+="background: "+r+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}function s(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var a=function(e,l){function h(e){d(e),t.bind(window,"mousemove",d),t.bind(window,"mouseup",u)}function u(){t.unbind(window,"mousemove",d),t.unbind(window,"mouseup",u)}function c(){var e=i(this.value);e!==!1?(m.__color.__state=e,m.setValue(m.__color.toOriginal())):this.value=m.__color.toString()}function p(){t.unbind(window,"mousemove",f),t.unbind(window,"mouseup",p)}function d(e){e.preventDefault();var n=t.getWidth(m.__saturation_field),i=t.getOffset(m.__saturation_field),r=(e.clientX-i.left+document.body.scrollLeft)/n,o=1-(e.clientY-i.top+document.body.scrollTop)/n;return o>1?o=1:0>o&&(o=0),r>1?r=1:0>r&&(r=0),m.__color.v=o,m.__color.s=r,m.setValue(m.__color.toOriginal()),!1}function f(e){e.preventDefault();var n=t.getHeight(m.__hue_field),i=t.getOffset(m.__hue_field),r=1-(e.clientY-i.top+document.body.scrollTop)/n;return r>1?r=1:0>r&&(r=0),m.__color.h=360*r,m.setValue(m.__color.toOriginal()),!1}a.superclass.call(this,e,l),this.__color=new n(this.getValue()),this.__temp=new n(0);var m=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){13===e.keyCode&&c.call(this)}),t.bind(this.__input,"blur",c),t.bind(this.__selector,"mousedown",function(e){t.addClass(this,"drag").bind(window,"mouseup",function(e){t.removeClass(m.__selector,"drag")})});var v=document.createElement("div");r.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),r.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),r.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),r.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),r.extend(v.style,{width:"100%",height:"100%",background:"none"}),o(v,"top","rgba(0,0,0,0)","#000"),r.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),s(this.__hue_field),r.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",h),t.bind(this.__field_knob,"mousedown",h),t.bind(this.__hue_field,"mousedown",function(e){f(e),t.bind(window,"mousemove",f),t.bind(window,"mouseup",p)}),this.__saturation_field.appendChild(v),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};a.superclass=e,r.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=i(this.getValue());if(e!==!1){var t=!1;r.each(n.COMPONENTS,function(n){return r.isUndefined(e[n])||r.isUndefined(this.__color.__state[n])||e[n]===this.__color.__state[n]?void 0:(t=!0,{})},this),t&&r.extend(this.__color.__state,e)}r.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,a=255-s;r.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,o(this.__saturation_field,"left","#fff",this.__temp.toString()),r.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var l=["-moz-","-o-","-webkit-","-ms-",""];return a}(i.controllers.Controller,i.dom.dom,i.color.Color=function(e,t,n,i){function r(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(s(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(s(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(a(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV"),this.__state[t]=e}})}function s(e,n,r){if("HEX"===e.__state.space)e.__state[n]=t.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw"Corrupted color state";i.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function a(e){var n=t.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:n.s,v:n.v}),i.isNaN(n.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var l=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS=["r","g","b","h","s","v","hex","a"],i.extend(l.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),r(l.prototype,"r",2),r(l.prototype,"g",1),r(l.prototype,"b",0),o(l.prototype,"h"),o(l.prototype,"s"),o(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),l}(i.color.interpret,i.color.math=function(){var e;return{hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),o=n*(1-t),s=n*(1-r*t),a=n*(1-(1-r)*t),l=[[n,a,o],[s,n,o],[o,n,a],[o,s,n],[a,o,n],[n,o,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var i,r,o=Math.min(e,t,n),s=Math.max(e,t,n),a=s-o;return 0==s?{h:0/0,s:0,v:0}:(r=a/s,i=e==s?(t-n)/a:t==s?2+(n-e)/a:4+(e-t)/a,i/=6,0>i&&(i+=1),{h:360*i,s:r,v:s/255})},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(t,n,i){return i<<(e=8*n)|t&~(255<<e)}}}(),i.color.toString,i.utils.common),i.color.interpret,i.utils.common),i.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}(),i.dom.CenteredDiv=function(e,t){var n=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var t=this,n=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",n),e.unbind(t.domElement,"transitionend",n),e.unbind(t.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(i.dom.dom,i.utils.common),i.dom.dom,i.utils.common)},{}],7:[function(e,t,n){!function(e,n){"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?n(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=e.length,n=J.type(e);return"function"===n||J.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function i(e,t,n){if(J.isFunction(t))return J.grep(e,function(e,i){return!!t.call(e,i,e)!==n});if(t.nodeType)return J.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(ae.test(t))return J.filter(t,e,n);t=J.filter(t,e)}return J.grep(e,function(e){return W.call(t,e)>=0!==n})}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=fe[e]={};return J.each(e.match(de)||[],function(e,n){t[n]=!0}),t}function s(){Z.removeEventListener("DOMContentLoaded",s,!1),e.removeEventListener("load",s,!1),J.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=J.expando+a.uid++}function l(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace(be,"-$1").toLowerCase(),n=e.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:xe.test(n)?J.parseJSON(n):n}catch(r){}ge.set(e,t,n)}else n=void 0;return n}function h(){return!0}function u(){return!1}function c(){try{return Z.activeElement}catch(e){}}function p(e,t){return J.nodeName(e,"table")&&J.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function d(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function f(e){var t=Ne.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var n=0,i=e.length;i>n;n++)ye.set(e[n],"globalEval",!t||ye.get(t[n],"globalEval"))}function v(e,t){var n,i,r,o,s,a,l,h;if(1===t.nodeType){if(ye.hasData(e)&&(o=ye.access(e),s=ye.set(t,o),h=o.events)){delete s.handle,s.events={};for(r in h)for(n=0,i=h[r].length;i>n;n++)J.event.add(t,r,h[r][n])}ge.hasData(e)&&(a=ge.access(e),l=J.extend({},a),ge.set(t,l))}}function y(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&J.nodeName(e,t)?J.merge([e],n):n}function g(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Me.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function x(t,n){var i,r=J(n.createElement(t)).appendTo(n.body),o=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(r[0]))?i.display:J.css(r[0],"display");return r.detach(),o}function b(e){var t=Z,n=Ue[e];return n||(n=x(e,t),"none"!==n&&n||(ze=(ze||J("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=ze[0].contentDocument,t.write(),t.close(),n=x(e,t),ze.detach()),Ue[e]=n),n}function _(e,t,n){var i,r,o,s,a=e.style;return n=n||Ge(e),n&&(s=n.getPropertyValue(t)||n[t]),n&&(""!==s||J.contains(e.ownerDocument,e)||(s=J.style(e,t)),je.test(s)&&Ie.test(t)&&(i=a.width,r=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=i,a.minWidth=r,a.maxWidth=o)),void 0!==s?s+"":s}function w(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function S(e,t){if(t in e)return t;for(var n=t[0].toUpperCase()+t.slice(1),i=t,r=Qe.length;r--;)if(t=Qe[r]+n,t in e)return t;return i}function M(e,t,n){var i=He.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function T(e,t,n,i,r){for(var o=n===(i?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===n&&(s+=J.css(e,n+we[o],!0,r)),
i?("content"===n&&(s-=J.css(e,"padding"+we[o],!0,r)),"margin"!==n&&(s-=J.css(e,"border"+we[o]+"Width",!0,r))):(s+=J.css(e,"padding"+we[o],!0,r),"padding"!==n&&(s+=J.css(e,"border"+we[o]+"Width",!0,r)));return s}function E(e,t,n){var i=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=Ge(e),s="border-box"===J.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=_(e,t,o),(0>r||null==r)&&(r=e.style[t]),je.test(r))return r;i=s&&(K.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+T(e,t,n||(s?"border":"content"),i,o)+"px"}function C(e,t){for(var n,i,r,o=[],s=0,a=e.length;a>s;s++)i=e[s],i.style&&(o[s]=ye.get(i,"olddisplay"),n=i.style.display,t?(o[s]||"none"!==n||(i.style.display=""),""===i.style.display&&Se(i)&&(o[s]=ye.access(i,"olddisplay",b(i.nodeName)))):(r=Se(i),"none"===n&&r||ye.set(i,"olddisplay",r?n:J.css(i,"display"))));for(s=0;a>s;s++)i=e[s],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[s]||"":"none"));return e}function A(e,t,n,i,r){return new A.prototype.init(e,t,n,i,r)}function P(){return setTimeout(function(){Ke=void 0}),Ke=J.now()}function F(e,t){var n,i=0,r={height:e};for(t=t?1:0;4>i;i+=2-t)n=we[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function L(e,t,n){for(var i,r=(nt[t]||[]).concat(nt["*"]),o=0,s=r.length;s>o;o++)if(i=r[o].call(n,t,e))return i}function R(e,t,n){var i,r,o,s,a,l,h,u,c=this,p={},d=e.style,f=e.nodeType&&Se(e),m=ye.get(e,"fxshow");n.queue||(a=J._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,c.always(function(){c.always(function(){a.unqueued--,J.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],h=J.css(e,"display"),u="none"===h?ye.get(e,"olddisplay")||b(e.nodeName):h,"inline"===u&&"none"===J.css(e,"float")&&(d.display="inline-block")),n.overflow&&(d.overflow="hidden",c.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(r=t[i],$e.exec(r)){if(delete t[i],o=o||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!m||void 0===m[i])continue;f=!0}p[i]=m&&m[i]||J.style(e,i)}else h=void 0;if(J.isEmptyObject(p))"inline"===("none"===h?b(e.nodeName):h)&&(d.display=h);else{m?"hidden"in m&&(f=m.hidden):m=ye.access(e,"fxshow",{}),o&&(m.hidden=!f),f?J(e).show():c.done(function(){J(e).hide()}),c.done(function(){var t;ye.remove(e,"fxshow");for(t in p)J.style(e,t,p[t])});for(i in p)s=L(f?m[i]:0,i,c),i in m||(m[i]=s.start,f&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function B(e,t){var n,i,r,o,s;for(n in e)if(i=J.camelCase(n),r=t[i],o=e[n],J.isArray(o)&&(r=o[1],o=e[n]=o[0]),n!==i&&(e[i]=o,delete e[n]),s=J.cssHooks[i],s&&"expand"in s){o=s.expand(o),delete e[i];for(n in o)n in e||(e[n]=o[n],t[n]=r)}else t[i]=r}function k(e,t,n){var i,r,o=0,s=tt.length,a=J.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Ke||P(),n=Math.max(0,h.startTime+h.duration-t),i=n/h.duration||0,o=1-i,s=0,l=h.tweens.length;l>s;s++)h.tweens[s].run(o);return a.notifyWith(e,[h,o,n]),1>o&&l?n:(a.resolveWith(e,[h]),!1)},h=a.promise({elem:e,props:J.extend({},t),opts:J.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Ke||P(),duration:n.duration,tweens:[],createTween:function(t,n){var i=J.Tween(e,h.opts,t,n,h.opts.specialEasing[t]||h.opts.easing);return h.tweens.push(i),i},stop:function(t){var n=0,i=t?h.tweens.length:0;if(r)return this;for(r=!0;i>n;n++)h.tweens[n].run(1);return t?a.resolveWith(e,[h,t]):a.rejectWith(e,[h,t]),this}}),u=h.props;for(B(u,h.opts.specialEasing);s>o;o++)if(i=tt[o].call(h,e,u,h.opts))return i;return J.map(u,L,h),J.isFunction(h.opts.start)&&h.opts.start.call(e,h),J.fx.timer(J.extend(l,{elem:e,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function D(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,o=t.toLowerCase().match(de)||[];if(J.isFunction(n))for(;i=o[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function N(e,t,n,i){function r(a){var l;return o[a]=!0,J.each(e[a]||[],function(e,a){var h=a(t,n,i);return"string"!=typeof h||s||o[h]?s?!(l=h):void 0:(t.dataTypes.unshift(h),r(h),!1)}),l}var o={},s=e===xt;return r(t.dataTypes[0])||!o["*"]&&r("*")}function O(e,t){var n,i,r=J.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((r[n]?e:i||(i={}))[n]=t[n]);return i&&J.extend(!0,e,i),e}function V(e,t,n){for(var i,r,o,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(r in a)if(a[r]&&a[r].test(i)){l.unshift(r);break}if(l[0]in n)o=l[0];else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}s||(s=r)}o=o||s}return o?(o!==l[0]&&l.unshift(o),n[o]):void 0}function z(e,t,n,i){var r,o,s,a,l,h={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)h[s.toLowerCase()]=e.converters[s];for(o=u.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=u.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(s=h[l+" "+o]||h["* "+o],!s)for(r in h)if(a=r.split(" "),a[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){s===!0?s=h[r]:h[r]!==!0&&(o=a[0],u.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(c){return{state:"parsererror",error:s?c:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function U(e,t,n,i){var r;if(J.isArray(t))J.each(t,function(t,r){n||Mt.test(e)?i(e,r):U(e+"["+("object"==typeof r?t:"")+"]",r,n,i)});else if(n||"object"!==J.type(t))i(e,t);else for(r in t)U(e+"["+r+"]",t[r],n,i)}function I(e){return J.isWindow(e)?e:9===e.nodeType&&e.defaultView}var j=[],G=j.slice,q=j.concat,H=j.push,W=j.indexOf,X={},Y=X.toString,Q=X.hasOwnProperty,K={},Z=e.document,$="2.1.3",J=function(e,t){return new J.fn.init(e,t)},ee=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,te=/^-ms-/,ne=/-([\da-z])/gi,ie=function(e,t){return t.toUpperCase()};J.fn=J.prototype={jquery:$,constructor:J,selector:"",length:0,toArray:function(){return G.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:G.call(this)},pushStack:function(e){var t=J.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return J.each(this,e,t)},map:function(e){return this.pushStack(J.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(G.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:H,sort:j.sort,splice:j.splice},J.extend=J.fn.extend=function(){var e,t,n,i,r,o,s=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[a]||{},a++),"object"==typeof s||J.isFunction(s)||(s={}),a===l&&(s=this,a--);l>a;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],i=e[t],s!==i&&(h&&i&&(J.isPlainObject(i)||(r=J.isArray(i)))?(r?(r=!1,o=n&&J.isArray(n)?n:[]):o=n&&J.isPlainObject(n)?n:{},s[t]=J.extend(h,o,i)):void 0!==i&&(s[t]=i));return s},J.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===J.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!J.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==J.type(e)||e.nodeType||J.isWindow(e)?!1:e.constructor&&!Q.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?X[Y.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;e=J.trim(e),e&&(1===e.indexOf("use strict")?(t=Z.createElement("script"),t.text=e,Z.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(te,"ms-").replace(ne,ie)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var r,o=0,s=e.length,a=n(e);if(i){if(a)for(;s>o&&(r=t.apply(e[o],i),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],i),r===!1)break}else if(a)for(;s>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ee,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?J.merge(i,"string"==typeof e?[e]:e):H.call(i,e)),i},inArray:function(e,t,n){return null==t?-1:W.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,r=e.length;n>i;i++)e[r++]=t[i];return e.length=r,e},grep:function(e,t,n){for(var i,r=[],o=0,s=e.length,a=!n;s>o;o++)i=!t(e[o],o),i!==a&&r.push(e[o]);return r},map:function(e,t,i){var r,o=0,s=e.length,a=n(e),l=[];if(a)for(;s>o;o++)r=t(e[o],o,i),null!=r&&l.push(r);else for(o in e)r=t(e[o],o,i),null!=r&&l.push(r);return q.apply([],l)},guid:1,proxy:function(e,t){var n,i,r;return"string"==typeof t&&(n=e[t],t=e,e=n),J.isFunction(e)?(i=G.call(arguments,2),r=function(){return e.apply(t||this,i.concat(G.call(arguments)))},r.guid=e.guid=e.guid||J.guid++,r):void 0},now:Date.now,support:K}),J.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){X["[object "+t+"]"]=t.toLowerCase()});var re=function(e){function t(e,t,n,i){var r,o,s,a,l,h,c,d,f,m;if((t?t.ownerDocument||t:U)!==R&&L(t),t=t||R,n=n||[],a=t.nodeType,"string"!=typeof e||!e||1!==a&&9!==a&&11!==a)return n;if(!i&&k){if(11!==a&&(r=ge.exec(e)))if(s=r[1]){if(9===a){if(o=t.getElementById(s),!o||!o.parentNode)return n;if(o.id===s)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&V(t,o)&&o.id===s)return n.push(o),n}else{if(r[2])return $.apply(n,t.getElementsByTagName(e)),n;if((s=r[3])&&_.getElementsByClassName)return $.apply(n,t.getElementsByClassName(s)),n}if(_.qsa&&(!D||!D.test(e))){if(d=c=z,f=t,m=1!==a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(h=T(e),(c=t.getAttribute("id"))?d=c.replace(be,"\\$&"):t.setAttribute("id",d),d="[id='"+d+"'] ",l=h.length;l--;)h[l]=d+p(h[l]);f=xe.test(e)&&u(t.parentNode)||t,m=h.join(",")}if(m)try{return $.apply(n,f.querySelectorAll(m)),n}catch(v){}finally{c||t.removeAttribute("id")}}}return C(e.replace(le,"$1"),t,n,i)}function n(){function e(n,i){return t.push(n+" ")>w.cacheLength&&delete e[t.shift()],e[n+" "]=i}var t=[];return e}function i(e){return e[z]=!0,e}function r(e){var t=R.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var n=e.split("|"),i=e.length;i--;)w.attrHandle[n[i]]=t}function s(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||X)-(~e.sourceIndex||X);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function h(e){return i(function(t){return t=+t,i(function(n,i){for(var r,o=e([],n.length,t),s=o.length;s--;)n[r=o[s]]&&(n[r]=!(i[r]=n[r]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function c(){}function p(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function d(e,t,n){var i=t.dir,r=n&&"parentNode"===i,o=j++;return t.first?function(t,n,o){for(;t=t[i];)if(1===t.nodeType||r)return e(t,n,o)}:function(t,n,s){var a,l,h=[I,o];if(s){for(;t=t[i];)if((1===t.nodeType||r)&&e(t,n,s))return!0}else for(;t=t[i];)if(1===t.nodeType||r){if(l=t[z]||(t[z]={}),(a=l[i])&&a[0]===I&&a[1]===o)return h[2]=a[2];if(l[i]=h,h[2]=e(t,n,s))return!0}}}function f(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function m(e,n,i){for(var r=0,o=n.length;o>r;r++)t(e,n[r],i);return i}function v(e,t,n,i,r){for(var o,s=[],a=0,l=e.length,h=null!=t;l>a;a++)(o=e[a])&&(!n||n(o,i,r))&&(s.push(o),h&&t.push(a));return s}function y(e,t,n,r,o,s){return r&&!r[z]&&(r=y(r)),o&&!o[z]&&(o=y(o,s)),i(function(i,s,a,l){var h,u,c,p=[],d=[],f=s.length,y=i||m(t||"*",a.nodeType?[a]:a,[]),g=!e||!i&&t?y:v(y,p,e,a,l),x=n?o||(i?e:f||r)?[]:s:g;if(n&&n(g,x,a,l),r)for(h=v(x,d),r(h,[],a,l),u=h.length;u--;)(c=h[u])&&(x[d[u]]=!(g[d[u]]=c));if(i){if(o||e){if(o){for(h=[],u=x.length;u--;)(c=x[u])&&h.push(g[u]=c);o(null,x=[],h,l)}for(u=x.length;u--;)(c=x[u])&&(h=o?ee(i,c):p[u])>-1&&(i[h]=!(s[h]=c))}}else x=v(x===s?x.splice(f,x.length):x),o?o(null,s,x,l):$.apply(s,x)})}function g(e){for(var t,n,i,r=e.length,o=w.relative[e[0].type],s=o||w.relative[" "],a=o?1:0,l=d(function(e){return e===t},s,!0),h=d(function(e){return ee(t,e)>-1},s,!0),u=[function(e,n,i){var r=!o&&(i||n!==A)||((t=n).nodeType?l(e,n,i):h(e,n,i));return t=null,r}];r>a;a++)if(n=w.relative[e[a].type])u=[d(f(u),n)];else{if(n=w.filter[e[a].type].apply(null,e[a].matches),n[z]){for(i=++a;r>i&&!w.relative[e[i].type];i++);return y(a>1&&f(u),a>1&&p(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(le,"$1"),n,i>a&&g(e.slice(a,i)),r>i&&g(e=e.slice(i)),r>i&&p(e))}u.push(n)}return f(u)}function x(e,n){var r=n.length>0,o=e.length>0,s=function(i,s,a,l,h){var u,c,p,d=0,f="0",m=i&&[],y=[],g=A,x=i||o&&w.find.TAG("*",h),b=I+=null==g?1:Math.random()||.1,_=x.length;for(h&&(A=s!==R&&s);f!==_&&null!=(u=x[f]);f++){if(o&&u){for(c=0;p=e[c++];)if(p(u,s,a)){l.push(u);break}h&&(I=b)}r&&((u=!p&&u)&&d--,i&&m.push(u))}if(d+=f,r&&f!==d){for(c=0;p=n[c++];)p(m,y,s,a);if(i){if(d>0)for(;f--;)m[f]||y[f]||(y[f]=K.call(l));y=v(y)}$.apply(l,y),h&&!i&&y.length>0&&d+n.length>1&&t.uniqueSort(l)}return h&&(I=b,A=g),m};return r?i(s):s}var b,_,w,S,M,T,E,C,A,P,F,L,R,B,k,D,N,O,V,z="sizzle"+1*new Date,U=e.document,I=0,j=0,G=n(),q=n(),H=n(),W=function(e,t){return e===t&&(F=!0),0},X=1<<31,Y={}.hasOwnProperty,Q=[],K=Q.pop,Z=Q.push,$=Q.push,J=Q.slice,ee=function(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",ie="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",re=ie.replace("w","w#"),oe="\\["+ne+"*("+ie+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",se=":("+ie+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),le=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),he=new RegExp("^"+ne+"*,"+ne+"*"),ue=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),ce=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),pe=new RegExp(se),de=new RegExp("^"+re+"$"),fe={ID:new RegExp("^#("+ie+")"),CLASS:new RegExp("^\\.("+ie+")"),TAG:new RegExp("^("+ie.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,ve=/^h\d$/i,ye=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,xe=/[+~]/,be=/'|\\/g,_e=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),we=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},Se=function(){L()};try{$.apply(Q=J.call(U.childNodes),U.childNodes),Q[U.childNodes.length].nodeType}catch(Me){$={apply:Q.length?function(e,t){Z.apply(e,J.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}_=t.support={},M=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},L=t.setDocument=function(e){var t,n,i=e?e.ownerDocument||e:U;return i!==R&&9===i.nodeType&&i.documentElement?(R=i,B=i.documentElement,n=i.defaultView,n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",Se,!1):n.attachEvent&&n.attachEvent("onunload",Se)),k=!M(i),_.attributes=r(function(e){return e.className="i",!e.getAttribute("className")}),_.getElementsByTagName=r(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),_.getElementsByClassName=ye.test(i.getElementsByClassName),_.getById=r(function(e){return B.appendChild(e).id=z,!i.getElementsByName||!i.getElementsByName(z).length}),_.getById?(w.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&k){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},w.filter.ID=function(e){var t=e.replace(_e,we);return function(e){return e.getAttribute("id")===t}}):(delete w.find.ID,w.filter.ID=function(e){var t=e.replace(_e,we);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),w.find.TAG=_.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):_.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[r++];)1===n.nodeType&&i.push(n);return i}return o},w.find.CLASS=_.getElementsByClassName&&function(e,t){return k?t.getElementsByClassName(e):void 0},N=[],D=[],(_.qsa=ye.test(i.querySelectorAll))&&(r(function(e){B.appendChild(e).innerHTML="<a id='"+z+"'></a><select id='"+z+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&D.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||D.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+z+"-]").length||D.push("~="),e.querySelectorAll(":checked").length||D.push(":checked"),e.querySelectorAll("a#"+z+"+*").length||D.push(".#.+[+~]")}),r(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&D.push("name"+ne+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||D.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),D.push(",.*:")})),(_.matchesSelector=ye.test(O=B.matches||B.webkitMatchesSelector||B.mozMatchesSelector||B.oMatchesSelector||B.msMatchesSelector))&&r(function(e){_.disconnectedMatch=O.call(e,"div"),O.call(e,"[s!='']:x"),N.push("!=",se)}),D=D.length&&new RegExp(D.join("|")),N=N.length&&new RegExp(N.join("|")),t=ye.test(B.compareDocumentPosition),V=t||ye.test(B.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=t?function(e,t){if(e===t)return F=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!_.sortDetached&&t.compareDocumentPosition(e)===n?e===i||e.ownerDocument===U&&V(U,e)?-1:t===i||t.ownerDocument===U&&V(U,t)?1:P?ee(P,e)-ee(P,t):0:4&n?-1:1)}:function(e,t){if(e===t)return F=!0,0;var n,r=0,o=e.parentNode,a=t.parentNode,l=[e],h=[t];if(!o||!a)return e===i?-1:t===i?1:o?-1:a?1:P?ee(P,e)-ee(P,t):0;if(o===a)return s(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)h.unshift(n);for(;l[r]===h[r];)r++;return r?s(l[r],h[r]):l[r]===U?-1:h[r]===U?1:0},i):R},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==R&&L(e),n=n.replace(ce,"='$1']"),!(!_.matchesSelector||!k||N&&N.test(n)||D&&D.test(n)))try{var i=O.call(e,n);if(i||_.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(r){}return t(n,R,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==R&&L(e),V(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==R&&L(e);var n=w.attrHandle[t.toLowerCase()],i=n&&Y.call(w.attrHandle,t.toLowerCase())?n(e,t,!k):void 0;return void 0!==i?i:_.attributes||!k?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],i=0,r=0;if(F=!_.detectDuplicates,P=!_.sortStable&&e.slice(0),e.sort(W),F){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return P=null,e},S=t.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=S(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i++];)n+=S(t);return n},w=t.selectors={cacheLength:50,createPseudo:i,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(_e,we),e[3]=(e[3]||e[4]||e[5]||"").replace(_e,we),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return fe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&pe.test(n)&&(t=T(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(_e,we).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=G[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&G(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(r){var o=t.attr(r,e);return null==o?"!="===n:n?(o+="","="===n?o===i:"!="===n?o!==i:"^="===n?i&&0===o.indexOf(i):"*="===n?i&&o.indexOf(i)>-1:"$="===n?i&&o.slice(-i.length)===i:"~="===n?(" "+o.replace(ae," ")+" ").indexOf(i)>-1:"|="===n?o===i||o.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,n,i,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,l){var h,u,c,p,d,f,m=o!==s?"nextSibling":"previousSibling",v=t.parentNode,y=a&&t.nodeName.toLowerCase(),g=!l&&!a;if(v){if(o){for(;m;){for(c=t;c=c[m];)if(a?c.nodeName.toLowerCase()===y:1===c.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?v.firstChild:v.lastChild],s&&g){for(u=v[z]||(v[z]={}),h=u[e]||[],d=h[0]===I&&h[1],p=h[0]===I&&h[2],c=d&&v.childNodes[d];c=++d&&c&&c[m]||(p=d=0)||f.pop();)if(1===c.nodeType&&++p&&c===t){u[e]=[I,d,p];break}}else if(g&&(h=(t[z]||(t[z]={}))[e])&&h[0]===I)p=h[1];else for(;(c=++d&&c&&c[m]||(p=d=0)||f.pop())&&((a?c.nodeName.toLowerCase()!==y:1!==c.nodeType)||!++p||(g&&((c[z]||(c[z]={}))[e]=[I,p]),c!==t)););return p-=r,p===i||p%i===0&&p/i>=0}}},PSEUDO:function(e,n){var r,o=w.pseudos[e]||w.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[z]?o(n):o.length>1?(r=[e,e,"",n],w.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,r=o(e,n),s=r.length;s--;)i=ee(e,r[s]),e[i]=!(t[i]=r[s])}):function(e){return o(e,0,r)}):o}},pseudos:{not:i(function(e){var t=[],n=[],r=E(e.replace(le,"$1"));return r[z]?i(function(e,t,n,i){for(var o,s=r(e,null,i,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:i(function(e){return function(n){return t(e,n).length>0}}),contains:i(function(e){return e=e.replace(_e,we),function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:i(function(e){return de.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(_e,we).toLowerCase(),function(t){var n;do if(n=k?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===B},focus:function(e){return e===R.activeElement&&(!R.hasFocus||R.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!w.pseudos.empty(e)},header:function(e){return ve.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:h(function(){return[0]}),last:h(function(e,t){return[t-1]}),eq:h(function(e,t,n){return[0>n?n+t:n]}),even:h(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:h(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:h(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:h(function(e,t,n){for(var i=0>n?n+t:n;++i<t;)e.push(i);return e})}},w.pseudos.nth=w.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[b]=a(b);for(b in{submit:!0,reset:!0})w.pseudos[b]=l(b);return c.prototype=w.filters=w.pseudos,w.setFilters=new c,T=t.tokenize=function(e,n){var i,r,o,s,a,l,h,u=q[e+" "];if(u)return n?0:u.slice(0);for(a=e,l=[],h=w.preFilter;a;){(!i||(r=he.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),l.push(o=[])),i=!1,(r=ue.exec(a))&&(i=r.shift(),o.push({value:i,type:r[0].replace(le," ")}),a=a.slice(i.length));for(s in w.filter)!(r=fe[s].exec(a))||h[s]&&!(r=h[s](r))||(i=r.shift(),o.push({value:i,type:s,matches:r}),a=a.slice(i.length));if(!i)break}return n?a.length:a?t.error(e):q(e,l).slice(0)},E=t.compile=function(e,t){var n,i=[],r=[],o=H[e+" "];if(!o){for(t||(t=T(e)),n=t.length;n--;)o=g(t[n]),o[z]?i.push(o):r.push(o);o=H(e,x(r,i)),o.selector=e}return o},C=t.select=function(e,t,n,i){var r,o,s,a,l,h="function"==typeof e&&e,c=!i&&T(e=h.selector||e);if(n=n||[],1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&_.getById&&9===t.nodeType&&k&&w.relative[o[1].type]){if(t=(w.find.ID(s.matches[0].replace(_e,we),t)||[])[0],!t)return n;h&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=fe.needsContext.test(e)?0:o.length;r--&&(s=o[r],!w.relative[a=s.type]);)if((l=w.find[a])&&(i=l(s.matches[0].replace(_e,we),xe.test(o[0].type)&&u(t.parentNode)||t))){if(o.splice(r,1),e=i.length&&p(o),!e)return $.apply(n,i),n;break}}return(h||E(e,c))(i,t,!k,n,xe.test(e)&&u(t.parentNode)||t),n},_.sortStable=z.split("").sort(W).join("")===z,_.detectDuplicates=!!F,L(),_.sortDetached=r(function(e){return 1&e.compareDocumentPosition(R.createElement("div"))}),r(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),_.attributes&&r(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),r(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,n){var i;return n?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);J.find=re,J.expr=re.selectors,J.expr[":"]=J.expr.pseudos,J.unique=re.uniqueSort,J.text=re.getText,J.isXMLDoc=re.isXML,J.contains=re.contains;var oe=J.expr.match.needsContext,se=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ae=/^.[^:#\[\.,]*$/;J.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?J.find.matchesSelector(i,e)?[i]:[]:J.find.matches(e,J.grep(t,function(e){return 1===e.nodeType}))},J.fn.extend({find:function(e){var t,n=this.length,i=[],r=this;if("string"!=typeof e)return this.pushStack(J(e).filter(function(){for(t=0;n>t;t++)if(J.contains(r[t],this))return!0}));for(t=0;n>t;t++)J.find(e,r[t],i);return i=this.pushStack(n>1?J.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&oe.test(e)?J(e):e||[],!1).length}});var le,he=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ue=J.fn.init=function(e,t){var n,i;if(!e)return this;if("string"==typeof e){if(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:he.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||le).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof J?t[0]:t,J.merge(this,J.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:Z,!0)),se.test(n[1])&&J.isPlainObject(t))for(n in t)J.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return i=Z.getElementById(n[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=Z,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):J.isFunction(e)?"undefined"!=typeof le.ready?le.ready(e):e(J):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),J.makeArray(e,this))};ue.prototype=J.fn,le=J(Z);var ce=/^(?:parents|prev(?:Until|All))/,pe={children:!0,contents:!0,next:!0,prev:!0};J.extend({dir:function(e,t,n){for(var i=[],r=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&J(e).is(n))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),J.fn.extend({has:function(e){var t=J(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(J.contains(this,t[e]))return!0})},closest:function(e,t){for(var n,i=0,r=this.length,o=[],s=oe.test(e)||"string"!=typeof e?J(e,t||this.context):0;r>i;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&J.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?J.unique(o):o)},index:function(e){return e?"string"==typeof e?W.call(J(e),this[0]):W.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(J.unique(J.merge(this.get(),J(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),J.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return J.dir(e,"parentNode")},parentsUntil:function(e,t,n){return J.dir(e,"parentNode",n)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return J.dir(e,"nextSibling")},prevAll:function(e){return J.dir(e,"previousSibling")},nextUntil:function(e,t,n){return J.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return J.dir(e,"previousSibling",n)},siblings:function(e){return J.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return J.sibling(e.firstChild)},contents:function(e){return e.contentDocument||J.merge([],e.childNodes)}},function(e,t){J.fn[e]=function(n,i){var r=J.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=J.filter(i,r)),this.length>1&&(pe[e]||J.unique(r),ce.test(e)&&r.reverse()),this.pushStack(r)}});var de=/\S+/g,fe={};J.Callbacks=function(e){e="string"==typeof e?fe[e]||o(e):J.extend({},e);var t,n,i,r,s,a,l=[],h=!e.once&&[],u=function(o){for(t=e.memory&&o,n=!0,a=r||0,r=0,s=l.length,i=!0;l&&s>a;a++)if(l[a].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,l&&(h?h.length&&u(h.shift()):t?l=[]:c.disable())},c={add:function(){if(l){var n=l.length;!function o(t){
J.each(t,function(t,n){var i=J.type(n);"function"===i?e.unique&&c.has(n)||l.push(n):n&&n.length&&"string"!==i&&o(n)})}(arguments),i?s=l.length:t&&(r=n,u(t))}return this},remove:function(){return l&&J.each(arguments,function(e,t){for(var n;(n=J.inArray(t,l,n))>-1;)l.splice(n,1),i&&(s>=n&&s--,a>=n&&a--)}),this},has:function(e){return e?J.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],s=0,this},disable:function(){return l=h=t=void 0,this},disabled:function(){return!l},lock:function(){return h=void 0,t||c.disable(),this},locked:function(){return!h},fireWith:function(e,t){return!l||n&&!h||(t=t||[],t=[e,t.slice?t.slice():t],i?h.push(t):u(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},J.extend({Deferred:function(e){var t=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return J.Deferred(function(n){J.each(t,function(t,o){var s=J.isFunction(e[t])&&e[t];r[o[1]](function(){var e=s&&s.apply(this,arguments);e&&J.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o[0]+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?J.extend(e,i):i}},r={};return i.pipe=i.then,J.each(t,function(e,o){var s=o[2],a=o[3];i[o[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?i:this,arguments),this},r[o[0]+"With"]=s.fireWith}),i.promise(r),e&&e.call(r,r),r},when:function(e){var t,n,i,r=0,o=G.call(arguments),s=o.length,a=1!==s||e&&J.isFunction(e.promise)?s:0,l=1===a?e:J.Deferred(),h=function(e,n,i){return function(r){n[e]=this,i[e]=arguments.length>1?G.call(arguments):r,i===t?l.notifyWith(n,i):--a||l.resolveWith(n,i)}};if(s>1)for(t=new Array(s),n=new Array(s),i=new Array(s);s>r;r++)o[r]&&J.isFunction(o[r].promise)?o[r].promise().done(h(r,i,o)).fail(l.reject).progress(h(r,n,t)):--a;return a||l.resolveWith(i,o),l.promise()}});var me;J.fn.ready=function(e){return J.ready.promise().done(e),this},J.extend({isReady:!1,readyWait:1,holdReady:function(e){e?J.readyWait++:J.ready(!0)},ready:function(e){(e===!0?--J.readyWait:J.isReady)||(J.isReady=!0,e!==!0&&--J.readyWait>0||(me.resolveWith(Z,[J]),J.fn.triggerHandler&&(J(Z).triggerHandler("ready"),J(Z).off("ready"))))}}),J.ready.promise=function(t){return me||(me=J.Deferred(),"complete"===Z.readyState?setTimeout(J.ready):(Z.addEventListener("DOMContentLoaded",s,!1),e.addEventListener("load",s,!1))),me.promise(t)},J.ready.promise();var ve=J.access=function(e,t,n,i,r,o,s){var a=0,l=e.length,h=null==n;if("object"===J.type(n)){r=!0;for(a in n)J.access(e,t,a,n[a],!0,o,s)}else if(void 0!==i&&(r=!0,J.isFunction(i)||(s=!0),h&&(s?(t.call(e,i),t=null):(h=t,t=function(e,t,n){return h.call(J(e),n)})),t))for(;l>a;a++)t(e[a],n,s?i:i.call(e[a],a,t(e[a],n)));return r?e:h?t.call(e):l?t(e[0],n):o};J.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},a.uid=1,a.accepts=J.acceptData,a.prototype={key:function(e){if(!a.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=a.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(i){t[this.expando]=n,J.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var i,r=this.key(e),o=this.cache[r];if("string"==typeof t)o[t]=n;else if(J.isEmptyObject(o))J.extend(this.cache[r],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,n){var i;return void 0===t||t&&"string"==typeof t&&void 0===n?(i=this.get(e,t),void 0!==i?i:this.get(e,J.camelCase(t))):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i,r,o=this.key(e),s=this.cache[o];if(void 0===t)this.cache[o]={};else{J.isArray(t)?i=t.concat(t.map(J.camelCase)):(r=J.camelCase(t),t in s?i=[t,r]:(i=r,i=i in s?[i]:i.match(de)||[])),n=i.length;for(;n--;)delete s[i[n]]}},hasData:function(e){return!J.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var ye=new a,ge=new a,xe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,be=/([A-Z])/g;J.extend({hasData:function(e){return ge.hasData(e)||ye.hasData(e)},data:function(e,t,n){return ge.access(e,t,n)},removeData:function(e,t){ge.remove(e,t)},_data:function(e,t,n){return ye.access(e,t,n)},_removeData:function(e,t){ye.remove(e,t)}}),J.fn.extend({data:function(e,t){var n,i,r,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(r=ge.get(o),1===o.nodeType&&!ye.get(o,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(i=s[n].name,0===i.indexOf("data-")&&(i=J.camelCase(i.slice(5)),l(o,i,r[i])));ye.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){ge.set(this,e)}):ve(this,function(t){var n,i=J.camelCase(e);if(o&&void 0===t){if(n=ge.get(o,e),void 0!==n)return n;if(n=ge.get(o,i),void 0!==n)return n;if(n=l(o,i,void 0),void 0!==n)return n}else this.each(function(){var n=ge.get(this,i);ge.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&ge.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ge.remove(this,e)})}}),J.extend({queue:function(e,t,n){var i;return e?(t=(t||"fx")+"queue",i=ye.get(e,t),n&&(!i||J.isArray(n)?i=ye.access(e,t,J.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=J.queue(e,t),i=n.length,r=n.shift(),o=J._queueHooks(e,t),s=function(){J.dequeue(e,t)};"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete o.stop,r.call(e,s,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ye.get(e,n)||ye.access(e,n,{empty:J.Callbacks("once memory").add(function(){ye.remove(e,[t+"queue",n])})})}}),J.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?J.queue(this[0],e):void 0===t?this:this.each(function(){var n=J.queue(this,e,t);J._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&J.dequeue(this,e)})},dequeue:function(e){return this.each(function(){J.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,r=J.Deferred(),o=this,s=this.length,a=function(){--i||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)n=ye.get(o[s],e+"queueHooks"),n&&n.empty&&(i++,n.empty.add(a));return a(),r.promise(t)}});var _e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,we=["Top","Right","Bottom","Left"],Se=function(e,t){return e=t||e,"none"===J.css(e,"display")||!J.contains(e.ownerDocument,e)},Me=/^(?:checkbox|radio)$/i;!function(){var e=Z.createDocumentFragment(),t=e.appendChild(Z.createElement("div")),n=Z.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),K.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",K.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Te="undefined";K.focusinBubbles="onfocusin"in e;var Ee=/^key/,Ce=/^(?:mouse|pointer|contextmenu)|click/,Ae=/^(?:focusinfocus|focusoutblur)$/,Pe=/^([^.]*)(?:\.(.+)|)$/;J.event={global:{},add:function(e,t,n,i,r){var o,s,a,l,h,u,c,p,d,f,m,v=ye.get(e);if(v)for(n.handler&&(o=n,n=o.handler,r=o.selector),n.guid||(n.guid=J.guid++),(l=v.events)||(l=v.events={}),(s=v.handle)||(s=v.handle=function(t){return typeof J!==Te&&J.event.triggered!==t.type?J.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(de)||[""],h=t.length;h--;)a=Pe.exec(t[h])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d&&(c=J.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,c=J.event.special[d]||{},u=J.extend({type:d,origType:m,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&J.expr.match.needsContext.test(r),namespace:f.join(".")},o),(p=l[d])||(p=l[d]=[],p.delegateCount=0,c.setup&&c.setup.call(e,i,f,s)!==!1||e.addEventListener&&e.addEventListener(d,s,!1)),c.add&&(c.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),r?p.splice(p.delegateCount++,0,u):p.push(u),J.event.global[d]=!0)},remove:function(e,t,n,i,r){var o,s,a,l,h,u,c,p,d,f,m,v=ye.hasData(e)&&ye.get(e);if(v&&(l=v.events)){for(t=(t||"").match(de)||[""],h=t.length;h--;)if(a=Pe.exec(t[h])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d){for(c=J.event.special[d]||{},d=(i?c.delegateType:c.bindType)||d,p=l[d]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=p.length;o--;)u=p[o],!r&&m!==u.origType||n&&n.guid!==u.guid||a&&!a.test(u.namespace)||i&&i!==u.selector&&("**"!==i||!u.selector)||(p.splice(o,1),u.selector&&p.delegateCount--,c.remove&&c.remove.call(e,u));s&&!p.length&&(c.teardown&&c.teardown.call(e,f,v.handle)!==!1||J.removeEvent(e,d,v.handle),delete l[d])}else for(d in l)J.event.remove(e,d+t[h],n,i,!0);J.isEmptyObject(l)&&(delete v.handle,ye.remove(e,"events"))}},trigger:function(t,n,i,r){var o,s,a,l,h,u,c,p=[i||Z],d=Q.call(t,"type")?t.type:t,f=Q.call(t,"namespace")?t.namespace.split("."):[];if(s=a=i=i||Z,3!==i.nodeType&&8!==i.nodeType&&!Ae.test(d+J.event.triggered)&&(d.indexOf(".")>=0&&(f=d.split("."),d=f.shift(),f.sort()),h=d.indexOf(":")<0&&"on"+d,t=t[J.expando]?t:new J.Event(d,"object"==typeof t&&t),t.isTrigger=r?2:3,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:J.makeArray(n,[t]),c=J.event.special[d]||{},r||!c.trigger||c.trigger.apply(i,n)!==!1)){if(!r&&!c.noBubble&&!J.isWindow(i)){for(l=c.delegateType||d,Ae.test(l+d)||(s=s.parentNode);s;s=s.parentNode)p.push(s),a=s;a===(i.ownerDocument||Z)&&p.push(a.defaultView||a.parentWindow||e)}for(o=0;(s=p[o++])&&!t.isPropagationStopped();)t.type=o>1?l:c.bindType||d,u=(ye.get(s,"events")||{})[t.type]&&ye.get(s,"handle"),u&&u.apply(s,n),u=h&&s[h],u&&u.apply&&J.acceptData(s)&&(t.result=u.apply(s,n),t.result===!1&&t.preventDefault());return t.type=d,r||t.isDefaultPrevented()||c._default&&c._default.apply(p.pop(),n)!==!1||!J.acceptData(i)||h&&J.isFunction(i[d])&&!J.isWindow(i)&&(a=i[h],a&&(i[h]=null),J.event.triggered=d,i[d](),J.event.triggered=void 0,a&&(i[h]=a)),t.result}},dispatch:function(e){e=J.event.fix(e);var t,n,i,r,o,s=[],a=G.call(arguments),l=(ye.get(this,"events")||{})[e.type]||[],h=J.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!h.preDispatch||h.preDispatch.call(this,e)!==!1){for(s=J.event.handlers.call(this,e,l),t=0;(r=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,n=0;(o=r.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((J.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,i,r,o,s=[],a=t.delegateCount,l=e.target;if(a&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(i=[],n=0;a>n;n++)o=t[n],r=o.selector+" ",void 0===i[r]&&(i[r]=o.needsContext?J(r,this).index(l)>=0:J.find(r,this,null,[l]).length),i[r]&&i.push(o);i.length&&s.push({elem:l,handlers:i})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,i,r,o=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||Z,i=n.documentElement,r=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[J.expando])return e;var t,n,i,r=e.type,o=e,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Ce.test(r)?this.mouseHooks:Ee.test(r)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,e=new J.Event(o),t=i.length;t--;)n=i[t],e[n]=o[n];return e.target||(e.target=Z),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==c()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===c()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&J.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return J.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var r=J.extend(new J.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?J.event.trigger(r,null,t):J.event.dispatch.call(t,r),r.isDefaultPrevented()&&n.preventDefault()}},J.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},J.Event=function(e,t){return this instanceof J.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?h:u):this.type=e,t&&J.extend(this,t),this.timeStamp=e&&e.timeStamp||J.now(),void(this[J.expando]=!0)):new J.Event(e,t)},J.Event.prototype={isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=h,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=h,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=h,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},J.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){J.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==i&&!J.contains(i,r))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),K.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){J.event.simulate(t,e.target,J.event.fix(e),!0)};J.event.special[t]={setup:function(){var i=this.ownerDocument||this,r=ye.access(i,t);r||i.addEventListener(e,n,!0),ye.access(i,t,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this,r=ye.access(i,t)-1;r?ye.access(i,t,r):(i.removeEventListener(e,n,!0),ye.remove(i,t))}}}),J.fn.extend({on:function(e,t,n,i,r){var o,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(s in e)this.on(s,t,n,e[s],r);return this}if(null==n&&null==i?(i=t,n=t=void 0):null==i&&("string"==typeof t?(i=n,n=void 0):(i=n,n=t,t=void 0)),i===!1)i=u;else if(!i)return this;return 1===r&&(o=i,i=function(e){return J().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=J.guid++)),this.each(function(){J.event.add(this,e,i,n,t)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,J(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=u),this.each(function(){J.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){J.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?J.event.trigger(e,t,n,!0):void 0}});var Fe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Le=/<([\w:]+)/,Re=/<|&#?\w+;/,Be=/<(?:script|style|link)/i,ke=/checked\s*(?:[^=]|=\s*.checked.)/i,De=/^$|\/(?:java|ecma)script/i,Ne=/^true\/(.*)/,Oe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ve={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ve.optgroup=Ve.option,Ve.tbody=Ve.tfoot=Ve.colgroup=Ve.caption=Ve.thead,Ve.th=Ve.td,J.extend({clone:function(e,t,n){var i,r,o,s,a=e.cloneNode(!0),l=J.contains(e.ownerDocument,e);if(!(K.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||J.isXMLDoc(e)))for(s=y(a),o=y(e),i=0,r=o.length;r>i;i++)g(o[i],s[i]);if(t)if(n)for(o=o||y(e),s=s||y(a),i=0,r=o.length;r>i;i++)v(o[i],s[i]);else v(e,a);return s=y(a,"script"),s.length>0&&m(s,!l&&y(e,"script")),a},buildFragment:function(e,t,n,i){for(var r,o,s,a,l,h,u=t.createDocumentFragment(),c=[],p=0,d=e.length;d>p;p++)if(r=e[p],r||0===r)if("object"===J.type(r))J.merge(c,r.nodeType?[r]:r);else if(Re.test(r)){for(o=o||u.appendChild(t.createElement("div")),s=(Le.exec(r)||["",""])[1].toLowerCase(),a=Ve[s]||Ve._default,o.innerHTML=a[1]+r.replace(Fe,"<$1></$2>")+a[2],h=a[0];h--;)o=o.lastChild;J.merge(c,o.childNodes),o=u.firstChild,o.textContent=""}else c.push(t.createTextNode(r));for(u.textContent="",p=0;r=c[p++];)if((!i||-1===J.inArray(r,i))&&(l=J.contains(r.ownerDocument,r),o=y(u.appendChild(r),"script"),l&&m(o),n))for(h=0;r=o[h++];)De.test(r.type||"")&&n.push(r);return u},cleanData:function(e){for(var t,n,i,r,o=J.event.special,s=0;void 0!==(n=e[s]);s++){if(J.acceptData(n)&&(r=n[ye.expando],r&&(t=ye.cache[r]))){if(t.events)for(i in t.events)o[i]?J.event.remove(n,i):J.removeEvent(n,i,t.handle);ye.cache[r]&&delete ye.cache[r]}delete ge.cache[n[ge.expando]]}}}),J.fn.extend({text:function(e){return ve(this,function(e){return void 0===e?J.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=p(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=p(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=e?J.filter(e,this):this,r=0;null!=(n=i[r]);r++)t||1!==n.nodeType||J.cleanData(y(n)),n.parentNode&&(t&&J.contains(n.ownerDocument,n)&&m(y(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(J.cleanData(y(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return J.clone(this,e,t)})},html:function(e){return ve(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Be.test(e)&&!Ve[(Le.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Fe,"<$1></$2>");try{for(;i>n;n++)t=this[n]||{},1===t.nodeType&&(J.cleanData(y(t,!1)),t.innerHTML=e);t=0}catch(r){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,J.cleanData(y(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=q.apply([],e);var n,i,r,o,s,a,l=0,h=this.length,u=this,c=h-1,p=e[0],m=J.isFunction(p);if(m||h>1&&"string"==typeof p&&!K.checkClone&&ke.test(p))return this.each(function(n){var i=u.eq(n);m&&(e[0]=p.call(this,n,i.html())),i.domManip(e,t)});if(h&&(n=J.buildFragment(e,this[0].ownerDocument,!1,this),i=n.firstChild,1===n.childNodes.length&&(n=i),i)){for(r=J.map(y(n,"script"),d),o=r.length;h>l;l++)s=n,l!==c&&(s=J.clone(s,!0,!0),o&&J.merge(r,y(s,"script"))),t.call(this[l],s,l);if(o)for(a=r[r.length-1].ownerDocument,J.map(r,f),l=0;o>l;l++)s=r[l],De.test(s.type||"")&&!ye.access(s,"globalEval")&&J.contains(a,s)&&(s.src?J._evalUrl&&J._evalUrl(s.src):J.globalEval(s.textContent.replace(Oe,"")))}return this}}),J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){J.fn[e]=function(e){for(var n,i=[],r=J(e),o=r.length-1,s=0;o>=s;s++)n=s===o?this:this.clone(!0),J(r[s])[t](n),H.apply(i,n.get());return this.pushStack(i)}});var ze,Ue={},Ie=/^margin/,je=new RegExp("^("+_e+")(?!px)[a-z%]+$","i"),Ge=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(o);var t=e.getComputedStyle(s,null);n="1%"!==t.top,i="4px"===t.width,r.removeChild(o)}var n,i,r=Z.documentElement,o=Z.createElement("div"),s=Z.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",K.clearCloneStyle="content-box"===s.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(s),e.getComputedStyle&&J.extend(K,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return null==i&&t(),i},reliableMarginRight:function(){var t,n=s.appendChild(Z.createElement("div"));return n.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",s.style.width="1px",r.appendChild(o),t=!parseFloat(e.getComputedStyle(n,null).marginRight),r.removeChild(o),s.removeChild(n),t}}))}(),J.swap=function(e,t,n,i){var r,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];r=n.apply(e,i||[]);for(o in t)e.style[o]=s[o];return r};var qe=/^(none|table(?!-c[ea]).+)/,He=new RegExp("^("+_e+")(.*)$","i"),We=new RegExp("^([+-])=("+_e+")","i"),Xe={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:"0",fontWeight:"400"},Qe=["Webkit","O","Moz","ms"];J.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=_(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,s,a=J.camelCase(t),l=e.style;return t=J.cssProps[a]||(J.cssProps[a]=S(l,a)),s=J.cssHooks[t]||J.cssHooks[a],void 0===n?s&&"get"in s&&void 0!==(r=s.get(e,!1,i))?r:l[t]:(o=typeof n,"string"===o&&(r=We.exec(n))&&(n=(r[1]+1)*r[2]+parseFloat(J.css(e,t)),o="number"),null!=n&&n===n&&("number"!==o||J.cssNumber[a]||(n+="px"),K.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,i))||(l[t]=n)),void 0)}},css:function(e,t,n,i){var r,o,s,a=J.camelCase(t);return t=J.cssProps[a]||(J.cssProps[a]=S(e.style,a)),s=J.cssHooks[t]||J.cssHooks[a],s&&"get"in s&&(r=s.get(e,!0,n)),void 0===r&&(r=_(e,t,i)),"normal"===r&&t in Ye&&(r=Ye[t]),""===n||n?(o=parseFloat(r),n===!0||J.isNumeric(o)?o||0:r):r}}),J.each(["height","width"],function(e,t){J.cssHooks[t]={get:function(e,n,i){return n?qe.test(J.css(e,"display"))&&0===e.offsetWidth?J.swap(e,Xe,function(){return E(e,t,i)}):E(e,t,i):void 0},set:function(e,n,i){var r=i&&Ge(e);return M(e,n,i?T(e,t,i,"border-box"===J.css(e,"boxSizing",!1,r),r):0)}}}),J.cssHooks.marginRight=w(K.reliableMarginRight,function(e,t){return t?J.swap(e,{display:"inline-block"},_,[e,"marginRight"]):void 0}),J.each({margin:"",padding:"",border:"Width"},function(e,t){J.cssHooks[e+t]={expand:function(n){for(var i=0,r={},o="string"==typeof n?n.split(" "):[n];4>i;i++)r[e+we[i]+t]=o[i]||o[i-2]||o[0];return r}},Ie.test(e)||(J.cssHooks[e+t].set=M)}),J.fn.extend({css:function(e,t){return ve(this,function(e,t,n){var i,r,o={},s=0;if(J.isArray(t)){for(i=Ge(e),r=t.length;r>s;s++)o[t[s]]=J.css(e,t[s],!1,i);return o}return void 0!==n?J.style(e,t,n):J.css(e,t)},e,t,arguments.length>1)},show:function(){return C(this,!0)},hide:function(){return C(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Se(this)?J(this).show():J(this).hide()})}}),J.Tween=A,A.prototype={constructor:A,init:function(e,t,n,i,r,o){this.elem=e,this.prop=n,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(J.cssNumber[n]?"":"px")},cur:function(){var e=A.propHooks[this.prop];return e&&e.get?e.get(this):A.propHooks._default.get(this)},run:function(e){var t,n=A.propHooks[this.prop];return this.pos=t=this.options.duration?J.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):A.propHooks._default.set(this),this}},A.prototype.init.prototype=A.prototype,A.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=J.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){J.fx.step[e.prop]?J.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[J.cssProps[e.prop]]||J.cssHooks[e.prop])?J.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},A.propHooks.scrollTop=A.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},J.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},J.fx=A.prototype.init,J.fx.step={};var Ke,Ze,$e=/^(?:toggle|show|hide)$/,Je=new RegExp("^(?:([+-])=|)("+_e+")([a-z%]*)$","i"),et=/queueHooks$/,tt=[R],nt={"*":[function(e,t){var n=this.createTween(e,t),i=n.cur(),r=Je.exec(t),o=r&&r[3]||(J.cssNumber[e]?"":"px"),s=(J.cssNumber[e]||"px"!==o&&+i)&&Je.exec(J.css(n.elem,e)),a=1,l=20;if(s&&s[3]!==o){o=o||s[3],r=r||[],s=+i||1;do a=a||".5",s/=a,J.style(n.elem,e,s+o);while(a!==(a=n.cur()/i)&&1!==a&&--l)}return r&&(s=n.start=+s||+i||0,n.unit=o,n.end=r[1]?s+(r[1]+1)*r[2]:+r[2]),n}]};J.Animation=J.extend(k,{tweener:function(e,t){J.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,r=e.length;r>i;i++)n=e[i],nt[n]=nt[n]||[],nt[n].unshift(t)},prefilter:function(e,t){t?tt.unshift(e):tt.push(e)}}),J.speed=function(e,t,n){var i=e&&"object"==typeof e?J.extend({},e):{complete:n||!n&&t||J.isFunction(e)&&e,duration:e,easing:n&&t||t&&!J.isFunction(t)&&t};return i.duration=J.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in J.fx.speeds?J.fx.speeds[i.duration]:J.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){J.isFunction(i.old)&&i.old.call(this),i.queue&&J.dequeue(this,i.queue)},i},J.fn.extend({fadeTo:function(e,t,n,i){return this.filter(Se).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=J.isEmptyObject(e),o=J.speed(t,n,i),s=function(){var t=k(this,J.extend({},e),o);(r||ye.get(this,"finish"))&&t.stop(!0)};return s.finish=s,r||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",o=J.timers,s=ye.get(this);if(r)s[r]&&s[r].stop&&i(s[r]);else for(r in s)s[r]&&s[r].stop&&et.test(r)&&i(s[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(n),t=!1,o.splice(r,1));(t||!n)&&J.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=ye.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],o=J.timers,s=i?i.length:0;for(n.finish=!0,J.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),J.each(["toggle","show","hide"],function(e,t){var n=J.fn[t];J.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(F(t,!0),e,i,r)}}),J.each({slideDown:F("show"),slideUp:F("hide"),slideToggle:F("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){J.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),J.timers=[],J.fx.tick=function(){var e,t=0,n=J.timers;for(Ke=J.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||J.fx.stop(),Ke=void 0},J.fx.timer=function(e){J.timers.push(e),e()?J.fx.start():J.timers.pop()},J.fx.interval=13,J.fx.start=function(){Ze||(Ze=setInterval(J.fx.tick,J.fx.interval))},J.fx.stop=function(){clearInterval(Ze),Ze=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fn.delay=function(e,t){return e=J.fx?J.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},function(){var e=Z.createElement("input"),t=Z.createElement("select"),n=t.appendChild(Z.createElement("option"));e.type="checkbox",K.checkOn=""!==e.value,K.optSelected=n.selected,t.disabled=!0,K.optDisabled=!n.disabled,e=Z.createElement("input"),e.value="t",e.type="radio",K.radioValue="t"===e.value}();var it,rt,ot=J.expr.attrHandle;J.fn.extend({attr:function(e,t){return ve(this,J.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){J.removeAttr(this,e)})}}),J.extend({attr:function(e,t,n){var i,r,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===Te?J.prop(e,t,n):(1===o&&J.isXMLDoc(e)||(t=t.toLowerCase(),i=J.attrHooks[t]||(J.expr.match.bool.test(t)?rt:it)),void 0===n?i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=J.find.attr(e,t),null==r?void 0:r):null!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):void J.removeAttr(e,t))},removeAttr:function(e,t){var n,i,r=0,o=t&&t.match(de);if(o&&1===e.nodeType)for(;n=o[r++];)i=J.propFix[n]||n,J.expr.match.bool.test(n)&&(e[i]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!K.radioValue&&"radio"===t&&J.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),rt={set:function(e,t,n){return t===!1?J.removeAttr(e,n):e.setAttribute(n,n),n}},J.each(J.expr.match.bool.source.match(/\w+/g),function(e,t){var n=ot[t]||J.find.attr;ot[t]=function(e,t,i){var r,o;return i||(o=ot[t],ot[t]=r,r=null!=n(e,t,i)?t.toLowerCase():null,ot[t]=o),r}});var st=/^(?:input|select|textarea|button)$/i;J.fn.extend({prop:function(e,t){return ve(this,J.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[J.propFix[e]||e]})}}),J.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var i,r,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!J.isXMLDoc(e),o&&(t=J.propFix[t]||t,r=J.propHooks[t]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(e,n,t))?i:e[t]=n:r&&"get"in r&&null!==(i=r.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||st.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),K.optSelected||(J.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),J.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){J.propFix[this.toLowerCase()]=this});var at=/[\t\r\n\f]/g;J.fn.extend({addClass:function(e){var t,n,i,r,o,s,a="string"==typeof e&&e,l=0,h=this.length;

if(J.isFunction(e))return this.each(function(t){J(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(de)||[];h>l;l++)if(n=this[l],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(at," "):" ")){for(o=0;r=t[o++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");s=J.trim(i),n.className!==s&&(n.className=s)}return this},removeClass:function(e){var t,n,i,r,o,s,a=0===arguments.length||"string"==typeof e&&e,l=0,h=this.length;if(J.isFunction(e))return this.each(function(t){J(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(de)||[];h>l;l++)if(n=this[l],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(at," "):"")){for(o=0;r=t[o++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");s=e?J.trim(i):"",n.className!==s&&(n.className=s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(J.isFunction(e)?function(n){J(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,i=0,r=J(this),o=e.match(de)||[];t=o[i++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(n===Te||"boolean"===n)&&(this.className&&ye.set(this,"__className__",this.className),this.className=this.className||e===!1?"":ye.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(at," ").indexOf(t)>=0)return!0;return!1}});var lt=/\r/g;J.fn.extend({val:function(e){var t,n,i,r=this[0];{if(arguments.length)return i=J.isFunction(e),this.each(function(n){var r;1===this.nodeType&&(r=i?e.call(this,n,J(this).val()):e,null==r?r="":"number"==typeof r?r+="":J.isArray(r)&&(r=J.map(r,function(e){return null==e?"":e+""})),t=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))});if(r)return t=J.valHooks[r.type]||J.valHooks[r.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(r,"value"))?n:(n=r.value,"string"==typeof n?n.replace(lt,""):null==n?"":n)}}}),J.extend({valHooks:{option:{get:function(e){var t=J.find.attr(e,"value");return null!=t?t:J.trim(J.text(e))}},select:{get:function(e){for(var t,n,i=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,s=o?null:[],a=o?r+1:i.length,l=0>r?a:o?r:0;a>l;l++)if(n=i[l],!(!n.selected&&l!==r||(K.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&J.nodeName(n.parentNode,"optgroup"))){if(t=J(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,i,r=e.options,o=J.makeArray(t),s=r.length;s--;)i=r[s],(i.selected=J.inArray(i.value,o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]={set:function(e,t){return J.isArray(t)?e.checked=J.inArray(J(e).val(),t)>=0:void 0}},K.checkOn||(J.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){J.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),J.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var ht=J.now(),ut=/\?/;J.parseJSON=function(e){return JSON.parse(e+"")},J.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+e),t};var ct=/#.*$/,pt=/([?&])_=[^&]*/,dt=/^(.*?):[ \t]*([^\r\n]*)$/gm,ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,mt=/^(?:GET|HEAD)$/,vt=/^\/\//,yt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,gt={},xt={},bt="*/".concat("*"),_t=e.location.href,wt=yt.exec(_t.toLowerCase())||[];J.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:_t,type:"GET",isLocal:ft.test(wt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":bt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?O(O(e,J.ajaxSettings),t):O(J.ajaxSettings,e)},ajaxPrefilter:D(gt),ajaxTransport:D(xt),ajax:function(e,t){function n(e,t,n,s){var l,u,y,g,b,w=t;2!==x&&(x=2,a&&clearTimeout(a),i=void 0,o=s||"",_.readyState=e>0?4:0,l=e>=200&&300>e||304===e,n&&(g=V(c,_,n)),g=z(c,g,_,l),l?(c.ifModified&&(b=_.getResponseHeader("Last-Modified"),b&&(J.lastModified[r]=b),b=_.getResponseHeader("etag"),b&&(J.etag[r]=b)),204===e||"HEAD"===c.type?w="nocontent":304===e?w="notmodified":(w=g.state,u=g.data,y=g.error,l=!y)):(y=w,(e||!w)&&(w="error",0>e&&(e=0))),_.status=e,_.statusText=(t||w)+"",l?f.resolveWith(p,[u,w,_]):f.rejectWith(p,[_,w,y]),_.statusCode(v),v=void 0,h&&d.trigger(l?"ajaxSuccess":"ajaxError",[_,c,l?u:y]),m.fireWith(p,[_,w]),h&&(d.trigger("ajaxComplete",[_,c]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,r,o,s,a,l,h,u,c=J.ajaxSetup({},t),p=c.context||c,d=c.context&&(p.nodeType||p.jquery)?J(p):J.event,f=J.Deferred(),m=J.Callbacks("once memory"),v=c.statusCode||{},y={},g={},x=0,b="canceled",_={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!s)for(s={};t=dt.exec(o);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=g[n]=g[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)v[t]=[v[t],e[t]];else _.always(e[_.status]);return this},abort:function(e){var t=e||b;return i&&i.abort(t),n(0,t),this}};if(f.promise(_).complete=m.add,_.success=_.done,_.error=_.fail,c.url=((e||c.url||_t)+"").replace(ct,"").replace(vt,wt[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=J.trim(c.dataType||"*").toLowerCase().match(de)||[""],null==c.crossDomain&&(l=yt.exec(c.url.toLowerCase()),c.crossDomain=!(!l||l[1]===wt[1]&&l[2]===wt[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(wt[3]||("http:"===wt[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=J.param(c.data,c.traditional)),N(gt,c,t,_),2===x)return _;h=J.event&&c.global,h&&0===J.active++&&J.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!mt.test(c.type),r=c.url,c.hasContent||(c.data&&(r=c.url+=(ut.test(r)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=pt.test(r)?r.replace(pt,"$1_="+ht++):r+(ut.test(r)?"&":"?")+"_="+ht++)),c.ifModified&&(J.lastModified[r]&&_.setRequestHeader("If-Modified-Since",J.lastModified[r]),J.etag[r]&&_.setRequestHeader("If-None-Match",J.etag[r])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&_.setRequestHeader("Content-Type",c.contentType),_.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+bt+"; q=0.01":""):c.accepts["*"]);for(u in c.headers)_.setRequestHeader(u,c.headers[u]);if(c.beforeSend&&(c.beforeSend.call(p,_,c)===!1||2===x))return _.abort();b="abort";for(u in{success:1,error:1,complete:1})_[u](c[u]);if(i=N(xt,c,t,_)){_.readyState=1,h&&d.trigger("ajaxSend",[_,c]),c.async&&c.timeout>0&&(a=setTimeout(function(){_.abort("timeout")},c.timeout));try{x=1,i.send(y,n)}catch(w){if(!(2>x))throw w;n(-1,w)}}else n(-1,"No Transport");return _},getJSON:function(e,t,n){return J.get(e,t,n,"json")},getScript:function(e,t){return J.get(e,void 0,t,"script")}}),J.each(["get","post"],function(e,t){J[t]=function(e,n,i,r){return J.isFunction(n)&&(r=r||i,i=n,n=void 0),J.ajax({url:e,type:t,dataType:r,data:n,success:i})}}),J._evalUrl=function(e){return J.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},J.fn.extend({wrapAll:function(e){var t;return J.isFunction(e)?this.each(function(t){J(this).wrapAll(e.call(this,t))}):(this[0]&&(t=J(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(J.isFunction(e)?function(t){J(this).wrapInner(e.call(this,t))}:function(){var t=J(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=J.isFunction(e);return this.each(function(n){J(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()}}),J.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},J.expr.filters.visible=function(e){return!J.expr.filters.hidden(e)};var St=/%20/g,Mt=/\[\]$/,Tt=/\r?\n/g,Et=/^(?:submit|button|image|reset|file)$/i,Ct=/^(?:input|select|textarea|keygen)/i;J.param=function(e,t){var n,i=[],r=function(e,t){t=J.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(e)||e.jquery&&!J.isPlainObject(e))J.each(e,function(){r(this.name,this.value)});else for(n in e)U(n,e[n],t,r);return i.join("&").replace(St,"+")},J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=J.prop(this,"elements");return e?J.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!J(this).is(":disabled")&&Ct.test(this.nodeName)&&!Et.test(e)&&(this.checked||!Me.test(e))}).map(function(e,t){var n=J(this).val();return null==n?null:J.isArray(n)?J.map(n,function(e){return{name:t.name,value:e.replace(Tt,"\r\n")}}):{name:t.name,value:n.replace(Tt,"\r\n")}}).get()}}),J.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var At=0,Pt={},Ft={0:200,1223:204},Lt=J.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Pt)Pt[e]()}),K.cors=!!Lt&&"withCredentials"in Lt,K.ajax=Lt=!!Lt,J.ajaxTransport(function(e){var t;return K.cors||Lt&&!e.crossDomain?{send:function(n,i){var r,o=e.xhr(),s=++At;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)o[r]=e.xhrFields[r];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(r in n)o.setRequestHeader(r,n[r]);t=function(e){return function(){t&&(delete Pt[s],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?i(o.status,o.statusText):i(Ft[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=Pt[s]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(a){if(t)throw a}},abort:function(){t&&t()}}:void 0}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return J.globalEval(e),e}}}),J.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),J.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,r){t=J("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&r("error"===e.type?404:200,e.type)}),Z.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Rt=[],Bt=/(=)\?(?=&|$)|\?\?/;J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Rt.pop()||J.expando+"_"+ht++;return this[e]=!0,e}}),J.ajaxPrefilter("json jsonp",function(t,n,i){var r,o,s,a=t.jsonp!==!1&&(Bt.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bt.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(r=t.jsonpCallback=J.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Bt,"$1"+r):t.jsonp!==!1&&(t.url+=(ut.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return s||J.error(r+" was not called"),s[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){s=arguments},i.always(function(){e[r]=o,t[r]&&(t.jsonpCallback=n.jsonpCallback,Rt.push(r)),s&&J.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),J.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||Z;var i=se.exec(e),r=!n&&[];return i?[t.createElement(i[1])]:(i=J.buildFragment([e],t,r),r&&r.length&&J(r).remove(),J.merge([],i.childNodes))};var kt=J.fn.load;J.fn.load=function(e,t,n){if("string"!=typeof e&&kt)return kt.apply(this,arguments);var i,r,o,s=this,a=e.indexOf(" ");return a>=0&&(i=J.trim(e.slice(a)),e=e.slice(0,a)),J.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),s.length>0&&J.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){o=arguments,s.html(i?J("<div>").append(J.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){s.each(n,o||[e.responseText,t,e])}),this},J.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){J.fn[t]=function(e){return this.on(t,e)}}),J.expr.filters.animated=function(e){return J.grep(J.timers,function(t){return e===t.elem}).length};var Dt=e.document.documentElement;J.offset={setOffset:function(e,t,n){var i,r,o,s,a,l,h,u=J.css(e,"position"),c=J(e),p={};"static"===u&&(e.style.position="relative"),a=c.offset(),o=J.css(e,"top"),l=J.css(e,"left"),h=("absolute"===u||"fixed"===u)&&(o+l).indexOf("auto")>-1,h?(i=c.position(),s=i.top,r=i.left):(s=parseFloat(o)||0,r=parseFloat(l)||0),J.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(p.top=t.top-a.top+s),null!=t.left&&(p.left=t.left-a.left+r),"using"in t?t.using.call(e,p):c.css(p)}},J.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){J.offset.setOffset(this,e,t)});var t,n,i=this[0],r={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,J.contains(t,i)?(typeof i.getBoundingClientRect!==Te&&(r=i.getBoundingClientRect()),n=I(o),{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r},position:function(){if(this[0]){var e,t,n=this[0],i={top:0,left:0};return"fixed"===J.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),J.nodeName(e[0],"html")||(i=e.offset()),i.top+=J.css(e[0],"borderTopWidth",!0),i.left+=J.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-J.css(n,"marginTop",!0),left:t.left-i.left-J.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Dt;e&&!J.nodeName(e,"html")&&"static"===J.css(e,"position");)e=e.offsetParent;return e||Dt})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var i="pageYOffset"===n;J.fn[t]=function(r){return ve(this,function(t,r,o){var s=I(t);return void 0===o?s?s[n]:t[r]:void(s?s.scrollTo(i?e.pageXOffset:o,i?o:e.pageYOffset):t[r]=o)},t,r,arguments.length,null)}}),J.each(["top","left"],function(e,t){J.cssHooks[t]=w(K.pixelPosition,function(e,n){return n?(n=_(e,t),je.test(n)?J(e).position()[t]+"px":n):void 0})}),J.each({Height:"height",Width:"width"},function(e,t){J.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){J.fn[i]=function(i,r){var o=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||r===!0?"margin":"border");return ve(this,function(t,n,i){var r;return J.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===i?J.css(t,n,s):J.style(t,n,i,s)},t,o?i:void 0,o,null)}})}),J.fn.size=function(){return this.length},J.fn.andSelf=J.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return J});var Nt=e.jQuery,Ot=e.$;return J.noConflict=function(t){return e.$===J&&(e.$=Ot),t&&e.jQuery===J&&(e.jQuery=Nt),J},typeof t===Te&&(e.jQuery=e.$=J),J})},{}],8:[function(e,t,n){function i(e,t,n){var i=-1,o=e?e.length:0,a=[];for(t=r(t,n,3);++i<o;){var l=e[i];t(l,i,e)&&(a.push(l),s.call(e,i--,1),o--)}return a}var r=e(10),o=Array.prototype,s=o.splice;t.exports=i},{10:10}],9:[function(e,t,n){function i(e,t,n,i){var c=e?e.length:0;return a(c)||(e=h(e),c=e.length),c?(n="number"!=typeof n||i&&s(t,n,i)?0:0>n?u(c+n,0):n||0,"string"==typeof e||!o(e)&&l(e)?c>n&&e.indexOf(t,n)>-1:r(e,t,n)>-1):!1}var r=e(11),o=e(34),s=e(27),a=e(28),l=e(37),h=e(42),u=Math.max;t.exports=i},{11:11,27:27,28:28,34:34,37:37,42:42}],10:[function(e,t,n){function i(e,t,n){var i=typeof e;return"function"==i?"undefined"==typeof t?e:a(e,t,n):null==e?l:"object"==i?r(e):"undefined"==typeof t?s(e+""):o(e+"",t)}var r=e(15),o=e(16),s=e(17),a=e(21),l=e(46);t.exports=i},{15:15,16:16,17:17,21:21,46:46}],11:[function(e,t,n){function i(e,t,n){if(t!==t)return r(e,n);for(var i=n-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}var r=e(25);t.exports=i},{25:25}],12:[function(e,t,n){function i(e,t,n,o,s,a){if(e===t)return 0!==e||1/e==1/t;var l=typeof e,h=typeof t;return"function"!=l&&"object"!=l&&"function"!=h&&"object"!=h||null==e||null==t?e!==e&&t!==t:r(e,t,i,n,o,s,a)}var r=e(13);t.exports=i},{13:13}],13:[function(e,t,n){function i(e,t,n,i,d,v,y){var g=a(e),x=a(t),b=u,_=u;g||(b=m.call(e),b==h?b=p:b!=p&&(g=l(e))),x||(_=m.call(t),_==h?_=p:_!=p&&(x=l(t)));var w=b==p||d&&b==c,S=_==p||d&&_==c,M=b==_;if(M&&!g&&!w)return o(e,t,b);if(d){if(!(M||w&&S))return!1}else{var T=w&&f.call(e,"__wrapped__"),E=S&&f.call(t,"__wrapped__");if(T||E)return n(T?e.value():e,E?t.value():t,i,d,v,y);if(!M)return!1}v||(v=[]),y||(y=[]);for(var C=v.length;C--;)if(v[C]==e)return y[C]==t;v.push(e),y.push(t);var A=(g?r:s)(e,t,n,i,d,v,y);return v.pop(),y.pop(),A}var r=e(22),o=e(23),s=e(24),a=e(34),l=e(38),h="[object Arguments]",u="[object Array]",c="[object Function]",p="[object Object]",d=Object.prototype,f=d.hasOwnProperty,m=d.toString;t.exports=i},{22:22,23:23,24:24,34:34,38:38}],14:[function(e,t,n){function i(e,t,n,i,o){for(var s=-1,a=t.length,l=!o;++s<a;)if(l&&i[s]?n[s]!==e[t[s]]:!(t[s]in e))return!1;for(s=-1;++s<a;){var h=t[s],u=e[h],c=n[s];if(l&&i[s])var p="undefined"!=typeof u||h in e;else p=o?o(u,c,h):void 0,"undefined"==typeof p&&(p=r(c,u,o,!0));if(!p)return!1}return!0}var r=e(12);t.exports=i},{12:12}],15:[function(e,t,n){function i(e){var t=a(e),n=t.length;if(!n)return o(!0);if(1==n){var i=t[0],h=e[i];if(s(h))return function(e){return null!=e&&e[i]===h&&("undefined"!=typeof h||i in l(e))}}for(var u=Array(n),c=Array(n);n--;)h=e[t[n]],u[n]=h,c[n]=s(h);return function(e){return null!=e&&r(l(e),t,u,c)}}var r=e(14),o=e(45),s=e(30),a=e(40),l=e(32);t.exports=i},{14:14,30:30,32:32,40:40,45:45}],16:[function(e,t,n){function i(e,t){return o(t)?function(n){return null!=n&&n[e]===t&&("undefined"!=typeof t||e in s(n))}:function(n){return null!=n&&r(t,n[e],null,!0)}}var r=e(12),o=e(30),s=e(32);t.exports=i},{12:12,30:30,32:32}],17:[function(e,t,n){function i(e){return function(t){return null==t?void 0:t[e]}}t.exports=i},{}],18:[function(e,t,n){function i(e,t){return e+r(o()*(t-e+1))}var r=Math.floor,o=Math.random;t.exports=i},{}],19:[function(e,t,n){function i(e){return"string"==typeof e?e:null==e?"":e+""}t.exports=i},{}],20:[function(e,t,n){function i(e,t){for(var n=-1,i=t.length,r=Array(i);++n<i;)r[n]=e[t[n]];return r}t.exports=i},{}],21:[function(e,t,n){function i(e,t,n){if("function"!=typeof e)return r;if("undefined"==typeof t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,o){return e.call(t,n,i,r,o)};case 5:return function(n,i,r,o,s){return e.call(t,n,i,r,o,s)}}return function(){return e.apply(t,arguments)}}var r=e(46);t.exports=i},{46:46}],22:[function(e,t,n){function i(e,t,n,i,r,o,s){var a=-1,l=e.length,h=t.length,u=!0;if(l!=h&&!(r&&h>l))return!1;for(;u&&++a<l;){var c=e[a],p=t[a];if(u=void 0,i&&(u=r?i(p,c,a):i(c,p,a)),"undefined"==typeof u)if(r)for(var d=h;d--&&(p=t[d],!(u=c&&c===p||n(c,p,i,r,o,s))););else u=c&&c===p||n(c,p,i,r,o,s)}return!!u}t.exports=i},{}],23:[function(e,t,n){function i(e,t,n){switch(n){case r:case o:return+e==+t;case s:return e.name==t.name&&e.message==t.message;case a:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case l:case h:return e==t+""}return!1}var r="[object Boolean]",o="[object Date]",s="[object Error]",a="[object Number]",l="[object RegExp]",h="[object String]";t.exports=i},{}],24:[function(e,t,n){function i(e,t,n,i,o,a,l){var h=r(e),u=h.length,c=r(t),p=c.length;if(u!=p&&!o)return!1;for(var d=o,f=-1;++f<u;){var m=h[f],v=o?m in t:s.call(t,m);if(v){var y=e[m],g=t[m];v=void 0,i&&(v=o?i(g,y,m):i(y,g,m)),"undefined"==typeof v&&(v=y&&y===g||n(y,g,i,o,a,l))}if(!v)return!1;d||(d="constructor"==m)}if(!d){var x=e.constructor,b=t.constructor;if(x!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b))return!1}return!0}var r=e(40),o=Object.prototype,s=o.hasOwnProperty;t.exports=i},{40:40}],25:[function(e,t,n){function i(e,t,n){for(var i=e.length,r=t+(n?0:-1);n?r--:++r<i;){var o=e[r];if(o!==o)return r}return-1}t.exports=i},{}],26:[function(e,t,n){function i(e,t){return e=+e,t=null==t?r:t,e>-1&&e%1==0&&t>e}var r=Math.pow(2,53)-1;t.exports=i},{}],27:[function(e,t,n){function i(e,t,n){if(!s(n))return!1;var i=typeof t;if("number"==i)var a=n.length,l=o(a)&&r(t,a);else l="string"==i&&t in n;if(l){var h=n[t];return e===e?e===h:h!==h}return!1}var r=e(26),o=e(28),s=e(36);t.exports=i},{26:26,28:28,36:36}],28:[function(e,t,n){function i(e){return"number"==typeof e&&e>-1&&e%1==0&&r>=e}var r=Math.pow(2,53)-1;t.exports=i},{}],29:[function(e,t,n){function i(e){return!!e&&"object"==typeof e}t.exports=i},{}],30:[function(e,t,n){function i(e){return e===e&&(0===e?1/e>0:!r(e))}var r=e(36);t.exports=i},{36:36}],31:[function(e,t,n){function i(e){for(var t=l(e),n=t.length,i=n&&e.length,u=i&&a(i)&&(o(e)||h.nonEnumArgs&&r(e)),p=-1,d=[];++p<n;){var f=t[p];(u&&s(f,i)||c.call(e,f))&&d.push(f)}return d}var r=e(33),o=e(34),s=e(26),a=e(28),l=e(41),h=e(44),u=Object.prototype,c=u.hasOwnProperty;t.exports=i},{26:26,28:28,33:33,34:34,41:41,44:44}],32:[function(e,t,n){function i(e){return r(e)?e:Object(e)}var r=e(36);t.exports=i},{36:36}],33:[function(e,t,n){function i(e){var t=o(e)?e.length:void 0;return r(t)&&l.call(e)==s}var r=e(28),o=e(29),s="[object Arguments]",a=Object.prototype,l=a.toString;t.exports=i},{28:28,29:29}],34:[function(e,t,n){var i=e(28),r=e(35),o=e(29),s="[object Array]",a=Object.prototype,l=a.toString,h=r(h=Array.isArray)&&h,u=h||function(e){return o(e)&&i(e.length)&&l.call(e)==s};t.exports=u},{28:28,29:29,35:35}],35:[function(e,t,n){function i(e){return null==e?!1:u.call(e)==s?c.test(h.call(e)):o(e)&&a.test(e)}var r=e(43),o=e(29),s="[object Function]",a=/^\[object .+?Constructor\]$/,l=Object.prototype,h=Function.prototype.toString,u=l.toString,c=RegExp("^"+r(u).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=i},{29:29,43:43}],36:[function(e,t,n){function i(e){var t=typeof e;return"function"==t||!!e&&"object"==t}t.exports=i},{}],37:[function(e,t,n){function i(e){return"string"==typeof e||r(e)&&a.call(e)==o}var r=e(29),o="[object String]",s=Object.prototype,a=s.toString;t.exports=i},{29:29}],38:[function(e,t,n){function i(e){return o(e)&&r(e.length)&&!!P[L.call(e)]}var r=e(28),o=e(29),s="[object Arguments]",a="[object Array]",l="[object Boolean]",h="[object Date]",u="[object Error]",c="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",m="[object RegExp]",v="[object Set]",y="[object String]",g="[object WeakMap]",x="[object ArrayBuffer]",b="[object Float32Array]",_="[object Float64Array]",w="[object Int8Array]",S="[object Int16Array]",M="[object Int32Array]",T="[object Uint8Array]",E="[object Uint8ClampedArray]",C="[object Uint16Array]",A="[object Uint32Array]",P={};P[b]=P[_]=P[w]=P[S]=P[M]=P[T]=P[E]=P[C]=P[A]=!0,P[s]=P[a]=P[x]=P[l]=P[h]=P[u]=P[c]=P[p]=P[d]=P[f]=P[m]=P[v]=P[y]=P[g]=!1;var F=Object.prototype,L=F.toString;t.exports=i},{28:28,29:29}],39:[function(e,t,n){function i(e,t,n){n&&o(e,t,n)&&(t=n=null);var i=null==e,l=null==t;if(null==n&&(l&&"boolean"==typeof e?(n=e,e=1):"boolean"==typeof t&&(n=t,l=!0)),i&&l&&(t=1,l=!1),e=+e||0,l?(t=e,e=0):t=+t||0,n||e%1||t%1){var h=a();return s(e+h*(t-e+parseFloat("1e-"+((h+"").length-1))),t)}return r(e,t)}var r=e(18),o=e(27),s=Math.min,a=Math.random;t.exports=i},{18:18,27:27}],40:[function(e,t,n){var i=e(28),r=e(35),o=e(36),s=e(31),a=r(a=Object.keys)&&a,l=a?function(e){if(e)var t=e.constructor,n=e.length;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&n&&i(n)?s(e):o(e)?a(e):[]}:s;t.exports=l},{28:28,31:31,35:35,36:36}],41:[function(e,t,n){function i(e){if(null==e)return[];l(e)||(e=Object(e));var t=e.length;t=t&&a(t)&&(o(e)||h.nonEnumArgs&&r(e))&&t||0;for(var n=e.constructor,i=-1,u="function"==typeof n&&n.prototype===e,p=Array(t),d=t>0;++i<t;)p[i]=i+"";for(var f in e)d&&s(f,t)||"constructor"==f&&(u||!c.call(e,f))||p.push(f);return p}var r=e(33),o=e(34),s=e(26),a=e(28),l=e(36),h=e(44),u=Object.prototype,c=u.hasOwnProperty;t.exports=i},{26:26,28:28,33:33,34:34,36:36,44:44}],42:[function(e,t,n){function i(e){return r(e,o(e))}var r=e(20),o=e(40);t.exports=i},{20:20,40:40}],43:[function(e,t,n){function i(e){return e=r(e),e&&s.test(e)?e.replace(o,"\\$&"):e}var r=e(19),o=/[.*+?^${}()|[\]\/\\]/g,s=RegExp(o.source);t.exports=i},{19:19}],44:[function(e,t,n){(function(e){var n=Object.prototype,i=(i=e.window)&&i.document,r=n.propertyIsEnumerable,o={};!function(e){o.funcDecomp=/\bthis\b/.test(function(){return this}),o.funcNames="string"==typeof Function.name;try{o.dom=11===i.createDocumentFragment().nodeType}catch(t){o.dom=!1}try{o.nonEnumArgs=!r.call(arguments,1)}catch(t){o.nonEnumArgs=!0}}(0,0),t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t,n){function i(e){return function(){return e}}t.exports=i},{}],46:[function(e,t,n){function i(e){return e}t.exports=i},{}],47:[function(e,t,n){(function(n){function i(e,t,n){if(e=+e,1>e||!o(e))return[];var i=-1,l=Array(s(e,a));for(t=r(t,n,1);++i<e;)a>i?l[i]=t(i):t(i);return l}var r=e(21),o=n.isFinite,s=Math.min,a=Math.pow(2,32)-1;t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{21:21}],48:[function(e,t,n){!function(){function e(e){e||(e=Math.random),this.p=new Uint8Array(256),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var t=0;256>t;t++)this.p[t]=256*e();for(t=0;512>t;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}var i=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,o=1/3,s=1/6,a=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;e.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,t){var n,o,s,a,l,h=this.permMod12,u=this.perm,c=this.grad3,p=(e+t)*i,d=Math.floor(e+p),f=Math.floor(t+p),m=(d+f)*r,v=d-m,y=f-m,g=e-v,x=t-y;g>x?(a=1,l=0):(a=0,l=1);var b=g-a+r,_=x-l+r,w=g-1+2*r,S=x-1+2*r,M=255&d,T=255&f,E=.5-g*g-x*x;if(0>E)n=0;else{var C=3*h[M+u[T]];E*=E,n=E*E*(c[C]*g+c[C+1]*x)}var A=.5-b*b-_*_;if(0>A)o=0;else{var P=3*h[M+a+u[T+l]];A*=A,o=A*A*(c[P]*b+c[P+1]*_)}var F=.5-w*w-S*S;if(0>F)s=0;else{var L=3*h[M+1+u[T+1]];F*=F,s=F*F*(c[L]*w+c[L+1]*S)}return 70*(n+o+s)},noise3D:function(e,t,n){var i,r,a,l,h,u,c,p,d,f,m=this.permMod12,v=this.perm,y=this.grad3,g=(e+t+n)*o,x=Math.floor(e+g),b=Math.floor(t+g),_=Math.floor(n+g),w=(x+b+_)*s,S=x-w,M=b-w,T=_-w,E=e-S,C=t-M,A=n-T;E>=C?C>=A?(h=1,u=0,c=0,p=1,d=1,f=0):E>=A?(h=1,u=0,c=0,p=1,d=0,f=1):(h=0,u=0,c=1,p=1,d=0,f=1):A>C?(h=0,u=0,c=1,p=0,d=1,f=1):A>E?(h=0,u=1,c=0,p=0,d=1,f=1):(h=0,u=1,c=0,p=1,d=1,f=0);var P=E-h+s,F=C-u+s,L=A-c+s,R=E-p+2*s,B=C-d+2*s,k=A-f+2*s,D=E-1+3*s,N=C-1+3*s,O=A-1+3*s,V=255&x,z=255&b,U=255&_,I=.6-E*E-C*C-A*A;if(0>I)i=0;else{var j=3*m[V+v[z+v[U]]];I*=I,i=I*I*(y[j]*E+y[j+1]*C+y[j+2]*A)}var G=.6-P*P-F*F-L*L;if(0>G)r=0;else{var q=3*m[V+h+v[z+u+v[U+c]]];G*=G,r=G*G*(y[q]*P+y[q+1]*F+y[q+2]*L)}var H=.6-R*R-B*B-k*k;if(0>H)a=0;else{var W=3*m[V+p+v[z+d+v[U+f]]];H*=H,a=H*H*(y[W]*R+y[W+1]*B+y[W+2]*k)}var X=.6-D*D-N*N-O*O;if(0>X)l=0;else{var Y=3*m[V+1+v[z+1+v[U+1]]];X*=X,l=X*X*(y[Y]*D+y[Y+1]*N+y[Y+2]*O)}return 32*(i+r+a+l)},noise4D:function(e,t,n,i){var r,o,s,h,u,c=(this.permMod12,this.perm),p=this.grad4,d=(e+t+n+i)*a,f=Math.floor(e+d),m=Math.floor(t+d),v=Math.floor(n+d),y=Math.floor(i+d),g=(f+m+v+y)*l,x=f-g,b=m-g,_=v-g,w=y-g,S=e-x,M=t-b,T=n-_,E=i-w,C=0,A=0,P=0,F=0;S>M?C++:A++,S>T?C++:P++,S>E?C++:F++,M>T?A++:P++,M>E?A++:F++,T>E?P++:F++;var L,R,B,k,D,N,O,V,z,U,I,j;L=C>=3?1:0,R=A>=3?1:0,B=P>=3?1:0,k=F>=3?1:0,D=C>=2?1:0,N=A>=2?1:0,O=P>=2?1:0,V=F>=2?1:0,z=C>=1?1:0,U=A>=1?1:0,I=P>=1?1:0,j=F>=1?1:0;var G=S-L+l,q=M-R+l,H=T-B+l,W=E-k+l,X=S-D+2*l,Y=M-N+2*l,Q=T-O+2*l,K=E-V+2*l,Z=S-z+3*l,$=M-U+3*l,J=T-I+3*l,ee=E-j+3*l,te=S-1+4*l,ne=M-1+4*l,ie=T-1+4*l,re=E-1+4*l,oe=255&f,se=255&m,ae=255&v,le=255&y,he=.6-S*S-M*M-T*T-E*E;if(0>he)r=0;else{var ue=c[oe+c[se+c[ae+c[le]]]]%32*4;he*=he,r=he*he*(p[ue]*S+p[ue+1]*M+p[ue+2]*T+p[ue+3]*E)}var ce=.6-G*G-q*q-H*H-W*W;if(0>ce)o=0;else{var pe=c[oe+L+c[se+R+c[ae+B+c[le+k]]]]%32*4;ce*=ce,o=ce*ce*(p[pe]*G+p[pe+1]*q+p[pe+2]*H+p[pe+3]*W)}var de=.6-X*X-Y*Y-Q*Q-K*K;if(0>de)s=0;else{var fe=c[oe+D+c[se+N+c[ae+O+c[le+V]]]]%32*4;de*=de,s=de*de*(p[fe]*X+p[fe+1]*Y+p[fe+2]*Q+p[fe+3]*K)}var me=.6-Z*Z-$*$-J*J-ee*ee;if(0>me)h=0;else{var ve=c[oe+z+c[se+U+c[ae+I+c[le+j]]]]%32*4;me*=me,h=me*me*(p[ve]*Z+p[ve+1]*$+p[ve+2]*J+p[ve+3]*ee)}var ye=.6-te*te-ne*ne-ie*ie-re*re;if(0>ye)u=0;else{var ge=c[oe+1+c[se+1+c[ae+1+c[le+1]]]]%32*4;ye*=ye,u=ye*ye*(p[ge]*te+p[ge+1]*ne+p[ge+2]*ie+p[ge+3]*re)}return 27*(r+o+s+h+u)}},"undefined"!=typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof window&&(window.SimplexNoise=e),"undefined"!=typeof n&&(n.SimplexNoise=e),"undefined"!=typeof t&&(t.exports=e)}()},{}],49:[function(e,t,n){var i={REVISION:"70"};"object"==typeof t&&(t.exports=i),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:e>0?1:0}),i.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},i.CullFaceNone=0,i.CullFaceBack=1,i.CullFaceFront=2,i.CullFaceFrontBack=3,i.FrontFaceDirectionCW=0,i.FrontFaceDirectionCCW=1,i.BasicShadowMap=0,i.PCFShadowMap=1,i.PCFSoftShadowMap=2,i.FrontSide=0,i.BackSide=1,i.DoubleSide=2,i.NoShading=0,i.FlatShading=1,i.SmoothShading=2,i.NoColors=0,i.FaceColors=1,i.VertexColors=2,i.NoBlending=0,i.NormalBlending=1,i.AdditiveBlending=2,i.SubtractiveBlending=3,i.MultiplyBlending=4,i.CustomBlending=5,i.AddEquation=100,i.SubtractEquation=101,i.ReverseSubtractEquation=102,i.MinEquation=103,i.MaxEquation=104,i.ZeroFactor=200,i.OneFactor=201,i.SrcColorFactor=202,i.OneMinusSrcColorFactor=203,i.SrcAlphaFactor=204,i.OneMinusSrcAlphaFactor=205,i.DstAlphaFactor=206,i.OneMinusDstAlphaFactor=207,i.DstColorFactor=208,i.OneMinusDstColorFactor=209,i.SrcAlphaSaturateFactor=210,i.MultiplyOperation=0,i.MixOperation=1,i.AddOperation=2,i.UVMapping=300,i.CubeReflectionMapping=301,i.CubeRefractionMapping=302,i.EquirectangularReflectionMapping=303,i.EquirectangularRefractionMapping=304,i.SphericalReflectionMapping=305,
i.RepeatWrapping=1e3,i.ClampToEdgeWrapping=1001,i.MirroredRepeatWrapping=1002,i.NearestFilter=1003,i.NearestMipMapNearestFilter=1004,i.NearestMipMapLinearFilter=1005,i.LinearFilter=1006,i.LinearMipMapNearestFilter=1007,i.LinearMipMapLinearFilter=1008,i.UnsignedByteType=1009,i.ByteType=1010,i.ShortType=1011,i.UnsignedShortType=1012,i.IntType=1013,i.UnsignedIntType=1014,i.FloatType=1015,i.UnsignedShort4444Type=1016,i.UnsignedShort5551Type=1017,i.UnsignedShort565Type=1018,i.AlphaFormat=1019,i.RGBFormat=1020,i.RGBAFormat=1021,i.LuminanceFormat=1022,i.LuminanceAlphaFormat=1023,i.RGBEFormat=i.RGBAFormat,i.RGB_S3TC_DXT1_Format=2001,i.RGBA_S3TC_DXT1_Format=2002,i.RGBA_S3TC_DXT3_Format=2003,i.RGBA_S3TC_DXT5_Format=2004,i.RGB_PVRTC_4BPPV1_Format=2100,i.RGB_PVRTC_2BPPV1_Format=2101,i.RGBA_PVRTC_4BPPV1_Format=2102,i.RGBA_PVRTC_2BPPV1_Format=2103,i.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},i.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},i.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},i.Color.prototype={constructor:i.Color,r:1,g:1,b:1,set:function(e){return e instanceof i.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var i=function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+6*(t-e)*(2/3-n):e},r=.5>=n?n*(1+t):n+t-n*t,o=2*n-r;this.r=i(o,r,e+1/3),this.g=i(o,r,e),this.b=i(o,r,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(i.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,n,i=e||{h:0,s:0,l:0},r=this.r,o=this.g,s=this.b,a=Math.max(r,o,s),l=Math.min(r,o,s),h=(l+a)/2;if(l===a)t=0,n=0;else{var u=a-l;switch(n=.5>=h?u/(a+l):u/(2-a-l),a){case r:t=(o-s)/u+(s>o?6:0);break;case o:t=(s-r)/u+2;break;case s:t=(r-o)/u+4}t/=6}return i.h=t,i.s=n,i.l=h,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=n,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new i.Color).setRGB(this.r,this.g,this.b)}},i.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},i.Quaternion=function(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1},i.Quaternion.prototype={constructor:i.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof i.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),r=Math.cos(e._y/2),o=Math.cos(e._z/2),s=Math.sin(e._x/2),a=Math.sin(e._y/2),l=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=s*r*o+n*a*l,this._y=n*a*o-s*r*l,this._z=n*r*l+s*a*o,this._w=n*r*o-s*a*l):"YXZ"===e.order?(this._x=s*r*o+n*a*l,this._y=n*a*o-s*r*l,this._z=n*r*l-s*a*o,this._w=n*r*o+s*a*l):"ZXY"===e.order?(this._x=s*r*o-n*a*l,this._y=n*a*o+s*r*l,this._z=n*r*l+s*a*o,this._w=n*r*o-s*a*l):"ZYX"===e.order?(this._x=s*r*o-n*a*l,this._y=n*a*o+s*r*l,this._z=n*r*l-s*a*o,this._w=n*r*o+s*a*l):"YZX"===e.order?(this._x=s*r*o+n*a*l,this._y=n*a*o+s*r*l,this._z=n*r*l-s*a*o,this._w=n*r*o-s*a*l):"XZY"===e.order&&(this._x=s*r*o-n*a*l,this._y=n*a*o-s*r*l,this._z=n*r*l+s*a*o,this._w=n*r*o+s*a*l),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],o=n[8],s=n[1],a=n[5],l=n[9],h=n[2],u=n[6],c=n[10],p=i+a+c;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-l)*t,this._y=(o-h)*t,this._z=(s-r)*t):i>a&&i>c?(t=2*Math.sqrt(1+i-a-c),this._w=(u-l)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(o+h)/t):a>c?(t=2*Math.sqrt(1+a-i-c),this._w=(o-h)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+c-i-a),this._w=(s-r)/t,this._x=(o+h)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,n=1e-6;return function(r,o){return void 0===e&&(e=new i.Vector3),t=r.dot(o)+1,n>t?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,o),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,h=t._w;return this._x=n*h+o*s+i*l-r*a,this._y=i*h+o*a+r*s-n*l,this._z=r*h+o*l+n*a-i*s,this._w=o*h-n*s-i*a-r*l,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,o=this._w,s=o*e._w+n*e._x+i*e._y+r*e._z;if(0>s?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var a=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var h=Math.sin((1-t)*a)/l,u=Math.sin(t*a)/l;return this._w=o*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new i.Quaternion(this._x,this._y,this._z,this._w)}},i.Quaternion.slerp=function(e,t,n,i){return n.copy(e).slerp(t,i)},i.Vector2=function(e,t){this.x=e||0,this.y=t||0},i.Vector2.prototype={constructor:i.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new i.Vector2,t=new i.Vector2),e.set(n,n),t.set(r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new i.Vector2(this.x,this.y)}},i.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof i.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new i.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,n){return void 0===e&&(e=new i.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12],this.y=r[1]*t+r[5]*n+r[9]*i+r[13],this.z=r[2]*t+r[6]*n+r[10]*i+r[14],this},applyProjection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*i-s*n,h=a*n+s*t-r*i,u=a*i+r*n-o*t,c=-r*t-o*n-s*i;return this.x=l*a+c*-r+h*-s-u*-o,this.y=h*a+c*-o+u*-r-l*-s,this.z=u*a+c*-s+l*-o-h*-r,this},project:function(){var e;return function(t){return void 0===e&&(e=new i.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new i.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new i.Vector3,t=new i.Vector3),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this},projectOnVector:function(){var e,t;return function(n){return void 0===e&&(e=new i.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new i.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new i.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){var n=4*e,i=t.elements;return this.x=i[n],this.y=i[n+1],this.z=i[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new i.Vector3(this.x,this.y,this.z)}},i.Vector4=function(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1},i.Vector4.prototype={constructor:i.Vector4,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,o=.01,s=.1,a=e.elements,l=a[0],h=a[4],u=a[8],c=a[1],p=a[5],d=a[9],f=a[2],m=a[6],v=a[10];if(Math.abs(h-c)<o&&Math.abs(u-f)<o&&Math.abs(d-m)<o){if(Math.abs(h+c)<s&&Math.abs(u+f)<s&&Math.abs(d+m)<s&&Math.abs(l+p+v-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var y=(l+1)/2,g=(p+1)/2,x=(v+1)/2,b=(h+c)/4,_=(u+f)/4,w=(d+m)/4;return y>g&&y>x?o>y?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(y),i=b/n,r=_/n):g>x?o>g?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(g),n=b/i,r=w/i):o>x?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(x),n=_/r,i=w/r),this.set(n,i,r,t),this}var S=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(c-h)*(c-h));return Math.abs(S)<.001&&(S=1),this.x=(m-d)/S,this.y=(u-f)/S,this.z=(c-h)/S,this.w=Math.acos((l+p+v-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new i.Vector4,t=new i.Vector4),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,n){return void 0===n&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new i.Vector4(this.x,this.y,this.z,this.w)}},i.Euler=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||i.Euler.DefaultOrder},i.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],i.Euler.DefaultOrder="XYZ",i.Euler.prototype={constructor:i.Euler,_x:0,_y:0,_z:0,_order:i.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=i.Math.clamp,o=e.elements,s=o[0],a=o[4],l=o[8],h=o[1],u=o[5],c=o[9],p=o[2],d=o[6],f=o[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(l,f),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-p,s),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-p,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(h,s))):"ZYX"===t?(this._y=Math.asin(-r(p,-1,1)),Math.abs(p)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===t?(this._z=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(l,f))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,n!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,n,r){return void 0===e&&(e=new i.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new i.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order;

},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new i.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new i.Euler(this._x,this._y,this._z,this._order)}},i.Line3=function(e,t){this.start=void 0!==e?e:new i.Vector3,this.end=void 0!==t?t:new i.Vector3},i.Line3.prototype={constructor:i.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new i.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new i.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new i.Vector3,t=new i.Vector3;return function(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var o=t.dot(t),s=t.dot(e),a=s/o;return r&&(a=i.Math.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t),o=n||new i.Vector3;return this.delta(o).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new i.Line3).copy(this)}},i.Box2=function(e,t){this.min=void 0!==e?e:new i.Vector2(1/0,1/0),this.max=void 0!==t?t:new i.Vector2(-(1/0),-(1/0))},i.Box2.prototype={constructor:i.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;n>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i.Vector2;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new i.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var n=t||new i.Vector2;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var n=t||new i.Vector2;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector2;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box2).copy(this)}},i.Box3=function(e,t){this.min=void 0!==e?e:new i.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new i.Vector3(-(1/0),-(1/0),-(1/0))},i.Box3.prototype={constructor:i.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;n>t;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i.Vector3;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(){var e=new i.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var r=t.geometry;if(void 0!==r)if(r instanceof i.Geometry)for(var o=r.vertices,s=0,a=o.length;a>s;s++)e.copy(o[s]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e);else if(r instanceof i.BufferGeometry&&void 0!==r.attributes.position)for(var l=r.attributes.position.array,s=0,a=l.length;a>s;s+=3)e.set(l[s],l[s+1],l[s+2]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var n=t||new i.Vector3;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var n=t||new i.Vector3;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new i.Vector3;return function(t){var n=t||new i.Sphere;return n.center=this.center(),n.radius=.5*this.size(e).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box3).copy(this)}},i.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},i.Matrix3.prototype={constructor:i.Matrix3,set:function(e,t,n,i,r,o,s,a,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=n,h[1]=i,h[4]=r,h[7]=o,h[2]=s,h[5]=a,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new i.Vector3;return function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length);for(var r=0,o=n;i>r;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],h=e[8];return t*o*h-t*s*l-n*r*h+n*s*a+i*r*l-i*o*a},getInverse:function(e,t){var n=e.elements,i=this.elements;i[0]=n[10]*n[5]-n[6]*n[9],i[1]=-n[10]*n[1]+n[2]*n[9],i[2]=n[6]*n[1]-n[2]*n[5],i[3]=-n[10]*n[4]+n[6]*n[8],i[4]=n[10]*n[0]-n[2]*n[8],i[5]=-n[6]*n[0]+n[2]*n[4],i[6]=n[9]*n[4]-n[5]*n[8],i[7]=-n[9]*n[0]+n[1]*n[8],i[8]=n[5]*n[0]-n[1]*n[4];var r=n[0]*i[0]+n[1]*i[3]+n[2]*i[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new i.Matrix3).fromArray(this.elements)}},i.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},i.Matrix4.prototype={constructor:i.Matrix4,set:function(e,t,n,i,r,o,s,a,l,h,u,c,p,d,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=i,v[1]=r,v[5]=o,v[9]=s,v[13]=a,v[2]=l,v[6]=h,v[10]=u,v[14]=c,v[3]=p,v[7]=d,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){var i=this.elements;return e.set(i[0],i[1],i[2]),t.set(i[4],i[5],i[6]),n.set(i[8],i[9],i[10]),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new i.Vector3;return function(t){var n=this.elements,i=t.elements,r=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),s=1/e.set(i[8],i[9],i[10]).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[8]=i[8]*s,n[9]=i[9]*s,n[10]=i[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof i.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,o=e.z,s=Math.cos(n),a=Math.sin(n),l=Math.cos(r),h=Math.sin(r),u=Math.cos(o),c=Math.sin(o);if("XYZ"===e.order){var p=s*u,d=s*c,f=a*u,m=a*c;t[0]=l*u,t[4]=-l*c,t[8]=h,t[1]=d+f*h,t[5]=p-m*h,t[9]=-a*l,t[2]=m-p*h,t[6]=f+d*h,t[10]=s*l}else if("YXZ"===e.order){var v=l*u,y=l*c,g=h*u,x=h*c;t[0]=v+x*a,t[4]=g*a-y,t[8]=s*h,t[1]=s*c,t[5]=s*u,t[9]=-a,t[2]=y*a-g,t[6]=x+v*a,t[10]=s*l}else if("ZXY"===e.order){var v=l*u,y=l*c,g=h*u,x=h*c;t[0]=v-x*a,t[4]=-s*c,t[8]=g+y*a,t[1]=y+g*a,t[5]=s*u,t[9]=x-v*a,t[2]=-s*h,t[6]=a,t[10]=s*l}else if("ZYX"===e.order){var p=s*u,d=s*c,f=a*u,m=a*c;t[0]=l*u,t[4]=f*h-d,t[8]=p*h+m,t[1]=l*c,t[5]=m*h+p,t[9]=d*h-f,t[2]=-h,t[6]=a*l,t[10]=s*l}else if("YZX"===e.order){var b=s*l,_=s*h,w=a*l,S=a*h;t[0]=l*u,t[4]=S-b*c,t[8]=w*c+_,t[1]=c,t[5]=s*u,t[9]=-a*u,t[2]=-h*u,t[6]=_*c+w,t[10]=b-S*c}else if("XZY"===e.order){var b=s*l,_=s*h,w=a*l,S=a*h;t[0]=l*u,t[4]=-c,t[8]=h*u,t[1]=b*c+S,t[5]=s*u,t[9]=_*c-w,t[2]=w*c-_,t[6]=a*u,t[10]=S*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,o=e.w,s=n+n,a=i+i,l=r+r,h=n*s,u=n*a,c=n*l,p=i*a,d=i*l,f=r*l,m=o*s,v=o*a,y=o*l;return t[0]=1-(p+f),t[4]=u-y,t[8]=c+v,t[1]=u+y,t[5]=1-(h+f),t[9]=d-m,t[2]=c-v,t[6]=d+m,t[10]=1-(h+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new i.Vector3,t=new i.Vector3,n=new i.Vector3;return function(i,r,o){var s=this.elements;return n.subVectors(i,r).normalize(),0===n.length()&&(n.z=1),e.crossVectors(o,n).normalize(),0===e.length()&&(n.x+=1e-4,e.crossVectors(o,n).normalize()),t.crossVectors(n,e),s[0]=e.x,s[4]=t.x,s[8]=n.x,s[1]=e.y,s[5]=t.y,s[9]=n.y,s[2]=e.z,s[6]=t.z,s[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],h=n[1],u=n[5],c=n[9],p=n[13],d=n[2],f=n[6],m=n[10],v=n[14],y=n[3],g=n[7],x=n[11],b=n[15],_=i[0],w=i[4],S=i[8],M=i[12],T=i[1],E=i[5],C=i[9],A=i[13],P=i[2],F=i[6],L=i[10],R=i[14],B=i[3],k=i[7],D=i[11],N=i[15];return r[0]=o*_+s*T+a*P+l*B,r[4]=o*w+s*E+a*F+l*k,r[8]=o*S+s*C+a*L+l*D,r[12]=o*M+s*A+a*R+l*N,r[1]=h*_+u*T+c*P+p*B,r[5]=h*w+u*E+c*F+p*k,r[9]=h*S+u*C+c*L+p*D,r[13]=h*M+u*A+c*R+p*N,r[2]=d*_+f*T+m*P+v*B,r[6]=d*w+f*E+m*F+v*k,r[10]=d*S+f*C+m*L+v*D,r[14]=d*M+f*A+m*R+v*N,r[3]=y*_+g*T+x*P+b*B,r[7]=y*w+g*E+x*F+b*k,r[11]=y*S+g*C+x*L+b*D,r[15]=y*M+g*A+x*R+b*N,this},multiplyToArray:function(e,t,n){var i=this.elements;return this.multiplyMatrices(e,t),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new i.Vector3;return function(t,n,i){void 0===n&&(n=0),void 0===i&&(i=t.length);for(var r=0,o=n;i>r;r+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],h=e[2],u=e[6],c=e[10],p=e[14],d=e[3],f=e[7],m=e[11],v=e[15];return d*(+r*a*u-i*l*u-r*s*c+n*l*c+i*s*p-n*a*p)+f*(+t*a*p-t*l*c+r*o*c-i*o*p+i*l*h-r*a*h)+m*(+t*l*u-t*s*p-r*o*u+n*o*p+r*s*h-n*l*h)+v*(-i*s*h-t*a*u+t*s*c+i*o*u-n*o*c+n*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new i.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],o=i[4],s=i[8],a=i[12],l=i[1],h=i[5],u=i[9],c=i[13],p=i[2],d=i[6],f=i[10],m=i[14],v=i[3],y=i[7],g=i[11],x=i[15];n[0]=u*m*y-c*f*y+c*d*g-h*m*g-u*d*x+h*f*x,n[4]=a*f*y-s*m*y-a*d*g+o*m*g+s*d*x-o*f*x,n[8]=s*c*y-a*u*y+a*h*g-o*c*g-s*h*x+o*u*x,n[12]=a*u*d-s*c*d-a*h*f+o*c*f+s*h*m-o*u*m,n[1]=c*f*v-u*m*v-c*p*g+l*m*g+u*p*x-l*f*x,n[5]=s*m*v-a*f*v+a*p*g-r*m*g-s*p*x+r*f*x,n[9]=a*u*v-s*c*v-a*l*g+r*c*g+s*l*x-r*u*x,n[13]=s*c*p-a*u*p+a*l*f-r*c*f-s*l*m+r*u*m,n[2]=h*m*v-c*d*v+c*p*y-l*m*y-h*p*x+l*d*x,n[6]=a*d*v-o*m*v-a*p*y+r*m*y+o*p*x-r*d*x,n[10]=o*c*v-a*h*v+a*l*y-r*c*y-o*l*x+r*h*x,n[14]=a*h*p-o*c*p-a*l*d+r*c*d+o*l*m-r*h*m,n[3]=u*d*v-h*f*v-u*p*y+l*f*y+h*p*g-l*d*g,n[7]=o*f*v-s*d*v+s*p*y-r*f*y-o*p*g+r*d*g,n[11]=s*h*v-o*u*v-s*l*y+r*u*y+o*l*g-r*h*g,n[15]=o*u*p-s*h*p+s*l*d-r*u*d-o*l*f+r*h*f;var b=r*n[0]+l*n[4]+p*n[8]+v*n[12];if(0==b){var _="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return console.warn(_),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,i)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,l=r*o,h=r*s;return this.set(l*o+n,l*s-i*a,l*a+i*s,0,l*s+i*a,h*s+n,h*a-i*o,0,l*a-i*s,h*a+i*o,r*a*a+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new i.Vector3,t=new i.Matrix4;return function(n,i,r){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length(),h=this.determinant();0>h&&(s=-s),n.x=o[12],n.y=o[13],n.z=o[14],t.elements.set(this.elements);var u=1/s,c=1/a,p=1/l;return t.elements[0]*=u,t.elements[1]*=u,t.elements[2]*=u,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=p,t.elements[9]*=p,t.elements[10]*=p,i.setFromRotationMatrix(t),r.x=s,r.y=a,r.z=l,this}}(),makeFrustum:function(e,t,n,i,r,o){var s=this.elements,a=2*r/(t-e),l=2*r/(i-n),h=(t+e)/(t-e),u=(i+n)/(i-n),c=-(o+r)/(o-r),p=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=c,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,n,r){var o=n*Math.tan(i.Math.degToRad(.5*e)),s=-o,a=s*t,l=o*t;return this.makeFrustum(a,l,s,o,n,r)},makeOrthographic:function(e,t,n,i,r,o){var s=this.elements,a=t-e,l=n-i,h=o-r,u=(t+e)/a,c=(n+i)/l,p=(o+r)/h;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-c,s[2]=0,s[6]=0,s[10]=-2/h,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new i.Matrix4).fromArray(this.elements)}},i.Ray=function(e,t){this.origin=void 0!==e?e:new i.Vector3,this.direction=void 0!==t?t:new i.Vector3},i.Ray.prototype={constructor:i.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var n=t||new i.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new i.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new i.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return 0>r?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return 0>n?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(){var e=new i.Vector3,t=new i.Vector3,n=new i.Vector3;return function(i,r,o,s){e.copy(i).add(r).multiplyScalar(.5),t.copy(r).sub(i).normalize(),n.copy(this.origin).sub(e);var a,l,h,u,c=.5*i.distanceTo(r),p=-this.direction.dot(t),d=n.dot(this.direction),f=-n.dot(t),m=n.lengthSq(),v=Math.abs(1-p*p);if(v>0)if(a=p*f-d,l=p*d-f,u=c*v,a>=0)if(l>=-u)if(u>=l){var y=1/v;a*=y,l*=y,h=a*(a+p*l+2*d)+l*(p*a+l+2*f)+m}else l=c,a=Math.max(0,-(p*l+d)),h=-a*a+l*(l+2*f)+m;else l=-c,a=Math.max(0,-(p*l+d)),h=-a*a+l*(l+2*f)+m;else-u>=l?(a=Math.max(0,-(-p*c+d)),l=a>0?-c:Math.min(Math.max(-c,-f),c),h=-a*a+l*(l+2*f)+m):u>=l?(a=0,l=Math.min(Math.max(-c,-f),c),h=l*(l+2*f)+m):(a=Math.max(0,-(p*c+d)),l=a>0?c:Math.min(Math.max(-c,-f),c),h=-a*a+l*(l+2*f)+m);else l=p>0?-c:c,a=Math.max(0,-(p*l+d)),h=-a*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(t).multiplyScalar(l).add(e),h}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new i.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,o=t.radius*t.radius;if(r>o)return null;var s=Math.sqrt(o-r),a=i-s,l=i+s;return 0>a&&0>l?null:0>a?this.at(l,n):this.at(a,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var n=e.normal.dot(this.direction);return 0>n*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:function(){var e=new i.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var n,i,r,o,s,a,l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,c=this.origin;return l>=0?(n=(e.min.x-c.x)*l,i=(e.max.x-c.x)*l):(n=(e.max.x-c.x)*l,i=(e.min.x-c.x)*l),h>=0?(r=(e.min.y-c.y)*h,o=(e.max.y-c.y)*h):(r=(e.max.y-c.y)*h,o=(e.min.y-c.y)*h),n>o||r>i?null:((r>n||n!==n)&&(n=r),(i>o||i!==i)&&(i=o),u>=0?(s=(e.min.z-c.z)*u,a=(e.max.z-c.z)*u):(s=(e.max.z-c.z)*u,a=(e.min.z-c.z)*u),n>a||s>i?null:((s>n||n!==n)&&(n=s),(i>a||i!==i)&&(i=a),0>i?null:this.at(n>=0?n:i,t)))},intersectTriangle:function(){var e=new i.Vector3,t=new i.Vector3,n=new i.Vector3,r=new i.Vector3;return function(i,o,s,a,l){t.subVectors(o,i),n.subVectors(s,i),r.crossVectors(t,n);var h,u=this.direction.dot(r);if(u>0){if(a)return null;h=1}else{if(!(0>u))return null;h=-1,u=-u}e.subVectors(this.origin,i);var c=h*this.direction.dot(n.crossVectors(e,n));if(0>c)return null;var p=h*this.direction.dot(t.cross(e));if(0>p)return null;if(c+p>u)return null;var d=-h*e.dot(r);return 0>d?null:this.at(d/u,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new i.Ray).copy(this)}},i.Sphere=function(e,t){this.center=void 0!==e?e:new i.Vector3,this.radius=void 0!==t?t:0},i.Sphere.prototype={constructor:i.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new i.Box3;return function(t,n){var i=this.center;void 0!==n?i.copy(n):e.setFromPoints(t).center(i);for(var r=0,o=0,s=t.length;s>o;o++)r=Math.max(r,i.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new i.Vector3;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new i.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new i.Sphere).copy(this)}},i.Frustum=function(e,t,n,r,o,s){this.planes=[void 0!==e?e:new i.Plane,void 0!==t?t:new i.Plane,void 0!==n?n:new i.Plane,void 0!==r?r:new i.Plane,void 0!==o?o:new i.Plane,void 0!==s?s:new i.Plane]},i.Frustum.prototype={constructor:i.Frustum,set:function(e,t,n,i,r,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],l=n[5],h=n[6],u=n[7],c=n[8],p=n[9],d=n[10],f=n[11],m=n[12],v=n[13],y=n[14],g=n[15];return t[0].setComponents(s-i,u-a,f-c,g-m).normalize(),t[1].setComponents(s+i,u+a,f+c,g+m).normalize(),t[2].setComponents(s+r,u+l,f+p,g+v).normalize(),t[3].setComponents(s-r,u-l,f-p,g-v).normalize(),t[4].setComponents(s-o,u-h,f-d,g-y).normalize(),t[5].setComponents(s+o,u+h,f+d,g+y).normalize(),this},intersectsObject:function(){var e=new i.Sphere;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;6>r;r++){var o=t[r].distanceToPoint(n);if(i>o)return!1}return!0},intersectsBox:function(){var e=new i.Vector3,t=new i.Vector3;return function(n){for(var i=this.planes,r=0;6>r;r++){var o=i[r];e.x=o.normal.x>0?n.min.x:n.max.x,t.x=o.normal.x>0?n.max.x:n.min.x,e.y=o.normal.y>0?n.min.y:n.max.y,t.y=o.normal.y>0?n.max.y:n.min.y,e.z=o.normal.z>0?n.min.z:n.max.z,t.z=o.normal.z>0?n.max.z:n.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(0>s&&0>a)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new i.Frustum).copy(this)}},i.Plane=function(e,t){this.normal=void 0!==e?e:new i.Vector3(1,0,0),this.constant=void 0!==t?t:0},i.Plane.prototype={constructor:i.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new i.Vector3,t=new i.Vector3;return function(n,i,r){var o=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e),r=t||new i.Vector3;return r.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return 0>t&&n>0||0>n&&t>0},intersectLine:function(){var e=new i.Vector3;return function(t,n){var r=n||new i.Vector3,o=t.delta(e),s=this.normal.dot(o);if(0==s)return 0==this.distanceToPoint(t.start)?r.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/s;return 0>a||a>1?void 0:r.copy(o).multiplyScalar(a).add(t.start)}}(),coplanarPoint:function(e){var t=e||new i.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new i.Vector3,t=new i.Vector3,n=new i.Matrix3;return function(i,r){var o=r||n.getNormalMatrix(i),s=e.copy(this.normal).applyMatrix3(o),a=this.coplanarPoint(t);return a.applyMatrix4(i),this.setFromNormalAndCoplanarPoint(s,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new i.Plane).copy(this)}},i.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;36>r;r++)8==r||13==r||18==r||23==r?n[r]="-":14==r?n[r]="4":(2>=i&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19==r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return t>e?t:e>n?n:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},smoothstep:function(e,t,n){return t>=e?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return t>=e?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t));

},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e}},i.Spline=function(e){function t(e,t,n,i,r,o,s){var a=.5*(n-e),l=.5*(i-t);return(2*(t-n)+a+l)*s+(-3*(t-n)-2*a-l)*o+a*r+t}this.points=e;var n,r,o,s,a,l,h,u,c,p=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return n=(this.points.length-1)*e,r=Math.floor(n),o=n-r,p[0]=0===r?r:r-1,p[1]=r,p[2]=r>this.points.length-2?this.points.length-1:r+1,p[3]=r>this.points.length-3?this.points.length-1:r+2,l=this.points[p[0]],h=this.points[p[1]],u=this.points[p[2]],c=this.points[p[3]],s=o*o,a=o*s,d.x=t(l.x,h.x,u.x,c.x,o,s,a),d.y=t(l.y,h.y,u.y,c.y,o,s,a),d.z=t(l.z,h.z,u.z,c.z,o,s,a),d},this.getControlPointsArray=function(){var e,t,n=this.points.length,i=[];for(e=0;n>e;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,n,r,o,s=0,a=0,l=0,h=new i.Vector3,u=new i.Vector3,c=[],p=0;for(c[0]=0,e||(e=100),r=this.points.length*e,h.copy(this.points[0]),t=1;r>t;t++)n=t/r,o=this.getPoint(n),u.copy(o),p+=u.distanceTo(h),h.copy(o),s=(this.points.length-1)*n,a=Math.floor(s),a!=l&&(c[a]=p,l=a);return c[c.length]=p,{chunks:c,total:p}},this.reparametrizeByArcLength=function(e){var t,n,r,o,s,a,l,h,u=[],c=new i.Vector3,p=this.getLength();for(u.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=p.chunks[t]-p.chunks[t-1],l=Math.ceil(e*a/p.total),o=(t-1)/(this.points.length-1),s=t/(this.points.length-1),n=1;l-1>n;n++)r=o+n*(1/l)*(s-o),h=this.getPoint(r),u.push(c.copy(h).clone());u.push(c.copy(this.points[t]).clone())}this.points=u}},i.Triangle=function(e,t,n){this.a=void 0!==e?e:new i.Vector3,this.b=void 0!==t?t:new i.Vector3,this.c=void 0!==n?n:new i.Vector3},i.Triangle.normal=function(){var e=new i.Vector3;return function(t,n,r,o){var s=o||new i.Vector3;s.subVectors(r,n),e.subVectors(t,n),s.cross(e);var a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}}(),i.Triangle.barycoordFromPoint=function(){var e=new i.Vector3,t=new i.Vector3,n=new i.Vector3;return function(r,o,s,a,l){e.subVectors(a,o),t.subVectors(s,o),n.subVectors(r,o);var h=e.dot(e),u=e.dot(t),c=e.dot(n),p=t.dot(t),d=t.dot(n),f=h*p-u*u,m=l||new i.Vector3;if(0==f)return m.set(-2,-1,-1);var v=1/f,y=(p*c-u*d)*v,g=(h*d-u*c)*v;return m.set(1-y-g,g,y)}}(),i.Triangle.containsPoint=function(){var e=new i.Vector3;return function(t,n,r,o){var s=i.Triangle.barycoordFromPoint(t,n,r,o,e);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}(),i.Triangle.prototype={constructor:i.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new i.Vector3,t=new i.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new i.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return i.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new i.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return i.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return i.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new i.Triangle).copy(this)}},i.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},i.Clock.prototype={constructor:i.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},i.EventDispatcher=function(){},i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(e){e.addEventListener=i.EventDispatcher.prototype.addEventListener,e.hasEventListener=i.EventDispatcher.prototype.hasEventListener,e.removeEventListener=i.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,i=n[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var i=[],r=n.length,o=0;r>o;o++)i[o]=n[o];for(var o=0;r>o;o++)i[o].call(this,e)}}}},function(e){e.Raycaster=function(t,n,i,r){this.ray=new e.Ray(t,n),this.near=i||0,this.far=r||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var t=function(e,t){return e.distance-t.distance},n=function(e,t,i,r){if(e.raycast(t,i),r===!0)for(var o=e.children,s=0,a=o.length;a>s;s++)n(o[s],t,i,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,n){n instanceof e.PerspectiveCamera?(this.ray.origin.copy(n.position),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(n.position).normalize()):n instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,i){var r=[];return n(e,this,r,i),r.sort(t),r},intersectObjects:function(e,i){var r=[];if(e instanceof Array==!1)return console.log("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var o=0,s=e.length;s>o;o++)n(e[o],this,r,i);return r.sort(t),r}}}(i),i.Object3D=function(){Object.defineProperty(this,"id",{value:i.Object3DIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=i.Object3D.DefaultUp.clone();var e=new i.Vector3,t=new i.Euler,n=new i.Quaternion,r=new i.Vector3(1,1,1),o=function(){n.setFromEuler(t,!1)},s=function(){t.setFromQuaternion(n,void 0,!1)};t.onChange(o),n.onChange(s),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r}}),this.rotationAutoUpdate=!0,this.matrix=new i.Matrix4,this.matrixWorld=new i.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},i.Object3D.DefaultUp=new i.Vector3(0,1,0),i.Object3D.prototype={constructor:i.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i.Quaternion;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new i.Vector3;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new i.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add:",e,"can't be added as a child of itself."),this):(e instanceof i.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D."),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var n=this.children.indexOf(e);-1!==n&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(e,t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getObjectById:function(e,t){return this.getObjectByProperty("id",e,t)},getObjectByName:function(e,t){return this.getObjectByProperty("name",e,t)},getObjectByProperty:function(e,t,n){if(this[e]===t)return this;for(var i=0,r=this.children.length;r>i;i++){var o=this.children[i],s=o.getObjectByProperty(e,t,n);if(void 0!==s)return s}return void 0},getWorldPosition:function(e){var t=e||new i.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new i.Vector3,t=new i.Vector3;return function(n){var r=n||new i.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new i.Quaternion;return function(t){var n=t||new i.Euler;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new i.Vector3,t=new i.Quaternion;return function(n){var r=n||new i.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new i.Quaternion;return function(t){var n=t||new i.Vector3;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,n=this.children.length;n>t;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=0,n=this.children.length;n>t;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;n>t;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},n=function(n){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[n.uuid]){var i=n.toJSON();delete i.metadata,t[n.uuid]=i,e.geometries.push(i)}return n.uuid},r={},o=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===r[t.uuid]){var n=t.toJSON();delete n.metadata,r[t.uuid]=n,e.materials.push(n)}return t.uuid},s=function(e){var t={};if(t.uuid=e.uuid,t.type=e.type,""!==e.name&&(t.name=e.name),"{}"!==JSON.stringify(e.userData)&&(t.userData=e.userData),e.visible!==!0&&(t.visible=e.visible),e instanceof i.PerspectiveCamera?(t.fov=e.fov,t.aspect=e.aspect,t.near=e.near,t.far=e.far):e instanceof i.OrthographicCamera?(t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom,t.near=e.near,t.far=e.far):e instanceof i.AmbientLight?t.color=e.color.getHex():e instanceof i.DirectionalLight?(t.color=e.color.getHex(),t.intensity=e.intensity):e instanceof i.PointLight?(t.color=e.color.getHex(),t.intensity=e.intensity,t.distance=e.distance):e instanceof i.SpotLight?(t.color=e.color.getHex(),t.intensity=e.intensity,t.distance=e.distance,t.angle=e.angle,t.exponent=e.exponent):e instanceof i.HemisphereLight?(t.color=e.color.getHex(),t.groundColor=e.groundColor.getHex()):e instanceof i.Mesh?(t.geometry=n(e.geometry),t.material=o(e.material)):e instanceof i.Line?(t.geometry=n(e.geometry),t.material=o(e.material)):e instanceof i.Sprite&&(t.material=o(e.material)),t.matrix=e.matrix.toArray(),e.children.length>0){t.children=[];for(var r=0;r<e.children.length;r++)t.children.push(s(e.children[r]))}return t};return e.object=s(this),e},clone:function(e,t){if(void 0===e&&(e=new i.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var n=0;n<this.children.length;n++){var r=this.children[n];e.add(r.clone())}return e}},i.EventDispatcher.prototype.apply(i.Object3D.prototype),i.Object3DIdCount=0,i.Face3=function(e,t,n,r,o,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof i.Vector3?r:new i.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof i.Color?o:new i.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0},i.Face3.prototype={constructor:i.Face3,clone:function(){var e=new i.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,n=this.vertexNormals.length;n>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(var t=0,n=this.vertexColors.length;n>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(var t=0,n=this.vertexTangents.length;n>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},i.Face4=function(e,t,n,r,o,s,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new i.Face3(e,t,n,o,s,a)},i.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.needsUpdate=!1},i.BufferAttribute.prototype={constructor:i.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;r>i;i++)this.array[e+i]=t.array[n+i]},set:function(e){return this.array.set(e),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},clone:function(){return new i.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},i.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new i.BufferAttribute(e,t)},i.BufferGeometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},i.BufferGeometry.prototype={constructor:i.BufferGeometry,addAttribute:function(e,t){return t instanceof i.BufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]})):(this.attributes[e]=t,void(this.attributesKeys=Object.keys(this.attributes)))},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:void 0!==n?n:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new i.Matrix3).getNormalMatrix(e);r.applyToVector3Array(n.array),n.needsUpdate=!0}},center:function(){},fromGeometry:function(e,t){t=t||{vertexColors:i.NoColors};var n=e.vertices,r=e.faces,o=e.faceVertexUvs,s=t.vertexColors,a=o[0].length>0,l=3==r[0].vertexNormals.length,h=new Float32Array(3*r.length*3);this.addAttribute("position",new i.BufferAttribute(h,3));var u=new Float32Array(3*r.length*3);if(this.addAttribute("normal",new i.BufferAttribute(u,3)),s!==i.NoColors){var c=new Float32Array(3*r.length*3);this.addAttribute("color",new i.BufferAttribute(c,3))}if(a===!0){var p=new Float32Array(3*r.length*2);this.addAttribute("uv",new i.BufferAttribute(p,2))}for(var d=0,f=0,m=0;d<r.length;d++,f+=6,m+=9){var v=r[d],y=n[v.a],g=n[v.b],x=n[v.c];if(h[m]=y.x,h[m+1]=y.y,h[m+2]=y.z,h[m+3]=g.x,h[m+4]=g.y,h[m+5]=g.z,h[m+6]=x.x,h[m+7]=x.y,h[m+8]=x.z,l===!0){var b=v.vertexNormals[0],_=v.vertexNormals[1],w=v.vertexNormals[2];u[m]=b.x,u[m+1]=b.y,u[m+2]=b.z,u[m+3]=_.x,u[m+4]=_.y,u[m+5]=_.z,u[m+6]=w.x,u[m+7]=w.y,u[m+8]=w.z}else{var S=v.normal;u[m]=S.x,u[m+1]=S.y,u[m+2]=S.z,u[m+3]=S.x,u[m+4]=S.y,u[m+5]=S.z,u[m+6]=S.x,u[m+7]=S.y,u[m+8]=S.z}if(s===i.FaceColors){var M=v.color;c[m]=M.r,c[m+1]=M.g,c[m+2]=M.b,c[m+3]=M.r,c[m+4]=M.g,c[m+5]=M.b,c[m+6]=M.r,c[m+7]=M.g,c[m+8]=M.b}else if(s===i.VertexColors){var T=v.vertexColors[0],E=v.vertexColors[1],C=v.vertexColors[2];c[m]=T.r,c[m+1]=T.g,c[m+2]=T.b,c[m+3]=E.r,c[m+4]=E.g,c[m+5]=E.b,c[m+6]=C.r,c[m+7]=C.g,c[m+8]=C.b}if(a===!0){var A=o[0][d][0],P=o[0][d][1],F=o[0][d][2];p[f]=A.x,p[f+1]=A.y,p[f+2]=P.x,p[f+3]=P.y,p[f+4]=F.x,p[f+5]=F.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new i.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new i.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox;n.makeEmpty();for(var r=0,o=t.length;o>r;r+=3)e.set(t[r],t[r+1],t[r+2]),n.expandByPoint(e)}(void 0===t||0===t.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new i.Box3,t=new i.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var r=this.boundingSphere.center,o=0,s=n.length;s>o;o+=3)t.set(n[o],n[o+1],n[o+2]),e.expandByPoint(t);e.center(r);for(var a=0,o=0,s=n.length;s>o;o+=3)t.set(n[o],n[o+1],n[o+2]),a=Math.max(a,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new i.BufferAttribute(new Float32Array(t.length),3));else for(var n=e.normal.array,r=0,o=n.length;o>r;r++)n[r]=0;var s,a,l,n=e.normal.array,h=new i.Vector3,u=new i.Vector3,c=new i.Vector3,p=new i.Vector3,d=new i.Vector3;if(e.index)for(var f=e.index.array,m=this.offsets.length>0?this.offsets:[{start:0,count:f.length,index:0}],v=0,y=m.length;y>v;++v)for(var g=m[v].start,x=m[v].count,b=m[v].index,r=g,o=g+x;o>r;r+=3)s=3*(b+f[r]),a=3*(b+f[r+1]),l=3*(b+f[r+2]),h.fromArray(t,s),u.fromArray(t,a),c.fromArray(t,l),p.subVectors(c,u),d.subVectors(h,u),p.cross(d),n[s]+=p.x,n[s+1]+=p.y,n[s+2]+=p.z,n[a]+=p.x,n[a+1]+=p.y,n[a+2]+=p.z,n[l]+=p.x,n[l+1]+=p.y,n[l+2]+=p.z;else for(var r=0,o=t.length;o>r;r+=9)h.fromArray(t,r),u.fromArray(t,r+3),c.fromArray(t,r+6),p.subVectors(c,u),d.subVectors(h,u),p.cross(d),n[r]=p.x,n[r+1]=p.y,n[r+2]=p.z,n[r+3]=p.x,n[r+4]=p.y,n[r+5]=p.z,n[r+6]=p.x,n[r+7]=p.y,n[r+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){function e(e,t,n){F.fromArray(r,3*e),L.fromArray(r,3*t),R.fromArray(r,3*n),B.fromArray(s,2*e),k.fromArray(s,2*t),D.fromArray(s,2*n),p=L.x-F.x,d=R.x-F.x,f=L.y-F.y,m=R.y-F.y,v=L.z-F.z,y=R.z-F.z,g=k.x-B.x,x=D.x-B.x,b=k.y-B.y,_=D.y-B.y,w=1/(g*_-x*b),N.set((_*p-b*d)*w,(_*f-b*m)*w,(_*v-b*y)*w),O.set((g*d-x*p)*w,(g*m-x*f)*w,(g*y-x*v)*w),h[e].add(N),h[t].add(N),h[n].add(N),u[e].add(O),u[t].add(O),u[n].add(O)}function t(e){X.fromArray(o,3*e),Y.copy(X),G=h[e],H.copy(G),H.sub(X.multiplyScalar(X.dot(G))).normalize(),W.crossVectors(Y,G),q=W.dot(u[e]),j=0>q?-1:1,l[4*e]=H.x,l[4*e+1]=H.y,l[4*e+2]=H.z,l[4*e+3]=j}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var n=this.attributes.index.array,r=this.attributes.position.array,o=this.attributes.normal.array,s=this.attributes.uv.array,a=r.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new i.BufferAttribute(new Float32Array(4*a),4));for(var l=this.attributes.tangent.array,h=[],u=[],c=0;a>c;c++)h[c]=new i.Vector3,u[c]=new i.Vector3;var p,d,f,m,v,y,g,x,b,_,w,S,M,T,E,C,A,P,F=new i.Vector3,L=new i.Vector3,R=new i.Vector3,B=new i.Vector2,k=new i.Vector2,D=new i.Vector2,N=new i.Vector3,O=new i.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,n.length,0);var V=this.drawcalls;for(T=0,E=V.length;E>T;++T){var z=V[T].start,U=V[T].count,I=V[T].index;for(S=z,M=z+U;M>S;S+=3)C=I+n[S],A=I+n[S+1],P=I+n[S+2],e(C,A,P)}var j,G,q,H=new i.Vector3,W=new i.Vector3,X=new i.Vector3,Y=new i.Vector3;for(T=0,E=V.length;E>T;++T){var z=V[T].start,U=V[T].count,I=V[T].index;for(S=z,M=z+U;M>S;S+=3)C=I+n[S],A=I+n[S+1],P=I+n[S+2],t(C),t(A),t(P)}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535);for(var n=(Date.now(),this.attributes.index.array),i=this.attributes.position.array,r=(i.length/3,n.length/3),o=new Uint16Array(n.length),s=0,a=0,l=[{start:0,count:0,index:0}],h=l[0],u=0,c=0,p=new Int32Array(6),d=new Int32Array(i.length),f=new Int32Array(i.length),m=0;m<i.length;m++)d[m]=-1,f[m]=-1;for(var v=0;r>v;v++){c=0;for(var y=0;3>y;y++){var g=n[3*v+y];-1==d[g]?(p[2*y]=g,p[2*y+1]=-1,c++):d[g]<h.index?(p[2*y]=g,p[2*y+1]=-1,u++):(p[2*y]=g,p[2*y+1]=d[g])}var x=a+c;if(x>h.index+t){var b={start:s,count:0,index:a};l.push(b),h=b;for(var _=0;6>_;_+=2){var w=p[_+1];w>-1&&w<h.index&&(p[_+1]=-1)}}for(var _=0;6>_;_+=2){var g=p[_],w=p[_+1];-1===w&&(w=a++),d[g]=w,f[w]=g,o[s++]=w-h.index,h.count++}}return this.reorderBuffers(o,f,a),this.offsets=l,l},merge:function(e,t){if(e instanceof i.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var o=n[r],s=o.array,a=e.attributes[r],l=a.array,h=a.itemSize,u=0,c=h*t;u<l.length;u++,c++)s[c]=l[u];return this},normalizeNormals:function(){for(var e,t,n,i,r=this.attributes.normal.array,o=0,s=r.length;s>o;o+=3)e=r[o],t=r[o+1],n=r[o+2],i=1/Math.sqrt(e*e+t*t+n*n),r[o]*=i,r[o+1]*=i,r[o+2]*=i},reorderBuffers:function(e,t,n){var i={};for(var r in this.attributes)if("index"!=r){var o=this.attributes[r].array;i[r]=new o.constructor(this.attributes[r].itemSize*n)}for(var s=0;n>s;s++){var a=t[s];for(var r in this.attributes)if("index"!=r)for(var l=this.attributes[r].array,h=this.attributes[r].itemSize,u=i[r],c=0;h>c;c++)u[s*h+c]=l[a*h+c]}this.attributes.index.array=e;for(var r in this.attributes)"index"!=r&&(this.attributes[r].array=i[r],this.attributes[r].numItems=this.attributes[r].itemSize*n)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,n=this.offsets,i=this.boundingSphere;for(var r in t){for(var o=t[r],s=[],a=o.array,l=0,h=a.length;h>l;l++)s[l]=a[l];e.data.attributes[r]={itemSize:o.itemSize,type:o.array.constructor.name,array:s}}return n.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(n))),null!==i&&(e.data.boundingSphere={center:i.center.toArray(),radius:i.radius}),e},clone:function(){var e=new i.BufferGeometry;for(var t in this.attributes){var n=this.attributes[t];e.addAttribute(t,n.clone())}for(var r=0,o=this.offsets.length;o>r;r++){var s=this.offsets[r];e.offsets.push({start:s.start,index:s.index,count:s.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.BufferGeometry.prototype),i.Geometry=function(){Object.defineProperty(this,"id",{value:i.GeometryIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},i.Geometry.prototype={constructor:i.Geometry,applyMatrix:function(e){for(var t=(new i.Matrix3).getNormalMatrix(e),n=0,r=this.vertices.length;r>n;n++){var o=this.vertices[n];o.applyMatrix4(e)}for(var n=0,r=this.faces.length;r>n;n++){var s=this.faces[n];s.normal.applyMatrix3(t).normalize();for(var a=0,l=s.vertexNormals.length;l>a;a++)s.vertexNormals[a].applyMatrix3(t).normalize()}this.boundingBox instanceof i.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof i.Sphere&&this.computeBoundingSphere()},fromBufferGeometry:function(e){for(var t=this,n=e.attributes,r=n.position.array,o=void 0!==n.index?n.index.array:void 0,s=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,l=void 0!==n.uv?n.uv.array:void 0,h=[],u=[],c=0,p=0;c<r.length;c+=3,p+=2)t.vertices.push(new i.Vector3(r[c],r[c+1],r[c+2])),void 0!==s&&h.push(new i.Vector3(s[c],s[c+1],s[c+2])),void 0!==a&&t.colors.push(new i.Color(a[c],a[c+1],a[c+2])),void 0!==l&&u.push(new i.Vector2(l[p],l[p+1]));var d=function(e,n,r){var o=void 0!==s?[h[e].clone(),h[n].clone(),h[r].clone()]:[],c=void 0!==a?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[];t.faces.push(new i.Face3(e,n,r,o,c)),void 0!==l&&t.faceVertexUvs[0].push([u[e].clone(),u[n].clone(),u[r].clone()])};if(void 0!==o)for(var c=0;c<o.length;c+=3)d(o[c],o[c+1],o[c+2]);else for(var c=0;c<r.length/3;c+=3)d(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=new i.Vector3;return e.addVectors(this.boundingBox.min,this.boundingBox.max),e.multiplyScalar(-.5),this.applyMatrix((new i.Matrix4).makeTranslation(e.x,e.y,e.z)),this.computeBoundingBox(),e},computeFaceNormals:function(){for(var e=new i.Vector3,t=new i.Vector3,n=0,r=this.faces.length;r>n;n++){var o=this.faces[n],s=this.vertices[o.a],a=this.vertices[o.b],l=this.vertices[o.c];e.subVectors(l,a),t.subVectors(s,a),e.cross(t),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,o,s,a;for(a=new Array(this.vertices.length),t=0,n=this.vertices.length;n>t;t++)a[t]=new i.Vector3;if(e){{var l,h,u,c=new i.Vector3,p=new i.Vector3;new i.Vector3,new i.Vector3,new i.Vector3}for(r=0,o=this.faces.length;o>r;r++)s=this.faces[r],l=this.vertices[s.a],h=this.vertices[s.b],u=this.vertices[s.c],c.subVectors(u,h),p.subVectors(l,h),c.cross(p),a[s.a].add(c),a[s.b].add(c),a[s.c].add(c)}else for(r=0,o=this.faces.length;o>r;r++)s=this.faces[r],a[s.a].add(s.normal),a[s.b].add(s.normal),a[s.c].add(s.normal);for(t=0,n=this.vertices.length;n>t;t++)a[t].normalize();for(r=0,o=this.faces.length;o>r;r++)s=this.faces[r],s.vertexNormals[0]=a[s.a].clone(),s.vertexNormals[1]=a[s.b].clone(),s.vertexNormals[2]=a[s.c].clone()},computeMorphNormals:function(){var e,t,n,r,o;for(n=0,r=this.faces.length;r>n;n++)for(o=this.faces[n],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,t=o.vertexNormals.length;t>e;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();

var s=new i.Geometry;for(s.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,l,h=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;r>n;n++)a=new i.Vector3,l={a:new i.Vector3,b:new i.Vector3,c:new i.Vector3},h.push(a),u.push(l)}var c=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals();var a,l;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],a=c.faceNormals[n],l=c.vertexNormals[n],a.copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){function e(e,t,n,i,r,o,s){u=e.vertices[t],c=e.vertices[n],p=e.vertices[i],d=h[r],f=h[o],m=h[s],v=c.x-u.x,y=p.x-u.x,g=c.y-u.y,x=p.y-u.y,b=c.z-u.z,_=p.z-u.z,w=f.x-d.x,S=m.x-d.x,M=f.y-d.y,T=m.y-d.y,E=1/(w*T-S*M),R.set((T*v-M*y)*E,(T*g-M*x)*E,(T*b-M*_)*E),B.set((w*y-S*v)*E,(w*x-S*g)*E,(w*_-S*b)*E),F[t].add(R),F[n].add(R),F[i].add(R),L[t].add(B),L[n].add(B),L[i].add(B)}var t,n,r,o,s,a,l,h,u,c,p,d,f,m,v,y,g,x,b,_,w,S,M,T,E,C,A,P,F=[],L=[],R=new i.Vector3,B=new i.Vector3,k=new i.Vector3,D=new i.Vector3,N=new i.Vector3;for(r=0,o=this.vertices.length;o>r;r++)F[r]=new i.Vector3,L[r]=new i.Vector3;for(t=0,n=this.faces.length;n>t;t++)l=this.faces[t],h=this.faceVertexUvs[0][t],e(this,l.a,l.b,l.c,0,1,2);var O=["a","b","c","d"];for(t=0,n=this.faces.length;n>t;t++)for(l=this.faces[t],s=0;s<Math.min(l.vertexNormals.length,3);s++)N.copy(l.vertexNormals[s]),a=l[O[s]],C=F[a],k.copy(C),k.sub(N.multiplyScalar(N.dot(C))).normalize(),D.crossVectors(l.vertexNormals[s],C),A=D.dot(L[a]),P=0>A?-1:1,l.vertexTangents[s]=new i.Vector4(k.x,k.y,k.z,P);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,i=t.length;i>n;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new i.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new i.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof i.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var r,o=this.vertices.length,s=this.vertices,a=e.vertices,l=this.faces,h=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===n&&(n=0),void 0!==t&&(r=(new i.Matrix3).getNormalMatrix(t));for(var p=0,d=a.length;d>p;p++){var f=a[p],m=f.clone();void 0!==t&&m.applyMatrix4(t),s.push(m)}for(p=0,d=h.length;d>p;p++){var v,y,g,x=h[p],b=x.vertexNormals,_=x.vertexColors;v=new i.Face3(x.a+o,x.b+o,x.c+o),v.normal.copy(x.normal),void 0!==r&&v.normal.applyMatrix3(r).normalize();for(var w=0,S=b.length;S>w;w++)y=b[w].clone(),void 0!==r&&y.applyMatrix3(r).normalize(),v.vertexNormals.push(y);v.color.copy(x.color);for(var w=0,S=_.length;S>w;w++)g=_[w],v.vertexColors.push(g.clone());v.materialIndex=x.materialIndex+n,l.push(v)}for(p=0,d=c.length;d>p;p++){var M=c[p],T=[];if(void 0!==M){for(var w=0,S=M.length;S>w;w++)T.push(M[w].clone());u.push(T)}}},mergeMesh:function(e){return e instanceof i.Mesh==!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e):(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix))},mergeVertices:function(){var e,t,n,i,r,o,s,a,l={},h=[],u=[],c=4,p=Math.pow(10,c);for(n=0,i=this.vertices.length;i>n;n++)e=this.vertices[n],t=Math.round(e.x*p)+"_"+Math.round(e.y*p)+"_"+Math.round(e.z*p),void 0===l[t]?(l[t]=n,h.push(this.vertices[n]),u[n]=h.length-1):u[n]=u[l[t]];var d=[];for(n=0,i=this.faces.length;i>n;n++){r=this.faces[n],r.a=u[r.a],r.b=u[r.b],r.c=u[r.c],o=[r.a,r.b,r.c];for(var f=-1,m=0;3>m;m++)if(o[m]==o[(m+1)%3]){f=m,d.push(n);break}}for(n=d.length-1;n>=0;n--){var v=d[n];for(this.faces.splice(v,1),s=0,a=this.faceVertexUvs.length;a>s;s++)this.faceVertexUvs[s].splice(v,1)}var y=this.vertices.length-h.length;return this.vertices=h,y},toJSON:function(){function e(e,t,n){return n?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==p[t]?p[t]:(p[t]=c.length/3,c.push(e.x,e.y,e.z),p[t])}function n(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==f[t]?f[t]:(f[t]=d.length,d.push(e.getHex()),f[t])}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==v[t]?v[t]:(v[t]=m.length/2,m.push(e.x,e.y),v[t])}var r={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var s in o)void 0!==o[s]&&(r[s]=o[s]);return r}for(var a=[],l=0;l<this.vertices.length;l++){var h=this.vertices[l];a.push(h.x,h.y,h.z)}for(var u=[],c=[],p={},d=[],f={},m=[],v={},l=0;l<this.faces.length;l++){var y=this.faces[l],g=!1,x=!1,b=void 0!==this.faceVertexUvs[0][l],_=y.normal.length()>0,w=y.vertexNormals.length>0,S=1!==y.color.r||1!==y.color.g||1!==y.color.b,M=y.vertexColors.length>0,T=0;if(T=e(T,0,0),T=e(T,1,g),T=e(T,2,x),T=e(T,3,b),T=e(T,4,_),T=e(T,5,w),T=e(T,6,S),T=e(T,7,M),u.push(T),u.push(y.a,y.b,y.c),b){var E=this.faceVertexUvs[0][l];u.push(i(E[0]),i(E[1]),i(E[2]))}if(_&&u.push(t(y.normal)),w){var C=y.vertexNormals;u.push(t(C[0]),t(C[1]),t(C[2]))}if(S&&u.push(n(y.color)),M){var A=y.vertexColors;u.push(n(A[0]),n(A[1]),n(A[2]))}}return r.data={},r.data.vertices=a,r.data.normals=c,d.length>0&&(r.data.colors=d),m.length>0&&(r.data.uvs=[m]),r.data.faces=u,r},clone:function(){for(var e=new i.Geometry,t=this.vertices,n=0,r=t.length;r>n;n++)e.vertices.push(t[n].clone());for(var o=this.faces,n=0,r=o.length;r>n;n++)e.faces.push(o[n].clone());for(var n=0,r=this.faceVertexUvs.length;r>n;n++){var s=this.faceVertexUvs[n];void 0===e.faceVertexUvs[n]&&(e.faceVertexUvs[n]=[]);for(var a=0,l=s.length;l>a;a++){for(var h=s[a],u=[],c=0,p=h.length;p>c;c++){var d=h[c];u.push(d.clone())}e.faceVertexUvs[n].push(u)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.Geometry.prototype),i.GeometryIdCount=0,i.Camera=function(){i.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new i.Matrix4,this.projectionMatrix=new i.Matrix4},i.Camera.prototype=Object.create(i.Object3D.prototype),i.Camera.prototype.constructor=i.Camera,i.Camera.prototype.getWorldDirection=function(){var e=new i.Quaternion;return function(t){var n=t||new i.Vector3;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),i.Camera.prototype.lookAt=function(){var e=new i.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),i.Camera.prototype.clone=function(e){return void 0===e&&(e=new i.Camera),i.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},i.CubeCamera=function(e,t,n){i.Object3D.call(this),this.type="CubeCamera";var r=90,o=1,s=new i.PerspectiveCamera(r,o,e,t);s.up.set(0,-1,0),s.lookAt(new i.Vector3(1,0,0)),this.add(s);var a=new i.PerspectiveCamera(r,o,e,t);a.up.set(0,-1,0),a.lookAt(new i.Vector3(-1,0,0)),this.add(a);var l=new i.PerspectiveCamera(r,o,e,t);l.up.set(0,0,1),l.lookAt(new i.Vector3(0,1,0)),this.add(l);var h=new i.PerspectiveCamera(r,o,e,t);h.up.set(0,0,-1),h.lookAt(new i.Vector3(0,-1,0)),this.add(h);var u=new i.PerspectiveCamera(r,o,e,t);u.up.set(0,-1,0),u.lookAt(new i.Vector3(0,0,1)),this.add(u);var c=new i.PerspectiveCamera(r,o,e,t);c.up.set(0,-1,0),c.lookAt(new i.Vector3(0,0,-1)),this.add(c),this.renderTarget=new i.WebGLRenderTargetCube(n,n,{format:i.RGBFormat,magFilter:i.LinearFilter,minFilter:i.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,i=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,s,n),n.activeCubeFace=1,e.render(t,a,n),n.activeCubeFace=2,e.render(t,l,n),n.activeCubeFace=3,e.render(t,h,n),n.activeCubeFace=4,e.render(t,u,n),n.generateMipmaps=i,n.activeCubeFace=5,e.render(t,c,n)}},i.CubeCamera.prototype=Object.create(i.Object3D.prototype),i.CubeCamera.prototype.constructor=i.CubeCamera,i.OrthographicCamera=function(e,t,n,r,o,s){i.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==o?o:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},i.OrthographicCamera.prototype=Object.create(i.Camera.prototype),i.OrthographicCamera.prototype.constructor=i.OrthographicCamera,i.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,i+t,i-t,this.near,this.far)},i.OrthographicCamera.prototype.clone=function(){var e=new i.OrthographicCamera;return i.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},i.PerspectiveCamera=function(e,t,n,r){i.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype),i.PerspectiveCamera.prototype.constructor=i.PerspectiveCamera,i.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*i.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},i.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,i,r,o){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=i,this.width=r,this.height=o,this.updateProjectionMatrix()},i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=i.Math.radToDeg(2*Math.atan(Math.tan(.5*i.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(i.Math.degToRad(.5*e))*this.near,r=-n,o=t*r,s=t*n,a=Math.abs(s-o),l=Math.abs(n-r);this.projectionMatrix.makeFrustum(o+this.x*a/this.fullWidth,o+(this.x+this.width)*a/this.fullWidth,n-(this.y+this.height)*l/this.fullHeight,n-this.y*l/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},i.PerspectiveCamera.prototype.clone=function(){var e=new i.PerspectiveCamera;return i.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},i.Light=function(e){i.Object3D.call(this),this.type="Light",this.color=new i.Color(e)},i.Light.prototype=Object.create(i.Object3D.prototype),i.Light.prototype.constructor=i.Light,i.Light.prototype.clone=function(e){return void 0===e&&(e=new i.Light),i.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},i.AmbientLight=function(e){i.Light.call(this,e),this.type="AmbientLight"},i.AmbientLight.prototype=Object.create(i.Light.prototype),i.AmbientLight.prototype.constructor=i.AmbientLight,i.AmbientLight.prototype.clone=function(){var e=new i.AmbientLight;return i.Light.prototype.clone.call(this,e),e},i.AreaLight=function(e,t){i.Light.call(this,e),this.type="AreaLight",this.normal=new i.Vector3(0,-1,0),this.right=new i.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},i.AreaLight.prototype=Object.create(i.Light.prototype),i.AreaLight.prototype.constructor=i.AreaLight,i.DirectionalLight=function(e,t){i.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new i.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new i.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},i.DirectionalLight.prototype=Object.create(i.Light.prototype),i.DirectionalLight.prototype.constructor=i.DirectionalLight,i.DirectionalLight.prototype.clone=function(){var e=new i.DirectionalLight;return i.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},i.HemisphereLight=function(e,t,n){i.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new i.Color(t),this.intensity=void 0!==n?n:1},i.HemisphereLight.prototype=Object.create(i.Light.prototype),i.HemisphereLight.prototype.constructor=i.HemisphereLight,i.HemisphereLight.prototype.clone=function(){var e=new i.HemisphereLight;return i.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},i.PointLight=function(e,t,n){i.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},i.PointLight.prototype=Object.create(i.Light.prototype),i.PointLight.prototype.constructor=i.PointLight,i.PointLight.prototype.clone=function(){var e=new i.PointLight;return i.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},i.SpotLight=function(e,t,n,r,o){i.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new i.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==o?o:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},i.SpotLight.prototype=Object.create(i.Light.prototype),i.SpotLight.prototype.constructor=i.SpotLight,i.SpotLight.prototype.clone=function(){var e=new i.SpotLight;return i.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},i.Cache=function(){this.files={}},i.Cache.prototype={constructor:i.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},i.Loader=function(e){this.showStatus=e,this.statusDomElement=e?i.Loader.prototype.addStatusElement():null,this.imageLoader=new i.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},i.Loader.prototype={constructor:i.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var n=[],i=0;i<e.length;++i)n[i]=this.createMaterial(e[i],t);return n},needsTangents:function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];if(r instanceof i.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function r(e,r,o,a,l,h,u){var c,p=t+o,d=i.Loader.Handlers.get(p);if(null!==d?c=d.load(p):(c=new i.Texture,d=s.imageLoader,d.crossOrigin=s.crossOrigin,d.load(p,function(e){if(i.Math.isPowerOfTwo(e.width)===!1||i.Math.isPowerOfTwo(e.height)===!1){var t=n(e.width),r=n(e.height),o=document.createElement("canvas");o.width=t,o.height=r;var s=o.getContext("2d");s.drawImage(e,0,0,t,r),c.image=o}else c.image=e;c.needsUpdate=!0})),c.sourceFile=o,a&&(c.repeat.set(a[0],a[1]),1!==a[0]&&(c.wrapS=i.RepeatWrapping),1!==a[1]&&(c.wrapT=i.RepeatWrapping)),l&&c.offset.set(l[0],l[1]),h){var f={repeat:i.RepeatWrapping,mirror:i.MirroredRepeatWrapping};void 0!==f[h[0]]&&(c.wrapS=f[h[0]]),void 0!==f[h[1]]&&(c.wrapT=f[h[1]])}u&&(c.anisotropy=u),e[r]=c}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,a="MeshLambertMaterial",l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var h=e.shading.toLowerCase();"phong"===h?a="MeshPhongMaterial":"basic"===h&&(a="MeshBasicMaterial")}void 0!==e.blending&&void 0!==i[e.blending]&&(l.blending=i[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(l.transparent=e.transparent),void 0!==e.depthTest&&(l.depthTest=e.depthTest),void 0!==e.depthWrite&&(l.depthWrite=e.depthWrite),void 0!==e.visible&&(l.visible=e.visible),void 0!==e.flipSided&&(l.side=i.BackSide),void 0!==e.doubleSided&&(l.side=i.DoubleSide),void 0!==e.wireframe&&(l.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?l.vertexColors=i.FaceColors:e.vertexColors&&(l.vertexColors=i.VertexColors)),e.colorDiffuse?l.color=o(e.colorDiffuse):e.DbgColor&&(l.color=e.DbgColor),e.colorSpecular&&(l.specular=o(e.colorSpecular)),e.colorAmbient&&(l.ambient=o(e.colorAmbient)),e.colorEmissive&&(l.emissive=o(e.colorEmissive)),e.transparency&&(l.opacity=e.transparency),e.specularCoef&&(l.shininess=e.specularCoef),e.mapDiffuse&&t&&r(l,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&r(l,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&r(l,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&r(l,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&r(l,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&r(l,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(l.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(l.normalScale=new i.Vector2(e.mapNormalFactor,e.mapNormalFactor));var u=new i[a](l);return void 0!==e.DbgName&&(u.name=e.DbgName),u}},i.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;n>t;t+=2){var i=this.handlers[t],r=this.handlers[t+1];if(i.test(e))return r}return null}},i.XHRLoader=function(e){this.cache=new i.Cache,this.manager=void 0!==e?e:i.DefaultLoadingManager},i.XHRLoader.prototype={constructor:i.XHRLoader,load:function(e,t,n,i){var r=this,o=r.cache.get(e);if(void 0!==o)return void(t&&t(o));var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",function(n){r.cache.add(e,this.response),t&&t(this.response),r.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==i&&s.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),s.send(null),r.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},i.ImageLoader=function(e){this.cache=new i.Cache,this.manager=void 0!==e?e:i.DefaultLoadingManager},i.ImageLoader.prototype={constructor:i.ImageLoader,load:function(e,t,n,i){var r=this,o=r.cache.get(e);if(void 0!==o)return void t(o);var s=document.createElement("img");return void 0!==t&&s.addEventListener("load",function(n){r.cache.add(e,this),t(this),r.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==i&&s.addEventListener("error",function(e){i(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,r.manager.itemStart(e),s},setCrossOrigin:function(e){this.crossOrigin=e}},i.JSONLoader=function(e){i.Loader.call(this,e),this.withCredentials=!1},i.JSONLoader.prototype=Object.create(i.Loader.prototype),i.JSONLoader.prototype.constructor=i.JSONLoader,i.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},i.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,i,r){var o=new XMLHttpRequest,s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var a=JSON.parse(o.responseText);if(void 0!==a.metadata&&"scene"===a.metadata.type)return void console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');var l=e.parse(a,i);n(l.geometry,l.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+o.status+")");else o.readyState===o.LOADING?r&&(0===s&&(s=o.getResponseHeader("Content-Length")),r({total:s,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},i.JSONLoader.prototype.parse=function(e,t){function n(t){function n(e,t){return e&1<<t}var r,o,a,l,h,u,c,p,d,f,m,v,y,g,x,b,_,w,S,M,T,E,C,A,P,F,L,R=e.faces,B=e.vertices,k=e.normals,D=e.colors,N=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&N++;for(r=0;N>r;r++)s.faceVertexUvs[r]=[]}for(l=0,h=B.length;h>l;)w=new i.Vector3,w.x=B[l++]*t,w.y=B[l++]*t,w.z=B[l++]*t,s.vertices.push(w);for(l=0,h=R.length;h>l;)if(f=R[l++],m=n(f,0),v=n(f,1),y=n(f,3),g=n(f,4),x=n(f,5),b=n(f,6),_=n(f,7),m){if(M=new i.Face3,M.a=R[l],M.b=R[l+1],M.c=R[l+3],T=new i.Face3,T.a=R[l+1],T.b=R[l+2],T.c=R[l+3],l+=4,v&&(d=R[l++],M.materialIndex=d,T.materialIndex=d),a=s.faces.length,y)for(r=0;N>r;r++)for(A=e.uvs[r],s.faceVertexUvs[r][a]=[],s.faceVertexUvs[r][a+1]=[],o=0;4>o;o++)p=R[l++],F=A[2*p],L=A[2*p+1],P=new i.Vector2(F,L),2!==o&&s.faceVertexUvs[r][a].push(P),0!==o&&s.faceVertexUvs[r][a+1].push(P);if(g&&(c=3*R[l++],M.normal.set(k[c++],k[c++],k[c]),T.normal.copy(M.normal)),x)for(r=0;4>r;r++)c=3*R[l++],C=new i.Vector3(k[c++],k[c++],k[c]),2!==r&&M.vertexNormals.push(C),0!==r&&T.vertexNormals.push(C);if(b&&(u=R[l++],E=D[u],M.color.setHex(E),T.color.setHex(E)),_)for(r=0;4>r;r++)u=R[l++],E=D[u],2!==r&&M.vertexColors.push(new i.Color(E)),0!==r&&T.vertexColors.push(new i.Color(E));s.faces.push(M),s.faces.push(T)}else{if(S=new i.Face3,S.a=R[l++],S.b=R[l++],S.c=R[l++],v&&(d=R[l++],S.materialIndex=d),a=s.faces.length,y)for(r=0;N>r;r++)for(A=e.uvs[r],s.faceVertexUvs[r][a]=[],o=0;3>o;o++)p=R[l++],F=A[2*p],L=A[2*p+1],P=new i.Vector2(F,L),s.faceVertexUvs[r][a].push(P);if(g&&(c=3*R[l++],S.normal.set(k[c++],k[c++],k[c])),x)for(r=0;3>r;r++)c=3*R[l++],C=new i.Vector3(k[c++],k[c++],k[c]),S.vertexNormals.push(C);if(b&&(u=R[l++],S.color.setHex(D[u])),_)for(r=0;3>r;r++)u=R[l++],S.vertexColors.push(new i.Color(D[u]));s.faces.push(S)}}function r(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var n=0,r=e.skinWeights.length;r>n;n+=t){var o=e.skinWeights[n],a=t>1?e.skinWeights[n+1]:0,l=t>2?e.skinWeights[n+2]:0,h=t>3?e.skinWeights[n+3]:0;s.skinWeights.push(new i.Vector4(o,a,l,h))}if(e.skinIndices)for(var n=0,r=e.skinIndices.length;r>n;n+=t){var u=e.skinIndices[n],c=t>1?e.skinIndices[n+1]:0,p=t>2?e.skinIndices[n+2]:0,d=t>3?e.skinIndices[n+3]:0;s.skinIndices.push(new i.Vector4(u,c,p,d))}s.bones=e.bones,s.bones&&s.bones.length>0&&(s.skinWeights.length!==s.skinIndices.length||s.skinIndices.length!==s.vertices.length)&&console.warn("When skinning, number of vertices ("+s.vertices.length+"), skinIndices ("+s.skinIndices.length+"), and skinWeights ("+s.skinWeights.length+") should match."),s.animation=e.animation,s.animations=e.animations}function o(t){if(void 0!==e.morphTargets){var n,r,o,a,l,h;for(n=0,r=e.morphTargets.length;r>n;n++)for(s.morphTargets[n]={},s.morphTargets[n].name=e.morphTargets[n].name,s.morphTargets[n].vertices=[],l=s.morphTargets[n].vertices,h=e.morphTargets[n].vertices,o=0,a=h.length;a>o;o+=3){var u=new i.Vector3;u.x=h[o]*t,u.y=h[o+1]*t,u.z=h[o+2]*t,l.push(u)}}if(void 0!==e.morphColors){var n,r,c,p,d,f,m;for(n=0,r=e.morphColors.length;r>n;n++)for(s.morphColors[n]={},s.morphColors[n].name=e.morphColors[n].name,s.morphColors[n].colors=[],d=s.morphColors[n].colors,f=e.morphColors[n].colors,c=0,p=f.length;p>c;c+=3)m=new i.Color(16755200),m.setRGB(f[c],f[c+1],f[c+2]),d.push(m)}}var s=new i.Geometry,a=void 0!==e.scale?1/e.scale:1;if(n(a),r(),o(a),s.computeFaceNormals(),s.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:s};var l=this.initMaterials(e.materials,t);return this.needsTangents(l)&&s.computeTangents(),{geometry:s,materials:l}},i.LoadingManager=function(e,t,n){var i=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++},this.itemEnd=function(e){r++,void 0!==i.onProgress&&i.onProgress(e,r,o),r===o&&void 0!==i.onLoad&&i.onLoad()}},i.DefaultLoadingManager=new i.LoadingManager,i.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.BufferGeometryLoader.prototype={constructor:i.BufferGeometryLoader,load:function(e,t,n,r){var o=this,s=new i.XHRLoader(o.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(o.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.BufferGeometry,n=e.attributes;for(var r in n){var o=n[r],s=new self[o.type](o.array);t.addAttribute(r,new i.BufferAttribute(s,o.itemSize))}var a=e.offsets;void 0!==a&&(t.offsets=JSON.parse(JSON.stringify(a)));var l=e.boundingSphere;if(void 0!==l){var h=new i.Vector3;void 0!==l.center&&h.fromArray(l.center),t.boundingSphere=new i.Sphere(h,l.radius)}return t}},i.MaterialLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.MaterialLoader.prototype={constructor:i.MaterialLoader,load:function(e,t,n,r){var o=this,s=new i.XHRLoader(o.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(o.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var n=0,r=e.materials.length;r>n;n++)t.materials.push(this.parse(e.materials[n]));return t}},i.ObjectLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.ObjectLoader.prototype={constructor:i.ObjectLoader,load:function(e,t,n,r){var o=this,s=new i.XHRLoader(o.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(o.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),n=this.parseMaterials(e.materials),i=this.parseObject(e.object,t,n);return i},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new i.JSONLoader,r=new i.BufferGeometryLoader,o=0,s=e.length;s>o;o++){var a,l=e[o];switch(l.type){case"PlaneGeometry":a=new i.PlaneGeometry(l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new i.BoxGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":a=new i.CircleGeometry(l.radius,l.segments);break;case"CylinderGeometry":a=new i.CylinderGeometry(l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded);break;case"SphereGeometry":a=new i.SphereGeometry(l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"IcosahedronGeometry":a=new i.IcosahedronGeometry(l.radius,l.detail);break;case"TorusGeometry":a=new i.TorusGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":a=new i.TorusKnotGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.p,l.q,l.heightScale);break;case"BufferGeometry":a=r.parse(l.data);break;case"Geometry":a=n.parse(l.data).geometry}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),t[l.uuid]=a}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var n=new i.MaterialLoader,r=0,o=e.length;o>r;r++){var s=e[r],a=n.parse(s);a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),t[s.uuid]=a}return t},parseObject:function(){var e=new i.Matrix4;return function(t,n,r){var o;switch(t.type){case"Scene":o=new i.Scene;break;case"PerspectiveCamera":o=new i.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":o=new i.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new i.AmbientLight(t.color);break;case"DirectionalLight":o=new i.DirectionalLight(t.color,t.intensity);break;case"PointLight":o=new i.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":o=new i.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":o=new i.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var s=n[t.geometry],a=r[t.material];void 0===s&&console.warn("THREE.ObjectLoader: Undefined geometry",t.geometry),void 0===a&&console.warn("THREE.ObjectLoader: Undefined material",t.material),o=new i.Mesh(s,a);break;case"Line":var s=n[t.geometry],a=r[t.material];void 0===s&&console.warn("THREE.ObjectLoader: Undefined geometry",t.geometry),void 0===a&&console.warn("THREE.ObjectLoader: Undefined material",t.material),
o=new i.Line(s,a);break;case"Sprite":var a=r[t.material];void 0===a&&console.warn("THREE.ObjectLoader: Undefined material",t.material),o=new i.Sprite(a);break;case"Group":o=new i.Group;break;default:o=new i.Object3D}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var l in t.children)o.add(this.parseObject(t.children[l],n,r));return o}}()},i.TextureLoader=function(e){this.manager=void 0!==e?e:i.DefaultLoadingManager},i.TextureLoader.prototype={constructor:i.TextureLoader,load:function(e,t,n,r){var o=this,s=new i.ImageLoader(o.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){var n=new i.Texture(e);n.needsUpdate=!0,void 0!==t&&t(n)},n,r)},setCrossOrigin:function(e){this.crossOrigin=e}},i.DataTextureLoader=i.BinaryTextureLoader=function(){this._parser=null},i.BinaryTextureLoader.prototype={constructor:i.BinaryTextureLoader,load:function(e,t,n,r){var o=this,s=new i.DataTexture,a=new i.XHRLoader;return a.setResponseType("arraybuffer"),a.load(e,function(e){var n=o._parser(e);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:i.ClampToEdgeWrapping,s.wrapT=void 0!==n.wrapT?n.wrapT:i.ClampToEdgeWrapping,s.magFilter=void 0!==n.magFilter?n.magFilter:i.LinearFilter,s.minFilter=void 0!==n.minFilter?n.minFilter:i.LinearMipMapLinearFilter,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps),1===n.mipmapCount&&(s.minFilter=i.LinearFilter),s.needsUpdate=!0,t&&t(s,n))},n,r),s}},i.CompressedTextureLoader=function(){this._parser=null},i.CompressedTextureLoader.prototype={constructor:i.CompressedTextureLoader,load:function(e,t,n){var r=this,o=[],s=new i.CompressedTexture;s.image=o;var a=new i.XHRLoader;if(a.setResponseType("arraybuffer"),e instanceof Array)for(var l=0,h=function(n){a.load(e[n],function(e){var a=r._parser(e,!0);o[n]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps},l+=1,6===l&&(1==a.mipmapCount&&(s.minFilter=i.LinearFilter),s.format=a.format,s.needsUpdate=!0,t&&t(s))})},u=0,c=e.length;c>u;++u)h(u);else a.load(e,function(e){var n=r._parser(e,!0);if(n.isCubemap)for(var a=n.mipmaps.length/n.mipmapCount,l=0;a>l;l++){o[l]={mipmaps:[]};for(var h=0;h<n.mipmapCount;h++)o[l].mipmaps.push(n.mipmaps[l*n.mipmapCount+h]),o[l].format=n.format,o[l].width=n.width,o[l].height=n.height}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=i.LinearFilter),s.format=n.format,s.needsUpdate=!0,t&&t(s)});return s}},i.Material=function(){Object.defineProperty(this,"id",{value:i.MaterialIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.type="Material",this.side=i.FrontSide,this.opacity=1,this.transparent=!1,this.blending=i.NormalBlending,this.blendSrc=i.SrcAlphaFactor,this.blendDst=i.OneMinusSrcAlphaFactor,this.blendEquation=i.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},i.Material.prototype={constructor:i.Material,setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){if(t in this){var r=this[t];r instanceof i.Color?r.set(n):r instanceof i.Vector3&&n instanceof i.Vector3?r.copy(n):this[t]="overdraw"==t?Number(n):n}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof i.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshLambertMaterial?(e.color=this.color.getHex(),e.ambient=this.ambient.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshPhongMaterial?(e.color=this.color.getHex(),e.ambient=this.ambient.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==i.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshNormalMaterial?(this.shading!==i.FlatShading&&(e.shading=this.shading),this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.MeshDepthMaterial?(this.blending!==i.NormalBlending&&(e.blending=this.blending),this.side!==i.FrontSide&&(e.side=this.side)):this instanceof i.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof i.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),this.transparent!==!1&&(e.transparent=this.transparent),this.wireframe!==!1&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new i.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.Material.prototype),i.MaterialIdCount=0,i.LineBasicMaterial=function(e){i.Material.call(this),this.type="LineBasicMaterial",this.color=new i.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=i.NoColors,this.fog=!0,this.setValues(e)},i.LineBasicMaterial.prototype=Object.create(i.Material.prototype),i.LineBasicMaterial.prototype.constructor=i.LineBasicMaterial,i.LineBasicMaterial.prototype.clone=function(){var e=new i.LineBasicMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},i.LineDashedMaterial=function(e){i.Material.call(this),this.type="LineDashedMaterial",this.color=new i.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},i.LineDashedMaterial.prototype=Object.create(i.Material.prototype),i.LineDashedMaterial.prototype.constructor=i.LineDashedMaterial,i.LineDashedMaterial.prototype.clone=function(){var e=new i.LineDashedMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},i.MeshBasicMaterial=function(e){i.Material.call(this),this.type="MeshBasicMaterial",this.color=new i.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=i.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=i.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},i.MeshBasicMaterial.prototype=Object.create(i.Material.prototype),i.MeshBasicMaterial.prototype.constructor=i.MeshBasicMaterial,i.MeshBasicMaterial.prototype.clone=function(){var e=new i.MeshBasicMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},i.MeshLambertMaterial=function(e){i.Material.call(this),this.type="MeshLambertMaterial",this.color=new i.Color(16777215),this.ambient=new i.Color(16777215),this.emissive=new i.Color(0),this.wrapAround=!1,this.wrapRGB=new i.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=i.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=i.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},i.MeshLambertMaterial.prototype=Object.create(i.Material.prototype),i.MeshLambertMaterial.prototype.constructor=i.MeshLambertMaterial,i.MeshLambertMaterial.prototype.clone=function(){var e=new i.MeshLambertMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},i.MeshPhongMaterial=function(e){i.Material.call(this),this.type="MeshPhongMaterial",this.color=new i.Color(16777215),this.ambient=new i.Color(16777215),this.emissive=new i.Color(0),this.specular=new i.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new i.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new i.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=i.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=i.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},i.MeshPhongMaterial.prototype=Object.create(i.Material.prototype),i.MeshPhongMaterial.prototype.constructor=i.MeshPhongMaterial,i.MeshPhongMaterial.prototype.clone=function(){var e=new i.MeshPhongMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},i.MeshDepthMaterial=function(e){i.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},i.MeshDepthMaterial.prototype=Object.create(i.Material.prototype),i.MeshDepthMaterial.prototype.constructor=i.MeshDepthMaterial,i.MeshDepthMaterial.prototype.clone=function(){var e=new i.MeshDepthMaterial;return i.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},i.MeshNormalMaterial=function(e){i.Material.call(this,e),this.type="MeshNormalMaterial",this.shading=i.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},i.MeshNormalMaterial.prototype=Object.create(i.Material.prototype),i.MeshNormalMaterial.prototype.constructor=i.MeshNormalMaterial,i.MeshNormalMaterial.prototype.clone=function(){var e=new i.MeshNormalMaterial;return i.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},i.MeshFaceMaterial=function(e){this.uuid=i.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},i.MeshFaceMaterial.prototype={constructor:i.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,n=this.materials.length;n>t;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new i.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},i.PointCloudMaterial=function(e){i.Material.call(this),this.type="PointCloudMaterial",this.color=new i.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=i.NoColors,this.fog=!0,this.setValues(e)},i.PointCloudMaterial.prototype=Object.create(i.Material.prototype),i.PointCloudMaterial.prototype.constructor=i.PointCloudMaterial,i.PointCloudMaterial.prototype.clone=function(){var e=new i.PointCloudMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},i.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new i.PointCloudMaterial(e)},i.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new i.PointCloudMaterial(e)},i.ShaderMaterial=function(e){i.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=i.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=i.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},i.ShaderMaterial.prototype=Object.create(i.Material.prototype),i.ShaderMaterial.prototype.constructor=i.ShaderMaterial,i.ShaderMaterial.prototype.clone=function(){var e=new i.ShaderMaterial;return i.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=i.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},i.RawShaderMaterial=function(e){i.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},i.RawShaderMaterial.prototype=Object.create(i.ShaderMaterial.prototype),i.RawShaderMaterial.prototype.constructor=i.RawShaderMaterial,i.RawShaderMaterial.prototype.clone=function(){var e=new i.RawShaderMaterial;return i.ShaderMaterial.prototype.clone.call(this,e),e},i.SpriteMaterial=function(e){i.Material.call(this),this.type="SpriteMaterial",this.color=new i.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},i.SpriteMaterial.prototype=Object.create(i.Material.prototype),i.SpriteMaterial.prototype.constructor=i.SpriteMaterial,i.SpriteMaterial.prototype.clone=function(){var e=new i.SpriteMaterial;return i.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},i.Texture=function(e,t,n,r,o,s,a,l,h){Object.defineProperty(this,"id",{value:i.TextureIdCount++}),this.uuid=i.Math.generateUUID(),this.name="",this.image=void 0!==e?e:i.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:i.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:i.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:i.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:i.LinearFilter,this.minFilter=void 0!==s?s:i.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:i.RGBAFormat,this.type=void 0!==l?l:i.UnsignedByteType,this.offset=new i.Vector2(0,0),this.repeat=new i.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},i.Texture.DEFAULT_IMAGE=void 0,i.Texture.DEFAULT_MAPPING=i.UVMapping,i.Texture.prototype={constructor:i.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new i.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.Texture.prototype),i.TextureIdCount=0,i.CubeTexture=function(e,t,n,r,o,s,a,l,h){t=void 0!==t?t:i.CubeReflectionMapping,i.Texture.call(this,e,t,n,r,o,s,a,l,h),this.images=e},i.CubeTexture.prototype=Object.create(i.Texture.prototype),i.CubeTexture.prototype.constructor=i.CubeTexture,i.CubeTexture.clone=function(e){return void 0===e&&(e=new i.CubeTexture),i.Texture.prototype.clone.call(this,e),e.images=this.images,e},i.CompressedTexture=function(e,t,n,r,o,s,a,l,h,u,c){i.Texture.call(this,null,s,a,l,h,u,r,o,c),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},i.CompressedTexture.prototype=Object.create(i.Texture.prototype),i.CompressedTexture.prototype.constructor=i.CompressedTexture,i.CompressedTexture.prototype.clone=function(){var e=new i.CompressedTexture;return i.Texture.prototype.clone.call(this,e),e},i.DataTexture=function(e,t,n,r,o,s,a,l,h,u,c){i.Texture.call(this,null,s,a,l,h,u,r,o,c),this.image={data:e,width:t,height:n}},i.DataTexture.prototype=Object.create(i.Texture.prototype),i.DataTexture.prototype.constructor=i.DataTexture,i.DataTexture.prototype.clone=function(){var e=new i.DataTexture;return i.Texture.prototype.clone.call(this,e),e},i.VideoTexture=function(e,t,n,r,o,s,a,l,h){i.Texture.call(this,e,t,n,r,o,s,a,l,h),this.generateMipmaps=!1;var u=this,c=function(){requestAnimationFrame(c),e.readyState===e.HAVE_ENOUGH_DATA&&(u.needsUpdate=!0)};c()},i.VideoTexture.prototype=Object.create(i.Texture.prototype),i.VideoTexture.prototype.constructor=i.VideoTexture,i.Group=function(){i.Object3D.call(this),this.type="Group"},i.Group.prototype=Object.create(i.Object3D.prototype),i.Group.prototype.constructor=i.Group,i.PointCloud=function(e,t){i.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new i.Geometry,this.material=void 0!==t?t:new i.PointCloudMaterial({color:16777215*Math.random()})},i.PointCloud.prototype=Object.create(i.Object3D.prototype),i.PointCloud.prototype.constructor=i.PointCloud,i.PointCloud.prototype.raycast=function(){var e=new i.Matrix4,t=new i.Ray;return function(n,r){var o=this,s=o.geometry,a=n.params.PointCloud.threshold;if(e.getInverse(this.matrixWorld),t.copy(n.ray).applyMatrix4(e),null===s.boundingBox||t.isIntersectionBox(s.boundingBox)!==!1){var l=a/((this.scale.x+this.scale.y+this.scale.z)/3),h=new i.Vector3,u=function(e,i){var s=t.distanceToPoint(e);if(l>s){var a=t.closestPointToPoint(e);a.applyMatrix4(o.matrixWorld);var h=n.ray.origin.distanceTo(a);r.push({distance:h,distanceToRay:s,point:a.clone(),index:i,face:null,object:o})}};if(s instanceof i.BufferGeometry){var c=s.attributes,p=c.position.array;if(void 0!==c.index){var d=c.index.array,f=s.offsets;if(0===f.length){var m={start:0,count:d.length,index:0};f=[m]}for(var v=0,y=f.length;y>v;++v)for(var g=f[v].start,x=f[v].count,b=f[v].index,_=g,w=g+x;w>_;_++){var S=b+d[_];h.fromArray(p,3*S),u(h,S)}}else for(var M=p.length/3,_=0;M>_;_++)h.set(p[3*_],p[3*_+1],p[3*_+2]),u(h,_)}else for(var T=this.geometry.vertices,_=0;_<T.length;_++)u(T[_],_)}}}(),i.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new i.PointCloud(this.geometry,this.material)),i.Object3D.prototype.clone.call(this,e),e},i.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new i.PointCloud(e,t)},i.Line=function(e,t,n){i.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new i.Geometry,this.material=void 0!==t?t:new i.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==n?n:i.LineStrip},i.LineStrip=0,i.LinePieces=1,i.Line.prototype=Object.create(i.Object3D.prototype),i.Line.prototype.constructor=i.Line,i.Line.prototype.raycast=function(){var e=new i.Matrix4,t=new i.Ray,n=new i.Sphere;return function(r,o){var s=r.linePrecision,a=s*s,l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),n.copy(l.boundingSphere),n.applyMatrix4(this.matrixWorld),r.ray.isIntersectionSphere(n)!==!1){e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e);var h=new i.Vector3,u=new i.Vector3,c=new i.Vector3,p=new i.Vector3,d=this.mode===i.LineStrip?1:2;if(l instanceof i.BufferGeometry){var f=l.attributes;if(void 0!==f.index){var m=f.index.array,v=f.position.array,y=l.offsets;0===y.length&&(y=[{start:0,count:m.length,index:0}]);for(var g=0;g<y.length;g++)for(var x=y[g].start,b=y[g].count,_=y[g].index,w=x;x+b-1>w;w+=d){var S=_+m[w],M=_+m[w+1];h.fromArray(v,3*S),u.fromArray(v,3*M);var T=t.distanceSqToSegment(h,u,p,c);if(!(T>a)){var E=t.origin.distanceTo(p);E<r.near||E>r.far||o.push({distance:E,point:c.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}else for(var v=f.position.array,w=0;w<v.length/3-1;w+=d){h.fromArray(v,3*w),u.fromArray(v,3*w+3);var T=t.distanceSqToSegment(h,u,p,c);if(!(T>a)){var E=t.origin.distanceTo(p);E<r.near||E>r.far||o.push({distance:E,point:c.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}else if(l instanceof i.Geometry)for(var C=l.vertices,A=C.length,w=0;A-1>w;w+=d){var T=t.distanceSqToSegment(C[w],C[w+1],p,c);if(!(T>a)){var E=t.origin.distanceTo(p);E<r.near||E>r.far||o.push({distance:E,point:c.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}}(),i.Line.prototype.clone=function(e){return void 0===e&&(e=new i.Line(this.geometry,this.material,this.mode)),i.Object3D.prototype.clone.call(this,e),e},i.Mesh=function(e,t){i.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new i.Geometry,this.material=void 0!==t?t:new i.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},i.Mesh.prototype=Object.create(i.Object3D.prototype),i.Mesh.prototype.constructor=i.Mesh,i.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},i.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},i.Mesh.prototype.raycast=function(){var e=new i.Matrix4,t=new i.Ray,n=new i.Sphere,r=new i.Vector3,o=new i.Vector3,s=new i.Vector3;return function(a,l){var h=this.geometry;if(null===h.boundingSphere&&h.computeBoundingSphere(),n.copy(h.boundingSphere),n.applyMatrix4(this.matrixWorld),a.ray.isIntersectionSphere(n)!==!1&&(e.getInverse(this.matrixWorld),t.copy(a.ray).applyMatrix4(e),null===h.boundingBox||t.isIntersectionBox(h.boundingBox)!==!1))if(h instanceof i.BufferGeometry){var u=this.material;if(void 0===u)return;var c,p,d,f=h.attributes,m=a.precision;if(void 0!==f.index){var v=f.index.array,y=f.position.array,g=h.offsets;0===g.length&&(g=[{start:0,count:v.length,index:0}]);for(var x=0,b=g.length;b>x;++x)for(var _=g[x].start,w=g[x].count,S=g[x].index,M=_,T=_+w;T>M;M+=3){if(c=S+v[M],p=S+v[M+1],d=S+v[M+2],r.fromArray(y,3*c),o.fromArray(y,3*p),s.fromArray(y,3*d),u.side===i.BackSide)var E=t.intersectTriangle(s,o,r,!0);else var E=t.intersectTriangle(r,o,s,u.side!==i.DoubleSide);if(null!==E){E.applyMatrix4(this.matrixWorld);var C=a.ray.origin.distanceTo(E);m>C||C<a.near||C>a.far||l.push({distance:C,point:E,face:new i.Face3(c,p,d,i.Triangle.normal(r,o,s)),faceIndex:null,object:this})}}}else for(var y=f.position.array,M=0,A=0,T=y.length;T>M;M+=3,A+=9){if(c=M,p=M+1,d=M+2,r.fromArray(y,A),o.fromArray(y,A+3),s.fromArray(y,A+6),u.side===i.BackSide)var E=t.intersectTriangle(s,o,r,!0);else var E=t.intersectTriangle(r,o,s,u.side!==i.DoubleSide);if(null!==E){E.applyMatrix4(this.matrixWorld);var C=a.ray.origin.distanceTo(E);m>C||C<a.near||C>a.far||l.push({distance:C,point:E,face:new i.Face3(c,p,d,i.Triangle.normal(r,o,s)),faceIndex:null,object:this})}}}else if(h instanceof i.Geometry)for(var c,p,d,P=this.material instanceof i.MeshFaceMaterial,F=P===!0?this.material.materials:null,m=a.precision,L=h.vertices,R=0,B=h.faces.length;B>R;R++){var k=h.faces[R],u=P===!0?F[k.materialIndex]:this.material;if(void 0!==u){if(c=L[k.a],p=L[k.b],d=L[k.c],u.morphTargets===!0){var D=h.morphTargets,N=this.morphTargetInfluences;r.set(0,0,0),o.set(0,0,0),s.set(0,0,0);for(var O=0,V=D.length;V>O;O++){var z=N[O];if(0!==z){var U=D[O].vertices;r.x+=(U[k.a].x-c.x)*z,r.y+=(U[k.a].y-c.y)*z,r.z+=(U[k.a].z-c.z)*z,o.x+=(U[k.b].x-p.x)*z,o.y+=(U[k.b].y-p.y)*z,o.z+=(U[k.b].z-p.z)*z,s.x+=(U[k.c].x-d.x)*z,s.y+=(U[k.c].y-d.y)*z,s.z+=(U[k.c].z-d.z)*z}}r.add(c),o.add(p),s.add(d),c=r,p=o,d=s}if(u.side===i.BackSide)var E=t.intersectTriangle(d,p,c,!0);else var E=t.intersectTriangle(c,p,d,u.side!==i.DoubleSide);if(null!==E){E.applyMatrix4(this.matrixWorld);var C=a.ray.origin.distanceTo(E);m>C||C<a.near||C>a.far||l.push({distance:C,point:E,face:k,faceIndex:R,object:this})}}}}}(),i.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new i.Mesh(this.geometry,this.material)),i.Object3D.prototype.clone.call(this,e,t),e},i.Bone=function(e){i.Object3D.call(this),this.skin=e},i.Bone.prototype=Object.create(i.Object3D.prototype),i.Bone.prototype.constructor=i.Bone,i.Skeleton=function(e,t,n){if(this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new i.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var r;r=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new i.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,i.RGBAFormat,i.FloatType),this.boneTexture.minFilter=i.NearestFilter,this.boneTexture.magFilter=i.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var o=0,s=this.bones.length;s>o;o++)this.boneInverses.push(new i.Matrix4)}},i.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;t>e;e++){var n=new i.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},i.Skeleton.prototype.pose=function(){for(var e,t=0,n=this.bones.length;n>t;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,n=this.bones.length;n>t;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},i.Skeleton.prototype.update=function(){var e=new i.Matrix4;return function(){for(var t=0,n=this.bones.length;n>t;t++){var i=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),i.SkinnedMesh=function(e,t,n){i.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new i.Matrix4,this.bindMatrixInverse=new i.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var o,s,a,l,h,u=0,c=this.geometry.bones.length;c>u;++u)s=this.geometry.bones[u],a=s.pos,l=s.rotq,h=s.scl,o=new i.Bone(this),r.push(o),o.name=s.name,o.position.set(a[0],a[1],a[2]),o.quaternion.set(l[0],l[1],l[2],l[3]),void 0!==h?o.scale.set(h[0],h[1],h[2]):o.scale.set(1,1,1);for(var u=0,c=this.geometry.bones.length;c>u;++u)s=this.geometry.bones[u],-1!==s.parent?r[s.parent].add(r[u]):this.add(r[u])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new i.Skeleton(r,void 0,n))},i.SkinnedMesh.prototype=Object.create(i.Mesh.prototype),i.SkinnedMesh.prototype.constructor=i.SkinnedMesh,i.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},i.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},i.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof i.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==1/0?t.multiplyScalar(n):t.set(1)}},i.SkinnedMesh.prototype.updateMatrixWorld=function(e){i.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},i.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new i.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),i.Mesh.prototype.clone.call(this,e),e},i.MorphAnimMesh=function(e,t){i.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},i.MorphAnimMesh.prototype=Object.create(i.Mesh.prototype),
i.MorphAnimMesh.prototype.constructor=i.MorphAnimMesh,i.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},i.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},i.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},i.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,i=/([a-z]+)_?(\d+)/,r=0,o=e.morphTargets.length;o>r;r++){var s=e.morphTargets[r],a=s.name.match(i);if(a&&a.length>1){{var l=a[1];a[2]}n[l]||(n[l]={start:1/0,end:-(1/0)});var h=n[l];r<h.start&&(h.start=r),r>h.end&&(h.end=r),t||(t=l)}}e.firstAnimation=t},i.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},i.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},i.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var n=this.startKeyframe+i.Math.clamp(Math.floor(this.time/t),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var r=this.time%t/t;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},i.MorphAnimMesh.prototype.interpolateTargets=function(e,t,n){for(var i=this.morphTargetInfluences,r=0,o=i.length;o>r;r++)i[r]=0;e>-1&&(i[e]=1-n),t>-1&&(i[t]=n)},i.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new i.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,i.Mesh.prototype.clone.call(this,e),e},i.LOD=function(){i.Object3D.call(this),this.objects=[]},i.LOD.prototype=Object.create(i.Object3D.prototype),i.LOD.prototype.constructor=i.LOD,i.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},i.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;n>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},i.LOD.prototype.raycast=function(){var e=new i.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,n)}}(),i.LOD.prototype.update=function(){var e=new i.Vector3,t=new i.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);this.objects[0].object.visible=!0;for(var r=1,o=this.objects.length;o>r&&i>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;o>r;r++)this.objects[r].object.visible=!1}}}(),i.LOD.prototype.clone=function(e){void 0===e&&(e=new i.LOD),i.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;n>t;t++){var r=this.objects[t].object.clone();r.visible=0===t,e.addLevel(r,this.objects[t].distance)}return e},i.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),n=new Float32Array([0,0,1,0,1,1,0,1]),r=new i.BufferGeometry;return r.addAttribute("index",new i.BufferAttribute(e,1)),r.addAttribute("position",new i.BufferAttribute(t,3)),r.addAttribute("uv",new i.BufferAttribute(n,2)),function(e){i.Object3D.call(this),this.type="Sprite",this.geometry=r,this.material=void 0!==e?e:new i.SpriteMaterial}}(),i.Sprite.prototype=Object.create(i.Object3D.prototype),i.Sprite.prototype.constructor=i.Sprite,i.Sprite.prototype.raycast=function(){var e=new i.Vector3;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.distanceToPoint(e);i>this.scale.x||n.push({distance:i,point:this.position,face:null,object:this})}}(),i.Sprite.prototype.clone=function(e){return void 0===e&&(e=new i.Sprite(this.material)),i.Object3D.prototype.clone.call(this,e),e},i.Particle=i.Sprite,i.LensFlare=function(e,t,n,r,o){i.Object3D.call(this),this.lensFlares=[],this.positionScreen=new i.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,r,o)},i.LensFlare.prototype=Object.create(i.Object3D.prototype),i.LensFlare.prototype.constructor=i.LensFlare,i.LensFlare.prototype.add=function(e,t,n,r,o,s){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===s&&(s=1),void 0===o&&(o=new i.Color(16777215)),void 0===r&&(r=i.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:o,blending:r})},i.LensFlare.prototype.updateLensFlares=function(){var e,t,n=this.lensFlares.length,i=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;n>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},i.Scene=function(){i.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},i.Scene.prototype=Object.create(i.Object3D.prototype),i.Scene.prototype.constructor=i.Scene,i.Scene.prototype.clone=function(e){return void 0===e&&(e=new i.Scene),i.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},i.Fog=function(e,t,n){this.name="",this.color=new i.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},i.Fog.prototype.clone=function(){return new i.Fog(this.color.getHex(),this.near,this.far)},i.FogExp2=function(e,t){this.name="",this.color=new i.Color(e),this.density=void 0!==t?t:25e-5},i.FogExp2.prototype.clone=function(){return new i.FogExp2(this.color.getHex(),this.density)},i.ShaderChunk={},i.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n",i.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif",i.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",i.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n	vec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",i.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",i.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n",i.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",i.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif",i.ShaderChunk.lights_phong_fragment="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif",i.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",i.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif",i.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",i.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",i.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",i.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n",i.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif",i.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif",i.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif",i.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif",i.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif",i.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif",i.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",i.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif",i.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",i.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",i.ShaderChunk.linear_to_gamma_fragment="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif",i.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",i.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n",i.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",i.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = clamp( flipNormal * reflectVec.y * 0.5 + 0.5, 0.0, 1.0);\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * 0.15915494309189533576888376337251 + 0.5; // reciprocal( 2 PI ) + 0.5\n		vec4 envColor = texture2D( envMap, sampleUV );\n		\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		envColor.xyz *= envColor.xyz;\n\n	#endif\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		gl_FragColor.xyz += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",i.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",i.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",i.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",i.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",i.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif",i.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif",i.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n	vec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n	vec3 objectNormal = morphedNormal;\n\n#else\n\n	vec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",
i.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",i.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",i.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",i.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif",i.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",i.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif",i.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif",i.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",i.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n",i.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#elif defined( USE_MORPHTARGETS )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif\n",i.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif",i.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",i.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif",i.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",i.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",i.UniformsUtils={merge:function(e){for(var t={},n=0;n<e.length;n++){var i=this.clone(e[n]);for(var r in i)t[r]=i[r]}return t},clone:function(e){var t={};for(var n in e){t[n]={};for(var r in e[n]){var o=e[n][r];t[n][r]=o instanceof i.Color||o instanceof i.Vector2||o instanceof i.Vector3||o instanceof i.Vector4||o instanceof i.Matrix4||o instanceof i.Texture?o.clone():o instanceof Array?o.slice():o}}return t}},i.UniformsLib={common:{diffuse:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new i.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},i.ShaderLib={basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.shadowmap]),vertexShader:[i.ShaderChunk.map_pars_vertex,i.ShaderChunk.lightmap_pars_vertex,i.ShaderChunk.envmap_pars_vertex,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.map_vertex,i.ShaderChunk.lightmap_vertex,i.ShaderChunk.color_vertex,i.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",i.ShaderChunk.morphnormal_vertex,i.ShaderChunk.skinnormal_vertex,i.ShaderChunk.defaultnormal_vertex,"	#endif",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.worldpos_vertex,i.ShaderChunk.envmap_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_pars_fragment,i.ShaderChunk.alphamap_pars_fragment,i.ShaderChunk.lightmap_pars_fragment,i.ShaderChunk.envmap_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.specularmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( diffuse, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_fragment,i.ShaderChunk.alphamap_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.specularmap_fragment,i.ShaderChunk.lightmap_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.envmap_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.linear_to_gamma_fragment,i.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,i.UniformsLib.lights,i.UniformsLib.shadowmap,{ambient:{type:"c",value:new i.Color(16777215)},emissive:{type:"c",value:new i.Color(0)},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk.map_pars_vertex,i.ShaderChunk.lightmap_pars_vertex,i.ShaderChunk.envmap_pars_vertex,i.ShaderChunk.lights_lambert_pars_vertex,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.map_vertex,i.ShaderChunk.lightmap_vertex,i.ShaderChunk.color_vertex,i.ShaderChunk.morphnormal_vertex,i.ShaderChunk.skinbase_vertex,i.ShaderChunk.skinnormal_vertex,i.ShaderChunk.defaultnormal_vertex,i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.worldpos_vertex,i.ShaderChunk.envmap_vertex,i.ShaderChunk.lights_lambert_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_pars_fragment,i.ShaderChunk.alphamap_pars_fragment,i.ShaderChunk.lightmap_pars_fragment,i.ShaderChunk.envmap_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.specularmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_fragment,i.ShaderChunk.alphamap_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",i.ShaderChunk.lightmap_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.envmap_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.linear_to_gamma_fragment,i.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.bump,i.UniformsLib.normalmap,i.UniformsLib.fog,i.UniformsLib.lights,i.UniformsLib.shadowmap,{ambient:{type:"c",value:new i.Color(16777215)},emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",i.ShaderChunk.map_pars_vertex,i.ShaderChunk.lightmap_pars_vertex,i.ShaderChunk.envmap_pars_vertex,i.ShaderChunk.lights_phong_pars_vertex,i.ShaderChunk.color_pars_vertex,i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.map_vertex,i.ShaderChunk.lightmap_vertex,i.ShaderChunk.color_vertex,i.ShaderChunk.morphnormal_vertex,i.ShaderChunk.skinbase_vertex,i.ShaderChunk.skinnormal_vertex,i.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",i.ShaderChunk.worldpos_vertex,i.ShaderChunk.envmap_vertex,i.ShaderChunk.lights_phong_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_pars_fragment,i.ShaderChunk.alphamap_pars_fragment,i.ShaderChunk.lightmap_pars_fragment,i.ShaderChunk.envmap_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.lights_phong_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.bumpmap_pars_fragment,i.ShaderChunk.normalmap_pars_fragment,i.ShaderChunk.specularmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_fragment,i.ShaderChunk.alphamap_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.specularmap_fragment,i.ShaderChunk.lights_phong_fragment,i.ShaderChunk.lightmap_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.envmap_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.linear_to_gamma_fragment,i.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib.particle,i.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",i.ShaderChunk.color_pars_vertex,i.ShaderChunk.shadowmap_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.worldpos_vertex,i.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",i.ShaderChunk.color_pars_fragment,i.ShaderChunk.map_particle_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.shadowmap_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( psColor, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.map_particle_fragment,i.ShaderChunk.alphatest_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.shadowmap_fragment,i.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:i.UniformsUtils.merge([i.UniformsLib.common,i.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",i.ShaderChunk.color_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",i.ShaderChunk.color_pars_fragment,i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",i.ShaderChunk.logdepthbuf_fragment,i.ShaderChunk.color_fragment,i.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",i.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",i.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",i.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",i.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = clamp( tFlip * direction.y * -0.5 + 0.5, 0.0, 1.0);","sampleUV.x = atan( direction.z, direction.x ) * 0.15915494309189533576888376337251 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",i.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[i.ShaderChunk.morphtarget_pars_vertex,i.ShaderChunk.skinning_pars_vertex,i.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",i.ShaderChunk.skinbase_vertex,i.ShaderChunk.morphtarget_vertex,i.ShaderChunk.skinning_vertex,i.ShaderChunk.default_vertex,i.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[i.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",i.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}},i.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Ne.createBuffer(),e.__webglColorBuffer=Ne.createBuffer(),Oe.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Ne.createBuffer(),e.__webglColorBuffer=Ne.createBuffer(),e.__webglLineDistanceBuffer=Ne.createBuffer(),Oe.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Ne.createBuffer(),e.__webglNormalBuffer=Ne.createBuffer(),e.__webglTangentBuffer=Ne.createBuffer(),e.__webglColorBuffer=Ne.createBuffer(),e.__webglUVBuffer=Ne.createBuffer(),e.__webglUV2Buffer=Ne.createBuffer(),e.__webglSkinIndicesBuffer=Ne.createBuffer(),e.__webglSkinWeightsBuffer=Ne.createBuffer(),e.__webglFaceBuffer=Ne.createBuffer(),e.__webglLineBuffer=Ne.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var n=0,i=t;i>n;n++)e.__webglMorphTargetsBuffers.push(Ne.createBuffer())}var r=e.numMorphNormals;if(r){e.__webglMorphNormalsBuffers=[];for(var n=0,i=r;i>n;n++)e.__webglMorphNormalsBuffers.push(Ne.createBuffer())}Oe.info.memory.geometries++}function o(e){var t=e.geometry,n=e.material,i=t.vertices.length;if(n.attributes){void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(i*s),o.buffer=Ne.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}}function s(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__sortArray=[],e.__webglParticleCount=n,o(t)}function a(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__lineDistanceArray=new Float32Array(1*n),e.__webglLineCount=n,o(t)}function l(e,t){var n=t.geometry,i=e.faces3,r=3*i.length,o=1*i.length,s=3*i.length,a=h(t,e);e.__vertexArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__uvArray=new Float32Array(2*r),n.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r));var l=null!==xt.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=l,e.__faceArray=new l(3*o),e.__lineArray=new l(2*s);var u=e.numMorphTargets;if(u){e.__morphTargetsArrays=[];for(var c=0,p=u;p>c;c++)e.__morphTargetsArrays.push(new Float32Array(3*r))}var d=e.numMorphNormals;if(d){e.__morphNormalsArrays=[];for(var c=0,p=d;p>c;c++)e.__morphNormalsArrays.push(new Float32Array(3*r))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var f in a.attributes){var m=a.attributes[f],v={};for(var y in m)v[y]=m[y];if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=!0;var g=1;"v2"===v.type?g=2:"v3"===v.type?g=3:"v4"===v.type?g=4:"c"===v.type&&(g=3),v.size=g,v.array=new Float32Array(r*g),v.buffer=Ne.createBuffer(),v.buffer.belongsToAttribute=f,m.needsUpdate=!0,v.__original=m}e.__webglCustomAttributesList.push(v)}}e.__inittedArrays=!0}function h(e,t){return e.material instanceof i.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function u(e){return e&&void 0!==e.shading&&e.shading===i.SmoothShading}function c(e,t,n){var i,r,o,s,a,l,h,u,c,p,d,f=e.vertices,m=f.length,v=e.colors,y=v.length,g=e.__vertexArray,x=e.__colorArray,b=(e.__sortArray,e.verticesNeedUpdate),_=(e.elementsNeedUpdate,e.colorsNeedUpdate),w=e.__webglCustomAttributesList;if(b){for(i=0;m>i;i++)o=f[i],
s=3*i,g[s]=o.x,g[s+1]=o.y,g[s+2]=o.z;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,g,t)}if(_){for(r=0;y>r;r++)a=v[r],s=3*r,x[s]=a.r,x[s+1]=a.g,x[s+2]=a.b;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,x,t)}if(w)for(l=0,h=w.length;h>l;l++){if(d=w[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo))if(c=d.value.length,s=0,1===d.size)for(u=0;c>u;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.x,d.array[s+1]=p.y,s+=2;else if(3===d.size)if("c"===d.type)for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.r,d.array[s+1]=p.g,d.array[s+2]=p.b,s+=3;else for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.x,d.array[s+1]=p.y,d.array[s+2]=p.z,s+=3;else if(4===d.size)for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.x,d.array[s+1]=p.y,d.array[s+2]=p.z,d.array[s+3]=p.w,s+=4;Ne.bindBuffer(Ne.ARRAY_BUFFER,d.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,d.array,t),d.needsUpdate=!1}}function p(e,t){var n,i,r,o,s,a,l,h,u,c,p,d,f=e.vertices,m=e.colors,v=e.lineDistances,y=f.length,g=m.length,x=v.length,b=e.__vertexArray,_=e.__colorArray,w=e.__lineDistanceArray,S=e.verticesNeedUpdate,M=e.colorsNeedUpdate,T=e.lineDistancesNeedUpdate,E=e.__webglCustomAttributesList;if(S){for(n=0;y>n;n++)o=f[n],s=3*n,b[s]=o.x,b[s+1]=o.y,b[s+2]=o.z;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,b,t)}if(M){for(i=0;g>i;i++)a=m[i],s=3*i,_[s]=a.r,_[s+1]=a.g,_[s+2]=a.b;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,_,t)}if(T){for(r=0;x>r;r++)w[r]=v[r];Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,w,t)}if(E)for(l=0,h=E.length;h>l;l++)if(d=E[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(s=0,c=d.value.length,1===d.size)for(u=0;c>u;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.x,d.array[s+1]=p.y,s+=2;else if(3===d.size)if("c"===d.type)for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.r,d.array[s+1]=p.g,d.array[s+2]=p.b,s+=3;else for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.x,d.array[s+1]=p.y,d.array[s+2]=p.z,s+=3;else if(4===d.size)for(u=0;c>u;u++)p=d.value[u],d.array[s]=p.x,d.array[s+1]=p.y,d.array[s+2]=p.z,d.array[s+3]=p.w,s+=4;Ne.bindBuffer(Ne.ARRAY_BUFFER,d.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,d.array,t),d.needsUpdate=!1}}function d(e,t,n,r,o){if(e.__inittedArrays){var s,a,l,h,c,p,d,f,m,v,y,g,x,b,_,w,S,M,T,E,C,A,P,F,L,R,B,k,D,N,O,V,z,U,I,j,G,q,H,W,X,Y,Q=u(o),K=0,Z=0,$=0,J=0,ee=0,te=0,ne=0,ie=0,re=0,oe=0,se=0,ae=0,le=0,he=e.__vertexArray,ue=e.__uvArray,ce=e.__uv2Array,pe=e.__normalArray,de=e.__tangentArray,fe=e.__colorArray,me=e.__skinIndexArray,ve=e.__skinWeightArray,ye=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,xe=e.__webglCustomAttributesList,be=e.__faceArray,_e=e.__lineArray,we=t.geometry,Se=we.verticesNeedUpdate,Me=we.elementsNeedUpdate,Te=we.uvsNeedUpdate,Ee=we.normalsNeedUpdate,Ce=we.tangentsNeedUpdate,Ae=we.colorsNeedUpdate,Pe=we.morphTargetsNeedUpdate,Fe=we.vertices,Le=e.faces3,Re=we.faces,Be=we.faceVertexUvs[0],ke=we.faceVertexUvs[1],De=(we.colors,we.skinIndices),Oe=we.skinWeights,Ve=we.morphTargets,ze=we.morphNormals;if(Se){for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],g=Fe[h.a],x=Fe[h.b],b=Fe[h.c],he[Z]=g.x,he[Z+1]=g.y,he[Z+2]=g.z,he[Z+3]=x.x,he[Z+4]=x.y,he[Z+5]=x.z,he[Z+6]=b.x,he[Z+7]=b.y,he[Z+8]=b.z,Z+=9;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,he,n)}if(Pe)for(I=0,j=Ve.length;j>I;I++){for(se=0,s=0,a=Le.length;a>s;s++)H=Le[s],h=Re[H],g=Ve[I].vertices[h.a],x=Ve[I].vertices[h.b],b=Ve[I].vertices[h.c],G=ye[I],G[se]=g.x,G[se+1]=g.y,G[se+2]=g.z,G[se+3]=x.x,G[se+4]=x.y,G[se+5]=x.z,G[se+6]=b.x,G[se+7]=b.y,G[se+8]=b.z,o.morphNormals&&(Q?(W=ze[I].vertexNormals[H],M=W.a,T=W.b,E=W.c):(M=ze[I].faceNormals[H],T=M,E=M),q=ge[I],q[se]=M.x,q[se+1]=M.y,q[se+2]=M.z,q[se+3]=T.x,q[se+4]=T.y,q[se+5]=T.z,q[se+6]=E.x,q[se+7]=E.y,q[se+8]=E.z),se+=9;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[I]),Ne.bufferData(Ne.ARRAY_BUFFER,ye[I],n),o.morphNormals&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[I]),Ne.bufferData(Ne.ARRAY_BUFFER,ge[I],n))}if(Oe.length){for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],F=Oe[h.a],L=Oe[h.b],R=Oe[h.c],ve[oe]=F.x,ve[oe+1]=F.y,ve[oe+2]=F.z,ve[oe+3]=F.w,ve[oe+4]=L.x,ve[oe+5]=L.y,ve[oe+6]=L.z,ve[oe+7]=L.w,ve[oe+8]=R.x,ve[oe+9]=R.y,ve[oe+10]=R.z,ve[oe+11]=R.w,B=De[h.a],k=De[h.b],D=De[h.c],me[oe]=B.x,me[oe+1]=B.y,me[oe+2]=B.z,me[oe+3]=B.w,me[oe+4]=k.x,me[oe+5]=k.y,me[oe+6]=k.z,me[oe+7]=k.w,me[oe+8]=D.x,me[oe+9]=D.y,me[oe+10]=D.z,me[oe+11]=D.w,oe+=12;oe>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,me,n),Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,ve,n))}if(Ae){for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],d=h.vertexColors,f=h.color,3===d.length&&o.vertexColors===i.VertexColors?(C=d[0],A=d[1],P=d[2]):(C=f,A=f,P=f),fe[re]=C.r,fe[re+1]=C.g,fe[re+2]=C.b,fe[re+3]=A.r,fe[re+4]=A.g,fe[re+5]=A.b,fe[re+6]=P.r,fe[re+7]=P.g,fe[re+8]=P.b,re+=9;re>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,fe,n))}if(Ce&&we.hasTangents){for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],m=h.vertexTangents,_=m[0],w=m[1],S=m[2],de[ne]=_.x,de[ne+1]=_.y,de[ne+2]=_.z,de[ne+3]=_.w,de[ne+4]=w.x,de[ne+5]=w.y,de[ne+6]=w.z,de[ne+7]=w.w,de[ne+8]=S.x,de[ne+9]=S.y,de[ne+10]=S.z,de[ne+11]=S.w,ne+=12;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglTangentBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,de,n)}if(Ee){for(s=0,a=Le.length;a>s;s++)if(h=Re[Le[s]],c=h.vertexNormals,p=h.normal,3===c.length&&Q)for(N=0;3>N;N++)V=c[N],pe[te]=V.x,pe[te+1]=V.y,pe[te+2]=V.z,te+=3;else for(N=0;3>N;N++)pe[te]=p.x,pe[te+1]=p.y,pe[te+2]=p.z,te+=3;Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglNormalBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,pe,n)}if(Te&&Be){for(s=0,a=Le.length;a>s;s++)if(l=Le[s],v=Be[l],void 0!==v)for(N=0;3>N;N++)z=v[N],ue[$]=z.x,ue[$+1]=z.y,$+=2;$>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglUVBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,ue,n))}if(Te&&ke){for(s=0,a=Le.length;a>s;s++)if(l=Le[s],y=ke[l],void 0!==y)for(N=0;3>N;N++)U=y[N],ce[J]=U.x,ce[J+1]=U.y,J+=2;J>0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglUV2Buffer),Ne.bufferData(Ne.ARRAY_BUFFER,ce,n))}if(Me){for(s=0,a=Le.length;a>s;s++)be[ee]=K,be[ee+1]=K+1,be[ee+2]=K+2,ee+=3,_e[ie]=K,_e[ie+1]=K+1,_e[ie+2]=K,_e[ie+3]=K+2,_e[ie+4]=K+1,_e[ie+5]=K+2,ie+=6,K+=3;Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Ne.bufferData(Ne.ELEMENT_ARRAY_BUFFER,be,n),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Ne.bufferData(Ne.ELEMENT_ARRAY_BUFFER,_e,n)}if(xe)for(N=0,O=xe.length;O>N;N++)if(Y=xe[N],Y.__original.needsUpdate){if(ae=0,le=0,1===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],Y.array[ae]=Y.value[h.a],Y.array[ae+1]=Y.value[h.b],Y.array[ae+2]=Y.value[h.c],ae+=3;else if("faces"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)X=Y.value[Le[s]],Y.array[ae]=X,Y.array[ae+1]=X,Y.array[ae+2]=X,ae+=3}else if(2===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],g=Y.value[h.a],x=Y.value[h.b],b=Y.value[h.c],Y.array[ae]=g.x,Y.array[ae+1]=g.y,Y.array[ae+2]=x.x,Y.array[ae+3]=x.y,Y.array[ae+4]=b.x,Y.array[ae+5]=b.y,ae+=6;else if("faces"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)X=Y.value[Le[s]],g=X,x=X,b=X,Y.array[ae]=g.x,Y.array[ae+1]=g.y,Y.array[ae+2]=x.x,Y.array[ae+3]=x.y,Y.array[ae+4]=b.x,Y.array[ae+5]=b.y,ae+=6}else if(3===Y.size){var Ue;if(Ue="c"===Y.type?["r","g","b"]:["x","y","z"],void 0===Y.boundTo||"vertices"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],g=Y.value[h.a],x=Y.value[h.b],b=Y.value[h.c],Y.array[ae]=g[Ue[0]],Y.array[ae+1]=g[Ue[1]],Y.array[ae+2]=g[Ue[2]],Y.array[ae+3]=x[Ue[0]],Y.array[ae+4]=x[Ue[1]],Y.array[ae+5]=x[Ue[2]],Y.array[ae+6]=b[Ue[0]],Y.array[ae+7]=b[Ue[1]],Y.array[ae+8]=b[Ue[2]],ae+=9;else if("faces"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)X=Y.value[Le[s]],g=X,x=X,b=X,Y.array[ae]=g[Ue[0]],Y.array[ae+1]=g[Ue[1]],Y.array[ae+2]=g[Ue[2]],Y.array[ae+3]=x[Ue[0]],Y.array[ae+4]=x[Ue[1]],Y.array[ae+5]=x[Ue[2]],Y.array[ae+6]=b[Ue[0]],Y.array[ae+7]=b[Ue[1]],Y.array[ae+8]=b[Ue[2]],ae+=9;else if("faceVertices"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)X=Y.value[Le[s]],g=X[0],x=X[1],b=X[2],Y.array[ae]=g[Ue[0]],Y.array[ae+1]=g[Ue[1]],Y.array[ae+2]=g[Ue[2]],Y.array[ae+3]=x[Ue[0]],Y.array[ae+4]=x[Ue[1]],Y.array[ae+5]=x[Ue[2]],Y.array[ae+6]=b[Ue[0]],Y.array[ae+7]=b[Ue[1]],Y.array[ae+8]=b[Ue[2]],ae+=9}else if(4===Y.size)if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)h=Re[Le[s]],g=Y.value[h.a],x=Y.value[h.b],b=Y.value[h.c],Y.array[ae]=g.x,Y.array[ae+1]=g.y,Y.array[ae+2]=g.z,Y.array[ae+3]=g.w,Y.array[ae+4]=x.x,Y.array[ae+5]=x.y,Y.array[ae+6]=x.z,Y.array[ae+7]=x.w,Y.array[ae+8]=b.x,Y.array[ae+9]=b.y,Y.array[ae+10]=b.z,Y.array[ae+11]=b.w,ae+=12;else if("faces"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)X=Y.value[Le[s]],g=X,x=X,b=X,Y.array[ae]=g.x,Y.array[ae+1]=g.y,Y.array[ae+2]=g.z,Y.array[ae+3]=g.w,Y.array[ae+4]=x.x,Y.array[ae+5]=x.y,Y.array[ae+6]=x.z,Y.array[ae+7]=x.w,Y.array[ae+8]=b.x,Y.array[ae+9]=b.y,Y.array[ae+10]=b.z,Y.array[ae+11]=b.w,ae+=12;else if("faceVertices"===Y.boundTo)for(s=0,a=Le.length;a>s;s++)X=Y.value[Le[s]],g=X[0],x=X[1],b=X[2],Y.array[ae]=g.x,Y.array[ae+1]=g.y,Y.array[ae+2]=g.z,Y.array[ae+3]=g.w,Y.array[ae+4]=x.x,Y.array[ae+5]=x.y,Y.array[ae+6]=x.z,Y.array[ae+7]=x.w,Y.array[ae+8]=b.x,Y.array[ae+9]=b.y,Y.array[ae+10]=b.z,Y.array[ae+11]=b.w,ae+=12;Ne.bindBuffer(Ne.ARRAY_BUFFER,Y.buffer),Ne.bufferData(Ne.ARRAY_BUFFER,Y.array,n)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function f(e,t,n,i){for(var r=n.attributes,o=t.attributes,s=t.attributesKeys,a=0,l=s.length;l>a;a++){var h=s[a],u=o[h];if(u>=0){var c=r[h];if(void 0!==c){var p=c.itemSize;Ne.bindBuffer(Ne.ARRAY_BUFFER,c.buffer),v(u),Ne.vertexAttribPointer(u,p,Ne.FLOAT,!1,0,i*p*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[h].length?Ne.vertexAttrib2fv(u,e.defaultAttributeValues[h]):3===e.defaultAttributeValues[h].length&&Ne.vertexAttrib3fv(u,e.defaultAttributeValues[h]))}}y()}function m(){for(var e=0,t=ht.length;t>e;e++)ht[e]=0}function v(e){ht[e]=1,0===ut[e]&&(Ne.enableVertexAttribArray(e),ut[e]=1)}function y(){for(var e=0,t=ut.length;t>e;e++)ut[e]!==ht[e]&&(Ne.disableVertexAttribArray(e),ut[e]=0)}function g(e,t,n){var i=e.program.attributes;if(-1!==n.morphTargetBase&&i.position>=0?(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]),v(i.position),Ne.vertexAttribPointer(i.position,3,Ne.FLOAT,!1,0,0)):i.position>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglVertexBuffer),v(i.position),Ne.vertexAttribPointer(i.position,3,Ne.FLOAT,!1,0,0)),n.morphTargetForcedOrder.length)for(var r,o=0,s=n.morphTargetForcedOrder,a=n.morphTargetInfluences;o<e.numSupportedMorphTargets&&o<s.length;)r=i["morphTarget"+o],r>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[s[o]]),v(r),Ne.vertexAttribPointer(r,3,Ne.FLOAT,!1,0,0)),r=i["morphNormal"+o],r>=0&&e.morphNormals&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[s[o]]),v(r),Ne.vertexAttribPointer(r,3,Ne.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[o]=a[s[o]],o++;else{for(var l=[],a=n.morphTargetInfluences,h=0,u=a.length;u>h;h++){var c=a[h];l.push([c,h])}l.length>e.numSupportedMorphTargets?(l.sort(_),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(_):0===l.length&&l.push([0,0]);for(var r,o=0,p=e.numSupportedMorphTargets;p>o;o++)if(l[o]){var d=l[o][1];r=i["morphTarget"+o],r>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[d]),v(r),Ne.vertexAttribPointer(r,3,Ne.FLOAT,!1,0,0)),r=i["morphNormal"+o],r>=0&&e.morphNormals&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[d]),v(r),Ne.vertexAttribPointer(r,3,Ne.FLOAT,!1,0,0)),n.__webglMorphTargetInfluences[o]=a[d]}else n.__webglMorphTargetInfluences[o]=0}null!==e.program.uniforms.morphTargetInfluences&&Ne.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}function x(e,t){return e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function b(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function _(e,t){return t[0]-e[0]}function w(e){if(e.visible!==!1){if(e instanceof i.Scene||e instanceof i.Group);else if(C(e),e instanceof i.Light)Pe.push(e);else if(e instanceof i.Sprite)ke.push(e);else if(e instanceof i.LensFlare)De.push(e);else{var t=Fe[e.id];if(t&&(e.frustumCulled===!1||ct.intersectsObject(e)===!0))for(var n=0,r=t.length;r>n;n++){var o=t[n];E(o),o.render=!0,Oe.sortObjects===!0&&(dt.setFromMatrixPosition(e.matrixWorld),dt.applyProjection(pt),o.z=dt.z)}}for(var n=0,r=e.children.length;r>n;n++)w(e.children[n])}}function S(e,t,n,r,o,s){for(var a,l=0,h=e.length;h>l;l++){var u=e[l],c=u.object,p=u.buffer;if($(c,t),s)a=s;else{if(a=u.material,!a)continue;o&&Oe.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),Oe.setDepthTest(a.depthTest),Oe.setDepthWrite(a.depthWrite),ie(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}Oe.setMaterialFaces(a),p instanceof i.BufferGeometry?Oe.renderBufferDirect(t,n,r,a,p,c):Oe.renderBuffer(t,n,r,a,p,c)}}function M(e,t,n,i,r,o,s){for(var a,l=0,h=e.length;h>l;l++){var u=e[l],c=u.object;if(c.visible){if(s)a=s;else{if(a=u[t],!a)continue;o&&Oe.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),Oe.setDepthTest(a.depthTest),Oe.setDepthWrite(a.depthWrite),ie(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}Oe.renderImmediateObject(n,i,r,a,c)}}}function T(e){var t=e.object,n=t.material;n.transparent?(e.transparent=n,e.opaque=null):(e.opaque=n,e.transparent=null)}function E(e){var t=e.object,n=e.buffer,r=t.geometry,o=t.material;if(o instanceof i.MeshFaceMaterial){var s=r instanceof i.BufferGeometry?0:n.materialIndex;o=o.materials[s],e.material=o,o.transparent?Be.push(e):Re.push(e)}else o&&(e.material=o,o.transparent?Be.push(e):Re.push(e))}function C(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new i.Matrix4,e._normalMatrix=new i.Matrix3,e.addEventListener("removed",Vt));var r=e.geometry;if(void 0===r||void 0===r.__webglInit&&(r.__webglInit=!0,r.addEventListener("dispose",zt),r instanceof i.BufferGeometry?Oe.info.memory.geometries++:e instanceof i.Mesh?P(e,r):e instanceof i.Line?void 0===r.__webglVertexBuffer&&(n(r),a(r,e),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0,r.lineDistancesNeedUpdate=!0):e instanceof i.PointCloud&&void 0===r.__webglVertexBuffer&&(t(r),s(r,e),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0)),void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof i.Mesh){if(r instanceof i.BufferGeometry)F(Fe,r,e);else if(r instanceof i.Geometry)for(var o=Yt[r.id],l=0,h=o.length;h>l;l++)F(Fe,o[l],e)}else e instanceof i.Line||e instanceof i.PointCloud?F(Fe,r,e):(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback)&&L(Le,e)}function A(e,t){for(var n,i,r=xt.get("OES_element_index_uint")?4294967296:65535,o={},s=e.morphTargets.length,a=e.morphNormals.length,l={},h=[],u=0,c=e.faces.length;c>u;u++){var p=e.faces[u],d=t?p.materialIndex:0;d in o||(o[d]={hash:d,counter:0}),n=o[d].hash+"_"+o[d].counter,n in l||(i={id:Qt++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:s,numMorphNormals:a},l[n]=i,h.push(i)),l[n].vertices+3>r&&(o[d].counter+=1,n=o[d].hash+"_"+o[d].counter,n in l||(i={id:Qt++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:s,numMorphNormals:a},l[n]=i,h.push(i))),l[n].faces3.push(u),l[n].vertices+=3}return h}function P(e,t){var n=e.material,o=!1;(void 0===Yt[t.id]||t.groupsNeedUpdate===!0)&&(delete Fe[e.id],Yt[t.id]=A(t,n instanceof i.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var s=Yt[t.id],a=0,h=s.length;h>a;a++){var u=s[a];void 0===u.__webglVertexBuffer?(r(u),l(u,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,o=!0):o=!1,(o||void 0===e.__webglActive)&&F(Fe,u,e)}e.__webglActive=!0}function F(e,t,n){var i=n.id;e[i]=e[i]||[],e[i].push({id:i,buffer:t,object:n,material:null,z:0})}function L(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function R(e){var t=e.geometry;if(t instanceof i.BufferGeometry)for(var n=t.attributes,r=t.attributesKeys,o=0,s=r.length;s>o;o++){var a=r[o],u=n[a];if(void 0===u.buffer&&(u.buffer=Ne.createBuffer(),u.needsUpdate=!0),u.needsUpdate===!0){var f="index"===a?Ne.ELEMENT_ARRAY_BUFFER:Ne.ARRAY_BUFFER;Ne.bindBuffer(f,u.buffer),Ne.bufferData(f,u.array,Ne.STATIC_DRAW),u.needsUpdate=!1}}else if(e instanceof i.Mesh){t.groupsNeedUpdate===!0&&P(e,t);for(var m=Yt[t.id],o=0,v=m.length;v>o;o++){var y=m[o],g=h(e,y);t.groupsNeedUpdate===!0&&l(y,e);var x=g.attributes&&B(g);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||x)&&d(y,e,Ne.DYNAMIC_DRAW,!t.dynamic,g)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,g.attributes&&k(g)}else if(e instanceof i.Line){var g=h(e,t),x=g.attributes&&B(g);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||x)&&p(t,Ne.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,g.attributes&&k(g)}else if(e instanceof i.PointCloud){var g=h(e,t),x=g.attributes&&B(g);(t.verticesNeedUpdate||t.colorsNeedUpdate||x)&&c(t,Ne.DYNAMIC_DRAW,e),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,g.attributes&&k(g)}}function B(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function k(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function D(e){e instanceof i.Mesh||e instanceof i.PointCloud||e instanceof i.Line?delete Fe[e.id]:(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback)&&N(Le,e),delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}function N(e,t){for(var n=e.length-1;n>=0;n--)e[n].object===t&&e.splice(n,1)}function O(e,t,n,r){e.addEventListener("dispose",jt);var o=Kt[e.type];if(o){var s=i.ShaderLib[o];e.__webglShader={uniforms:i.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var a=fe(t),l=me(t),h=de(r),u={precision:xe,supportsVertexTextures:Et,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof i.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:Ee,skinning:e.skinning,maxBones:h,useVertexTexture:Ct&&r&&r.skeleton&&r.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:Oe.maxMorphTargets,maxMorphNormals:Oe.maxMorphNormals,maxDirLights:a.directional,maxPointLights:a.point,maxSpotLights:a.spot,maxHemiLights:a.hemi,maxShadows:l,shadowMapEnabled:Oe.shadowMapEnabled&&r.receiveShadow&&l>0,shadowMapType:Oe.shadowMapType,shadowMapDebug:Oe.shadowMapDebug,shadowMapCascade:Oe.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===i.DoubleSide,flipSided:e.side===i.BackSide},c=[];if(o?c.push(o):(c.push(e.fragmentShader),c.push(e.vertexShader)),void 0!==e.defines)for(var p in e.defines)c.push(p),c.push(e.defines[p]);for(var p in u)c.push(p),c.push(u[p]);for(var d,f=c.join(),m=0,v=Ve.length;v>m;m++){var y=Ve[m];if(y.code===f){d=y,d.usedTimes++;break}}void 0===d&&(d=new i.WebGLProgram(Oe,f,e,u),Ve.push(d),Oe.info.memory.programs=Ve.length),e.program=d;var g=d.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var x,b="morphTarget",_=0;_<Oe.maxMorphTargets;_++)x=b+_,g[x]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var x,b="morphNormal";for(_=0;_<Oe.maxMorphNormals;_++)x=b+_,g[x]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(var w in e.__webglShader.uniforms){var S=e.program.uniforms[w];S&&e.uniformsList.push([e.__webglShader.uniforms[w],S])}}function V(e,t,n,r,o){qe=0,r.needsUpdate&&(r.program&&Xt(r),O(r,t,n,o),r.needsUpdate=!1),r.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(Oe.maxMorphTargets)));var s=!1,a=!1,l=!1,h=r.program,u=h.uniforms,c=r.__webglShader.uniforms;if(h.id!==ze&&(Ne.useProgram(h.program),ze=h.id,s=!0,a=!0,l=!0),r.id!==Ie&&(-1===Ie&&(l=!0),Ie=r.id,a=!0),(s||e!==Ge)&&(Ne.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),Ee&&Ne.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Ge&&(Ge=e),(r instanceof i.ShaderMaterial||r instanceof i.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(dt.setFromMatrixPosition(e.matrixWorld),Ne.uniform3f(u.cameraPosition,dt.x,dt.y,dt.z)),(r instanceof i.MeshPhongMaterial||r instanceof i.MeshLambertMaterial||r instanceof i.MeshBasicMaterial||r instanceof i.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&Ne.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)),r.skinning)if(o.bindMatrix&&null!==u.bindMatrix&&Ne.uniformMatrix4fv(u.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==u.bindMatrixInverse&&Ne.uniformMatrix4fv(u.bindMatrixInverse,!1,o.bindMatrixInverse.elements),Ct&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==u.boneTexture){var p=K();Ne.uniform1i(u.boneTexture,p),Oe.setTexture(o.skeleton.boneTexture,p)}null!==u.boneTextureWidth&&Ne.uniform1i(u.boneTextureWidth,o.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&Ne.uniform1i(u.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==u.boneGlobalMatrices&&Ne.uniformMatrix4fv(u.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return a&&(n&&r.fog&&G(c,n),(r instanceof i.MeshPhongMaterial||r instanceof i.MeshLambertMaterial||r.lights)&&(mt&&(l=!0,te(t),mt=!1),l?(W(c,vt),X(c,!0)):X(c,!1)),(r instanceof i.MeshBasicMaterial||r instanceof i.MeshLambertMaterial||r instanceof i.MeshPhongMaterial)&&z(c,r),r instanceof i.LineBasicMaterial?U(c,r):r instanceof i.LineDashedMaterial?(U(c,r),I(c,r)):r instanceof i.PointCloudMaterial?j(c,r):r instanceof i.MeshPhongMaterial?q(c,r):r instanceof i.MeshLambertMaterial?H(c,r):r instanceof i.MeshDepthMaterial?(c.mNear.value=e.near,c.mFar.value=e.far,c.opacity.value=r.opacity):r instanceof i.MeshNormalMaterial&&(c.opacity.value=r.opacity),o.receiveShadow&&!r._shadowPass&&Y(c,t),Z(r.uniformsList)),Q(u,o),null!==u.modelMatrix&&Ne.uniformMatrix4fv(u.modelMatrix,!1,o.matrixWorld.elements),h}function z(e,t){e.opacity.value=t.opacity,Oe.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var n;if(t.map?n=t.map:t.specularMap?n=t.specularMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.alphaMap&&(n=t.alphaMap),void 0!==n){var r=n.offset,o=n.repeat;e.offsetRepeat.value.set(r.x,r.y,o.x,o.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof i.WebGLRenderTargetCube?1:-1,e.reflectivity.value=Oe.gammaInput?t.reflectivity:t.reflectivity,e.refractionRatio.value=t.refractionRatio}function U(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function I(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function j(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=ve.height/2,e.map.value=t.map}function G(e,t){e.fogColor.value=t.color,t instanceof i.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof i.FogExp2&&(e.fogDensity.value=t.density)}function q(e,t){e.shininess.value=t.shininess,Oe.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function H(e,t){Oe.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function W(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function X(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Y(e,t){if(e.shadowMatrix)for(var n=0,r=0,o=t.length;o>r;r++){var s=t[r];s.castShadow&&(s instanceof i.SpotLight||s instanceof i.DirectionalLight&&!s.shadowCascade)&&(e.shadowMap.value[n]=s.shadowMap,e.shadowMapSize.value[n]=s.shadowMapSize,e.shadowMatrix.value[n]=s.shadowMatrix,e.shadowDarkness.value[n]=s.shadowDarkness,e.shadowBias.value[n]=s.shadowBias,n++)}}function Q(e,t){Ne.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Ne.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function K(){var e=qe;return e>=wt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+wt),qe+=1,e}function Z(e){for(var t,n,r,o=0,s=e.length;s>o;o++){var a=e[o][0];if(a.needsUpdate!==!1){var l=a.type,h=a.value,u=e[o][1];switch(l){case"1i":Ne.uniform1i(u,h);break;case"1f":Ne.uniform1f(u,h);break;case"2f":Ne.uniform2f(u,h[0],h[1]);break;case"3f":Ne.uniform3f(u,h[0],h[1],h[2]);break;case"4f":Ne.uniform4f(u,h[0],h[1],h[2],h[3]);break;case"1iv":Ne.uniform1iv(u,h);break;case"3iv":Ne.uniform3iv(u,h);break;case"1fv":Ne.uniform1fv(u,h);break;case"2fv":Ne.uniform2fv(u,h);break;case"3fv":Ne.uniform3fv(u,h);break;case"4fv":Ne.uniform4fv(u,h);break;case"Matrix3fv":Ne.uniformMatrix3fv(u,!1,h);break;case"Matrix4fv":Ne.uniformMatrix4fv(u,!1,h);break;case"i":Ne.uniform1i(u,h);break;case"f":Ne.uniform1f(u,h);break;case"v2":Ne.uniform2f(u,h.x,h.y);break;case"v3":Ne.uniform3f(u,h.x,h.y,h.z);break;case"v4":Ne.uniform4f(u,h.x,h.y,h.z,h.w);break;case"c":Ne.uniform3f(u,h.r,h.g,h.b);break;case"iv1":Ne.uniform1iv(u,h);break;case"iv":Ne.uniform3iv(u,h);break;case"fv1":Ne.uniform1fv(u,h);break;case"fv":Ne.uniform3fv(u,h);break;case"v2v":void 0===a._array&&(a._array=new Float32Array(2*h.length));for(var c=0,p=h.length;p>c;c++)r=2*c,a._array[r]=h[c].x,a._array[r+1]=h[c].y;Ne.uniform2fv(u,a._array);break;case"v3v":void 0===a._array&&(a._array=new Float32Array(3*h.length));for(var c=0,p=h.length;p>c;c++)r=3*c,a._array[r]=h[c].x,a._array[r+1]=h[c].y,a._array[r+2]=h[c].z;Ne.uniform3fv(u,a._array);break;case"v4v":void 0===a._array&&(a._array=new Float32Array(4*h.length));for(var c=0,p=h.length;p>c;c++)r=4*c,a._array[r]=h[c].x,a._array[r+1]=h[c].y,a._array[r+2]=h[c].z,a._array[r+3]=h[c].w;Ne.uniform4fv(u,a._array);break;case"m3":Ne.uniformMatrix3fv(u,!1,h.elements);break;case"m3v":void 0===a._array&&(a._array=new Float32Array(9*h.length));for(var c=0,p=h.length;p>c;c++)h[c].flattenToArrayOffset(a._array,9*c);Ne.uniformMatrix3fv(u,!1,a._array);break;case"m4":Ne.uniformMatrix4fv(u,!1,h.elements);break;case"m4v":void 0===a._array&&(a._array=new Float32Array(16*h.length));for(var c=0,p=h.length;p>c;c++)h[c].flattenToArrayOffset(a._array,16*c);Ne.uniformMatrix4fv(u,!1,a._array);break;case"t":if(t=h,n=K(),Ne.uniform1i(u,n),!t)continue;t instanceof i.CubeTexture||t.image instanceof Array&&6===t.image.length?se(t,n):t instanceof i.WebGLRenderTargetCube?ae(t,n):Oe.setTexture(t,n);break;case"tv":void 0===a._array&&(a._array=[]);for(var c=0,p=a.value.length;p>c;c++)a._array[c]=K();Ne.uniform1iv(u,a._array);for(var c=0,p=a.value.length;p>c;c++)t=a.value[c],n=a._array[c],t&&Oe.setTexture(t,n);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+l)}}}}function $(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function J(e,t,n,i){e[t]=n.r*n.r*i,e[t+1]=n.g*n.g*i,e[t+2]=n.b*n.b*i}function ee(e,t,n,i){e[t]=n.r*i,e[t+1]=n.g*i,e[t+2]=n.b*i}function te(e){var t,n,r,o,s,a,l,h,u,c=0,p=0,d=0,f=vt,m=f.directional.colors,v=f.directional.positions,y=f.point.colors,g=f.point.positions,x=f.point.distances,b=f.spot.colors,_=f.spot.positions,w=f.spot.distances,S=f.spot.directions,M=f.spot.anglesCos,T=f.spot.exponents,E=f.hemi.skyColors,C=f.hemi.groundColors,A=f.hemi.positions,P=0,F=0,L=0,R=0,B=0,k=0,D=0,N=0,O=0,V=0,z=0,U=0;for(t=0,n=e.length;n>t;t++)if(r=e[t],!r.onlyShadow)if(o=r.color,l=r.intensity,u=r.distance,r instanceof i.AmbientLight){if(!r.visible)continue;Oe.gammaInput?(c+=o.r*o.r,p+=o.g*o.g,d+=o.b*o.b):(c+=o.r,p+=o.g,d+=o.b)}else if(r instanceof i.DirectionalLight){if(B+=1,!r.visible)continue;ft.setFromMatrixPosition(r.matrixWorld),dt.setFromMatrixPosition(r.target.matrixWorld),ft.sub(dt),ft.normalize(),O=3*P,v[O]=ft.x,v[O+1]=ft.y,v[O+2]=ft.z,Oe.gammaInput?J(m,O,o,l*l):ee(m,O,o,l),P+=1}else if(r instanceof i.PointLight){if(k+=1,!r.visible)continue;V=3*F,Oe.gammaInput?J(y,V,o,l*l):ee(y,V,o,l),dt.setFromMatrixPosition(r.matrixWorld),g[V]=dt.x,g[V+1]=dt.y,g[V+2]=dt.z,x[F]=u,F+=1}else if(r instanceof i.SpotLight){if(D+=1,!r.visible)continue;z=3*L,Oe.gammaInput?J(b,z,o,l*l):ee(b,z,o,l),ft.setFromMatrixPosition(r.matrixWorld),_[z]=ft.x,_[z+1]=ft.y,_[z+2]=ft.z,w[L]=u,dt.setFromMatrixPosition(r.target.matrixWorld),ft.sub(dt),ft.normalize(),S[z]=ft.x,S[z+1]=ft.y,S[z+2]=ft.z,M[L]=Math.cos(r.angle),T[L]=r.exponent,L+=1}else if(r instanceof i.HemisphereLight){if(N+=1,!r.visible)continue;ft.setFromMatrixPosition(r.matrixWorld),ft.normalize(),U=3*R,A[U]=ft.x,A[U+1]=ft.y,A[U+2]=ft.z,s=r.color,a=r.groundColor,Oe.gammaInput?(h=l*l,J(E,U,s,h),J(C,U,a,h)):(ee(E,U,s,l),ee(C,U,a,l)),R+=1}for(t=3*P,n=Math.max(m.length,3*B);n>t;t++)m[t]=0;for(t=3*F,n=Math.max(y.length,3*k);n>t;t++)y[t]=0;for(t=3*L,n=Math.max(b.length,3*D);n>t;t++)b[t]=0;for(t=3*R,n=Math.max(E.length,3*N);n>t;t++)E[t]=0;for(t=3*R,n=Math.max(C.length,3*N);n>t;t++)C[t]=0;f.directional.length=P,f.point.length=F,f.spot.length=L,f.hemi.length=R,f.ambient[0]=c,f.ambient[1]=p,f.ambient[2]=d}function ne(e){e*=ge,e!==nt&&(Ne.lineWidth(e),nt=e)}function ie(e,t,n){Je!==e&&(e?Ne.enable(Ne.POLYGON_OFFSET_FILL):Ne.disable(Ne.POLYGON_OFFSET_FILL),Je=e),!e||et===t&&tt===n||(Ne.polygonOffset(t,n),et=t,tt=n)}function re(e,t,n){var r;n?(Ne.texParameteri(e,Ne.TEXTURE_WRAP_S,pe(t.wrapS)),Ne.texParameteri(e,Ne.TEXTURE_WRAP_T,pe(t.wrapT)),Ne.texParameteri(e,Ne.TEXTURE_MAG_FILTER,pe(t.magFilter)),Ne.texParameteri(e,Ne.TEXTURE_MIN_FILTER,pe(t.minFilter))):(Ne.texParameteri(e,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),
Ne.texParameteri(e,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),(t.wrapS!==i.ClampToEdgeWrapping||t.wrapT!==i.ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT is set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),Ne.texParameteri(e,Ne.TEXTURE_MAG_FILTER,ce(t.magFilter)),Ne.texParameteri(e,Ne.TEXTURE_MIN_FILTER,ce(t.minFilter)),t.minFilter!==i.NearestFilter&&t.minFilter!==i.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter is set to THREE.LinearFilter or THREE.NearestFilter. ( "+t.sourceFile+" )")),r=xt.get("EXT_texture_filter_anisotropic"),r&&t.type!==i.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Ne.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Oe.getMaxAnisotropy())),t.__oldAnisotropy=t.anisotropy)}function oe(e,t){if(e.width>t||e.height>t){var n=t/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=Math.floor(e.width*n),i.height=Math.floor(e.height*n);var r=i.getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.log("THREE.WebGLRenderer:",e,"is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height+"."),i}return e}function se(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Ut),e.image.__webglTextureCube=Ne.createTexture(),Oe.info.memory.textures++),Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Ne.pixelStorei(Ne.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var n=e instanceof i.CompressedTexture,r=e.image[0]instanceof i.DataTexture,o=[],s=0;6>s;s++)o[s]=!Oe.autoScaleCubemaps||n||r?r?e.image[s].image:e.image[s]:oe(e.image[s],Tt);var a=o[0],l=i.Math.isPowerOfTwo(a.width)&&i.Math.isPowerOfTwo(a.height),h=pe(e.format),u=pe(e.type);re(Ne.TEXTURE_CUBE_MAP,e,l);for(var s=0;6>s;s++)if(n)for(var c,p=o[s].mipmaps,d=0,f=p.length;f>d;d++)c=p[d],e.format!==i.RGBAFormat&&e.format!==i.RGBFormat?Rt().indexOf(h)>-1?Ne.compressedTexImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+s,d,h,c.width,c.height,0,c.data):console.warn("Attempt to load unsupported compressed texture format"):Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+s,d,h,c.width,c.height,0,h,u,c.data);else r?Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,h,o[s].width,o[s].height,0,h,u,o[s].data):Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,h,h,u,o[s]);e.generateMipmaps&&l&&Ne.generateMipmap(Ne.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function ae(e,t){Ne.activeTexture(Ne.TEXTURE0+t),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.__webglTexture)}function le(e,t,n){Ne.bindFramebuffer(Ne.FRAMEBUFFER,e),Ne.framebufferTexture2D(Ne.FRAMEBUFFER,Ne.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function he(e,t){Ne.bindRenderbuffer(Ne.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.DEPTH_COMPONENT16,t.width,t.height),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_ATTACHMENT,Ne.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.DEPTH_STENCIL,t.width,t.height),Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_STENCIL_ATTACHMENT,Ne.RENDERBUFFER,e)):Ne.renderbufferStorage(Ne.RENDERBUFFER,Ne.RGBA4,t.width,t.height)}function ue(e){e instanceof i.WebGLRenderTargetCube?(Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.__webglTexture),Ne.generateMipmap(Ne.TEXTURE_CUBE_MAP),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,null)):(Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture),Ne.generateMipmap(Ne.TEXTURE_2D),Ne.bindTexture(Ne.TEXTURE_2D,null))}function ce(e){return e===i.NearestFilter||e===i.NearestMipMapNearestFilter||e===i.NearestMipMapLinearFilter?Ne.NEAREST:Ne.LINEAR}function pe(e){var t;if(e===i.RepeatWrapping)return Ne.REPEAT;if(e===i.ClampToEdgeWrapping)return Ne.CLAMP_TO_EDGE;if(e===i.MirroredRepeatWrapping)return Ne.MIRRORED_REPEAT;if(e===i.NearestFilter)return Ne.NEAREST;if(e===i.NearestMipMapNearestFilter)return Ne.NEAREST_MIPMAP_NEAREST;if(e===i.NearestMipMapLinearFilter)return Ne.NEAREST_MIPMAP_LINEAR;if(e===i.LinearFilter)return Ne.LINEAR;if(e===i.LinearMipMapNearestFilter)return Ne.LINEAR_MIPMAP_NEAREST;if(e===i.LinearMipMapLinearFilter)return Ne.LINEAR_MIPMAP_LINEAR;if(e===i.UnsignedByteType)return Ne.UNSIGNED_BYTE;if(e===i.UnsignedShort4444Type)return Ne.UNSIGNED_SHORT_4_4_4_4;if(e===i.UnsignedShort5551Type)return Ne.UNSIGNED_SHORT_5_5_5_1;if(e===i.UnsignedShort565Type)return Ne.UNSIGNED_SHORT_5_6_5;if(e===i.ByteType)return Ne.BYTE;if(e===i.ShortType)return Ne.SHORT;if(e===i.UnsignedShortType)return Ne.UNSIGNED_SHORT;if(e===i.IntType)return Ne.INT;if(e===i.UnsignedIntType)return Ne.UNSIGNED_INT;if(e===i.FloatType)return Ne.FLOAT;if(e===i.AlphaFormat)return Ne.ALPHA;if(e===i.RGBFormat)return Ne.RGB;if(e===i.RGBAFormat)return Ne.RGBA;if(e===i.LuminanceFormat)return Ne.LUMINANCE;if(e===i.LuminanceAlphaFormat)return Ne.LUMINANCE_ALPHA;if(e===i.AddEquation)return Ne.FUNC_ADD;if(e===i.SubtractEquation)return Ne.FUNC_SUBTRACT;if(e===i.ReverseSubtractEquation)return Ne.FUNC_REVERSE_SUBTRACT;if(e===i.ZeroFactor)return Ne.ZERO;if(e===i.OneFactor)return Ne.ONE;if(e===i.SrcColorFactor)return Ne.SRC_COLOR;if(e===i.OneMinusSrcColorFactor)return Ne.ONE_MINUS_SRC_COLOR;if(e===i.SrcAlphaFactor)return Ne.SRC_ALPHA;if(e===i.OneMinusSrcAlphaFactor)return Ne.ONE_MINUS_SRC_ALPHA;if(e===i.DstAlphaFactor)return Ne.DST_ALPHA;if(e===i.OneMinusDstAlphaFactor)return Ne.ONE_MINUS_DST_ALPHA;if(e===i.DstColorFactor)return Ne.DST_COLOR;if(e===i.OneMinusDstColorFactor)return Ne.ONE_MINUS_DST_COLOR;if(e===i.SrcAlphaSaturateFactor)return Ne.SRC_ALPHA_SATURATE;if(t=xt.get("WEBGL_compressed_texture_s3tc"),null!==t){if(e===i.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===i.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t=xt.get("WEBGL_compressed_texture_pvrtc"),null!==t){if(e===i.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===i.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===i.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===i.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t=xt.get("EXT_blend_minmax"),null!==t){if(e===i.MinEquation)return t.MIN_EXT;if(e===i.MaxEquation)return t.MAX_EXT}return 0}function de(e){if(Ct&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=Ne.getParameter(Ne.MAX_VERTEX_UNIFORM_VECTORS),n=Math.floor((t-20)/4),r=n;return void 0!==e&&e instanceof i.SkinnedMesh&&(r=Math.min(e.skeleton.bones.length,r),r<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function fe(e){for(var t=0,n=0,r=0,o=0,s=0,a=e.length;a>s;s++){var l=e[s];l.onlyShadow||l.visible===!1||(l instanceof i.DirectionalLight&&t++,l instanceof i.PointLight&&n++,l instanceof i.SpotLight&&r++,l instanceof i.HemisphereLight&&o++)}return{directional:t,point:n,spot:r,hemi:o}}function me(e){for(var t=0,n=0,r=e.length;r>n;n++){var o=e[n];o.castShadow&&(o instanceof i.SpotLight&&t++,o instanceof i.DirectionalLight&&!o.shadowCascade&&t++)}return t}console.log("THREE.WebGLRenderer",i.REVISION),e=e||{};var ve=void 0!==e.canvas?e.canvas:document.createElement("canvas"),ye=void 0!==e.context?e.context:null,ge=1,xe=void 0!==e.precision?e.precision:"highp",be=void 0!==e.alpha?e.alpha:!1,_e=void 0!==e.depth?e.depth:!0,we=void 0!==e.stencil?e.stencil:!0,Se=void 0!==e.antialias?e.antialias:!1,Me=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Te=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Ee=void 0!==e.logarithmicDepthBuffer?e.logarithmicDepthBuffer:!1,Ce=new i.Color(0),Ae=0,Pe=[],Fe={},Le=[],Re=[],Be=[],ke=[],De=[];this.domElement=ve,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=i.PCFShadowMap,this.shadowMapCullFace=i.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Ne,Oe=this,Ve=[],ze=null,Ue=null,Ie=-1,je="",Ge=null,qe=0,He=-1,We=-1,Xe=-1,Ye=-1,Qe=-1,Ke=-1,Ze=-1,$e=-1,Je=null,et=null,tt=null,nt=null,it=0,rt=0,ot=ve.width,st=ve.height,at=0,lt=0,ht=new Uint8Array(16),ut=new Uint8Array(16),ct=new i.Frustum,pt=new i.Matrix4,dt=(new i.Matrix4,new i.Vector3),ft=new i.Vector3,mt=!0,vt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var yt={alpha:be,depth:_e,stencil:we,antialias:Se,premultipliedAlpha:Me,preserveDrawingBuffer:Te};if(Ne=ye||ve.getContext("webgl",yt)||ve.getContext("experimental-webgl",yt),null===Ne)throw null!==ve.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";ve.addEventListener("webglcontextlost",function(e){e.preventDefault(),_t(),bt(),Fe={}},!1)}catch(gt){console.error(gt)}void 0===Ne.getShaderPrecisionFormat&&(Ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var xt=new i.WebGLExtensions(Ne);xt.get("OES_texture_float"),xt.get("OES_texture_float_linear"),xt.get("OES_standard_derivatives"),Ee&&xt.get("EXT_frag_depth");var bt=function(){Ne.clearColor(0,0,0,1),Ne.clearDepth(1),Ne.clearStencil(0),Ne.enable(Ne.DEPTH_TEST),Ne.depthFunc(Ne.LEQUAL),Ne.frontFace(Ne.CCW),Ne.cullFace(Ne.BACK),Ne.enable(Ne.CULL_FACE),Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA),Ne.viewport(it,rt,ot,st),Ne.clearColor(Ce.r,Ce.g,Ce.b,Ae)},_t=function(){ze=null,Ge=null,Xe=-1,Ze=-1,$e=-1,He=-1,We=-1,je="",Ie=-1,mt=!0;for(var e=0;e<ut.length;e++)ut[e]=0};bt(),this.context=Ne;var wt=Ne.getParameter(Ne.MAX_TEXTURE_IMAGE_UNITS),St=Ne.getParameter(Ne.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Mt=Ne.getParameter(Ne.MAX_TEXTURE_SIZE),Tt=Ne.getParameter(Ne.MAX_CUBE_MAP_TEXTURE_SIZE),Et=St>0,Ct=Et&&xt.get("OES_texture_float"),At=Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.HIGH_FLOAT),Pt=Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.MEDIUM_FLOAT),Ft=(Ne.getShaderPrecisionFormat(Ne.VERTEX_SHADER,Ne.LOW_FLOAT),Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.HIGH_FLOAT)),Lt=Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.MEDIUM_FLOAT),Rt=(Ne.getShaderPrecisionFormat(Ne.FRAGMENT_SHADER,Ne.LOW_FLOAT),function(){var e;return function(){if(void 0!==e)return e;if(e=[],xt.get("WEBGL_compressed_texture_pvrtc")||xt.get("WEBGL_compressed_texture_s3tc"))for(var t=Ne.getParameter(Ne.COMPRESSED_TEXTURE_FORMATS),n=0;n<t.length;n++)e.push(t[n]);return e}}()),Bt=At.precision>0&&Ft.precision>0,kt=Pt.precision>0&&Lt.precision>0;"highp"!==xe||Bt||(kt?(xe="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(xe="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==xe||kt||(xe="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var Dt=new i.ShadowMapPlugin(this,Pe,Fe,Le),Nt=new i.SpritePlugin(this,ke),Ot=new i.LensFlarePlugin(this,De);this.getContext=function(){return Ne},this.forceContextLoss=function(){xt.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return Et},this.supportsFloatTextures=function(){return xt.get("OES_texture_float")},this.supportsStandardDerivatives=function(){return xt.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return xt.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return xt.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return xt.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=xt.get("EXT_texture_filter_anisotropic");return e=null!==t?Ne.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return xe},this.getPixelRatio=function(){return ge},this.setPixelRatio=function(e){ge=e},this.setSize=function(e,t,n){ve.width=e*ge,ve.height=t*ge,n!==!1&&(ve.style.width=e+"px",ve.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,i){it=e*ge,rt=t*ge,ot=n*ge,st=i*ge,Ne.viewport(it,rt,ot,st)},this.setScissor=function(e,t,n,i){Ne.scissor(e*ge,t*ge,n*ge,i*ge)},this.enableScissorTest=function(e){e?Ne.enable(Ne.SCISSOR_TEST):Ne.disable(Ne.SCISSOR_TEST)},this.getClearColor=function(){return Ce},this.setClearColor=function(e,t){Ce.set(e),Ae=void 0!==t?t:1,Ne.clearColor(Ce.r,Ce.g,Ce.b,Ae)},this.getClearAlpha=function(){return Ae},this.setClearAlpha=function(e){Ae=e,Ne.clearColor(Ce.r,Ce.g,Ce.b,Ae)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=Ne.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Ne.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=Ne.STENCIL_BUFFER_BIT),Ne.clear(i)},this.clearColor=function(){Ne.clear(Ne.COLOR_BUFFER_BIT)},this.clearDepth=function(){Ne.clear(Ne.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Ne.clear(Ne.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,i){this.setRenderTarget(e),this.clear(t,n,i)},this.resetGLState=_t;var Vt=function(e){var t=e.target;t.traverse(function(e){e.removeEventListener("remove",Vt),D(e)})},zt=function(e){var t=e.target;t.removeEventListener("dispose",zt),qt(t)},Ut=function(e){var t=e.target;t.removeEventListener("dispose",Ut),Ht(t),Oe.info.memory.textures--},It=function(e){var t=e.target;t.removeEventListener("dispose",It),Wt(t),Oe.info.memory.textures--},jt=function(e){var t=e.target;t.removeEventListener("dispose",jt),Xt(t)},Gt=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],n=0,i=t.length;i>n;n++){var r=t[n];void 0!==e[r]&&(Ne.deleteBuffer(e[r]),delete e[r])}if(void 0!==e.__webglCustomAttributesList){for(var r in e.__webglCustomAttributesList)Ne.deleteBuffer(e.__webglCustomAttributesList[r].buffer);delete e.__webglCustomAttributesList}Oe.info.memory.geometries--},qt=function(e){if(delete e.__webglInit,e instanceof i.BufferGeometry){for(var t in e.attributes){var n=e.attributes[t];void 0!==n.buffer&&(Ne.deleteBuffer(n.buffer),delete n.buffer)}Oe.info.memory.geometries--}else{var r=Yt[e.id];if(void 0!==r){for(var o=0,s=r.length;s>o;o++){var a=r[o];if(void 0!==a.numMorphTargets){for(var l=0,h=a.numMorphTargets;h>l;l++)Ne.deleteBuffer(a.__webglMorphTargetsBuffers[l]);delete a.__webglMorphTargetsBuffers}if(void 0!==a.numMorphNormals){for(var l=0,h=a.numMorphNormals;h>l;l++)Ne.deleteBuffer(a.__webglMorphNormalsBuffers[l]);delete a.__webglMorphNormalsBuffers}Gt(a)}delete Yt[e.id]}else Gt(e)}je=""},Ht=function(e){if(e.image&&e.image.__webglTextureCube)Ne.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;Ne.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},Wt=function(e){if(e&&void 0!==e.__webglTexture){if(Ne.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof i.WebGLRenderTargetCube)for(var t=0;6>t;t++)Ne.deleteFramebuffer(e.__webglFramebuffer[t]),Ne.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Ne.deleteFramebuffer(e.__webglFramebuffer),Ne.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Xt=function(e){var t=e.program.program;if(void 0!==t){e.program=void 0;var n,i,r,o=!1;for(n=0,i=Ve.length;i>n;n++)if(r=Ve[n],r.program===t){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(o===!0){var s=[];for(n=0,i=Ve.length;i>n;n++)r=Ve[n],r.program!==t&&s.push(r);Ve=s,Ne.deleteProgram(t),Oe.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,n){if(m(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Ne.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Ne.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Ne.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Ne.createBuffer()),e.hasPositions&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglVertexBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,e.positionArray,Ne.DYNAMIC_DRAW),v(t.attributes.position),Ne.vertexAttribPointer(t.attributes.position,3,Ne.FLOAT,!1,0,0)),e.hasNormals){if(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglNormalBuffer),n.shading===i.FlatShading){var r,o,s,a,l,h,u,c,p,d,f,g,x,b,_=3*e.count;for(b=0;_>b;b+=9)x=e.normalArray,a=x[b],u=x[b+1],d=x[b+2],l=x[b+3],c=x[b+4],f=x[b+5],h=x[b+6],p=x[b+7],g=x[b+8],r=(a+l+h)/3,o=(u+c+p)/3,s=(d+f+g)/3,x[b]=r,x[b+1]=o,x[b+2]=s,x[b+3]=r,x[b+4]=o,x[b+5]=s,x[b+6]=r,x[b+7]=o,x[b+8]=s}Ne.bufferData(Ne.ARRAY_BUFFER,e.normalArray,Ne.DYNAMIC_DRAW),v(t.attributes.normal),Ne.vertexAttribPointer(t.attributes.normal,3,Ne.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglUvBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,e.uvArray,Ne.DYNAMIC_DRAW),v(t.attributes.uv),Ne.vertexAttribPointer(t.attributes.uv,2,Ne.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==i.NoColors&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,e.__webglColorBuffer),Ne.bufferData(Ne.ARRAY_BUFFER,e.colorArray,Ne.DYNAMIC_DRAW),v(t.attributes.color),Ne.vertexAttribPointer(t.attributes.color,3,Ne.FLOAT,!1,0,0)),y(),Ne.drawArrays(Ne.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,o,s){if(r.visible!==!1){R(s);var a=V(e,t,n,r,s),l=!1,h=r.wireframe?1:0,u="direct_"+o.id+"_"+a.id+"_"+h;if(u!==je&&(je=u,l=!0),l&&m(),s instanceof i.Mesh){var c=r.wireframe===!0?Ne.LINES:Ne.TRIANGLES,p=o.attributes.index;if(p){var d,v;p.array instanceof Uint32Array&&xt.get("OES_element_index_uint")?(d=Ne.UNSIGNED_INT,v=4):(d=Ne.UNSIGNED_SHORT,v=2);var y=o.offsets;if(0===y.length)l&&(f(r,a,o,0),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,p.buffer)),Ne.drawElements(c,p.array.length,d,0),Oe.info.render.calls++,Oe.info.render.vertices+=p.array.length,Oe.info.render.faces+=p.array.length/3;else{l=!0;for(var g=0,x=y.length;x>g;g++){var b=y[g].index;l&&(f(r,a,o,b),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,p.buffer)),Ne.drawElements(c,y[g].count,d,y[g].start*v),Oe.info.render.calls++,Oe.info.render.vertices+=y[g].count,Oe.info.render.faces+=y[g].count/3}}}else{l&&f(r,a,o,0);var _=o.attributes.position;Ne.drawArrays(c,0,_.array.length/3),Oe.info.render.calls++,Oe.info.render.vertices+=_.array.length/3,Oe.info.render.faces+=_.array.length/9}}else if(s instanceof i.PointCloud){var c=Ne.POINTS,p=o.attributes.index;if(p){var d,v;p.array instanceof Uint32Array&&xt.get("OES_element_index_uint")?(d=Ne.UNSIGNED_INT,v=4):(d=Ne.UNSIGNED_SHORT,v=2);var y=o.offsets;if(0===y.length)l&&(f(r,a,o,0),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,p.buffer)),Ne.drawElements(c,p.array.length,d,0),Oe.info.render.calls++,Oe.info.render.points+=p.array.length;else{y.length>1&&(l=!0);for(var g=0,x=y.length;x>g;g++){var b=y[g].index;l&&(f(r,a,o,b),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,p.buffer)),Ne.drawElements(c,y[g].count,d,y[g].start*v),Oe.info.render.calls++,Oe.info.render.points+=y[g].count}}}else{l&&f(r,a,o,0);var _=o.attributes.position,y=o.offsets;if(0===y.length)Ne.drawArrays(c,0,_.array.length/3),Oe.info.render.calls++,Oe.info.render.points+=_.array.length/3;else for(var g=0,x=y.length;x>g;g++)Ne.drawArrays(c,y[g].index,y[g].count),Oe.info.render.calls++,Oe.info.render.points+=y[g].count}}else if(s instanceof i.Line){var c=s.mode===i.LineStrip?Ne.LINE_STRIP:Ne.LINES;ne(r.linewidth);var p=o.attributes.index;if(p){var d,v;p.array instanceof Uint32Array?(d=Ne.UNSIGNED_INT,v=4):(d=Ne.UNSIGNED_SHORT,v=2);var y=o.offsets;if(0===y.length)l&&(f(r,a,o,0),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,p.buffer)),Ne.drawElements(c,p.array.length,d,0),Oe.info.render.calls++,Oe.info.render.vertices+=p.array.length;else{y.length>1&&(l=!0);for(var g=0,x=y.length;x>g;g++){var b=y[g].index;l&&(f(r,a,o,b),Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,p.buffer)),Ne.drawElements(c,y[g].count,d,y[g].start*v),Oe.info.render.calls++,Oe.info.render.vertices+=y[g].count}}}else{l&&f(r,a,o,0);var _=o.attributes.position,y=o.offsets;if(0===y.length)Ne.drawArrays(c,0,_.array.length/3),Oe.info.render.calls++,Oe.info.render.vertices+=_.array.length/3;else for(var g=0,x=y.length;x>g;g++)Ne.drawArrays(c,y[g].index,y[g].count),Oe.info.render.calls++,Oe.info.render.vertices+=y[g].count}}}},this.renderBuffer=function(e,t,n,r,o,s){if(r.visible!==!1){R(s);var a=V(e,t,n,r,s),l=a.attributes,h=!1,u=r.wireframe?1:0,c=o.id+"_"+a.id+"_"+u;if(c!==je&&(je=c,h=!0),h&&m(),!r.morphTargets&&l.position>=0?h&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglVertexBuffer),v(l.position),Ne.vertexAttribPointer(l.position,3,Ne.FLOAT,!1,0,0)):s.morphTargetBase&&g(r,o,s),h){if(o.__webglCustomAttributesList)for(var p=0,d=o.__webglCustomAttributesList.length;d>p;p++){var f=o.__webglCustomAttributesList[p];l[f.buffer.belongsToAttribute]>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,f.buffer),v(l[f.buffer.belongsToAttribute]),Ne.vertexAttribPointer(l[f.buffer.belongsToAttribute],f.size,Ne.FLOAT,!1,0,0))}l.color>=0&&(s.geometry.colors.length>0||s.geometry.faces.length>0?(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglColorBuffer),v(l.color),Ne.vertexAttribPointer(l.color,3,Ne.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&Ne.vertexAttrib3fv(l.color,r.defaultAttributeValues.color)),l.normal>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglNormalBuffer),v(l.normal),Ne.vertexAttribPointer(l.normal,3,Ne.FLOAT,!1,0,0)),l.tangent>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglTangentBuffer),v(l.tangent),Ne.vertexAttribPointer(l.tangent,4,Ne.FLOAT,!1,0,0)),l.uv>=0&&(s.geometry.faceVertexUvs[0]?(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglUVBuffer),v(l.uv),Ne.vertexAttribPointer(l.uv,2,Ne.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&Ne.vertexAttrib2fv(l.uv,r.defaultAttributeValues.uv)),l.uv2>=0&&(s.geometry.faceVertexUvs[1]?(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglUV2Buffer),v(l.uv2),Ne.vertexAttribPointer(l.uv2,2,Ne.FLOAT,!1,0,0)):void 0!==r.defaultAttributeValues&&Ne.vertexAttrib2fv(l.uv2,r.defaultAttributeValues.uv2)),r.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),v(l.skinIndex),Ne.vertexAttribPointer(l.skinIndex,4,Ne.FLOAT,!1,0,0),Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),v(l.skinWeight),Ne.vertexAttribPointer(l.skinWeight,4,Ne.FLOAT,!1,0,0)),l.lineDistance>=0&&(Ne.bindBuffer(Ne.ARRAY_BUFFER,o.__webglLineDistanceBuffer),v(l.lineDistance),Ne.vertexAttribPointer(l.lineDistance,1,Ne.FLOAT,!1,0,0))}if(y(),s instanceof i.Mesh){var x=o.__typeArray===Uint32Array?Ne.UNSIGNED_INT:Ne.UNSIGNED_SHORT;r.wireframe?(ne(r.wireframeLinewidth),h&&Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),Ne.drawElements(Ne.LINES,o.__webglLineCount,x,0)):(h&&Ne.bindBuffer(Ne.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),Ne.drawElements(Ne.TRIANGLES,o.__webglFaceCount,x,0)),Oe.info.render.calls++,Oe.info.render.vertices+=o.__webglFaceCount,Oe.info.render.faces+=o.__webglFaceCount/3}else if(s instanceof i.Line){var b=s.mode===i.LineStrip?Ne.LINE_STRIP:Ne.LINES;ne(r.linewidth),Ne.drawArrays(b,0,o.__webglLineCount),Oe.info.render.calls++}else s instanceof i.PointCloud&&(Ne.drawArrays(Ne.POINTS,0,o.__webglParticleCount),Oe.info.render.calls++,Oe.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,n,r){if(t instanceof i.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var o=e.fog;je="",Ie=-1,Ge=null,mt=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse(function(e){e instanceof i.SkinnedMesh&&e.skeleton.update()}),t.matrixWorldInverse.getInverse(t.matrixWorld),pt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ct.setFromMatrix(pt),Pe.length=0,Re.length=0,Be.length=0,ke.length=0,De.length=0,w(e),Oe.sortObjects===!0&&(Re.sort(x),Be.sort(b)),Dt.render(e,t),Oe.info.render.calls=0,Oe.info.render.vertices=0,Oe.info.render.faces=0,Oe.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var s=0,a=Le.length;a>s;s++){var l=Le[s],h=l.object;h.visible&&($(h,t),T(l))}if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),ie(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),S(Re,t,Pe,o,!0,u),S(Be,t,Pe,o,!0,u),M(Le,"",t,Pe,o,!1,u)}else{var u=null;this.setBlending(i.NoBlending),S(Re,t,Pe,o,!1,u),M(Le,"opaque",t,Pe,o,!1,u),S(Be,t,Pe,o,!0,u),M(Le,"transparent",t,Pe,o,!0,u)}Nt.render(e,t),Ot.render(e,t,at,lt),n&&n.generateMipmaps&&n.minFilter!==i.NearestFilter&&n.minFilter!==i.LinearFilter&&ue(n),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,n,i,r){var o=V(e,t,n,i,r);je="",Oe.setMaterialFaces(i),r.immediateRenderCallback?r.immediateRenderCallback(o,Ne,ct):r.render(function(e){Oe.renderBufferImmediate(e,o,i)})};var Yt={},Qt=0,Kt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(e,t){e===i.CullFaceNone?Ne.disable(Ne.CULL_FACE):(Ne.frontFace(t===i.FrontFaceDirectionCW?Ne.CW:Ne.CCW),Ne.cullFace(e===i.CullFaceBack?Ne.BACK:e===i.CullFaceFront?Ne.FRONT:Ne.FRONT_AND_BACK),Ne.enable(Ne.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===i.DoubleSide,n=e.side===i.BackSide;He!==t&&(t?Ne.disable(Ne.CULL_FACE):Ne.enable(Ne.CULL_FACE),He=t),We!==n&&(Ne.frontFace(n?Ne.CW:Ne.CCW),We=n)},this.setDepthTest=function(e){Ze!==e&&(e?Ne.enable(Ne.DEPTH_TEST):Ne.disable(Ne.DEPTH_TEST),Ze=e)},this.setDepthWrite=function(e){$e!==e&&(Ne.depthMask(e),$e=e)},this.setBlending=function(e,t,n,r){e!==Xe&&(e===i.NoBlending?Ne.disable(Ne.BLEND):e===i.AdditiveBlending?(Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.SRC_ALPHA,Ne.ONE)):e===i.SubtractiveBlending?(Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.ZERO,Ne.ONE_MINUS_SRC_COLOR)):e===i.MultiplyBlending?(Ne.enable(Ne.BLEND),Ne.blendEquation(Ne.FUNC_ADD),Ne.blendFunc(Ne.ZERO,Ne.SRC_COLOR)):e===i.CustomBlending?Ne.enable(Ne.BLEND):(Ne.enable(Ne.BLEND),Ne.blendEquationSeparate(Ne.FUNC_ADD,Ne.FUNC_ADD),Ne.blendFuncSeparate(Ne.SRC_ALPHA,Ne.ONE_MINUS_SRC_ALPHA,Ne.ONE,Ne.ONE_MINUS_SRC_ALPHA)),Xe=e),e===i.CustomBlending?(t!==Ye&&(Ne.blendEquation(pe(t)),Ye=t),(n!==Qe||r!==Ke)&&(Ne.blendFunc(pe(n),pe(r)),Qe=n,Ke=r)):(Ye=null,Qe=null,Ke=null)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Ut),e.__webglTexture=Ne.createTexture(),Oe.info.memory.textures++),Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture),Ne.pixelStorei(Ne.UNPACK_FLIP_Y_WEBGL,e.flipY),Ne.pixelStorei(Ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Ne.pixelStorei(Ne.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=oe(e.image,Mt);var t=e.image,n=i.Math.isPowerOfTwo(t.width)&&i.Math.isPowerOfTwo(t.height),r=pe(e.format),o=pe(e.type);re(Ne.TEXTURE_2D,e,n);var s,a=e.mipmaps;if(e instanceof i.DataTexture)if(a.length>0&&n){for(var l=0,h=a.length;h>l;l++)s=a[l],Ne.texImage2D(Ne.TEXTURE_2D,l,r,s.width,s.height,0,r,o,s.data);e.generateMipmaps=!1}else Ne.texImage2D(Ne.TEXTURE_2D,0,r,t.width,t.height,0,r,o,t.data);else if(e instanceof i.CompressedTexture)for(var l=0,h=a.length;h>l;l++)s=a[l],e.format!==i.RGBAFormat&&e.format!==i.RGBFormat?Rt().indexOf(r)>-1?Ne.compressedTexImage2D(Ne.TEXTURE_2D,l,r,s.width,s.height,0,s.data):console.warn("Attempt to load unsupported compressed texture format"):Ne.texImage2D(Ne.TEXTURE_2D,l,r,s.width,s.height,0,r,o,s.data);else if(a.length>0&&n){for(var l=0,h=a.length;h>l;l++)s=a[l],Ne.texImage2D(Ne.TEXTURE_2D,l,r,r,o,s);e.generateMipmaps=!1}else Ne.texImage2D(Ne.TEXTURE_2D,0,r,r,o,e.image);e.generateMipmaps&&n&&Ne.generateMipmap(Ne.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){Ne.activeTexture(Ne.TEXTURE0+t),e.needsUpdate?Oe.uploadTexture(e):Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof i.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",It),e.__webglTexture=Ne.createTexture(),Oe.info.memory.textures++;var n=i.Math.isPowerOfTwo(e.width)&&i.Math.isPowerOfTwo(e.height),r=pe(e.format),o=pe(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,e.__webglTexture),re(Ne.TEXTURE_CUBE_MAP,e,n);for(var s=0;6>s;s++)e.__webglFramebuffer[s]=Ne.createFramebuffer(),e.__webglRenderbuffer[s]=Ne.createRenderbuffer(),Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,o,null),le(e.__webglFramebuffer[s],e,Ne.TEXTURE_CUBE_MAP_POSITIVE_X+s),he(e.__webglRenderbuffer[s],e);n&&Ne.generateMipmap(Ne.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Ne.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Ne.createRenderbuffer(),Ne.bindTexture(Ne.TEXTURE_2D,e.__webglTexture),re(Ne.TEXTURE_2D,e,n),Ne.texImage2D(Ne.TEXTURE_2D,0,r,e.width,e.height,0,r,o,null),le(e.__webglFramebuffer,e,Ne.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_ATTACHMENT,Ne.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Ne.framebufferRenderbuffer(Ne.FRAMEBUFFER,Ne.DEPTH_STENCIL_ATTACHMENT,Ne.RENDERBUFFER,e.__webglRenderbuffer):he(e.__webglRenderbuffer,e),n&&Ne.generateMipmap(Ne.TEXTURE_2D);t?Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,null):Ne.bindTexture(Ne.TEXTURE_2D,null),Ne.bindRenderbuffer(Ne.RENDERBUFFER,null),Ne.bindFramebuffer(Ne.FRAMEBUFFER,null)}var a,l,h,u,c;e?(a=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,l=e.width,h=e.height,u=0,c=0):(a=null,l=ot,h=st,u=it,c=rt),a!==Ue&&(Ne.bindFramebuffer(Ne.FRAMEBUFFER,a),Ne.viewport(u,c,l,h),Ue=a),at=l,lt=h},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},i.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:i.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:i.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:i.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:i.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new i.Vector2(0,0),this.repeat=new i.Vector2(1,1),this.format=void 0!==n.format?n.format:i.RGBAFormat,this.type=void 0!==n.type?n.type:i.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},i.WebGLRenderTarget.prototype={constructor:i.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new i.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,
e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},i.EventDispatcher.prototype.apply(i.WebGLRenderTarget.prototype),i.WebGLRenderTargetCube=function(e,t,n){i.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},i.WebGLRenderTargetCube.prototype=Object.create(i.WebGLRenderTarget.prototype),i.WebGLRenderTargetCube.prototype.constructor=i.WebGLRenderTargetCube,i.WebGLExtensions=function(e){var t={};this.get=function(n){if(void 0!==t[n])return t[n];var i;switch(n){case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return null===i&&console.log("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}},i.WebGLProgram=function(){var e=0,t=function(e){var t,n,i=[];for(var r in e)t=e[r],t!==!1&&(n="#define "+r+" "+t,i.push(n));return i.join("\n")},n=function(e,t,n){for(var i={},r=0,o=n.length;o>r;r++){var s=n[r];i[s]=e.getUniformLocation(t,s)}return i},r=function(e,t,n){for(var i={},r=0,o=n.length;o>r;r++){var s=n[r];i[s]=e.getAttribLocation(t,s)}return i};return function(o,s,a,l){var h=o,u=h.context,c=a.defines,p=a.__webglShader.uniforms,d=a.attributes,f=a.__webglShader.vertexShader,m=a.__webglShader.fragmentShader,v=a.index0AttributeName;void 0===v&&l.morphTargets===!0&&(v="position");var y="SHADOWMAP_TYPE_BASIC";l.shadowMapType===i.PCFShadowMap?y="SHADOWMAP_TYPE_PCF":l.shadowMapType===i.PCFSoftShadowMap&&(y="SHADOWMAP_TYPE_PCF_SOFT");var g="ENVMAP_TYPE_CUBE",x="ENVMAP_MODE_REFLECTION",b="ENVMAP_BLENDING_MULTIPLY";if(l.envMap){switch(a.envMap.mapping){case i.CubeReflectionMapping:case i.CubeRefractionMapping:g="ENVMAP_TYPE_CUBE";break;case i.EquirectangularReflectionMapping:case i.EquirectangularRefractionMapping:g="ENVMAP_TYPE_EQUIREC";break;case i.SphericalReflectionMapping:g="ENVMAP_TYPE_SPHERE"}switch(a.envMap.mapping){case i.CubeRefractionMapping:case i.EquirectangularRefractionMapping:x="ENVMAP_MODE_REFRACTION"}switch(a.combine){case i.MultiplyOperation:b="ENVMAP_BLENDING_MULTIPLY";break;case i.MixOperation:b="ENVMAP_BLENDING_MIX";break;case i.AddOperation:b="ENVMAP_BLENDING_ADD"}}var _,w,S=t(c),M=u.createProgram();a instanceof i.RawShaderMaterial?(_="",w=""):(_=["precision "+l.precision+" float;","precision "+l.precision+" int;",S,l.supportsVertexTextures?"#define VERTEX_TEXTURES":"",h.gammaInput?"#define GAMMA_INPUT":"",h.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,"#define MAX_BONES "+l.maxBones,l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+x:"",l.lightMap?"#define USE_LIGHTMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals?"#define USE_MORPHNORMALS":"",l.wrapAround?"#define WRAP_AROUND":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+y:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n"),w=["precision "+l.precision+" float;","precision "+l.precision+" int;",l.bumpMap||l.normalMap?"#extension GL_OES_standard_derivatives : enable":"",S,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,l.alphaTest?"#define ALPHATEST "+l.alphaTest:"",h.gammaInput?"#define GAMMA_INPUT":"",h.gammaOutput?"#define GAMMA_OUTPUT":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+g:"",l.envMap?"#define "+x:"",l.envMap?"#define "+b:"",l.lightMap?"#define USE_LIGHTMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.metal?"#define METAL":"",l.wrapAround?"#define WRAP_AROUND":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+y:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var T=new i.WebGLShader(u,u.VERTEX_SHADER,_+f),E=new i.WebGLShader(u,u.FRAGMENT_SHADER,w+m);u.attachShader(M,T),u.attachShader(M,E),void 0!==v&&u.bindAttribLocation(M,0,v),u.linkProgram(M),u.getProgramParameter(M,u.LINK_STATUS)===!1&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",u.getProgramParameter(M,u.VALIDATE_STATUS)),console.error("gl.getError()",u.getError())),""!==u.getProgramInfoLog(M)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",u.getProgramInfoLog(M)),u.deleteShader(T),u.deleteShader(E);var C=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];l.useVertexTexture?(C.push("boneTexture"),C.push("boneTextureWidth"),C.push("boneTextureHeight")):C.push("boneGlobalMatrices"),l.logarithmicDepthBuffer&&C.push("logDepthBufFC");for(var A in p)C.push(A);this.uniforms=n(u,M,C),C=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var P=0;P<l.maxMorphTargets;P++)C.push("morphTarget"+P);for(var P=0;P<l.maxMorphNormals;P++)C.push("morphNormal"+P);for(var F in d)C.push(F);return this.attributes=r(u,M,C),this.attributesKeys=Object.keys(this.attributes),this.id=e++,this.code=s,this.usedTimes=1,this.program=M,this.vertexShader=T,this.fragmentShader=E,this}}(),i.WebGLShader=function(){var e=function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")};return function(t,n,i){var r=t.createShader(n);return t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(r)&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t.getShaderInfoLog(r)),console.warn(e(i))),r}}(),i.LensFlarePlugin=function(e,t){function n(t){var n=p.createProgram(),i=p.createShader(p.FRAGMENT_SHADER),r=p.createShader(p.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return p.shaderSource(i,o+t.fragmentShader),p.shaderSource(r,o+t.vertexShader),p.compileShader(i),p.compileShader(r),p.attachShader(n,i),p.attachShader(n,r),p.linkProgram(n),n}var r,o,s,a,l,h,u,c,p=e.context,d=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);r=p.createBuffer(),o=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,r),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.bufferData(p.ELEMENT_ARRAY_BUFFER,t,p.STATIC_DRAW),u=p.createTexture(),c=p.createTexture(),p.bindTexture(p.TEXTURE_2D,u),p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.bindTexture(p.TEXTURE_2D,c),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),h=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var i;i=h?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},s=n(i),a={vertex:p.getAttribLocation(s,"position"),uv:p.getAttribLocation(s,"uv")},l={renderType:p.getUniformLocation(s,"renderType"),map:p.getUniformLocation(s,"map"),occlusionMap:p.getUniformLocation(s,"occlusionMap"),opacity:p.getUniformLocation(s,"opacity"),color:p.getUniformLocation(s,"color"),scale:p.getUniformLocation(s,"scale"),rotation:p.getUniformLocation(s,"rotation"),screenPosition:p.getUniformLocation(s,"screenPosition")}};this.render=function(n,f,m,v){if(0!==t.length){var y=new i.Vector3,g=v/m,x=.5*m,b=.5*v,_=16/v,w=new i.Vector2(_*g,_),S=new i.Vector3(1,1,0),M=new i.Vector2(1,1);void 0===s&&d(),p.useProgram(s),p.enableVertexAttribArray(a.vertex),p.enableVertexAttribArray(a.uv),p.uniform1i(l.occlusionMap,0),p.uniform1i(l.map,1),p.bindBuffer(p.ARRAY_BUFFER,r),p.vertexAttribPointer(a.vertex,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(a.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.disable(p.CULL_FACE),p.depthMask(!1);for(var T=0,E=t.length;E>T;T++){_=16/v,w.set(_*g,_);var C=t[T];if(y.set(C.matrixWorld.elements[12],C.matrixWorld.elements[13],C.matrixWorld.elements[14]),y.applyMatrix4(f.matrixWorldInverse),y.applyProjection(f.projectionMatrix),S.copy(y),M.x=S.x*x+x,M.y=S.y*b+b,h||M.x>0&&M.x<m&&M.y>0&&M.y<v){p.activeTexture(p.TEXTURE1),p.bindTexture(p.TEXTURE_2D,u),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,M.x-8,M.y-8,16,16,0),p.uniform1i(l.renderType,0),p.uniform2f(l.scale,w.x,w.y),p.uniform3f(l.screenPosition,S.x,S.y,S.z),p.disable(p.BLEND),p.enable(p.DEPTH_TEST),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,c),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,M.x-8,M.y-8,16,16,0),p.uniform1i(l.renderType,1),p.disable(p.DEPTH_TEST),p.activeTexture(p.TEXTURE1),p.bindTexture(p.TEXTURE_2D,u),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),C.positionScreen.copy(S),C.customUpdateCallback?C.customUpdateCallback(C):C.updateLensFlares(),p.uniform1i(l.renderType,2),p.enable(p.BLEND);for(var A=0,P=C.lensFlares.length;P>A;A++){var F=C.lensFlares[A];F.opacity>.001&&F.scale>.001&&(S.x=F.x,S.y=F.y,S.z=F.z,_=F.size*F.scale/v,w.x=_*g,w.y=_,p.uniform3f(l.screenPosition,S.x,S.y,S.z),p.uniform2f(l.scale,w.x,w.y),p.uniform1f(l.rotation,F.rotation),p.uniform1f(l.opacity,F.opacity),p.uniform3f(l.color,F.color.r,F.color.g,F.color.b),e.setBlending(F.blending,F.blendEquation,F.blendSrc,F.blendDst),e.setTexture(F.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}}p.enable(p.CULL_FACE),p.enable(p.DEPTH_TEST),p.depthMask(!0),e.resetGLState()}}},i.ShadowMapPlugin=function(e,t,n,r){function o(e,t,i){if(t.visible){var r=n[t.id];if(r&&t.castShadow&&(t.frustumCulled===!1||m.intersectsObject(t)===!0))for(var s=0,a=r.length;a>s;s++){var l=r[s];t._modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),b.push(l)}for(var s=0,a=t.children.length;a>s;s++)o(e,t.children[s],i)}}function s(e,t){var n=new i.DirectionalLight;n.isVirtual=!0,n.onlyShadow=!0,n.castShadow=!0,n.shadowCameraNear=e.shadowCameraNear,n.shadowCameraFar=e.shadowCameraFar,n.shadowCameraLeft=e.shadowCameraLeft,n.shadowCameraRight=e.shadowCameraRight,n.shadowCameraBottom=e.shadowCameraBottom,n.shadowCameraTop=e.shadowCameraTop,n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t],n.shadowMapWidth=e.shadowCascadeWidth[t],n.shadowMapHeight=e.shadowCascadeHeight[t],n.pointsWorld=[],n.pointsFrustum=[];for(var r=n.pointsWorld,o=n.pointsFrustum,s=0;8>s;s++)r[s]=new i.Vector3,o[s]=new i.Vector3;var a=e.shadowCascadeNearZ[t],l=e.shadowCascadeFarZ[t];return o[0].set(-1,-1,a),o[1].set(1,-1,a),o[2].set(-1,1,a),o[3].set(1,1,a),o[4].set(-1,-1,l),o[5].set(1,-1,l),o[6].set(-1,1,l),o[7].set(1,1,l),n}function a(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position),n.target.position.copy(e.target.position),n.lookAt(n.target),n.shadowCameraVisible=e.shadowCameraVisible,n.shadowDarkness=e.shadowDarkness,n.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],r=e.shadowCascadeFarZ[t],o=n.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=r,o[5].z=r,o[6].z=r,o[7].z=r}function l(e,t){var n=t.shadowCamera,i=t.pointsFrustum,r=t.pointsWorld;y.set(1/0,1/0,1/0),g.set(-(1/0),-(1/0),-(1/0));for(var o=0;8>o;o++){var s=r[o];s.copy(i[o]),s.unproject(e),s.applyMatrix4(n.matrixWorldInverse),s.x<y.x&&(y.x=s.x),s.x>g.x&&(g.x=s.x),s.y<y.y&&(y.y=s.y),s.y>g.y&&(g.y=s.y),s.z<y.z&&(y.z=s.z),s.z>g.z&&(g.z=s.z)}n.left=y.x,n.right=g.x,n.top=g.y,n.bottom=y.y,n.updateProjectionMatrix()}function h(e){return e.material instanceof i.MeshFaceMaterial?e.material.materials[0]:e.material}var u,c,p,d,f=e.context,m=new i.Frustum,v=new i.Matrix4,y=new i.Vector3,g=new i.Vector3,x=new i.Vector3,b=[],_=i.ShaderLib.depthRGBA,w=i.UniformsUtils.clone(_.uniforms);u=new i.ShaderMaterial({uniforms:w,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader}),c=new i.ShaderMaterial({uniforms:w,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,morphTargets:!0}),p=new i.ShaderMaterial({uniforms:w,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,skinning:!0}),d=new i.ShaderMaterial({uniforms:w,vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,morphTargets:!0,skinning:!0}),u._shadowPass=!0,c._shadowPass=!0,p._shadowPass=!0,d._shadowPass=!0,this.render=function(n,y){if(e.shadowMapEnabled!==!1){var g,_,w,S,M,T,E,C,A,P,F,L,R,B=[],k=0,D=null;for(f.clearColor(1,1,1,1),f.disable(f.BLEND),f.enable(f.CULL_FACE),f.frontFace(f.CCW),f.cullFace(e.shadowMapCullFace===i.CullFaceFront?f.FRONT:f.BACK),e.setDepthTest(!0),g=0,_=t.length;_>g;g++)if(R=t[g],R.castShadow)if(R instanceof i.DirectionalLight&&R.shadowCascade)for(M=0;M<R.shadowCascadeCount;M++){var N;if(R.shadowCascadeArray[M])N=R.shadowCascadeArray[M];else{N=s(R,M),N.originalCamera=y;var O=new i.Gyroscope;O.position.copy(R.shadowCascadeOffset),O.add(N),O.add(N.target),y.add(O),R.shadowCascadeArray[M]=N,console.log("Created virtualLight",N)}a(R,M),B[k]=N,k++}else B[k]=R,k++;for(g=0,_=B.length;_>g;g++){if(R=B[g],!R.shadowMap){var V=i.LinearFilter;e.shadowMapType===i.PCFSoftShadowMap&&(V=i.NearestFilter);var z={minFilter:V,magFilter:V,format:i.RGBAFormat};R.shadowMap=new i.WebGLRenderTarget(R.shadowMapWidth,R.shadowMapHeight,z),R.shadowMapSize=new i.Vector2(R.shadowMapWidth,R.shadowMapHeight),R.shadowMatrix=new i.Matrix4}if(!R.shadowCamera){if(R instanceof i.SpotLight)R.shadowCamera=new i.PerspectiveCamera(R.shadowCameraFov,R.shadowMapWidth/R.shadowMapHeight,R.shadowCameraNear,R.shadowCameraFar);else{if(!(R instanceof i.DirectionalLight)){console.error("Unsupported light type for shadow");continue}R.shadowCamera=new i.OrthographicCamera(R.shadowCameraLeft,R.shadowCameraRight,R.shadowCameraTop,R.shadowCameraBottom,R.shadowCameraNear,R.shadowCameraFar)}n.add(R.shadowCamera),n.autoUpdate===!0&&n.updateMatrixWorld()}R.shadowCameraVisible&&!R.cameraHelper&&(R.cameraHelper=new i.CameraHelper(R.shadowCamera),n.add(R.cameraHelper)),R.isVirtual&&N.originalCamera==y&&l(y,R),T=R.shadowMap,E=R.shadowMatrix,C=R.shadowCamera,C.position.setFromMatrixPosition(R.matrixWorld),x.setFromMatrixPosition(R.target.matrixWorld),C.lookAt(x),C.updateMatrixWorld(),C.matrixWorldInverse.getInverse(C.matrixWorld),R.cameraHelper&&(R.cameraHelper.visible=R.shadowCameraVisible),R.shadowCameraVisible&&R.cameraHelper.update(),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(C.projectionMatrix),E.multiply(C.matrixWorldInverse),v.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse),m.setFromMatrix(v),e.setRenderTarget(T),e.clear(),b.length=0,o(n,n,C);var U,I,j;for(w=0,S=b.length;S>w;w++)F=b[w],L=F.object,A=F.buffer,U=h(L),I=void 0!==L.geometry.morphTargets&&L.geometry.morphTargets.length>0&&U.morphTargets,j=L instanceof i.SkinnedMesh&&U.skinning,P=L.customDepthMaterial?L.customDepthMaterial:j?I?d:p:I?c:u,e.setMaterialFaces(U),A instanceof i.BufferGeometry?e.renderBufferDirect(C,t,D,P,A,L):e.renderBuffer(C,t,D,P,A,L);for(w=0,S=r.length;S>w;w++)F=r[w],L=F.object,L.visible&&L.castShadow&&(L._modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,L.matrixWorld),e.renderImmediateObject(C,t,D,u,L))}var G=e.getClearColor(),q=e.getClearAlpha();f.clearColor(G.r,G.g,G.b,q),f.enable(f.BLEND),e.shadowMapCullFace===i.CullFaceFront&&f.cullFace(f.BACK),e.resetGLState()}}},i.SpritePlugin=function(e,t){function n(){var t=c.createProgram(),n=c.createShader(c.VERTEX_SHADER),i=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(n,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),c.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),c.compileShader(n),c.compileShader(i),c.attachShader(t,n),c.attachShader(t,i),c.linkProgram(t),t}function r(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var o,s,a,l,h,u,c=e.context,p=new i.Vector3,d=new i.Quaternion,f=new i.Vector3,m=function(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);o=c.createBuffer(),s=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,o),c.bufferData(c.ARRAY_BUFFER,e,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),c.bufferData(c.ELEMENT_ARRAY_BUFFER,t,c.STATIC_DRAW),a=n(),l={position:c.getAttribLocation(a,"position"),uv:c.getAttribLocation(a,"uv")},h={uvOffset:c.getUniformLocation(a,"uvOffset"),uvScale:c.getUniformLocation(a,"uvScale"),rotation:c.getUniformLocation(a,"rotation"),scale:c.getUniformLocation(a,"scale"),color:c.getUniformLocation(a,"color"),map:c.getUniformLocation(a,"map"),opacity:c.getUniformLocation(a,"opacity"),modelViewMatrix:c.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:c.getUniformLocation(a,"projectionMatrix"),fogType:c.getUniformLocation(a,"fogType"),fogDensity:c.getUniformLocation(a,"fogDensity"),fogNear:c.getUniformLocation(a,"fogNear"),fogFar:c.getUniformLocation(a,"fogFar"),fogColor:c.getUniformLocation(a,"fogColor"),alphaTest:c.getUniformLocation(a,"alphaTest")};var r=document.createElement("canvas");r.width=8,r.height=8;var p=r.getContext("2d");p.fillStyle="white",p.fillRect(0,0,8,8),u=new i.Texture(r),u.needsUpdate=!0};this.render=function(n,v){if(0!==t.length){void 0===a&&m(),c.useProgram(a),c.enableVertexAttribArray(l.position),c.enableVertexAttribArray(l.uv),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.bindBuffer(c.ARRAY_BUFFER,o),c.vertexAttribPointer(l.position,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(l.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),c.uniformMatrix4fv(h.projectionMatrix,!1,v.projectionMatrix.elements),c.activeTexture(c.TEXTURE0),c.uniform1i(h.map,0);var y=0,g=0,x=n.fog;x?(c.uniform3f(h.fogColor,x.color.r,x.color.g,x.color.b),x instanceof i.Fog?(c.uniform1f(h.fogNear,x.near),c.uniform1f(h.fogFar,x.far),c.uniform1i(h.fogType,1),y=1,g=1):x instanceof i.FogExp2&&(c.uniform1f(h.fogDensity,x.density),c.uniform1i(h.fogType,2),y=2,g=2)):(c.uniform1i(h.fogType,0),y=0,g=0);for(var b=0,_=t.length;_>b;b++){var w=t[b];w._modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]}t.sort(r);for(var S=[],b=0,_=t.length;_>b;b++){var w=t[b],M=w.material;c.uniform1f(h.alphaTest,M.alphaTest),c.uniformMatrix4fv(h.modelViewMatrix,!1,w._modelViewMatrix.elements),w.matrixWorld.decompose(p,d,f),S[0]=f.x,S[1]=f.y;var T=0;n.fog&&M.fog&&(T=g),y!==T&&(c.uniform1i(h.fogType,T),y=T),null!==M.map?(c.uniform2f(h.uvOffset,M.map.offset.x,M.map.offset.y),c.uniform2f(h.uvScale,M.map.repeat.x,M.map.repeat.y)):(c.uniform2f(h.uvOffset,0,0),c.uniform2f(h.uvScale,1,1)),c.uniform1f(h.opacity,M.opacity),c.uniform3f(h.color,M.color.r,M.color.g,M.color.b),c.uniform1f(h.rotation,M.rotation),c.uniform2fv(h.scale,S),e.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),e.setDepthTest(M.depthTest),e.setDepthWrite(M.depthWrite),M.map&&M.map.image&&M.map.image.width?e.setTexture(M.map,0):e.setTexture(u,0),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}c.enable(c.CULL_FACE),e.resetGLState()}}},i.GeometryUtils={merge:function(e,t,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;t instanceof i.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},i.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,n,r){var o=new i.ImageLoader;o.crossOrigin=this.crossOrigin;var s=new i.Texture(void 0,t);return o.load(e,function(e){s.image=e,s.needsUpdate=!0,n&&n(s)},void 0,function(e){r&&r(e)}),s.sourceFile=e,s},loadTextureCube:function(e,t,n,r){var o=[],s=new i.ImageLoader;s.crossOrigin=this.crossOrigin;var a=new i.CubeTexture(o,t);a.flipY=!1;for(var l=0,h=function(t){s.load(e[t],function(e){a.images[t]=e,l+=1,6===l&&(a.needsUpdate=!0,n&&n(a))},void 0,r)},u=0,c=e.length;c>u;++u)h(u);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},r=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,s=e.height,a=document.createElement("canvas");a.width=o,a.height=s;var l=a.getContext("2d");l.drawImage(e,0,0);for(var h=l.getImageData(0,0,o,s).data,u=l.createImageData(o,s),c=u.data,p=0;o>p;p++)for(var d=0;s>d;d++){var f=0>d-1?0:d-1,m=d+1>s-1?s-1:d+1,v=0>p-1?0:p-1,y=p+1>o-1?o-1:p+1,g=[],x=[0,0,h[4*(d*o+p)]/255*t];g.push([-1,0,h[4*(d*o+v)]/255*t]),g.push([-1,-1,h[4*(f*o+v)]/255*t]),g.push([0,-1,h[4*(f*o+p)]/255*t]),g.push([1,-1,h[4*(f*o+y)]/255*t]),g.push([1,0,h[4*(d*o+y)]/255*t]),g.push([1,1,h[4*(m*o+y)]/255*t]),g.push([0,1,h[4*(m*o+p)]/255*t]),g.push([-1,1,h[4*(m*o+v)]/255*t]);for(var b=[],_=g.length,w=0;_>w;w++){var S=g[w],M=g[(w+1)%_];S=i(S,x),M=i(M,x),b.push(r(n(S,M)))}for(var T=[0,0,0],w=0;w<b.length;w++)T[0]+=b[w][0],T[1]+=b[w][1],T[2]+=b[w][2];T[0]/=b.length,T[1]/=b.length,T[2]/=b.length;var E=4*(d*o+p);c[E]=(T[0]+1)/2*255|0,c[E+1]=(T[1]+1)/2*255|0,c[E+2]=255*T[2]|0,c[E+3]=255}return l.putImageData(u,0,0),a},generateDataTexture:function(e,t,n){for(var r=e*t,o=new Uint8Array(3*r),s=Math.floor(255*n.r),a=Math.floor(255*n.g),l=Math.floor(255*n.b),h=0;r>h;h++)o[3*h]=s,o[3*h+1]=a,o[3*h+2]=l;var u=new i.DataTexture(o,e,t,i.RGBFormat);return u.needsUpdate=!0,u}},i.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new i.Object3D,r=0,o=t.length;o>r;r++)n.add(new i.Mesh(e,t[r]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new i.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},i.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),n=this;n.faces[t]=n.faces[t]||{},n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{},n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,n=this.getFace(),r=this.size/n.resolution,o=0,s=String(e).split(""),a=s.length,l=[];for(t=0;a>t;t++){var h=new i.Path,u=this.extractGlyphPoints(s[t],n,r,o,h);o+=u.offset,l.push(u.path)}var c=o/2;return{paths:l,offset:c}},extractGlyphPoints:function(e,t,n,r,o){var s,a,l,h,u,c,p,d,f,m,v,y,g,x,b,_,w,S,M,T=[],E=t.glyphs[e]||t.glyphs["?"];if(E){if(E.o)for(h=E._cachedOutline||(E._cachedOutline=E.o.split(" ")),c=h.length,p=n,d=n,s=0;c>s;)switch(u=h[s++]){case"m":f=h[s++]*p+r,m=h[s++]*d,o.moveTo(f,m);break;case"l":f=h[s++]*p+r,m=h[s++]*d,o.lineTo(f,m);break;case"q":if(v=h[s++]*p+r,y=h[s++]*d,b=h[s++]*p+r,_=h[s++]*d,o.quadraticCurveTo(b,_,v,y),M=T[T.length-1])for(g=M.x,x=M.y,a=1,l=this.divisions;l>=a;a++){var C=a/l;i.Shape.Utils.b2(C,g,b,v),i.Shape.Utils.b2(C,x,_,y)}break;case"b":if(v=h[s++]*p+r,y=h[s++]*d,b=h[s++]*p+r,_=h[s++]*d,w=h[s++]*p+r,S=h[s++]*d,o.bezierCurveTo(b,_,w,S,v,y),M=T[T.length-1])for(g=M.x,x=M.y,a=1,l=this.divisions;l>=a;a++){var C=a/l;i.Shape.Utils.b3(C,g,b,w,v),i.Shape.Utils.b3(C,x,_,S,y)}}return{offset:E.ha*n,path:o}}}},i.FontUtils.generateShapes=function(e,t){t=t||{};var n=void 0!==t.size?t.size:100,r=void 0!==t.curveSegments?t.curveSegments:4,o=void 0!==t.font?t.font:"helvetiker",s=void 0!==t.weight?t.weight:"normal",a=void 0!==t.style?t.style:"normal";i.FontUtils.size=n,i.FontUtils.divisions=r,i.FontUtils.face=o,i.FontUtils.weight=s,i.FontUtils.style=a;for(var l=i.FontUtils.drawText(e),h=l.paths,u=[],c=0,p=h.length;p>c;c++)Array.prototype.push.apply(u,h[c].toShapes());return u},function(e){var t=1e-10,n=function(e,t){var n=e.length;if(3>n)return null;var o,s,a,l=[],h=[],u=[];if(i(e)>0)for(s=0;n>s;s++)h[s]=s;else for(s=0;n>s;s++)h[s]=n-1-s;var c=n,p=2*c;for(s=c-1;c>2;){if(p--<=0)return console.log("Warning, unable to triangulate polygon!"),t?u:l;if(o=s,o>=c&&(o=0),s=o+1,s>=c&&(s=0),a=s+1,a>=c&&(a=0),r(e,o,s,a,c,h)){
var d,f,m,v,y;for(d=h[o],f=h[s],m=h[a],l.push([e[d],e[f],e[m]]),u.push([h[o],h[s],h[a]]),v=s,y=s+1;c>y;v++,y++)h[v]=h[y];c--,p=2*c}}return t?u:l},i=function(e){for(var t=e.length,n=0,i=t-1,r=0;t>r;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},r=function(e,n,i,r,o,s){var a,l,h,u,c,p,d,f,m;if(l=e[s[n]].x,h=e[s[n]].y,u=e[s[i]].x,c=e[s[i]].y,p=e[s[r]].x,d=e[s[r]].y,t>(u-l)*(d-h)-(c-h)*(p-l))return!1;var v,y,g,x,b,_,w,S,M,T,E,C,A,P,F;for(v=p-u,y=d-c,g=l-p,x=h-d,b=u-l,_=c-h,a=0;o>a;a++)if(f=e[s[a]].x,m=e[s[a]].y,!(f===l&&m===h||f===u&&m===c||f===p&&m===d)&&(w=f-l,S=m-h,M=f-u,T=m-c,E=f-p,C=m-d,F=v*T-y*M,A=b*S-_*w,P=g*C-x*E,F>=-t&&P>=-t&&A>=-t))return!1;return!0};return e.Triangulate=n,e.Triangulate.area=i,e}(i.FontUtils),self._typeface_js={faces:i.FontUtils.faces,loadFace:i.FontUtils.loadFace},i.typeface_js=self._typeface_js,i.Audio=function(e){i.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},i.Audio.prototype=Object.create(i.Object3D.prototype),i.Audio.prototype.constructor=i.Audio,i.Audio.prototype.load=function(e){var t=this,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.source.connect(t.panner),t.source.start(0)})},n.send(),this},i.Audio.prototype.setLoop=function(e){this.source.loop=e},i.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},i.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},i.Audio.prototype.updateMatrixWorld=function(){var e=new i.Vector3;return function(t){i.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),i.AudioListener=function(){i.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},i.AudioListener.prototype=Object.create(i.Object3D.prototype),i.AudioListener.prototype.constructor=i.AudioListener,i.AudioListener.prototype.updateMatrixWorld=function(){var e=new i.Vector3,t=new i.Quaternion,n=new i.Vector3,r=new i.Vector3,o=new i.Vector3,s=new i.Vector3;return function(a){i.Object3D.prototype.updateMatrixWorld.call(this,a);var l=this.context.listener,h=this.up;this.matrixWorld.decompose(e,t,n),r.set(0,0,-1).applyQuaternion(t),o.subVectors(e,s),l.setPosition(e.x,e.y,e.z),l.setOrientation(r.x,r.y,r.z,h.x,h.y,h.z),l.setVelocity(o.x,o.y,o.z),s.copy(e)}}(),i.Curve=function(){},i.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},i.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},i.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;e>=t;t++)n.push(this.getPoint(t/e));return n},i.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;e>=t;t++)n.push(this.getPointAt(t/e));return n},i.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},i.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),o=0;for(i.push(0),n=1;e>=n;n++)t=this.getPoint(n/e),o+=t.distanceTo(r),i.push(o),r=t;return this.cacheArcLengths=i,i},i.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},i.Curve.prototype.getUtoTmapping=function(e,t){var n,i=this.getLengths(),r=0,o=i.length;n=t?t:e*i[o-1];for(var s,a=0,l=o-1;l>=a;)if(r=Math.floor(a+(l-a)/2),s=i[r]-n,0>s)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,i[r]==n){var h=r/(o-1);return h}var u=i[r],c=i[r+1],p=c-u,d=(n-u)/p,h=(r+d)/(o-1);return h},i.Curve.prototype.getTangent=function(e){var t=1e-4,n=e-t,i=e+t;0>n&&(n=0),i>1&&(i=1);var r=this.getPoint(n),o=this.getPoint(i),s=o.clone().sub(r);return s.normalize()},i.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},i.Curve.Utils={tangentQuadraticBezier:function(e,t,n,i){return 2*(1-e)*(n-t)+2*e*(i-n)},tangentCubicBezier:function(e,t,n,i,r){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*r},tangentSpline:function(e,t,n,i,r){var o=6*e*e-6*e,s=3*e*e-4*e+1,a=-6*e*e+6*e,l=3*e*e-2*e;return o+s+a+l},interpolate:function(e,t,n,i,r){var o=.5*(n-e),s=.5*(i-t),a=r*r,l=r*a;return(2*t-2*n+o+s)*l+(-3*t+3*n-2*o-s)*a+o*r+t}},i.Curve.create=function(e,t){return e.prototype=Object.create(i.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},i.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},i.CurvePath.prototype=Object.create(i.Curve.prototype),i.CurvePath.prototype.constructor=i.CurvePath,i.CurvePath.prototype.add=function(e){this.curves.push(e)},i.CurvePath.prototype.checkConnection=function(){},i.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new i.LineCurve(t,e))},i.CurvePath.prototype.getPoint=function(e){for(var t,n,i=e*this.getLength(),r=this.getCurveLengths(),o=0;o<r.length;){if(r[o]>=i){t=r[o]-i,n=this.curves[o];var s=1-t/n.getLength();return n.getPointAt(s)}o++}return null},i.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},i.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],n=0,i=this.curves.length;for(e=0;i>e;e++)n+=this.curves[e].getLength(),t.push(n);return this.cacheLengths=t,t},i.CurvePath.prototype.getBoundingBox=function(){var e,t,n,r,o,s,a=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=o=Number.POSITIVE_INFINITY;var l,h,u,c,p=a[0]instanceof i.Vector3;for(c=p?new i.Vector3:new i.Vector2,h=0,u=a.length;u>h;h++)l=a[h],l.x>e?e=l.x:l.x<r&&(r=l.x),l.y>t?t=l.y:l.y<o&&(o=l.y),p&&(l.z>n?n=l.z:l.z<s&&(s=l.z)),c.add(l);var d={minX:r,minY:o,maxX:e,maxY:t};return p&&(d.maxZ=n,d.minZ=s),d},i.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},i.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},i.CurvePath.prototype.createGeometry=function(e){for(var t=new i.Geometry,n=0;n<e.length;n++)t.vertices.push(new i.Vector3(e[n].x,e[n].y,e[n].z||0));return t},i.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},i.CurvePath.prototype.getTransformedPoints=function(e,t){var n,i,r=this.getPoints(e);for(t||(t=this.bends),n=0,i=t.length;i>n;n++)r=this.getWrapPoints(r,t[n]);return r},i.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n,i,r=this.getSpacedPoints(e);for(t||(t=this.bends),n=0,i=t.length;i>n;n++)r=this.getWrapPoints(r,t[n]);return r},i.CurvePath.prototype.getWrapPoints=function(e,t){var n,i,r,o,s,a,l=this.getBoundingBox();for(n=0,i=e.length;i>n;n++){r=e[n],o=r.x,s=r.y,a=o/l.maxX,a=t.getUtoTmapping(a,o);var h=t.getPoint(a),u=t.getTangent(a);u.set(-u.y,u.x).multiplyScalar(s),r.x=h.x+u.x,r.y=h.y+u.y}return e},i.Gyroscope=function(){i.Object3D.call(this)},i.Gyroscope.prototype=Object.create(i.Object3D.prototype),i.Gyroscope.prototype.constructor=i.Gyroscope,i.Gyroscope.prototype.updateMatrixWorld=function(){var e=new i.Vector3,t=new i.Quaternion,n=new i.Vector3,r=new i.Vector3,o=new i.Quaternion,s=new i.Vector3;return function(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(r,o,s),this.matrix.decompose(e,t,n),this.matrixWorld.compose(r,t,s)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);for(var a=0,l=this.children.length;l>a;a++)this.children[a].updateMatrixWorld(i)}}(),i.Path=function(e){i.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},i.Path.prototype=Object.create(i.CurvePath.prototype),i.Path.prototype.constructor=i.Path,i.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},i.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;n>t;t++)this.lineTo(e[t].x,e[t].y)},i.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:i.PathActions.MOVE_TO,args:n})},i.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,o=r[r.length-2],s=r[r.length-1],a=new i.LineCurve(new i.Vector2(o,s),new i.Vector2(e,t));this.curves.push(a),this.actions.push({action:i.PathActions.LINE_TO,args:n})},i.Path.prototype.quadraticCurveTo=function(e,t,n,r){var o=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1],h=new i.QuadraticBezierCurve(new i.Vector2(a,l),new i.Vector2(e,t),new i.Vector2(n,r));this.curves.push(h),this.actions.push({action:i.PathActions.QUADRATIC_CURVE_TO,args:o})},i.Path.prototype.bezierCurveTo=function(e,t,n,r,o,s){var a=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,h=l[l.length-2],u=l[l.length-1],c=new i.CubicBezierCurve(new i.Vector2(h,u),new i.Vector2(e,t),new i.Vector2(n,r),new i.Vector2(o,s));this.curves.push(c),this.actions.push({action:i.PathActions.BEZIER_CURVE_TO,args:a})},i.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],o=n[n.length-1],s=[new i.Vector2(r,o)];Array.prototype.push.apply(s,e);var a=new i.SplineCurve(s);this.curves.push(a),this.actions.push({action:i.PathActions.CSPLINE_THRU,args:t})},i.Path.prototype.arc=function(e,t,n,i,r,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,n,i,r,o)},i.Path.prototype.absarc=function(e,t,n,i,r,o){this.absellipse(e,t,n,n,i,r,o)},i.Path.prototype.ellipse=function(e,t,n,i,r,o,s){var a=this.actions[this.actions.length-1].args,l=a[a.length-2],h=a[a.length-1];this.absellipse(e+l,t+h,n,i,r,o,s)},i.Path.prototype.absellipse=function(e,t,n,r,o,s,a){var l=Array.prototype.slice.call(arguments),h=new i.EllipseCurve(e,t,n,r,o,s,a);this.curves.push(h);var u=h.getPoint(1);l.push(u.x),l.push(u.y),this.actions.push({action:i.PathActions.ELLIPSE,args:l})},i.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],i=0;e>i;i++)n.push(this.getPoint(i/e));return n},i.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n,r,o,s,a,l,h,u,c,p,d,f,m,v,y,g,x,b,_=[];for(n=0,r=this.actions.length;r>n;n++)switch(o=this.actions[n],s=o.action,a=o.args,s){case i.PathActions.MOVE_TO:_.push(new i.Vector2(a[0],a[1]));break;case i.PathActions.LINE_TO:_.push(new i.Vector2(a[0],a[1]));break;case i.PathActions.QUADRATIC_CURVE_TO:for(l=a[2],h=a[3],p=a[0],d=a[1],_.length>0?(v=_[_.length-1],f=v.x,m=v.y):(v=this.actions[n-1].args,f=v[v.length-2],m=v[v.length-1]),y=1;e>=y;y++)g=y/e,x=i.Shape.Utils.b2(g,f,p,l),b=i.Shape.Utils.b2(g,m,d,h),_.push(new i.Vector2(x,b));break;case i.PathActions.BEZIER_CURVE_TO:for(l=a[4],h=a[5],p=a[0],d=a[1],u=a[2],c=a[3],_.length>0?(v=_[_.length-1],f=v.x,m=v.y):(v=this.actions[n-1].args,f=v[v.length-2],m=v[v.length-1]),y=1;e>=y;y++)g=y/e,x=i.Shape.Utils.b3(g,f,p,u,l),b=i.Shape.Utils.b3(g,m,d,c,h),_.push(new i.Vector2(x,b));break;case i.PathActions.CSPLINE_THRU:v=this.actions[n-1].args;var w=new i.Vector2(v[v.length-2],v[v.length-1]),S=[w],M=e*a[0].length;S=S.concat(a[0]);var T=new i.SplineCurve(S);for(y=1;M>=y;y++)_.push(T.getPointAt(y/M));break;case i.PathActions.ARC:var E,C=a[0],A=a[1],P=a[2],F=a[3],L=a[4],R=!!a[5],B=L-F,k=2*e;for(y=1;k>=y;y++)g=y/k,R||(g=1-g),E=F+g*B,x=C+P*Math.cos(E),b=A+P*Math.sin(E),_.push(new i.Vector2(x,b));break;case i.PathActions.ELLIPSE:var E,C=a[0],A=a[1],D=a[2],N=a[3],F=a[4],L=a[5],R=!!a[6],B=L-F,k=2*e;for(y=1;k>=y;y++)g=y/k,R||(g=1-g),E=F+g*B,x=C+D*Math.cos(E),b=A+N*Math.sin(E),_.push(new i.Vector2(x,b))}var O=_[_.length-1],V=1e-10;return Math.abs(O.x-_[0].x)<V&&Math.abs(O.y-_[0].y)<V&&_.splice(_.length-1,1),t&&_.push(_[0]),_},i.Path.prototype.toShapes=function(e,t){function n(e){var t,n,r,o,s,a=[],l=new i.Path;for(t=0,n=e.length;n>t;t++)r=e[t],s=r.args,o=r.action,o==i.PathActions.MOVE_TO&&0!=l.actions.length&&(a.push(l),l=new i.Path),l[o].apply(l,s);return 0!=l.actions.length&&a.push(l),a}function r(e){for(var t=[],n=0,r=e.length;r>n;n++){var o=e[n],s=new i.Shape;s.actions=o.actions,s.curves=o.curves,t.push(s)}return t}function o(e,t){for(var n=1e-10,i=t.length,r=!1,o=i-1,s=0;i>s;o=s++){var a=t[o],l=t[s],h=l.x-a.x,u=l.y-a.y;if(Math.abs(u)>n){if(0>u&&(a=t[s],h=-h,l=t[o],u=-u),e.y<a.y||e.y>l.y)continue;if(e.y==a.y){if(e.x==a.x)return!0}else{var c=u*(e.x-a.x)-h*(e.y-a.y);if(0==c)return!0;if(0>c)continue;r=!r}}else{if(e.y!=a.y)continue;if(l.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=l.x)return!0}}return r}var s=n(this.actions);if(0==s.length)return[];if(t===!0)return r(s);var a,l,h,u=[];if(1==s.length)return l=s[0],h=new i.Shape,h.actions=l.actions,h.curves=l.curves,u.push(h),u;var c=!i.Shape.Utils.isClockWise(s[0].getPoints());c=e?!c:c;var p,d=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];var y,g;for(y=0,g=s.length;g>y;y++)l=s[y],p=l.getPoints(),a=i.Shape.Utils.isClockWise(p),a=e?!a:a,a?(!c&&f[v]&&v++,f[v]={s:new i.Shape,p:p},f[v].s.actions=l.actions,f[v].s.curves=l.curves,c&&v++,m[v]=[]):m[v].push({h:l,p:p[0]});if(!f[0])return r(s);if(f.length>1){for(var x=!1,b=[],_=0,w=f.length;w>_;_++)d[_]=[];for(var _=0,w=f.length;w>_;_++)for(var S=(f[_],m[_]),M=0;M<S.length;M++){for(var T=S[M],E=!0,C=0;C<f.length;C++)o(T.p,f[C].p)&&(_!=C&&b.push({froms:_,tos:C,hole:M}),E?(E=!1,d[C].push(T)):x=!0);E&&d[_].push(T)}b.length>0&&(x||(m=d))}var A,P,F;for(y=0,g=f.length;g>y;y++)for(h=f[y].s,u.push(h),A=m[y],P=0,F=A.length;F>P;P++)h.holes.push(A[P].h);return u},i.Shape=function(){i.Path.apply(this,arguments),this.holes=[]},i.Shape.prototype=Object.create(i.Path.prototype),i.Shape.prototype.constructor=i.Shape,i.Shape.prototype.extrude=function(e){var t=new i.ExtrudeGeometry(this,e);return t},i.Shape.prototype.makeGeometry=function(e){var t=new i.ShapeGeometry(this,e);return t},i.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,i=[];for(t=0;n>t;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},i.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,i=[];for(t=0;n>t;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},i.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},i.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},i.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},i.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function r(e,t,i,r,o){var s=1e-10,a=t.x-e.x,l=t.y-e.y,h=r.x-i.x,u=r.y-i.y,c=e.x-i.x,p=e.y-i.y,d=l*h-a*u,f=l*c-a*p;if(Math.abs(d)>s){var m;if(d>0){if(0>f||f>d)return[];if(m=u*c-h*p,0>m||m>d)return[]}else{if(f>0||d>f)return[];if(m=u*c-h*p,m>0||d>m)return[]}if(0==m)return!o||0!=f&&f!=d?[e]:[];if(m==d)return!o||0!=f&&f!=d?[t]:[];if(0==f)return[i];if(f==d)return[r];var v=m/d;return[{x:e.x+v*a,y:e.y+v*l}]}if(0!=f||u*c!=h*p)return[];var y=0==a&&0==l,g=0==h&&0==u;if(y&&g)return e.x!=i.x||e.y!=i.y?[]:[e];if(y)return n(i,r,e)?[e]:[];if(g)return n(e,t,i)?[i]:[];var x,b,_,w,S,M,T,E;return 0!=a?(e.x<t.x?(x=e,_=e.x,b=t,w=t.x):(x=t,_=t.x,b=e,w=e.x),i.x<r.x?(S=i,T=i.x,M=r,E=r.x):(S=r,T=r.x,M=i,E=i.x)):(e.y<t.y?(x=e,_=e.y,b=t,w=t.y):(x=t,_=t.y,b=e,w=e.y),i.y<r.y?(S=i,T=i.y,M=r,E=r.y):(S=r,T=r.y,M=i,E=i.y)),T>=_?T>w?[]:w==T?o?[]:[S]:E>=w?[S,b]:[S,M]:_>E?[]:_==E?o?[]:[x]:E>=w?[x,b]:[x,M]}function o(e,t,n,i){var r=1e-10,o=t.x-e.x,s=t.y-e.y,a=n.x-e.x,l=n.y-e.y,h=i.x-e.x,u=i.y-e.y,c=o*l-s*a,p=o*u-s*h;if(Math.abs(c)>r){var d=h*l-u*a;return c>0?p>=0&&d>=0:p>=0||d>=0}return p>0}function s(e,t){function n(e,t){var n=g.length-1,i=e-1;0>i&&(i=n);var r=e+1;r>n&&(r=0);var s=o(g[e],g[i],g[r],a[t]);if(!s)return!1;var l=a.length-1,h=t-1;0>h&&(h=l);var u=t+1;return u>l&&(u=0),s=o(a[t],a[h],a[u],g[e]),s?!0:!1}function i(e,t){var n,i,o;for(n=0;n<g.length;n++)if(i=n+1,i%=g.length,o=r(e,t,g[n],g[i],!0),o.length>0)return!0;return!1}function s(e,n){var i,o,s,a,l;for(i=0;i<x.length;i++)for(o=t[x[i]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,l=r(e,n,o[s],o[a],!0),l.length>0)return!0;return!1}for(var a,l,h,u,c,p,d,f,m,v,y,g=e.concat(),x=[],b=[],_=0,w=t.length;w>_;_++)x.push(_);for(var S=0,M=2*x.length;x.length>0;){if(M--,0>M){console.log("Infinite Loop! Holes left:"+x.length+", Probably Hole outside Shape!");break}for(h=S;h<g.length;h++){u=g[h],l=-1;for(var _=0;_<x.length;_++)if(p=x[_],d=u.x+":"+u.y+":"+p,void 0===b[d]){a=t[p];for(var T=0;T<a.length;T++)if(c=a[T],n(h,T)&&!i(u,c)&&!s(u,c)){l=T,x.splice(_,1),f=g.slice(0,h+1),m=g.slice(h),v=a.slice(l),y=a.slice(0,l+1),g=f.concat(v).concat(y).concat(m),S=h;break}if(l>=0)break;b[d]=!0}if(l>=0)break}}return g}for(var a,l,h,u,c,p,d={},f=e.concat(),m=0,v=t.length;v>m;m++)Array.prototype.push.apply(f,t[m]);for(a=0,l=f.length;l>a;a++)c=f[a].x+":"+f[a].y,void 0!==d[c]&&console.log("Duplicate point",c),d[c]=a;var y=s(e,t),g=i.FontUtils.Triangulate(y,!1);for(a=0,l=g.length;l>a;a++)for(u=g[a],h=0;3>h;h++)c=u[h].x+":"+u[h].y,p=d[c],void 0!==p&&(u[h]=p);return g.concat()},isClockWise:function(e){return i.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,i){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,i)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){var n=1-e;return 3*n*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,i,r){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,i)+this.b3p3(e,r)}},i.LineCurve=function(e,t){this.v1=e,this.v2=t},i.LineCurve.prototype=Object.create(i.Curve.prototype),i.LineCurve.prototype.constructor=i.LineCurve,i.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},i.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},i.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},i.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},i.QuadraticBezierCurve.prototype=Object.create(i.Curve.prototype),i.QuadraticBezierCurve.prototype.constructor=i.QuadraticBezierCurve,i.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new i.Vector2;return t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},i.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new i.Vector2;return t.x=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},i.CubicBezierCurve=function(e,t,n,i){this.v0=e,this.v1=t,this.v2=n,this.v3=i},i.CubicBezierCurve.prototype=Object.create(i.Curve.prototype),i.CubicBezierCurve.prototype.constructor=i.CubicBezierCurve,i.CubicBezierCurve.prototype.getPoint=function(e){var t,n;return t=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new i.Vector2(t,n)},i.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=i.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=i.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new i.Vector2(t,n);return r.normalize(),r},i.SplineCurve=function(e){this.points=void 0==e?[]:e},i.SplineCurve.prototype=Object.create(i.Curve.prototype),i.SplineCurve.prototype.constructor=i.SplineCurve,i.SplineCurve.prototype.getPoint=function(e){var t=this.points,n=(t.length-1)*e,r=Math.floor(n),o=n-r,s=t[0==r?r:r-1],a=t[r],l=t[r>t.length-2?t.length-1:r+1],h=t[r>t.length-3?t.length-1:r+2],u=new i.Vector2;return u.x=i.Curve.Utils.interpolate(s.x,a.x,l.x,h.x,o),u.y=i.Curve.Utils.interpolate(s.y,a.y,l.y,h.y,o),u},i.EllipseCurve=function(e,t,n,i,r,o,s){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s},i.EllipseCurve.prototype=Object.create(i.Curve.prototype),i.EllipseCurve.prototype.constructor=i.EllipseCurve,i.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var n;n=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var r=new i.Vector2;return r.x=this.aX+this.xRadius*Math.cos(n),r.y=this.aY+this.yRadius*Math.sin(n),r},i.ArcCurve=function(e,t,n,r,o,s){i.EllipseCurve.call(this,e,t,n,n,r,o,s)},i.ArcCurve.prototype=Object.create(i.EllipseCurve.prototype),i.ArcCurve.prototype.constructor=i.ArcCurve,i.LineCurve3=i.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new i.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),i.QuadraticBezierCurve3=i.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t=new i.Vector3;return t.x=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=i.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),i.CubicBezierCurve3=i.Curve.create(function(e,t,n,i){this.v0=e,this.v1=t,this.v2=n,this.v3=i},function(e){var t=new i.Vector3;return t.x=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=i.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),i.SplineCurve3=i.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,n=(t.length-1)*e,r=Math.floor(n),o=n-r,s=t[0==r?r:r-1],a=t[r],l=t[r>t.length-2?t.length-1:r+1],h=t[r>t.length-3?t.length-1:r+2],u=new i.Vector3;return u.x=i.Curve.Utils.interpolate(s.x,a.x,l.x,h.x,o),u.y=i.Curve.Utils.interpolate(s.y,a.y,l.y,h.y,o),u.z=i.Curve.Utils.interpolate(s.z,a.z,l.z,h.z,o),u}),i.ClosedSplineCurve3=i.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,n=(t.length-0)*e,r=Math.floor(n),o=n-r;r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length;var s=t[(r-1)%t.length],a=t[r%t.length],l=t[(r+1)%t.length],h=t[(r+2)%t.length],u=new i.Vector3;return u.x=i.Curve.Utils.interpolate(s.x,a.x,l.x,h.x,o),u.y=i.Curve.Utils.interpolate(s.y,a.y,l.y,h.y,o),u.z=i.Curve.Utils.interpolate(s.z,a.z,l.z,h.z,o),u}),i.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized===!0)return e;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof i.Quaternion)){var r=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=(new i.Quaternion).fromArray(r)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},n=0;n<e.hierarchy[t].keys.length;n++)for(var s=0;s<e.hierarchy[t].keys[n].morphTargets.length;s++){var a=e.hierarchy[t].keys[n].morphTargets[s];o[a]=-1}e.hierarchy[t].usedMorphTargets=o;for(var n=0;n<e.hierarchy[t].keys.length;n++){var l={};for(var a in o){for(var s=0;s<e.hierarchy[t].keys[n].morphTargets.length;s++)if(e.hierarchy[t].keys[n].morphTargets[s]===a){l[a]=e.hierarchy[t].keys[n].morphTargetsInfluences[s];break}s===e.hierarchy[t].keys[n].morphTargets.length&&(l[a]=0)}e.hierarchy[t].keys[n].morphTargetsInfluences=l}}for(var n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(var n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},parse:function(e){var t=function(e,n){n.push(e);for(var i=0;i<e.children.length;i++)t(e.children[i],n)},n=[];if(e instanceof i.SkinnedMesh)for(var r=0;r<e.skeleton.bones.length;r++)n.push(e.skeleton.bones[r]);else t(e,n);return n},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},i.Animation=function(e,t){this.root=e,this.data=i.AnimationHandler.init(t),this.hierarchy=i.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=i.AnimationHandler.LINEAR},i.Animation.prototype.keyTypes=["pos","rot","scl"],i.Animation.prototype.play=function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),i.AnimationHandler.play(this)},i.Animation.prototype.stop=function(){this.isPlaying=!1,i.AnimationHandler.stop(this)},i.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var n=this.hierarchy[e];void 0===n.animationCache&&(n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}),void 0===n.animationCache.animations[this.data.name]&&(n.animationCache.animations[this.data.name]={},n.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0},n.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0},n.animationCache.animations[this.data.name].originalMatrix=n.matrix);for(var i=n.animationCache.animations[this.data.name],r=0;3>r;r++){for(var o=this.keyTypes[r],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(o,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(o,e,a.index+1);i.prevKey[o]=s,i.nextKey[o]=a}}},i.Animation.prototype.resetBlendWeights=function(){for(var e=0,t=this.hierarchy.length;t>e;e++){var n=this.hierarchy[e];void 0!==n.animationCache&&(n.animationCache.blending.positionWeight=0,n.animationCache.blending.quaternionWeight=0,n.animationCache.blending.scaleWeight=0)}},i.Animation.prototype.update=function(){var e=[],t=new i.Vector3,n=new i.Vector3,r=new i.Quaternion,o=function(e,t){var n,i,r,o,a,l,h,u,c,p=[],d=[];return n=(e.length-1)*t,i=Math.floor(n),r=n-i,p[0]=0===i?i:i-1,p[1]=i,p[2]=i>e.length-2?i:i+1,p[3]=i>e.length-3?i:i+2,l=e[p[0]],h=e[p[1]],u=e[p[2]],c=e[p[3]],o=r*r,a=r*o,d[0]=s(l[0],h[0],u[0],c[0],r,o,a),d[1]=s(l[1],h[1],u[1],c[1],r,o,a),d[2]=s(l[2],h[2],u[2],c[2],r,o,a),d},s=function(e,t,n,i,r,o,s){var a=.5*(n-e),l=.5*(i-t);return(2*(t-n)+a+l)*s+(-3*(t-n)-2*a-l)*o+a*r+t};return function(s){if(this.isPlaying!==!1&&(this.currentTime+=s*this.timeScale,0!==this.weight)){var a=this.data.length;(this.currentTime>a||this.currentTime<0)&&(this.loop?(this.currentTime%=a,this.currentTime<0&&(this.currentTime+=a),this.reset()):this.stop());for(var l=0,h=this.hierarchy.length;h>l;l++)for(var u=this.hierarchy[l],c=u.animationCache.animations[this.data.name],p=u.animationCache.blending,d=0;3>d;d++){var f=this.keyTypes[d],m=c.prevKey[f],v=c.nextKey[f];if(this.timeScale>0&&v.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){for(m=this.data.hierarchy[l].keys[0],v=this.getNextKeyWith(f,l,1);v.time<this.currentTime&&v.index>m.index;)m=v,v=this.getNextKeyWith(f,l,v.index+1);c.prevKey[f]=m,c.nextKey[f]=v}var y=(this.currentTime-m.time)/(v.time-m.time),g=m[f],x=v[f];if(0>y&&(y=0),y>1&&(y=1),"pos"===f){if(this.interpolationType===i.AnimationHandler.LINEAR){n.x=g[0]+(x[0]-g[0])*y,n.y=g[1]+(x[1]-g[1])*y,n.z=g[2]+(x[2]-g[2])*y;var b=this.weight/(this.weight+p.positionWeight);u.position.lerp(n,b),p.positionWeight+=this.weight}else if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",l,m.index-1).pos,e[1]=g,e[2]=x,e[3]=this.getNextKeyWith("pos",l,v.index+1).pos,y=.33*y+.33;var _=o(e,y),b=this.weight/(this.weight+p.positionWeight);p.positionWeight+=this.weight;var w=u.position;if(w.x=w.x+(_[0]-w.x)*b,w.y=w.y+(_[1]-w.y)*b,w.z=w.z+(_[2]-w.z)*b,this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){var S=o(e,1.01*y);t.set(S[0],S[1],S[2]),t.sub(w),t.y=0,t.normalize();var M=Math.atan2(t.x,t.z);u.rotation.set(0,M,0)}}}else if("rot"===f)if(i.Quaternion.slerp(g,x,r,y),0===p.quaternionWeight)u.quaternion.copy(r),p.quaternionWeight=this.weight;else{var b=this.weight/(this.weight+p.quaternionWeight);i.Quaternion.slerp(u.quaternion,r,u.quaternion,b),p.quaternionWeight+=this.weight}else if("scl"===f){n.x=g[0]+(x[0]-g[0])*y,n.y=g[1]+(x[1]-g[1])*y,n.z=g[2]+(x[2]-g[2])*y;var b=this.weight/(this.weight+p.scaleWeight);u.scale.lerp(n,b),p.scaleWeight+=this.weight}}return!0}}}(),i.Animation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD?n=n<r.length-1?n:r.length-1:n%=r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},i.Animation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+r.length;n>=0;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]},i.KeyFrameAnimation=function(e){this.root=e.node,this.data=i.AnimationHandler.init(e),this.hierarchy=i.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,n=this.hierarchy.length;n>t;t++){var r=this.data.hierarchy[t].keys,o=this.data.hierarchy[t].sids,s=this.hierarchy[t];if(r.length&&o){for(var a=0;a<o.length;a++){var l=o[a],h=this.getNextKeyWith(l,t,0);h&&h.apply(l)}s.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},i.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=void 0!==e?e:0,this.isPlaying===!1){this.isPlaying=!0;var t,n,r,o=this.hierarchy.length;for(t=0;o>t;t++){n=this.hierarchy[t],r=this.data.hierarchy[t],void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n.matrix);var s=this.data.hierarchy[t].keys;s.length&&(r.animationCache.prevKey=s[0],r.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,i.AnimationHandler.play(this)},i.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,i.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;r.copy(t.matrix),t.matrix=r,delete n.animationCache}}},i.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying!==!1){this.currentTime+=e*this.timeScale;var t=this.data.length;this.loop===!0&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var n=0,i=this.hierarchy.length;i>n;n++){var r=this.hierarchy[n],o=this.data.hierarchy[n],s=o.keys,a=o.animationCache;

if(s.length){var l=a.prevKey,h=a.nextKey;if(h.time<=this.currentTime){for(;h.time<this.currentTime&&h.index>l.index;)l=h,h=s[l.index+1];a.prevKey=l,a.nextKey=h}h.time>=this.currentTime?l.interpolate(h,this.currentTime):l.interpolate(h,h.time),this.data.hierarchy[n].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}}},i.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){var i=this.data.hierarchy[t].keys;for(n%=i.length;n<i.length;n++)if(i[n].hasTarget(e))return i[n];return i[0]},i.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){var i=this.data.hierarchy[t].keys;for(n=n>=0?n:n+i.length;n>=0;n--)if(i[n].hasTarget(e))return i[n];return i[i.length-1]},i.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},i.MorphAnimation.prototype={constructor:i.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(this.isPlaying!==!1){this.currentTime+=e,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,n=Math.floor(this.currentTime/t);n!=this.currentFrame&&(this.mesh.morphTargetInfluences[this.lastFrame]=0,this.mesh.morphTargetInfluences[this.currentFrame]=1,this.mesh.morphTargetInfluences[n]=0,this.lastFrame=this.currentFrame,this.currentFrame=n),this.mesh.morphTargetInfluences[n]=this.currentTime%t/t,this.mesh.morphTargetInfluences[this.lastFrame]=1-this.mesh.morphTargetInfluences[n]}}},i.BoxGeometry=function(e,t,n,r,o,s){function a(e,t,n,r,o,s,a,h){var u,c,p,d=l.widthSegments,f=l.heightSegments,m=o/2,v=s/2,y=l.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?u="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(u="y",f=l.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(u="x",d=l.depthSegments);var g=d+1,x=f+1,b=o/d,_=s/f,w=new i.Vector3;for(w[u]=a>0?1:-1,p=0;x>p;p++)for(c=0;g>c;c++){var S=new i.Vector3;S[e]=(c*b-m)*n,S[t]=(p*_-v)*r,S[u]=a,l.vertices.push(S)}for(p=0;f>p;p++)for(c=0;d>c;c++){var M=c+g*p,T=c+g*(p+1),E=c+1+g*(p+1),C=c+1+g*p,A=new i.Vector2(c/d,1-p/f),P=new i.Vector2(c/d,1-(p+1)/f),F=new i.Vector2((c+1)/d,1-(p+1)/f),L=new i.Vector2((c+1)/d,1-p/f),R=new i.Face3(M+y,T+y,C+y);R.normal.copy(w),R.vertexNormals.push(w.clone(),w.clone(),w.clone()),R.materialIndex=h,l.faces.push(R),l.faceVertexUvs[0].push([A,P,L]),R=new i.Face3(T+y,E+y,C+y),R.normal.copy(w),R.vertexNormals.push(w.clone(),w.clone(),w.clone()),R.materialIndex=h,l.faces.push(R),l.faceVertexUvs[0].push([P.clone(),F,L.clone()])}}i.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:o,depthSegments:s},this.widthSegments=r||1,this.heightSegments=o||1,this.depthSegments=s||1;var l=this,h=e/2,u=t/2,c=n/2;a("z","y",-1,-1,n,t,h,0),a("z","y",1,-1,n,t,-h,1),a("x","z",1,1,e,n,u,2),a("x","z",1,-1,e,n,-u,3),a("x","y",1,-1,e,t,c,4),a("x","y",-1,-1,e,t,-c,5),this.mergeVertices()},i.BoxGeometry.prototype=Object.create(i.Geometry.prototype),i.BoxGeometry.prototype.constructor=i.BoxGeometry,i.CircleGeometry=function(e,t,n,r){i.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var o,s=[],a=new i.Vector3,l=new i.Vector2(.5,.5);for(this.vertices.push(a),s.push(l),o=0;t>=o;o++){var h=new i.Vector3,u=n+o/t*r;h.x=e*Math.cos(u),h.y=e*Math.sin(u),this.vertices.push(h),s.push(new i.Vector2((h.x/e+1)/2,(h.y/e+1)/2))}var c=new i.Vector3(0,0,1);for(o=1;t>=o;o++)this.faces.push(new i.Face3(o,o+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([s[o].clone(),s[o+1].clone(),l.clone()]);this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,e)},i.CircleGeometry.prototype=Object.create(i.Geometry.prototype),i.CircleGeometry.prototype.constructor=i.CircleGeometry,i.CubeGeometry=function(e,t,n,r,o,s){return console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new i.BoxGeometry(e,t,n,r,o,s)},i.CylinderGeometry=function(e,t,n,r,o,s,a,l){i.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l},e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,r=r||8,o=o||1,s=void 0!==s?s:!1,a=void 0!==a?a:0,l=void 0!==l?l:2*Math.PI;var h,u,c=n/2,p=[],d=[];for(u=0;o>=u;u++){var f=[],m=[],v=u/o,y=v*(t-e)+e;for(h=0;r>=h;h++){var g=h/r,x=new i.Vector3;x.x=y*Math.sin(g*l+a),x.y=-v*n+c,x.z=y*Math.cos(g*l+a),this.vertices.push(x),f.push(this.vertices.length-1),m.push(new i.Vector2(g,1-v))}p.push(f),d.push(m)}var b,_,w=(t-e)/n;for(h=0;r>h;h++)for(0!==e?(b=this.vertices[p[0][h]].clone(),_=this.vertices[p[0][h+1]].clone()):(b=this.vertices[p[1][h]].clone(),_=this.vertices[p[1][h+1]].clone()),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*w).normalize(),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*w).normalize(),u=0;o>u;u++){var S=p[u][h],M=p[u+1][h],T=p[u+1][h+1],E=p[u][h+1],C=b.clone(),A=b.clone(),P=_.clone(),F=_.clone(),L=d[u][h].clone(),R=d[u+1][h].clone(),B=d[u+1][h+1].clone(),k=d[u][h+1].clone();this.faces.push(new i.Face3(S,M,E,[C,A,F])),this.faceVertexUvs[0].push([L,R,k]),this.faces.push(new i.Face3(M,T,E,[A.clone(),P,F.clone()])),this.faceVertexUvs[0].push([R.clone(),B,k.clone()])}if(s===!1&&e>0)for(this.vertices.push(new i.Vector3(0,c,0)),h=0;r>h;h++){var S=p[0][h],M=p[0][h+1],T=this.vertices.length-1,C=new i.Vector3(0,1,0),A=new i.Vector3(0,1,0),P=new i.Vector3(0,1,0),L=d[0][h].clone(),R=d[0][h+1].clone(),B=new i.Vector2(R.x,0);this.faces.push(new i.Face3(S,M,T,[C,A,P])),this.faceVertexUvs[0].push([L,R,B])}if(s===!1&&t>0)for(this.vertices.push(new i.Vector3(0,-c,0)),h=0;r>h;h++){var S=p[o][h+1],M=p[o][h],T=this.vertices.length-1,C=new i.Vector3(0,-1,0),A=new i.Vector3(0,-1,0),P=new i.Vector3(0,-1,0),L=d[o][h+1].clone(),R=d[o][h].clone(),B=new i.Vector2(R.x,1);this.faces.push(new i.Face3(S,M,T,[C,A,P])),this.faceVertexUvs[0].push([L,R,B])}this.computeFaceNormals()},i.CylinderGeometry.prototype=Object.create(i.Geometry.prototype),i.CylinderGeometry.prototype.constructor=i.CylinderGeometry,i.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(i.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),void this.computeFaceNormals())},i.ExtrudeGeometry.prototype=Object.create(i.Geometry.prototype),i.ExtrudeGeometry.prototype.constructor=i.ExtrudeGeometry,i.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,i=0;n>i;i++){var r=e[i];this.addShape(r,t)}},i.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function r(e,t,n){var r,o,s=1e-10,a=1,l=e.x-t.x,h=e.y-t.y,u=n.x-e.x,c=n.y-e.y,p=l*l+h*h,d=l*c-h*u;if(Math.abs(d)>s){var f=Math.sqrt(p),m=Math.sqrt(u*u+c*c),v=t.x-h/f,y=t.y+l/f,g=n.x-c/m,x=n.y+u/m,b=((g-v)*c-(x-y)*u)/(l*c-h*u);r=v+l*b-e.x,o=y+h*b-e.y;var _=r*r+o*o;if(2>=_)return new i.Vector2(r,o);a=Math.sqrt(_/2)}else{var w=!1;l>s?u>s&&(w=!0):-s>l?-s>u&&(w=!0):Math.sign(h)==Math.sign(c)&&(w=!0),w?(r=-h,o=l,a=Math.sqrt(p)):(r=l,o=h,a=Math.sqrt(p/2))}return new i.Vector2(r/a,o/a)}function o(){if(b){var e=0,t=H*e;for(Y=0;W>Y;Y++)q=O[Y],h(q[2]+t,q[1]+t,q[0]+t);for(e=w+2*x,t=H*e,Y=0;W>Y;Y++)q=O[Y],h(q[0]+t,q[1]+t,q[2]+t)}else{for(Y=0;W>Y;Y++)q=O[Y],h(q[2],q[1],q[0]);for(Y=0;W>Y;Y++)q=O[Y],h(q[0]+H*w,q[1]+H*w,q[2]+H*w)}}function s(){var e=0;for(a(V,e),e+=V.length,P=0,F=D.length;F>P;P++)A=D[P],a(A,e),e+=A.length}function a(e,t){var n,i;for(Y=e.length;--Y>=0;){n=Y,i=Y-1,0>i&&(i=e.length-1);var r=0,o=w+2*x;for(r=0;o>r;r++){var s=H*r,a=H*(r+1),l=t+n+s,h=t+i+s,c=t+i+a,p=t+n+a;u(l,h,c,p,e,r,o,n,i)}}}function l(e,t,n){L.vertices.push(new i.Vector3(e,t,n))}function h(e,t,n){e+=R,t+=R,n+=R,L.faces.push(new i.Face3(e,t,n,null,null,T));var r=C.generateTopUV(L,e,t,n);L.faceVertexUvs[0].push(r)}function u(e,t,n,r,o,s,a,l,h){e+=R,t+=R,n+=R,r+=R,L.faces.push(new i.Face3(e,t,r,null,null,E)),L.faces.push(new i.Face3(t,n,r,null,null,E));var u=C.generateSideWallUV(L,e,t,n,r);L.faceVertexUvs[0].push([u[0],u[1],u[3]]),L.faceVertexUvs[0].push([u[1],u[2],u[3]])}var c,p,d,f,m,v=void 0!==t.amount?t.amount:100,y=void 0!==t.bevelThickness?t.bevelThickness:6,g=void 0!==t.bevelSize?t.bevelSize:y-2,x=void 0!==t.bevelSegments?t.bevelSegments:3,b=void 0!==t.bevelEnabled?t.bevelEnabled:!0,_=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,S=t.extrudePath,M=!1,T=t.material,E=t.extrudeMaterial,C=void 0!==t.UVGenerator?t.UVGenerator:i.ExtrudeGeometry.WorldUVGenerator;S&&(c=S.getSpacedPoints(w),M=!0,b=!1,p=void 0!==t.frames?t.frames:new i.TubeGeometry.FrenetFrames(S,w,!1),d=new i.Vector3,f=new i.Vector3,m=new i.Vector3),b||(x=0,y=0,g=0);var A,P,F,L=this,R=this.vertices.length,B=e.extractPoints(_),k=B.shape,D=B.holes,N=!i.Shape.Utils.isClockWise(k);if(N){for(k=k.reverse(),P=0,F=D.length;F>P;P++)A=D[P],i.Shape.Utils.isClockWise(A)&&(D[P]=A.reverse());N=!1}var O=i.Shape.Utils.triangulateShape(k,D),V=k;for(P=0,F=D.length;F>P;P++)A=D[P],k=k.concat(A);for(var z,U,I,j,G,q,H=k.length,W=O.length,X=(V.length,180/Math.PI,[]),Y=0,Q=V.length,K=Q-1,Z=Y+1;Q>Y;Y++,K++,Z++){K===Q&&(K=0),Z===Q&&(Z=0);{V[Y],V[K],V[Z]}X[Y]=r(V[Y],V[K],V[Z])}var $,J=[],ee=X.concat();for(P=0,F=D.length;F>P;P++){for(A=D[P],$=[],Y=0,Q=A.length,K=Q-1,Z=Y+1;Q>Y;Y++,K++,Z++)K===Q&&(K=0),Z===Q&&(Z=0),$[Y]=r(A[Y],A[K],A[Z]);J.push($),ee=ee.concat($)}for(z=0;x>z;z++){for(I=z/x,j=y*(1-I),U=g*Math.sin(I*Math.PI/2),Y=0,Q=V.length;Q>Y;Y++)G=n(V[Y],X[Y],U),l(G.x,G.y,-j);for(P=0,F=D.length;F>P;P++)for(A=D[P],$=J[P],Y=0,Q=A.length;Q>Y;Y++)G=n(A[Y],$[Y],U),l(G.x,G.y,-j)}for(U=g,Y=0;H>Y;Y++)G=b?n(k[Y],ee[Y],U):k[Y],M?(f.copy(p.normals[0]).multiplyScalar(G.x),d.copy(p.binormals[0]).multiplyScalar(G.y),m.copy(c[0]).add(f).add(d),l(m.x,m.y,m.z)):l(G.x,G.y,0);var te;for(te=1;w>=te;te++)for(Y=0;H>Y;Y++)G=b?n(k[Y],ee[Y],U):k[Y],M?(f.copy(p.normals[te]).multiplyScalar(G.x),d.copy(p.binormals[te]).multiplyScalar(G.y),m.copy(c[te]).add(f).add(d),l(m.x,m.y,m.z)):l(G.x,G.y,v/w*te);for(z=x-1;z>=0;z--){for(I=z/x,j=y*(1-I),U=g*Math.sin(I*Math.PI/2),Y=0,Q=V.length;Q>Y;Y++)G=n(V[Y],X[Y],U),l(G.x,G.y,v+j);for(P=0,F=D.length;F>P;P++)for(A=D[P],$=J[P],Y=0,Q=A.length;Q>Y;Y++)G=n(A[Y],$[Y],U),M?l(G.x,G.y+c[w-1].y,c[w-1].x+j):l(G.x,G.y,v+j)}o(),s()},i.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r){var o=e.vertices,s=o[t],a=o[n],l=o[r];return[new i.Vector2(s.x,s.y),new i.Vector2(a.x,a.y),new i.Vector2(l.x,l.y)]},generateSideWallUV:function(e,t,n,r,o){var s=e.vertices,a=s[t],l=s[n],h=s[r],u=s[o];return Math.abs(a.y-l.y)<.01?[new i.Vector2(a.x,1-a.z),new i.Vector2(l.x,1-l.z),new i.Vector2(h.x,1-h.z),new i.Vector2(u.x,1-u.z)]:[new i.Vector2(a.y,1-a.z),new i.Vector2(l.y,1-l.z),new i.Vector2(h.y,1-h.z),new i.Vector2(u.y,1-u.z)]}},i.ShapeGeometry=function(e,t){i.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},i.ShapeGeometry.prototype=Object.create(i.Geometry.prototype),i.ShapeGeometry.prototype.constructor=i.ShapeGeometry,i.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,i=e.length;i>n;n++)this.addShape(e[n],t);return this},i.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n,r,o,s=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,l=void 0===t.UVGenerator?i.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=this.vertices.length,u=e.extractPoints(s),c=u.shape,p=u.holes,d=!i.Shape.Utils.isClockWise(c);if(d){for(c=c.reverse(),n=0,r=p.length;r>n;n++)o=p[n],i.Shape.Utils.isClockWise(o)&&(p[n]=o.reverse());d=!1}var f=i.Shape.Utils.triangulateShape(c,p),m=c;for(n=0,r=p.length;r>n;n++)o=p[n],c=c.concat(o);{var v,y,g=c.length,x=f.length;m.length}for(n=0;g>n;n++)v=c[n],this.vertices.push(new i.Vector3(v.x,v.y,0));for(n=0;x>n;n++){y=f[n];var b=y[0]+h,_=y[1]+h,w=y[2]+h;this.faces.push(new i.Face3(b,_,w,null,null,a)),this.faceVertexUvs[0].push(l.generateTopUV(this,b,_,w))}},i.LatheGeometry=function(e,t,n,r){i.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=t||12,n=n||0,r=r||2*Math.PI;for(var o=1/(e.length-1),s=1/t,a=0,l=t;l>=a;a++)for(var h=n+a*s*r,u=Math.cos(h),c=Math.sin(h),p=0,d=e.length;d>p;p++){var f=e[p],m=new i.Vector3;m.x=u*f.x-c*f.y,m.y=c*f.x+u*f.y,m.z=f.z,this.vertices.push(m)}for(var v=e.length,a=0,l=t;l>a;a++)for(var p=0,d=e.length-1;d>p;p++){var y=p+v*a,g=y,x=y+v,u=y+1+v,b=y+1,_=a*s,w=p*o,S=_+s,M=w+o;this.faces.push(new i.Face3(g,x,b)),this.faceVertexUvs[0].push([new i.Vector2(_,w),new i.Vector2(S,w),new i.Vector2(_,M)]),this.faces.push(new i.Face3(x,u,b)),this.faceVertexUvs[0].push([new i.Vector2(S,w),new i.Vector2(S,M),new i.Vector2(_,M)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},i.LatheGeometry.prototype=Object.create(i.Geometry.prototype),i.LatheGeometry.prototype.constructor=i.LatheGeometry,i.PlaneGeometry=function(e,t,n,r){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),i.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new i.PlaneBufferGeometry(e,t,n,r))},i.PlaneGeometry.prototype=Object.create(i.Geometry.prototype),i.PlaneGeometry.prototype.constructor=i.PlaneGeometry,i.PlaneBufferGeometry=function(e,t,n,r){i.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};for(var o=e/2,s=t/2,a=n||1,l=r||1,h=a+1,u=l+1,c=e/a,p=t/l,d=new Float32Array(h*u*3),f=new Float32Array(h*u*3),m=new Float32Array(h*u*2),v=0,y=0,g=0;u>g;g++)for(var x=g*p-s,b=0;h>b;b++){var _=b*c-o;d[v]=_,d[v+1]=-x,f[v+2]=1,m[y]=b/a,m[y+1]=1-g/l,v+=3,y+=2}v=0;for(var w=new(d.length/3>65535?Uint32Array:Uint16Array)(a*l*6),g=0;l>g;g++)for(var b=0;a>b;b++){var S=b+h*g,M=b+h*(g+1),T=b+1+h*(g+1),E=b+1+h*g;w[v]=S,w[v+1]=M,w[v+2]=E,w[v+3]=M,w[v+4]=T,w[v+5]=E,v+=6}this.addAttribute("index",new i.BufferAttribute(w,1)),this.addAttribute("position",new i.BufferAttribute(d,3)),this.addAttribute("normal",new i.BufferAttribute(f,3)),this.addAttribute("uv",new i.BufferAttribute(m,2))},i.PlaneBufferGeometry.prototype=Object.create(i.BufferGeometry.prototype),i.PlaneBufferGeometry.prototype.constructor=i.PlaneBufferGeometry,i.RingGeometry=function(e,t,n,r,o,s){i.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:o,thetaLength:s},e=e||0,t=t||50,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(1,r):8;var a,l,h=[],u=e,c=(t-e)/r;for(a=0;r+1>a;a++){for(l=0;n+1>l;l++){var p=new i.Vector3,d=o+l/n*s;p.x=u*Math.cos(d),p.y=u*Math.sin(d),this.vertices.push(p),h.push(new i.Vector2((p.x/t+1)/2,(p.y/t+1)/2))}u+=c}var f=new i.Vector3(0,0,1);for(a=0;r>a;a++){var m=a*(n+1);for(l=0;n>l;l++){var d=l+m,v=d,y=d+n+1,g=d+n+2;this.faces.push(new i.Face3(v,y,g,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([h[v].clone(),h[y].clone(),h[g].clone()]),v=d,y=d+n+2,g=d+1,this.faces.push(new i.Face3(v,y,g,[f.clone(),f.clone(),f.clone()])),this.faceVertexUvs[0].push([h[v].clone(),h[y].clone(),h[g].clone()])}}this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,u)},i.RingGeometry.prototype=Object.create(i.Geometry.prototype),i.RingGeometry.prototype.constructor=i.RingGeometry,i.SphereGeometry=function(e,t,n,r,o,s,a){i.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:o,thetaStart:s,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,s=void 0!==s?s:0,a=void 0!==a?a:Math.PI;var l,h,u=[],c=[];for(h=0;n>=h;h++){var p=[],d=[];for(l=0;t>=l;l++){var f=l/t,m=h/n,v=new i.Vector3;v.x=-e*Math.cos(r+f*o)*Math.sin(s+m*a),v.y=e*Math.cos(s+m*a),v.z=e*Math.sin(r+f*o)*Math.sin(s+m*a),this.vertices.push(v),p.push(this.vertices.length-1),d.push(new i.Vector2(f,1-m))}u.push(p),c.push(d)}for(h=0;n>h;h++)for(l=0;t>l;l++){var y=u[h][l+1],g=u[h][l],x=u[h+1][l],b=u[h+1][l+1],_=this.vertices[y].clone().normalize(),w=this.vertices[g].clone().normalize(),S=this.vertices[x].clone().normalize(),M=this.vertices[b].clone().normalize(),T=c[h][l+1].clone(),E=c[h][l].clone(),C=c[h+1][l].clone(),A=c[h+1][l+1].clone();Math.abs(this.vertices[y].y)===e?(T.x=(T.x+E.x)/2,this.faces.push(new i.Face3(y,x,b,[_,S,M])),this.faceVertexUvs[0].push([T,C,A])):Math.abs(this.vertices[x].y)===e?(C.x=(C.x+A.x)/2,this.faces.push(new i.Face3(y,g,x,[_,w,S])),this.faceVertexUvs[0].push([T,E,C])):(this.faces.push(new i.Face3(y,g,b,[_,w,M])),this.faceVertexUvs[0].push([T,E,A]),this.faces.push(new i.Face3(g,x,b,[w.clone(),S,M.clone()])),this.faceVertexUvs[0].push([E.clone(),C,A.clone()]))}this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,e)},i.SphereGeometry.prototype=Object.create(i.Geometry.prototype),i.SphereGeometry.prototype.constructor=i.SphereGeometry,i.TextGeometry=function(e,t){t=t||{};var n=i.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),i.ExtrudeGeometry.call(this,n,t),this.type="TextGeometry"},i.TextGeometry.prototype=Object.create(i.ExtrudeGeometry.prototype),i.TextGeometry.prototype.constructor=i.TextGeometry,i.TorusGeometry=function(e,t,n,r,o){i.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:o},e=e||100,t=t||40,n=n||8,r=r||6,o=o||2*Math.PI;for(var s=new i.Vector3,a=[],l=[],h=0;n>=h;h++)for(var u=0;r>=u;u++){var c=u/r*o,p=h/n*Math.PI*2;s.x=e*Math.cos(c),s.y=e*Math.sin(c);var d=new i.Vector3;d.x=(e+t*Math.cos(p))*Math.cos(c),d.y=(e+t*Math.cos(p))*Math.sin(c),d.z=t*Math.sin(p),this.vertices.push(d),a.push(new i.Vector2(u/r,h/n)),l.push(d.clone().sub(s).normalize())}for(var h=1;n>=h;h++)for(var u=1;r>=u;u++){var f=(r+1)*h+u-1,m=(r+1)*(h-1)+u-1,v=(r+1)*(h-1)+u,y=(r+1)*h+u,g=new i.Face3(f,m,y,[l[f].clone(),l[m].clone(),l[y].clone()]);this.faces.push(g),this.faceVertexUvs[0].push([a[f].clone(),a[m].clone(),a[y].clone()]),g=new i.Face3(m,v,y,[l[m].clone(),l[v].clone(),l[y].clone()]),this.faces.push(g),this.faceVertexUvs[0].push([a[m].clone(),a[v].clone(),a[y].clone()])}this.computeFaceNormals()},i.TorusGeometry.prototype=Object.create(i.Geometry.prototype),i.TorusGeometry.prototype.constructor=i.TorusGeometry,i.TorusKnotGeometry=function(e,t,n,r,o,s,a){function l(e,t,n,r,o){var s=Math.cos(e),a=Math.sin(e),l=t/n*e,h=Math.cos(l),u=r*(2+h)*.5*s,c=r*(2+h)*a*.5,p=o*r*Math.sin(l)*.5;return new i.Vector3(u,c,p)}i.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,p:o,q:s,heightScale:a},e=e||100,t=t||40,n=n||64,r=r||8,o=o||2,s=s||3,a=a||1;for(var h=new Array(n),u=new i.Vector3,c=new i.Vector3,p=new i.Vector3,d=0;n>d;++d){h[d]=new Array(r);var f=d/n*2*o*Math.PI,m=l(f,s,o,e,a),v=l(f+.01,s,o,e,a);u.subVectors(v,m),c.addVectors(v,m),p.crossVectors(u,c),c.crossVectors(p,u),p.normalize(),c.normalize();for(var y=0;r>y;++y){var g=y/r*2*Math.PI,x=-t*Math.cos(g),b=t*Math.sin(g),_=new i.Vector3;_.x=m.x+x*c.x+b*p.x,_.y=m.y+x*c.y+b*p.y,_.z=m.z+x*c.z+b*p.z,h[d][y]=this.vertices.push(_)-1}}for(var d=0;n>d;++d)for(var y=0;r>y;++y){var w=(d+1)%n,S=(y+1)%r,M=h[d][y],T=h[w][y],E=h[w][S],C=h[d][S],A=new i.Vector2(d/n,y/r),P=new i.Vector2((d+1)/n,y/r),F=new i.Vector2((d+1)/n,(y+1)/r),L=new i.Vector2(d/n,(y+1)/r);this.faces.push(new i.Face3(M,T,C)),this.faceVertexUvs[0].push([A,P,L]),this.faces.push(new i.Face3(T,E,C)),this.faceVertexUvs[0].push([P.clone(),F,L.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},i.TorusKnotGeometry.prototype=Object.create(i.Geometry.prototype),i.TorusKnotGeometry.prototype.constructor=i.TorusKnotGeometry,i.TubeGeometry=function(e,t,n,r,o,s){function a(e,t,n){return F.vertices.push(new i.Vector3(e,t,n))-1}i.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:n,radialSegments:r,closed:o},t=t||64,n=n||1,r=r||8,o=o||!1,s=s||i.TubeGeometry.NoTaper;var l,h,u,c,p,d,f,m,v,y,g,x,b,_,w,S,M,T,E,C,A,P=[],F=this,L=t+1,R=new i.Vector3,B=new i.TubeGeometry.FrenetFrames(e,t,o),k=B.tangents,D=B.normals,N=B.binormals;for(this.tangents=k,this.normals=D,this.binormals=N,y=0;L>y;y++)for(P[y]=[],c=y/(L-1),v=e.getPointAt(c),l=k[y],h=D[y],u=N[y],d=n*s(c),g=0;r>g;g++)p=g/r*2*Math.PI,f=-d*Math.cos(p),m=d*Math.sin(p),R.copy(v),R.x+=f*h.x+m*u.x,R.y+=f*h.y+m*u.y,R.z+=f*h.z+m*u.z,P[y][g]=a(R.x,R.y,R.z);for(y=0;t>y;y++)for(g=0;r>g;g++)x=o?(y+1)%t:y+1,b=(g+1)%r,_=P[y][g],w=P[x][g],S=P[x][b],M=P[y][b],T=new i.Vector2(y/t,g/r),E=new i.Vector2((y+1)/t,g/r),C=new i.Vector2((y+1)/t,(g+1)/r),A=new i.Vector2(y/t,(g+1)/r),this.faces.push(new i.Face3(_,w,M)),this.faceVertexUvs[0].push([T,E,A]),this.faces.push(new i.Face3(w,S,M)),this.faceVertexUvs[0].push([E.clone(),C,A.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},i.TubeGeometry.prototype=Object.create(i.Geometry.prototype),i.TubeGeometry.prototype.constructor=i.TubeGeometry,i.TubeGeometry.NoTaper=function(e){return 1},i.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},i.TubeGeometry.FrenetFrames=function(e,t,n){function r(){f[0]=new i.Vector3,m[0]=new i.Vector3,s=Number.MAX_VALUE,a=Math.abs(d[0].x),l=Math.abs(d[0].y),h=Math.abs(d[0].z),s>=a&&(s=a,p.set(1,0,0)),s>=l&&(s=l,p.set(0,1,0)),s>=h&&p.set(0,0,1),v.crossVectors(d[0],p).normalize(),f[0].crossVectors(d[0],v),m[0].crossVectors(d[0],f[0])}var o,s,a,l,h,u,c,p=(new i.Vector3,new i.Vector3),d=(new i.Vector3,[]),f=[],m=[],v=new i.Vector3,y=new i.Matrix4,g=t+1,x=1e-4;for(this.tangents=d,this.normals=f,this.binormals=m,u=0;g>u;u++)c=u/(g-1),d[u]=e.getTangentAt(c),d[u].normalize();for(r(),u=1;g>u;u++)f[u]=f[u-1].clone(),m[u]=m[u-1].clone(),v.crossVectors(d[u-1],d[u]),v.length()>x&&(v.normalize(),o=Math.acos(i.Math.clamp(d[u-1].dot(d[u]),-1,1)),f[u].applyMatrix4(y.makeRotationAxis(v,o))),m[u].crossVectors(d[u],f[u]);if(n)for(o=Math.acos(i.Math.clamp(f[0].dot(f[g-1]),-1,1)),o/=g-1,d[0].dot(v.crossVectors(f[0],f[g-1]))>0&&(o=-o),u=1;g>u;u++)f[u].applyMatrix4(y.makeRotationAxis(d[u],o*u)),m[u].crossVectors(d[u],f[u])},i.PolyhedronGeometry=function(e,t,n,r){function o(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var n=l(e)/2/Math.PI+.5,r=h(e)/Math.PI+.5;return t.uv=new i.Vector2(n,1-r),t}function s(e,t,n){var r=new i.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);c.faces.push(r),b.copy(e).add(t).add(n).divideScalar(3);var o=l(b);c.faceVertexUvs[0].push([u(e.uv,e,o),u(t.uv,t,o),u(n.uv,n,o)])}function a(e,t){for(var n=Math.pow(2,t),i=(Math.pow(4,t),o(c.vertices[e.a])),r=o(c.vertices[e.b]),a=o(c.vertices[e.c]),l=[],h=0;n>=h;h++){l[h]=[];for(var u=o(i.clone().lerp(a,h/n)),p=o(r.clone().lerp(a,h/n)),d=n-h,f=0;d>=f;f++)l[h][f]=0==f&&h==n?u:o(u.clone().lerp(p,f/d))}for(var h=0;n>h;h++)for(var f=0;2*(n-h)-1>f;f++){var m=Math.floor(f/2);f%2==0?s(l[h][m+1],l[h+1][m],l[h][m]):s(l[h][m+1],l[h+1][m+1],l[h+1][m])}}function l(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function u(e,t,n){return 0>n&&1===e.x&&(e=new i.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new i.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}i.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1,r=r||0;for(var c=this,p=0,d=e.length;d>p;p+=3)o(new i.Vector3(e[p],e[p+1],e[p+2]));for(var f=this.vertices,m=[],p=0,v=0,d=t.length;d>p;p+=3,v++){var y=f[t[p]],g=f[t[p+1]],x=f[t[p+2]];m[v]=new i.Face3(y.index,g.index,x.index,[y.clone(),g.clone(),x.clone()])}for(var b=new i.Vector3,p=0,d=m.length;d>p;p++)a(m[p],r);for(var p=0,d=this.faceVertexUvs[0].length;d>p;p++){var _=this.faceVertexUvs[0][p],w=_[0].x,S=_[1].x,M=_[2].x,T=Math.max(w,Math.max(S,M)),E=Math.min(w,Math.min(S,M));T>.9&&.1>E&&(.2>w&&(_[0].x+=1),.2>S&&(_[1].x+=1),.2>M&&(_[2].x+=1))}for(var p=0,d=this.vertices.length;d>p;p++)this.vertices[p].multiplyScalar(n);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new i.Sphere(new i.Vector3,n)},i.PolyhedronGeometry.prototype=Object.create(i.Geometry.prototype),i.PolyhedronGeometry.prototype.constructor=i.PolyhedronGeometry,i.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2,r=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];i.PolyhedronGeometry.call(this,o,s,e,t)},i.DodecahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.DodecahedronGeometry.prototype.constructor=i.DodecahedronGeometry,i.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];i.PolyhedronGeometry.call(this,r,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},i.IcosahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.IcosahedronGeometry.prototype.constructor=i.IcosahedronGeometry,i.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];i.PolyhedronGeometry.call(this,n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},i.OctahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.OctahedronGeometry.prototype.constructor=i.OctahedronGeometry,i.TetrahedronGeometry=function(e,t){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];i.PolyhedronGeometry.call(this,n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},i.TetrahedronGeometry.prototype=Object.create(i.Geometry.prototype),i.TetrahedronGeometry.prototype.constructor=i.TetrahedronGeometry,i.ParametricGeometry=function(e,t,n){i.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var r,o,s,a,l,h=this.vertices,u=this.faces,c=this.faceVertexUvs[0],p=t+1;for(r=0;n>=r;r++)for(l=r/n,o=0;t>=o;o++)a=o/t,s=e(a,l),h.push(s);var d,f,m,v,y,g,x,b;for(r=0;n>r;r++)for(o=0;t>o;o++)d=r*p+o,f=r*p+o+1,m=(r+1)*p+o+1,v=(r+1)*p+o,y=new i.Vector2(o/t,r/n),g=new i.Vector2((o+1)/t,r/n),x=new i.Vector2((o+1)/t,(r+1)/n),b=new i.Vector2(o/t,(r+1)/n),u.push(new i.Face3(d,f,v)),c.push([y,g,b]),u.push(new i.Face3(f,m,v)),c.push([g.clone(),x,b.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},i.ParametricGeometry.prototype=Object.create(i.Geometry.prototype),i.ParametricGeometry.prototype.constructor=i.ParametricGeometry,i.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new i.BufferGeometry;r.addAttribute("position",new i.BufferAttribute(t,3)),r.addAttribute("color",new i.BufferAttribute(n,3));var o=new i.LineBasicMaterial({vertexColors:i.VertexColors});i.Line.call(this,r,o,i.LinePieces)},i.AxisHelper.prototype=Object.create(i.Line.prototype),i.AxisHelper.prototype.constructor=i.AxisHelper,i.ArrowHelper=function(){var e=new i.Geometry;e.vertices.push(new i.Vector3(0,0,0),new i.Vector3(0,1,0));var t=new i.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0)),function(n,r,o,s,a,l){i.Object3D.call(this),void 0===s&&(s=16776960),void 0===o&&(o=1),void 0===a&&(a=.2*o),void 0===l&&(l=.2*a),this.position.copy(r),this.line=new i.Line(e,new i.LineBasicMaterial({color:s})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new i.Mesh(t,new i.MeshBasicMaterial({color:s})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(o,a,l)}}(),i.ArrowHelper.prototype=Object.create(i.Object3D.prototype),i.ArrowHelper.prototype.constructor=i.ArrowHelper,i.ArrowHelper.prototype.setDirection=function(){var e,t=new i.Vector3;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),i.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},i.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},i.BoxHelper=function(e){var t=new i.BufferGeometry;t.addAttribute("position",new i.BufferAttribute(new Float32Array(72),3)),i.Line.call(this,t,new i.LineBasicMaterial({color:16776960}),i.LinePieces),void 0!==e&&this.update(e)},i.BoxHelper.prototype=Object.create(i.Line.prototype),i.BoxHelper.prototype.constructor=i.BoxHelper,i.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,i=t.boundingBox.max,r=this.geometry.attributes.position.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=n.x,r[4]=i.y,r[5]=i.z,r[6]=n.x,r[7]=i.y,r[8]=i.z,r[9]=n.x,r[10]=n.y,r[11]=i.z,r[12]=n.x,r[13]=n.y,r[14]=i.z,r[15]=i.x,r[16]=n.y,r[17]=i.z,r[18]=i.x,r[19]=n.y,r[20]=i.z,r[21]=i.x,r[22]=i.y,r[23]=i.z,r[24]=i.x,r[25]=i.y,r[26]=n.z,r[27]=n.x,r[28]=i.y,r[29]=n.z,r[30]=n.x,r[31]=i.y,r[32]=n.z,r[33]=n.x,r[34]=n.y,r[35]=n.z,r[36]=n.x,r[37]=n.y,r[38]=n.z,r[39]=i.x,r[40]=n.y,r[41]=n.z,r[42]=i.x,r[43]=n.y,r[44]=n.z,r[45]=i.x,r[46]=i.y,r[47]=n.z,r[48]=i.x,r[49]=i.y,r[50]=i.z,r[51]=i.x,r[52]=i.y,r[53]=n.z,r[54]=n.x,r[55]=i.y,r[56]=i.z,r[57]=n.x,r[58]=i.y,r[59]=n.z,r[60]=n.x,r[61]=n.y,r[62]=i.z,r[63]=n.x,r[64]=n.y,r[65]=n.z,r[66]=i.x,r[67]=n.y,r[68]=i.z,r[69]=i.x,r[70]=n.y,r[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},i.BoundingBoxHelper=function(e,t){var n=void 0!==t?t:8947848;this.object=e,this.box=new i.Box3,i.Mesh.call(this,new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:n,wireframe:!0}))},i.BoundingBoxHelper.prototype=Object.create(i.Mesh.prototype),i.BoundingBoxHelper.prototype.constructor=i.BoundingBoxHelper,i.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},i.CameraHelper=function(e){function t(e,t,i){n(e,i),n(t,i)}function n(e,t){r.vertices.push(new i.Vector3),r.colors.push(new i.Color(t)),void 0===s[e]&&(s[e]=[]),s[e].push(r.vertices.length-1)}var r=new i.Geometry,o=new i.LineBasicMaterial({color:16777215,vertexColors:i.FaceColors}),s={},a=16755200,l=16711680,h=43775,u=16777215,c=3355443;t("n1","n2",a),t("n2","n4",a),t("n4","n3",a),t("n3","n1",a),t("f1","f2",a),t("f2","f4",a),t("f4","f3",a),t("f3","f1",a),t("n1","f1",a),t("n2","f2",a),t("n3","f3",a),t("n4","f4",a),t("p","n1",l),t("p","n2",l),t("p","n3",l),t("p","n4",l),t("u1","u2",h),t("u2","u3",h),t("u3","u1",h),t("c","t",u),t("p","c",c),t("cn1","cn2",c),t("cn3","cn4",c),t("cf1","cf2",c),t("cf3","cf4",c),i.Line.call(this,r,o,i.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},i.CameraHelper.prototype=Object.create(i.Line.prototype),i.CameraHelper.prototype.constructor=i.CameraHelper,i.CameraHelper.prototype.update=function(){var e,t,n=new i.Vector3,r=new i.Camera,o=function(i,o,s,a){
n.set(o,s,a).unproject(r);var l=t[i];if(void 0!==l)for(var h=0,u=l.length;u>h;h++)e.vertices[l[h]].copy(n)};return function(){e=this.geometry,t=this.pointMap;var n=1,i=1;r.projectionMatrix.copy(this.camera.projectionMatrix),o("c",0,0,-1),o("t",0,0,1),o("n1",-n,-i,-1),o("n2",n,-i,-1),o("n3",-n,i,-1),o("n4",n,i,-1),o("f1",-n,-i,1),o("f2",n,-i,1),o("f3",-n,i,1),o("f4",n,i,1),o("u1",.7*n,1.1*i,-1),o("u2",.7*-n,1.1*i,-1),o("u3",0,2*i,-1),o("cf1",-n,0,1),o("cf2",n,0,1),o("cf3",0,-i,1),o("cf4",0,i,1),o("cn1",-n,0,-1),o("cn2",n,0,-1),o("cn3",0,-i,-1),o("cn4",0,i,-1),e.verticesNeedUpdate=!0}}(),i.DirectionalLightHelper=function(e,t){i.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new i.Geometry;n.vertices.push(new i.Vector3(-t,t,0),new i.Vector3(t,t,0),new i.Vector3(t,-t,0),new i.Vector3(-t,-t,0),new i.Vector3(-t,t,0));var r=new i.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new i.Line(n,r),this.add(this.lightPlane),n=new i.Geometry,n.vertices.push(new i.Vector3,new i.Vector3),r=new i.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new i.Line(n,r),this.add(this.targetLine),this.update()},i.DirectionalLightHelper.prototype=Object.create(i.Object3D.prototype),i.DirectionalLightHelper.prototype.constructor=i.DirectionalLightHelper,i.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},i.DirectionalLightHelper.prototype.update=function(){var e=new i.Vector3,t=new i.Vector3,n=new i.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),i.EdgesHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],o={},s=function(e,t){return e-t},a=["a","b","c"],l=new i.BufferGeometry,h=e.geometry.clone();h.mergeVertices(),h.computeFaceNormals();for(var u=h.vertices,c=h.faces,p=0,d=0,f=c.length;f>d;d++)for(var m=c[d],v=0;3>v;v++){r[0]=m[a[v]],r[1]=m[a[(v+1)%3]],r.sort(s);var y=r.toString();void 0===o[y]?(o[y]={vert1:r[0],vert2:r[1],face1:d,face2:void 0},p++):o[y].face2=d}var g=new Float32Array(2*p*3),x=0;for(var y in o){var b=o[y];if(void 0===b.face2||c[b.face1].normal.dot(c[b.face2].normal)<.9999){var _=u[b.vert1];g[x++]=_.x,g[x++]=_.y,g[x++]=_.z,_=u[b.vert2],g[x++]=_.x,g[x++]=_.y,g[x++]=_.z}}l.addAttribute("position",new i.BufferAttribute(g,3)),i.Line.call(this,l,new i.LineBasicMaterial({color:n}),i.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},i.EdgesHelper.prototype=Object.create(i.Line.prototype),i.EdgesHelper.prototype.constructor=i.EdgesHelper,i.FaceNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==n?n:16776960,s=void 0!==r?r:1,a=new i.Geometry,l=this.object.geometry.faces,h=0,u=l.length;u>h;h++)a.vertices.push(new i.Vector3,new i.Vector3);i.Line.call(this,a,new i.LineBasicMaterial({color:o,linewidth:s}),i.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new i.Matrix3,this.update()},i.FaceNormalsHelper.prototype=Object.create(i.Line.prototype),i.FaceNormalsHelper.prototype.constructor=i.FaceNormalsHelper,i.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,i=t.geometry.faces,r=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(r);for(var o=0,s=0,a=i.length;a>o;o++,s+=2){var l=i[o];e[s].copy(n[l.a]).add(n[l.b]).add(n[l.c]).divideScalar(3).applyMatrix4(r),e[s+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[s])}return this.geometry.verticesNeedUpdate=!0,this},i.GridHelper=function(e,t){var n=new i.Geometry,r=new i.LineBasicMaterial({vertexColors:i.VertexColors});this.color1=new i.Color(4473924),this.color2=new i.Color(8947848);for(var o=-e;e>=o;o+=t){n.vertices.push(new i.Vector3(-e,0,o),new i.Vector3(e,0,o),new i.Vector3(o,0,-e),new i.Vector3(o,0,e));var s=0===o?this.color1:this.color2;n.colors.push(s,s,s,s)}i.Line.call(this,n,r,i.LinePieces)},i.GridHelper.prototype=Object.create(i.Line.prototype),i.GridHelper.prototype.constructor=i.GridHelper,i.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},i.HemisphereLightHelper=function(e,t,n,r){i.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new i.Color,new i.Color];var o=new i.SphereGeometry(t,4,2);o.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));for(var s=0,a=8;a>s;s++)o.faces[s].color=this.colors[4>s?0:1];var l=new i.MeshBasicMaterial({vertexColors:i.FaceColors,wireframe:!0});this.lightSphere=new i.Mesh(o,l),this.add(this.lightSphere),this.update()},i.HemisphereLightHelper.prototype=Object.create(i.Object3D.prototype),i.HemisphereLightHelper.prototype.constructor=i.HemisphereLightHelper,i.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},i.HemisphereLightHelper.prototype.update=function(){var e=new i.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),i.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new i.SphereGeometry(t,4,2),r=new i.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),i.Mesh.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},i.PointLightHelper.prototype=Object.create(i.Mesh.prototype),i.PointLightHelper.prototype.constructor=i.PointLightHelper,i.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},i.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},i.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new i.Geometry,n=0;n<this.bones.length;n++){var r=this.bones[n];r.parent instanceof i.Bone&&(t.vertices.push(new i.Vector3),t.vertices.push(new i.Vector3),t.colors.push(new i.Color(0,0,1)),t.colors.push(new i.Color(0,1,0)))}var o=new i.LineBasicMaterial({vertexColors:i.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});i.Line.call(this,t,o,i.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},i.SkeletonHelper.prototype=Object.create(i.Line.prototype),i.SkeletonHelper.prototype.constructor=i.SkeletonHelper,i.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof i.Bone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,this.getBoneList(e.children[n]));return t},i.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new i.Matrix4).getInverse(this.root.matrixWorld),n=new i.Matrix4,r=0,o=0;o<this.bones.length;o++){var s=this.bones[o];s.parent instanceof i.Bone&&(n.multiplyMatrices(t,s.matrixWorld),e.vertices[r].setFromMatrixPosition(n),n.multiplyMatrices(t,s.parent.matrixWorld),e.vertices[r+1].setFromMatrixPosition(n),r+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},i.SpotLightHelper=function(e){i.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new i.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));var n=new i.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new i.Mesh(t,n),this.add(this.cone),this.update()},i.SpotLightHelper.prototype=Object.create(i.Object3D.prototype),i.SpotLightHelper.prototype.constructor=i.SpotLightHelper,i.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},i.SpotLightHelper.prototype.update=function(){var e=new i.Vector3,t=new i.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,i=n*Math.tan(this.light.angle);this.cone.scale.set(i,i,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),i.VertexNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==n?n:16711680,s=void 0!==r?r:1,a=new i.Geometry,l=(e.geometry.vertices,e.geometry.faces),h=0,u=l.length;u>h;h++)for(var c=l[h],p=0,d=c.vertexNormals.length;d>p;p++)a.vertices.push(new i.Vector3,new i.Vector3);i.Line.call(this,a,new i.LineBasicMaterial({color:o,linewidth:s}),i.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new i.Matrix3,this.update()},i.VertexNormalsHelper.prototype=Object.create(i.Line.prototype),i.VertexNormalsHelper.prototype.constructor=i.VertexNormalsHelper,i.VertexNormalsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,h=o.length;h>l;l++)for(var u=o[l],c=0,p=u.vertexNormals.length;p>c;c++){var d=u[n[c]],f=r[d],m=u.vertexNormals[c];i[a].copy(f).applyMatrix4(s),t.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(i[a]),a+=1,i[a].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),i.VertexTangentsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;for(var o=void 0!==n?n:255,s=void 0!==r?r:1,a=new i.Geometry,l=(e.geometry.vertices,e.geometry.faces),h=0,u=l.length;u>h;h++)for(var c=l[h],p=0,d=c.vertexTangents.length;d>p;p++)a.vertices.push(new i.Vector3),a.vertices.push(new i.Vector3);i.Line.call(this,a,new i.LineBasicMaterial({color:o,linewidth:s}),i.LinePieces),this.matrixAutoUpdate=!1,this.update()},i.VertexTangentsHelper.prototype=Object.create(i.Line.prototype),i.VertexTangentsHelper.prototype.constructor=i.VertexTangentsHelper,i.VertexTangentsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,r=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,h=o.length;h>l;l++)for(var u=o[l],c=0,p=u.vertexTangents.length;p>c;c++){var d=u[n[c]],f=r[d],m=u.vertexTangents[c];i[a].copy(f).applyMatrix4(s),t.copy(m).transformDirection(s).multiplyScalar(this.size),t.add(i[a]),a+=1,i[a].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),i.WireframeHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],o={},s=function(e,t){return e-t},a=["a","b","c"],l=new i.BufferGeometry;if(e.geometry instanceof i.Geometry){for(var h=e.geometry.vertices,u=e.geometry.faces,c=0,p=new Uint32Array(6*u.length),d=0,f=u.length;f>d;d++)for(var m=u[d],v=0;3>v;v++){r[0]=m[a[v]],r[1]=m[a[(v+1)%3]],r.sort(s);var y=r.toString();void 0===o[y]&&(p[2*c]=r[0],p[2*c+1]=r[1],o[y]=!0,c++)}for(var g=new Float32Array(2*c*3),d=0,f=c;f>d;d++)for(var v=0;2>v;v++){var x=h[p[2*d+v]],b=6*d+3*v;g[b+0]=x.x,g[b+1]=x.y,g[b+2]=x.z}l.addAttribute("position",new i.BufferAttribute(g,3))}else if(e.geometry instanceof i.BufferGeometry)if(void 0!==e.geometry.attributes.index){var h=e.geometry.attributes.position.array,_=e.geometry.attributes.index.array,w=e.geometry.drawcalls,c=0;0===w.length&&(w=[{count:_.length,index:0,start:0}]);for(var p=new Uint32Array(2*_.length),S=0,M=w.length;M>S;++S)for(var T=w[S].start,E=w[S].count,b=w[S].index,d=T,C=T+E;C>d;d+=3)for(var v=0;3>v;v++){r[0]=b+_[d+v],r[1]=b+_[d+(v+1)%3],r.sort(s);var y=r.toString();void 0===o[y]&&(p[2*c]=r[0],p[2*c+1]=r[1],o[y]=!0,c++)}for(var g=new Float32Array(2*c*3),d=0,f=c;f>d;d++)for(var v=0;2>v;v++){var b=6*d+3*v,A=3*p[2*d+v];g[b+0]=h[A],g[b+1]=h[A+1],g[b+2]=h[A+2]}l.addAttribute("position",new i.BufferAttribute(g,3))}else{for(var h=e.geometry.attributes.position.array,c=h.length/3,P=c/3,g=new Float32Array(2*c*3),d=0,f=P;f>d;d++)for(var v=0;3>v;v++){var b=18*d+6*v,F=9*d+3*v;g[b+0]=h[F],g[b+1]=h[F+1],g[b+2]=h[F+2];var A=9*d+3*((v+1)%3);g[b+3]=h[A],g[b+4]=h[A+1],g[b+5]=h[A+2]}l.addAttribute("position",new i.BufferAttribute(g,3))}i.Line.call(this,l,new i.LineBasicMaterial({color:n}),i.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},i.WireframeHelper.prototype=Object.create(i.Line.prototype),i.WireframeHelper.prototype.constructor=i.WireframeHelper,i.ImmediateRenderObject=function(){i.Object3D.call(this),this.render=function(e){}},i.ImmediateRenderObject.prototype=Object.create(i.Object3D.prototype),i.ImmediateRenderObject.prototype.constructor=i.ImmediateRenderObject,i.MorphBlendMesh=function(e,t){i.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,r="__default",o=0,s=n-1,a=n/1;this.createAnimation(r,o,s,a),this.setAnimationWeight(r,1)},i.MorphBlendMesh.prototype=Object.create(i.Mesh.prototype),i.MorphBlendMesh.prototype.constructor=i.MorphBlendMesh,i.MorphBlendMesh.prototype.createAnimation=function(e,t,n,i){var r={startFrame:t,endFrame:n,length:n-t+1,fps:i,duration:(n-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},i.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,n=/([a-z]+)_?(\d+)/,i={},r=this.geometry,o=0,s=r.morphTargets.length;s>o;o++){var a=r.morphTargets[o],l=a.name.match(n);if(l&&l.length>1){{var h=l[1];l[2]}i[h]||(i[h]={start:1/0,end:-(1/0)});var u=i[h];o<u.start&&(u.start=o),o>u.end&&(u.end=o),t||(t=h)}}for(var h in i){var u=i[h];this.createAnimation(h,u.start,u.end,e)}this.firstAnimation=t},i.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},i.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},i.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},i.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},i.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},i.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},i.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},i.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},i.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},i.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},i.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;n>t;t++){var r=this.animationsList[t];if(r.active){var o=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var s=r.startFrame+i.Math.clamp(Math.floor(r.time/o),0,r.length-1),a=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s);var l=r.time%o/o;r.directionBackwards&&(l=1-l),this.morphTargetInfluences[r.currentFrame]=l*a,this.morphTargetInfluences[r.lastFrame]=(1-l)*a}}}},{}],50:[function(require,module,exports){!function(root){"use strict";function MainModule(e){Tone=e()}function ToneModule(e){e(Tone)}var Tone;MainModule(function(){function e(e){return void 0===e}function t(e){return"function"==typeof e}var n;if(e(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),e(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),e(AudioContext))throw new Error("Web Audio is not supported in this browser");n=new AudioContext,t(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),t(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),t(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),t(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),t(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),t(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),t(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),t(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(t,n,i){if(t.input)Array.isArray(t.input)?(e(i)&&(i=0),this.connect(t.input[i])):this.connect(t.input,n,i);else try{t instanceof AudioNode?this._nativeConnect(t,n,i):this._nativeConnect(t,n)}catch(r){throw new Error("error connecting to node: "+t)}};var i=function(t,n){e(t)||1===t?this.input=this.context.createGain():t>1&&(this.input=new Array(t)),e(n)||1===n?this.output=this.context.createGain():n>1&&(this.output=new Array(t))};i.prototype.set=function(t,n,r){if("object"==typeof t)r=n;else if("string"==typeof t){var o={};o[t]=n,t=o}for(var s in t){var a=this[s];e(a)||(n=t[s],a instanceof i.Signal?a.value!==n&&(e(r)?a.value=n:a.rampTo(n,r)):a instanceof AudioParam?a.value!==n&&(a.value=n):a instanceof i?a.set(n):a!==n&&(this[s]=n))}return this},i.prototype.get=function(n){e(n)&&(n=this._collectDefaults(this.constructor));for(var r={},o=0;o<n.length;o++){var s=n[o],a=this[s];a instanceof i.Signal?r[s]=a.value:a instanceof AudioParam?r[s]=a.value:a instanceof i?r[s]=a.get():t(a)||e(a)||(r[s]=a)}return r},i.prototype._collectDefaults=function(t){var n=[];return e(t.defaults)||(n=Object.keys(t.defaults)),e(t._super)||(n=n.concat(this._collectDefaults(t._super))),n},i.prototype.setPreset=function(e){return!this.isUndef(this.preset)&&this.preset.hasOwnProperty(e)&&this.set(this.preset[e]),this},i.context=n,i.prototype.context=i.context,i.prototype.bufferSize=2048,i.prototype.bufferTime=i.prototype.bufferSize/i.context.sampleRate,i.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this};var r=null;i.prototype.noGC=function(){return this.output.connect(r),this},AudioNode.prototype.noGC=function(){return this.connect(r),this},i.prototype.connect=function(e,t,n){return Array.isArray(this.output)?(t=this.defaultArg(t,0),this.output[t].connect(e,0,n)):this.output.connect(e,t,n),this},i.prototype.disconnect=function(e){return Array.isArray(this.output)?(e=this.defaultArg(e,0),this.output[e].disconnect()):this.output.disconnect(),this},i.prototype.connectSeries=function(){if(arguments.length>1)for(var e=arguments[0],t=1;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}return this},i.prototype.connectParallel=function(){var e=arguments[0];if(arguments.length>1)for(var t=1;t<arguments.length;t++){var n=arguments[t];e.connect(n)}return this},i.prototype.chain=function(){if(arguments.length>0)for(var e=this,t=0;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}return this},i.prototype.fan=function(){if(arguments.length>0)for(var e=0;e<arguments.length;e++)this.connect(arguments[e]);return this},AudioNode.prototype.chain=i.prototype.chain,AudioNode.prototype.fan=i.prototype.fan,i.prototype.defaultArg=function(t,n){if("object"==typeof t&&"object"==typeof n){var i={};for(var r in t)i[r]=this.defaultArg(t[r],t[r]);for(var o in n)i[o]=this.defaultArg(t[o],n[o]);return i}return e(t)?n:t},i.prototype.optionsObject=function(e,t,n){var i={};if(1===e.length&&"object"==typeof e[0])i=e[0];else for(var r=0;r<t.length;r++)i[t[r]]=e[r];return this.isUndef(n)?i:this.defaultArg(i,n)},i.prototype.isUndef=e,i.prototype.isFunction=t,i.prototype.interpolate=function(e,t,n){return e*(n-t)+t},i.prototype.normalize=function(e,t,n){if(t>n){var i=n;n=t,t=i}else if(t==n)return 0;return(e-t)/(n-t)},i.prototype.equalPowerScale=function(e){var t=.5*Math.PI;return Math.sin(e*t)},i.prototype.dbToGain=function(e){return Math.pow(2,e/6)},i.prototype.gainToDb=function(e){return 20*(Math.log(e)/Math.LN10)},i.prototype.now=function(){return this.context.currentTime},i.prototype.samplesToSeconds=function(e){return e/this.context.sampleRate},i.prototype.toSamples=function(e){var t=this.toSeconds(e);return Math.round(t*this.context.sampleRate)},i.prototype.toSeconds=function(e,t){if(t=this.defaultArg(t,this.now()),"number"==typeof e)return e;if("string"==typeof e){var n=0;return"+"===e.charAt(0)&&(e=e.slice(1),n=t),parseFloat(e)+n}return t},i.prototype.isFrequency=function(){var e=new RegExp(/\d*\.?\d+hz$/i);return function(t){return e.test(t)}}(),i.prototype.frequencyToSeconds=function(e){return 1/parseFloat(e)},i.prototype.secondsToFrequency=function(e){return 1/e},i.extend=function(t,n){function r(){}e(n)&&(n=i),r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t,t._super=n};var o=[];return i._initAudioContext=function(e){e(i.context),o.push(e)},i.setContext=function(e){i.prototype.context=e,i.context=e;for(var t=0;t<o.length;t++)o[t](e)},i.startMobile=function(){var e=i.context.createOscillator(),t=i.context.createGain();t.gain.value=0,e.connect(t),t.connect(i.context.destination);var n=i.context.currentTime;e.start(n),e.stop(n+1)},i._initAudioContext(function(e){i.prototype.bufferTime=i.prototype.bufferSize/e.sampleRate,r=e.createGain(),r.gain.value=0,r.connect(e.destination)}),console.log("%c * Tone.js r4 * ","background: #000; color: #fff"),i}),ToneModule(function(e){return e.SignalBase=function(){},e.extend(e.SignalBase),e.SignalBase.prototype.connect=function(t,n,i){return t.constructor===e.Signal?(t._value.cancelScheduledValues(0),t._value.value=0):t instanceof AudioParam&&(t.cancelScheduledValues(0),t.value=0),e.prototype.connect.call(this,t,n,i),this},e.SignalBase}),ToneModule(function(e){return e.WaveShaper=function(e,t){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(e)?this.curve=e:isFinite(e)||this.isUndef(e)?this._curve=new Float32Array(this.defaultArg(e,1024)):this.isFunction(e)&&(this._curve=new Float32Array(this.defaultArg(t,1024)),this.setMap(e))},e.extend(e.WaveShaper,e.SignalBase),e.WaveShaper.prototype.setMap=function(e){for(var t=0,n=this._curve.length;n>t;t++){var i=t/n*2-1;this._curve[t]=e(i,t)}return this._shaper.curve=this._curve,this},Object.defineProperty(e.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(e){if(this._isSafari()){var t=e[0];e.unshift(t)}this._curve=new Float32Array(e),this._shaper.curve=this._curve}}),Object.defineProperty(e.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),e.WaveShaper.prototype._isSafari=function(){var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")},e.WaveShaper.prototype.dispose=function(){return e.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},e.WaveShaper}),ToneModule(function(e){return e.Signal=function(t,n){this.units=this.defaultArg(n,e.Signal.Units.Number),this.output=this._scaler=this.context.createGain(),this.input=this._value=this._scaler.gain,t instanceof AudioParam?(this._scaler.connect(t),t.value=0):this.value=this.defaultArg(t,e.Signal.defaults.value),e.Signal._constant.chain(this._scaler)},e.extend(e.Signal,e.SignalBase),e.Signal.defaults={value:0},Object.defineProperty(e.Signal.prototype,"value",{get:function(){return this._toUnits(this._value.value)},set:function(e){var t=this._fromUnits(e);this.cancelScheduledValues(0),this._value.value=t}}),e.Signal.prototype._fromUnits=function(t){switch(this.units){case e.Signal.Units.Time:return this.toSeconds(t);case e.Signal.Units.Frequency:return this.toFrequency(t);case e.Signal.Units.Decibels:return this.dbToGain(t);case e.Signal.Units.Normal:return Math.min(Math.max(t,0),1);case e.Signal.Units.Audio:return Math.min(Math.max(t,-1),1);default:return t}},e.Signal.prototype._toUnits=function(t){switch(this.units){case e.Signal.Units.Decibels:return this.gainToDb(t);default:return t}},e.Signal.prototype.setValueAtTime=function(e,t){return e=this._fromUnits(e),this._value.setValueAtTime(e,this.toSeconds(t)),this},e.Signal.prototype.setCurrentValueNow=function(e){e=this.defaultArg(e,this.now());var t=this._value.value;return this.cancelScheduledValues(e),this._value.setValueAtTime(t,e),this},e.Signal.prototype.linearRampToValueAtTime=function(e,t){return e=this._fromUnits(e),this._value.linearRampToValueAtTime(e,this.toSeconds(t)),this},e.Signal.prototype.exponentialRampToValueAtTime=function(e,t){return e=this._fromUnits(e),e=Math.max(1e-5,e),this._value.exponentialRampToValueAtTime(e,this.toSeconds(t)),this},e.Signal.prototype.exponentialRampToValueNow=function(e,t){var n=this.now();return this.setCurrentValueNow(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this},e.Signal.prototype.linearRampToValueNow=function(e,t){var n=this.now();return this.setCurrentValueNow(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this},e.Signal.prototype.setTargetAtTime=function(e,t,n){return e=this._fromUnits(e),this._value.setTargetAtTime(e,this.toSeconds(t),n),this},e.Signal.prototype.setValueCurveAtTime=function(e,t,n){for(var i=0;i<e.length;i++)e[i]=this._fromUnits(e[i]);return this._value.setValueCurveAtTime(e,this.toSeconds(t),this.toSeconds(n)),this},e.Signal.prototype.cancelScheduledValues=function(e){return this._value.cancelScheduledValues(this.toSeconds(e)),this},e.Signal.prototype.rampTo=function(t,n){return n=this.defaultArg(n,0),this.units===e.Signal.Units.Frequency||this.units===e.Signal.Units.BPM?this.exponentialRampToValueNow(t,n):this.linearRampToValueNow(t,n),this},e.Signal.prototype.dispose=function(){return e.prototype.dispose.call(this),this._value=null,this._scaler=null,this},e.Signal.Units={Number:"number",Time:"time",Frequency:"frequency",Gain:"gain",Normal:"normal",Audio:"audio",Decibels:"db",Interval:"interval",BPM:"bpm"},e.Signal._generator=null,e.Signal._constant=null,e._initAudioContext(function(t){e.Signal._generator=t.createOscillator(),e.Signal._constant=new e.WaveShaper([1,1]),e.Signal._generator.connect(e.Signal._constant),e.Signal._generator.start(0),e.Signal._generator.noGC()}),e.Signal}),ToneModule(function(e){return e.Pow=function(t){this._exp=this.defaultArg(t,1),this._expScaler=this.input=this.output=new e.WaveShaper(this._expFunc(this._exp),8192)},e.extend(e.Pow,e.SignalBase),Object.defineProperty(e.Pow.prototype,"value",{get:function(){return this._exp},set:function(e){this._exp=e,this._expScaler.setMap(this._expFunc(this._exp))}}),e.Pow.prototype._expFunc=function(e){return function(t){return Math.pow(Math.abs(t),e)}},e.Pow.prototype.dispose=function(){return e.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},e.Pow}),ToneModule(function(e){return e.Envelope=function(){var t=this.optionsObject(arguments,["attack","decay","sustain","release"],e.Envelope.defaults);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this._sig=this.output=new e.Signal(0)},e.extend(e.Envelope),e.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1},e.Envelope.prototype._timeMult=.25,e.Envelope.prototype.triggerAttack=function(e,t){t=this.defaultArg(t,1);var n=this.toSeconds(this.attack),i=this.toSeconds(this.decay),r=t,o=this.sustain*r;return e=this.toSeconds(e),this._sig.cancelScheduledValues(e),this._sig.setTargetAtTime(r,e,n*this._timeMult),this._sig.setTargetAtTime(o,e+n,i*this._timeMult),this},e.Envelope.prototype.triggerRelease=function(e){e=this.toSeconds(e),this._sig.cancelScheduledValues(e);var t=this.toSeconds(this.release);return this._sig.setTargetAtTime(0,e,t*this._timeMult),this},e.Envelope.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this},e.Envelope.prototype.connect=e.Signal.prototype.connect,e.Envelope.prototype.dispose=function(){return e.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this},e.Envelope}),ToneModule(function(e){return e.AmplitudeEnvelope=function(){e.Envelope.apply(this,arguments),this.input=this.output=this.context.createGain(),this._sig.connect(this.output.gain)},e.extend(e.AmplitudeEnvelope,e.Envelope),e.AmplitudeEnvelope}),ToneModule(function(e){return e.Compressor=function(){var t=this.optionsObject(arguments,["threshold","ratio"],e.Compressor.defaults);this._compressor=this.context.createDynamicsCompressor(),this.input=this.output=this._compressor,this.threshold=this._compressor.threshold,this.attack=new e.Signal(this._compressor.attack,e.Signal.Units.Time),this.release=new e.Signal(this._compressor.release,e.Signal.Units.Time),this.knee=this._compressor.knee,this.ratio=this._compressor.ratio,this.set(t)},e.extend(e.Compressor),e.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},e.Compressor.prototype.dispose=function(){return e.prototype.dispose.call(this),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold=null,this.ratio=null,this.knee=null,this},e.Compressor}),ToneModule(function(e){return e.Add=function(t){e.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._value=this.input[1]=new e.Signal(t),this._value.connect(this._sum)},e.extend(e.Add,e.Signal),e.Add.prototype.dispose=function(){return e.prototype.dispose.call(this),this._sum.disconnect(),this._sum=null,this._value.dispose(),this._value=null,this},e.Add}),ToneModule(function(e){return e.Multiply=function(t){e.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._value=this.input[1]=this.output.gain,this._value.value=this.defaultArg(t,0)},e.extend(e.Multiply,e.Signal),e.Multiply.prototype.dispose=function(){return e.prototype.dispose.call(this),this._mult=null,this._value=null,this},e.Multiply}),ToneModule(function(e){return e.Negate=function(){this._multiply=this.input=this.output=new e.Multiply(-1)},e.extend(e.Negate,e.SignalBase),e.Negate.prototype.dispose=function(){return e.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},e.Negate}),ToneModule(function(e){return e.Subtract=function(t){e.call(this,2,0),this._sum=this.input[0]=this.output=this.context.createGain(),this._neg=new e.Negate,this._value=this.input[1]=new e.Signal(t),
this._value.chain(this._neg,this._sum)},e.extend(e.Subtract,e.Signal),e.Subtract.prototype.dispose=function(){return e.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this._value.dispose(),this._value=null,this},e.Subtract}),ToneModule(function(e){return e.GreaterThanZero=function(){this._thresh=this.output=new e.WaveShaper(function(e){return 0>=e?0:1}),this._scale=this.input=new e.Multiply(1e4),this._scale.connect(this._thresh)},e.extend(e.GreaterThanZero,e.SignalBase),e.GreaterThanZero.prototype.dispose=function(){return e.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},e.GreaterThanZero}),ToneModule(function(e){return e.EqualZero=function(){this._scale=this.input=new e.Multiply(1e4),this._thresh=new e.WaveShaper(function(e){return 0===e?1:0},128),this._gtz=this.output=new e.GreaterThanZero,this._scale.chain(this._thresh,this._gtz)},e.extend(e.EqualZero,e.SignalBase),e.EqualZero.prototype.dispose=function(){return e.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},e.EqualZero}),ToneModule(function(e){return e.Equal=function(t){e.call(this,2,0),this._sub=this.input[0]=new e.Subtract(t),this._equals=this.output=new e.EqualZero,this._sub.connect(this._equals),this.input[1]=this._sub.input[1]},e.extend(e.Equal,e.SignalBase),Object.defineProperty(e.Equal.prototype,"value",{get:function(){return this._sub.value},set:function(e){this._sub.value=e}}),e.Equal.prototype.dispose=function(){return e.prototype.dispose.call(this),this._equals.disconnect(),this._equals=null,this._sub.dispose(),this._sub=null,this},e.Equal}),ToneModule(function(e){e.Select=function(n){n=this.defaultArg(n,2),e.call(this,n,1),this.gate=new e.Signal(0);for(var i=0;n>i;i++){var r=new t(i);this.input[i]=r,this.gate.connect(r.selecter),r.connect(this.output)}},e.extend(e.Select,e.SignalBase),e.Select.prototype.select=function(e,t){return e=Math.floor(e),this.gate.setValueAtTime(e,this.toSeconds(t)),this},e.Select.prototype.dispose=function(){this.gate.dispose();for(var t=0;t<this.input.length;t++)this.input[t].dispose(),this.input[t]=null;return e.prototype.dispose.call(this),this.gate=null,this};var t=function(t){this.selecter=new e.Equal(t),this.gate=this.input=this.output=this.context.createGain(),this.selecter.connect(this.gate.gain)};return e.extend(t),t.prototype.dispose=function(){e.prototype.dispose.call(this),this.selecter.dispose(),this.gate.disconnect(),this.selecter=null,this.gate=null},e.Select}),ToneModule(function(e){return e.IfThenElse=function(){e.call(this,3,0),this._selector=this.output=new e.Select(2),this["if"]=this.input[0]=this._selector.gate,this.then=this.input[1]=this._selector.input[1],this["else"]=this.input[2]=this._selector.input[0]},e.extend(e.IfThenElse,e.SignalBase),e.IfThenElse.prototype.dispose=function(){return e.prototype.dispose.call(this),this._selector.dispose(),this._selector=null,this["if"]=null,this.then=null,this["else"]=null,this},e.IfThenElse}),ToneModule(function(e){return e.OR=function(t){t=this.defaultArg(t,2),e.call(this,t,0),this._sum=this.context.createGain(),this._gtz=new e.GreaterThanZero,this.output=this._gtz;for(var n=0;t>n;n++)this.input[n]=this._sum;this._sum.connect(this._gtz)},e.extend(e.OR,e.SignalBase),e.OR.prototype.dispose=function(){return e.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this._sum.disconnect(),this._sum=null,this},e.OR}),ToneModule(function(e){return e.AND=function(t){t=this.defaultArg(t,2),e.call(this,t,0),this._equals=this.output=new e.Equal(t);for(var n=0;t>n;n++)this.input[n]=this._equals},e.extend(e.AND,e.SignalBase),e.AND.prototype.dispose=function(){return e.prototype.dispose.call(this),this._equals.dispose(),this._equals=null,this},e.AND}),ToneModule(function(e){return e.NOT=e.EqualZero,e.NOT}),ToneModule(function(e){return e.GreaterThan=function(t){e.call(this,2,0),this._value=this.input[0]=new e.Subtract(t),this.input[1]=this._value.input[1],this._gtz=this.output=new e.GreaterThanZero,this._value.connect(this._gtz)},e.extend(e.GreaterThan,e.Signal),e.GreaterThan.prototype.dispose=function(){return e.prototype.dispose.call(this),this._value.dispose(),this._value=null,this._gtz.dispose(),this._gtz=null,this},e.GreaterThan}),ToneModule(function(e){return e.LessThan=function(t){e.call(this,2,0),this._neg=this.input[0]=new e.Negate,this._gt=this.output=new e.GreaterThan,this._rhNeg=new e.Negate,this._value=this.input[1]=new e.Signal(t),this._neg.connect(this._gt),this._value.connect(this._rhNeg),this._rhNeg.connect(this._gt,0,1)},e.extend(e.LessThan,e.Signal),e.LessThan.prototype.dispose=function(){return e.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._gt.dispose(),this._gt=null,this._rhNeg.dispose(),this._rhNeg=null,this._value.dispose(),this._value=null,this},e.LessThan}),ToneModule(function(e){return e.Abs=function(){e.call(this,1,0),this._ltz=new e.LessThan(0),this._switch=this.output=new e.Select(2),this._negate=new e.Negate,this.input.connect(this._switch,0,0),this.input.connect(this._negate),this._negate.connect(this._switch,0,1),this.input.chain(this._ltz,this._switch.gate)},e.extend(e.Abs,e.SignalBase),e.Abs.prototype.dispose=function(){return e.prototype.dispose.call(this),this._switch.dispose(),this._switch=null,this._ltz.dispose(),this._ltz=null,this._negate.dispose(),this._negate=null,this},e.Abs}),ToneModule(function(e){return e.Max=function(t){e.call(this,2,0),this.input[0]=this.context.createGain(),this._value=this.input[1]=new e.Signal(t),this._ifThenElse=this.output=new e.IfThenElse,this._gt=new e.GreaterThan,this.input[0].chain(this._gt,this._ifThenElse["if"]),this.input[0].connect(this._ifThenElse.then),this._value.connect(this._ifThenElse["else"]),this._value.connect(this._gt,0,1)},e.extend(e.Max,e.Signal),e.Max.prototype.dispose=function(){return e.prototype.dispose.call(this),this._value.dispose(),this._ifThenElse.dispose(),this._gt.dispose(),this._value=null,this._ifThenElse=null,this._gt=null,this},e.Max}),ToneModule(function(e){return e.Min=function(t){e.call(this,2,0),this.input[0]=this.context.createGain(),this._ifThenElse=this.output=new e.IfThenElse,this._lt=new e.LessThan,this._value=this.input[1]=new e.Signal(t),this.input[0].chain(this._lt,this._ifThenElse["if"]),this.input[0].connect(this._ifThenElse.then),this._value.connect(this._ifThenElse["else"]),this._value.connect(this._lt,0,1)},e.extend(e.Min,e.Signal),e.Min.prototype.dispose=function(){return e.prototype.dispose.call(this),this._value.dispose(),this._ifThenElse.dispose(),this._lt.dispose(),this._value=null,this._ifThenElse=null,this._lt=null,this},e.Min}),ToneModule(function(e){return e.Modulo=function(t){e.call(this,1,1),this._shaper=new e.WaveShaper(Math.pow(2,16)),this._multiply=new e.Multiply,this._subtract=this.output=new e.Subtract,this._modSignal=new e.Signal(t),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(t)},e.extend(e.Modulo,e.SignalBase),e.Modulo.prototype._setWaveShaper=function(e){this._shaper.setMap(function(t){var n=Math.floor((t+1e-4)/e);return n})},Object.defineProperty(e.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(e){this._modSignal.value=e,this._setWaveShaper(e)}}),e.Modulo.prototype.dispose=function(){return e.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},e.Modulo}),ToneModule(function(e){function t(e,t,n){var i=new e;return n._eval(t[0]).connect(i,0,0),n._eval(t[1]).connect(i,0,1),i}function n(e,t,n){var i=new e;return n._eval(t[0]).connect(i,0,0),i}function i(e){return e?parseFloat(e):void 0}function r(e){return e&&e.args?parseFloat(e.args):void 0}return e.Expr=function(){var e=this._replacements(Array.prototype.slice.call(arguments)),t=this._parseInputs(e);this._nodes=[],this.input=new Array(t);for(var n=0;t>n;n++)this.input[n]=this.context.createGain();var i,r=this._parseTree(e);try{i=this._eval(r)}catch(o){throw this._disposeNodes(),new Error("Could evaluate expression: "+e)}this.output=i},e.extend(e.Expr,e.SignalBase),e.Expr._Expressions={value:{signal:{regexp:/^\d+\.\d+|^\d+/,method:function(t){var n=new e.Signal(i(t));return n}},input:{regexp:/^\$\d/,method:function(e,t){return t.input[i(e.substr(1))]}}},glue:{"(":{regexp:/^\(/},")":{regexp:/^\)/},",":{regexp:/^,/}},func:{abs:{regexp:/^abs/,method:n.bind(this,e.Abs)},min:{regexp:/^min/,method:t.bind(this,e.Min)},max:{regexp:/^max/,method:t.bind(this,e.Max)},"if":{regexp:/^if/,method:function(t,n){var i=new e.IfThenElse;return n._eval(t[0]).connect(i["if"]),n._eval(t[1]).connect(i.then),n._eval(t[2]).connect(i["else"]),i}},gt0:{regexp:/^gt0/,method:n.bind(this,e.GreaterThanZero)},eq0:{regexp:/^eq0/,method:n.bind(this,e.EqualZero)},mod:{regexp:/^mod/,method:function(t,n){var i=r(t[1]),o=new e.Modulo(i);return n._eval(t[0]).connect(o),o}},pow:{regexp:/^pow/,method:function(t,n){var i=r(t[1]),o=new e.Pow(i);return n._eval(t[0]).connect(o),o}}},binary:{"+":{regexp:/^\+/,precedence:1,method:t.bind(this,e.Add)},"-":{regexp:/^\-/,precedence:1,method:function(i,r){return 1===i.length?n(e.Negate,i,r):t(e.Subtract,i,r)}},"*":{regexp:/^\*/,precedence:0,method:t.bind(this,e.Multiply)},">":{regexp:/^\>/,precedence:2,method:t.bind(this,e.GreaterThan)},"<":{regexp:/^</,precedence:2,method:t.bind(this,e.LessThan)},"==":{regexp:/^==/,precedence:3,method:t.bind(this,e.Equal)},"&&":{regexp:/^&&/,precedence:4,method:t.bind(this,e.AND)},"||":{regexp:/^\|\|/,precedence:5,method:t.bind(this,e.OR)}},unary:{"-":{regexp:/^\-/,method:n.bind(this,e.Negate)},"!":{regexp:/^\!/,method:n.bind(this,e.NOT)}}},e.Expr.prototype._parseInputs=function(e){var t=e.match(/\$\d/g),n=0;if(null!==t)for(var i=0;i<t.length;i++){var r=parseInt(t[i].substr(1))+1;n=Math.max(n,r)}return n},e.Expr.prototype._replacements=function(e){for(var t=e.shift(),n=0;n<e.length;n++)t=t.replace(/\%/i,e[n]);return t},e.Expr.prototype._tokenize=function(t){function n(t){for(var n in e.Expr._Expressions){var i=e.Expr._Expressions[n];for(var r in i){var o=i[r],s=o.regexp,a=t.match(s);if(null!==a)return{type:n,value:a[0],method:o.method}}}throw new SyntaxError("Unexpected token "+t)}for(var i=-1,r=[];t.length>0;){t=t.trim();var o=n(t);r.push(o),t=t.substr(o.value.length)}return{next:function(){return r[++i]},peek:function(){return r[i+1]}}},e.Expr.prototype._parseTree=function(t){function n(e,t){return!u(e)&&"glue"===e.type&&e.value===t}function i(t,n,i){var r=!1,o=e.Expr._Expressions[n];if(!u(t))for(var s in o){var a=o[s];if(a.regexp.test(t.value)){if(u(i))return!0;if(a.precedence===i)return!0}}return r}function r(e){u(e)&&(e=5);var t;t=0>e?o():r(e-1);for(var n=h.peek();i(n,"binary",e);)n=h.next(),t={operator:n.value,method:n.method,args:[t,r(e)]},n=h.peek();return t}function o(){var e,t;return e=h.peek(),i(e,"unary")?(e=h.next(),t=o(),{operator:e.value,method:e.method,args:[t]}):s()}function s(){var e,t;if(e=h.peek(),u(e))throw new SyntaxError("Unexpected termination of expression");if("func"===e.type)return e=h.next(),a(e);if("value"===e.type)return e=h.next(),{method:e.method,args:e.value};if(n(e,"(")){if(h.next(),t=r(),e=h.next(),!n(e,")"))throw new SyntaxError("Expected )");return t}throw new SyntaxError("Parse error, cannot process token "+e.value)}function a(e){var t,i=[];if(t=h.next(),!n(t,"("))throw new SyntaxError('Expected ( in a function call "'+e.value+'"');if(t=h.peek(),n(t,")")||(i=l()),t=h.next(),!n(t,")"))throw new SyntaxError('Expected ) in a function call "'+e.value+'"');return{method:e.method,args:i,name:name}}function l(){for(var e,t,i=[];;){if(t=r(),u(t))break;if(i.push(t),e=h.peek(),!n(e,","))break;h.next()}return i}var h=this._tokenize(t),u=this.isUndef.bind(this);return r()},e.Expr.prototype._eval=function(e){if(!this.isUndef(e)){var t=e.method(e.args,this);return this._nodes.push(t),t}},e.Expr.prototype._disposeNodes=function(){for(var e=0;e<this._nodes.length;e++){var t=this._nodes[e];this.isFunction(t.dispose)?t.dispose():this.isFunction(t.disconnect)&&t.disconnect(),t=null,this._nodes[e]=null}this._nodes=null},e.Expr.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeNodes()},e.Expr}),ToneModule(function(e){return e.EqualPowerGain=function(){this._eqPower=this.input=this.output=new e.WaveShaper(function(e){return Math.abs(e)<.001?0:this.equalPowerScale(e)}.bind(this),4096)},e.extend(e.EqualPowerGain,e.SignalBase),e.EqualPowerGain.prototype.dispose=function(){return e.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},e.EqualPowerGain}),ToneModule(function(e){return e.CrossFade=function(t){e.call(this,2,1),this.a=this.input[0]=this.context.createGain(),this.b=this.input[1]=this.context.createGain(),this.fade=new e.Signal(this.defaultArg(t,.5),e.Signal.Units.Normal),this._equalPowerA=new e.EqualPowerGain,this._equalPowerB=new e.EqualPowerGain,this._invert=new e.Expr("1 - $0"),this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this.fade.chain(this._invert,this._equalPowerA,this.a.gain)},e.extend(e.CrossFade),e.CrossFade.prototype.dispose=function(){return e.prototype.dispose.call(this),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this.a.disconnect(),this.a=null,this.b.disconnect(),this.b=null,this},e.CrossFade}),ToneModule(function(e){return e.Filter=function(){e.call(this);var t=this.optionsObject(arguments,["frequency","type","rolloff"],e.Filter.defaults);this._filters=[],this.frequency=new e.Signal(t.frequency,e.Signal.Units.Frequency),this.detune=new e.Signal(0),this.gain=new e.Signal(t.gain,e.Signal.Units.Decibels),this.Q=new e.Signal(t.Q),this._type=t.type,this._rolloff=t.rolloff,this.rolloff=t.rolloff},e.extend(e.Filter),e.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(e.Filter.prototype,"type",{get:function(){return this._type},set:function(e){var t=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(-1===t.indexOf(e))throw new TypeError("Tone.Filter does not have filter type "+e);this._type=e;for(var n=0;n<this._filters.length;n++)this._filters[n].type=e}}),Object.defineProperty(e.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(e){var t=Math.log(e/-12)/Math.LN2+1;if(t%1!==0)throw new RangeError("Filter rolloff can only be -12, -24, or -48");this._rolloff=e,this.input.disconnect();for(var n=0;n<this._filters.length;n++)this._filters[n].disconnect(),this._filters[n]=null;this._filters=new Array(t);for(var i=0;t>i;i++){var r=this.context.createBiquadFilter();r.type=this._type,this.frequency.connect(r.frequency),this.detune.connect(r.detune),this.Q.connect(r.Q),this.gain.connect(r.gain),this._filters[i]=r}var o=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,o)}}),e.Filter.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0;t<this._filters.length;t++)this._filters[t].disconnect(),this._filters[t]=null;return this._filters=null,this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},e.Filter}),ToneModule(function(e){return e.MultibandSplit=function(){var t=this.optionsObject(arguments,["lowFrequency","highFrequency"],e.MultibandSplit.defaults);this.input=this.context.createGain(),this.output=new Array(3),this.low=this.output[0]=new e.Filter(0,"lowpass"),this._lowMidFilter=new e.Filter(0,"highpass"),this.mid=this.output[1]=new e.Filter(0,"lowpass"),this.high=this.output[2]=new e.Filter(0,"highpass"),this.lowFrequency=new e.Signal(t.lowFrequency),this.highFrequency=new e.Signal(t.highFrequency),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency)},e.extend(e.MultibandSplit),e.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500},e.MultibandSplit.prototype.dispose=function(){return e.prototype.dispose.call(this),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.low=null,this._lowMidFilter=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},e.MultibandSplit}),ToneModule(function(e){return e.EQ=function(){var t=this.optionsObject(arguments,["low","mid","high"],e.EQ.defaults);this.output=this.context.createGain(),this._multibandSplit=this.input=new e.MultibandSplit({lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this._lowGain=this.context.createGain(),this._midGain=this.context.createGain(),this._highGain=this.context.createGain(),this.low=new e.Signal(this._lowGain.gain,e.Signal.Units.Decibels),this.mid=new e.Signal(this._midGain.gain,e.Signal.Units.Decibels),this.high=new e.Signal(this._highGain.gain,e.Signal.Units.Decibels),this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this.high.value=t.low,this.mid.value=t.mid,this.low.value=t.high},e.extend(e.EQ),e.EQ.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},e.EQ.prototype.dispose=function(){return e.prototype.dispose.call(this),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.disconnect(),this._lowGain=null,this._midGain.disconnect(),this._midGain=null,this._highGain.disconnect(),this._highGain=null,this.low.dispose(),this.low=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this},e.EQ}),ToneModule(function(e){return e.Scale=function(t,n){this._outputMin=this.defaultArg(t,0),this._outputMax=this.defaultArg(n,1),this._scale=this.input=new e.Multiply(1),this._add=this.output=new e.Add(0),this._scale.connect(this._add),this._setRange()},e.extend(e.Scale,e.SignalBase),Object.defineProperty(e.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(e){this._outputMin=e,this._setRange()}}),Object.defineProperty(e.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(e){this._outputMax=e,this._setRange()}}),e.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},e.Scale.prototype.dispose=function(){return e.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},e.Scale}),ToneModule(function(e){return e.ScaleExp=function(t,n,i){this._scale=this.output=new e.Scale(t,n),this._exp=this.input=new e.Pow(this.defaultArg(i,2)),this._exp.connect(this._scale)},e.extend(e.ScaleExp,e.SignalBase),Object.defineProperty(e.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),Object.defineProperty(e.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(e){this._scale.min=e}}),Object.defineProperty(e.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(e){this._scale.max=e}}),e.ScaleExp.prototype.dispose=function(){return e.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},e.ScaleExp}),ToneModule(function(e){return e.FeedbackCombFilter=function(){e.call(this);var t=this.optionsObject(arguments,["minDelay","maxDelay"],e.FeedbackCombFilter.defaults),n=t.minDelay,i=t.maxDelay,r=Math.ceil(this.bufferSize/(n*this.context.sampleRate));r=Math.min(r,10),r=Math.max(r,1),this._delayCount=r,this._delays=new Array(this._delayCount),this.resonance=new e.Signal(t.resonance,e.Signal.Units.Normal),this._resScale=new e.ScaleExp(.01,1/this._delayCount-.001,.5),this._highFrequencies=!1,this._delayTime=t.delayTime,this._feedback=this.context.createGain();for(var o=0;o<this._delayCount;o++){var s=this.context.createDelay(i);s.delayTime.value=n,s.connect(this._feedback),this._delays[o]=s}this.connectSeries.apply(this,this._delays),this.input.connect(this._delays[0]),this._feedback.connect(this._delays[0]),this.resonance.chain(this._resScale,this._feedback.gain),this._feedback.connect(this.output),this.delayTime=t.delayTime},e.extend(e.FeedbackCombFilter),e.FeedbackCombFilter.defaults={resonance:.5,minDelay:.1,maxDelay:1,delayTime:.1},Object.defineProperty(e.FeedbackCombFilter.prototype,"delayTime",{get:function(){return this._delayTime},set:function(e){this._delayTime=e,e=this.toSeconds(e);var t=this.context.sampleRate,n=t*e,i=this.now()+this.bufferTime,r=100;if(r>n){this._highFrequencies=!0;for(var o=Math.round(n/r*this._delayCount),s=0;o>s;s++)this._delays[s].delayTime.setValueAtTime(1/t+e,i);e=Math.floor(n)/t}else if(this._highFrequencies){this._highFrequencies=!1;for(var a=0;a<this._delays.length;a++)this._delays[a].delayTime.setValueAtTime(e,i)}}}),e.FeedbackCombFilter.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0;t<this._delays.length;t++)this._delays[t].disconnect(),this._delays[t]=null;return this._delays=null,this.resonance.dispose(),this.resonance=null,this._resScale.dispose(),this._resScale=null,this._feedback.disconnect(),this._feedback=null,this},e.FeedbackCombFilter}),ToneModule(function(e){return e.Follower=function(){e.call(this);var t=this.optionsObject(arguments,["attack","release"],e.Follower.defaults);this._abs=new e.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new e.WaveShaper,this._sub=new e.Subtract,this._delay=this.context.createDelay(),this._delay.delayTime.value=this.bufferTime,this._mult=new e.Multiply(1e4),this._attack=t.attack,this._release=t.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},e.extend(e.Follower),e.Follower.defaults={attack:.05,release:.5},e.Follower.prototype._setAttackRelease=function(e,t){var n=this.bufferTime;e=this.secondsToFrequency(this.toSeconds(e)),t=this.secondsToFrequency(this.toSeconds(t)),e=Math.max(e,n),t=Math.max(t,n),this._frequencyValues.setMap(function(n){return 0>=n?e:t})},Object.defineProperty(e.Follower.prototype,"attack",{get:function(){return this._attack},set:function(e){this._attack=e,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(e.Follower.prototype,"release",{get:function(){return this._release},set:function(e){this._release=e,this._setAttackRelease(this._attack,this._release)}}),e.Follower.prototype.connect=e.Signal.prototype.connect,e.Follower.prototype.dispose=function(){return e.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.disconnect(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},e.Follower}),ToneModule(function(e){return e.Gate=function(){e.call(this);var t=this.optionsObject(arguments,["threshold","attack","release"],e.Gate.defaults);this._follower=new e.Follower(t.attack,t.release),this._gt=new e.GreaterThan(this.dbToGain(t.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},e.extend(e.Gate),e.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(e.Gate.prototype,"threshold",{get:function(){return this.gainToDb(this._gt.value)},set:function(e){this._gt.value=this.dbToGain(e)}}),Object.defineProperty(e.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(e){this._follower.attack=e}}),Object.defineProperty(e.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(e){this._follower.release=e}}),e.Gate.prototype.dispose=function(){return e.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},e.Gate}),ToneModule(function(e){return e.Clock=function(t,n){this._oscillator=null,this._jsNode=this.context.createScriptProcessor(this.bufferSize,1,1),this._jsNode.onaudioprocess=this._processBuffer.bind(this),this.frequency=new e.Signal(t),this._upTick=!1,this.tick=n,this._jsNode.noGC()},e.extend(e.Clock),e.Clock.prototype.start=function(e){if(!this._oscillator){this._oscillator=this.context.createOscillator(),this._oscillator.type="square",this._oscillator.connect(this._jsNode),this.frequency.connect(this._oscillator.frequency),this._upTick=!1;var t=this.toSeconds(e);this._oscillator.start(t)}return this},e.Clock.prototype.stop=function(e,t){if(this._oscillator){var n=this.now(),i=this.toSeconds(e,n);this._oscillator.stop(i),this._oscillator=null,e?setTimeout(t,1e3*(i-n)):t()}return this},e.Clock.prototype._processBuffer=function(e){for(var t=this.defaultArg(e.playbackTime,this.now()),n=this._jsNode.bufferSize,i=e.inputBuffer.getChannelData(0),r=this._upTick,o=this,s=0;n>s;s++){var a=i[s];a>0&&!r?(r=!0,setTimeout(function(){var e=t+o.samplesToSeconds(s+2*n);return function(){o.tick&&o.tick(e)}}(),0)):0>a&&r&&(r=!1)}this._upTick=r},e.Clock.prototype.dispose=function(){return this._jsNode.disconnect(),this.frequency.dispose(),this.frequency=null,this._oscillator&&(this._oscillator.disconnect(),this._oscillator=null),this._jsNode.onaudioprocess=function(){},this._jsNode=null,this.tick=null,this},e.Clock}),ToneModule(function(Tone){Tone.Transport=function(){this._clock=new Tone.Clock(0,this._processTick.bind(this)),this.loop=!1,this.bpm=new Tone.Signal(120,Tone.Signal.Units.BPM),this._bpmMult=new Tone.Multiply(1/60*tatum),this.state=TransportState.STOPPED,this.bpm.chain(this._bpmMult,this._clock.frequency)},Tone.extend(Tone.Transport),Tone.Transport.defaults={bpm:120,swing:0,swingSubdivision:"16n",timeSignature:4,loopStart:0,loopEnd:"4m"};var tatum=12,timelineTicks=0,transportTicks=0,swingSubdivision="16n",swingTatum=3,swingAmount=0,transportTimeSignature=4,loopStart=0,loopEnd=4*tatum,intervals=[],timeouts=[],transportTimeline=[],timelineProgress=0,SyncedSources=[],SyncedSignals=[],TransportState={STARTED:"started",PAUSED:"paused",STOPPED:"stopped"};Tone.Transport.prototype._processTick=function(e){this.state===TransportState.STARTED&&(swingAmount>0&&timelineTicks%tatum!==0&&timelineTicks%swingTatum===0&&(e+=this._ticksToSeconds(swingTatum)*swingAmount),processIntervals(e),processTimeouts(e),processTimeline(e),transportTicks+=1,timelineTicks+=1,this.loop&&timelineTicks===loopEnd&&this._setTicks(loopStart))},Tone.Transport.prototype._setTicks=function(e){timelineTicks=e;for(var t=0;t<transportTimeline.length;t++){var n=transportTimeline[t];if(n.callbackTick()>=e){timelineProgress=t;break}}};var processIntervals=function(e){for(var t=0,n=intervals.length;n>t;t++){var i=intervals[t];i.testInterval(transportTicks)&&i.doCallback(e)}},processTimeouts=function(e){for(var t=0,n=0,i=timeouts.length;i>n;n++){var r=timeouts[n],o=r.callbackTick();if(transportTicks>=o)r.doCallback(e),t++;else if(o>transportTicks)break}timeouts.splice(0,t)},processTimeline=function(e){for(var t=timelineProgress,n=transportTimeline.length;n>t;t++){var i=transportTimeline[t],r=i.callbackTick();if(r===timelineTicks)timelineProgress=t,i.doCallback(e);else if(r>timelineTicks)break}};Tone.Transport.prototype.setInterval=function(e,t,n){var i=this._toTicks(t),r=new TimelineEvent(e,n,i,transportTicks);return intervals.push(r),r.id},Tone.Transport.prototype.clearInterval=function(e){for(var t=0;t<intervals.length;t++){var n=intervals[t];if(n.id===e)return intervals.splice(t,1),!0}return!1},Tone.Transport.prototype.clearIntervals=function(){var e=intervals.length>0;return intervals=[],e},Tone.Transport.prototype.setTimeout=function(e,t,n){for(var i=this._toTicks(t),r=new TimelineEvent(e,n,i+transportTicks,0),o=0,s=timeouts.length;s>o;o++){var a=timeouts[o];if(a.callbackTick()>r.callbackTick())return timeouts.splice(o,0,r),r.id}return timeouts.push(r),r.id},Tone.Transport.prototype.clearTimeout=function(e){for(var t=0;t<timeouts.length;t++){var n=timeouts[t];if(n.id===e)return timeouts.splice(t,1),!0}return!1},Tone.Transport.prototype.clearTimeouts=function(){var e=timeouts.length>0;return timeouts=[],e},Tone.Transport.prototype.setTimeline=function(e,t,n){for(var i=this._toTicks(t),r=new TimelineEvent(e,n,i,0),o=timelineProgress,s=transportTimeline.length;s>o;o++){var a=transportTimeline[o];if(a.callbackTick()>r.callbackTick())return transportTimeline.splice(o,0,r),r.id}return transportTimeline.push(r),r.id},Tone.Transport.prototype.clearTimeline=function(e){for(var t=0;t<transportTimeline.length;t++){var n=transportTimeline[t];if(n.id===e)return transportTimeline.splice(t,1),!0}return!1},Tone.Transport.prototype.clearTimelines=function(){timelineProgress=0;var e=transportTimeline.length>0;return transportTimeline=[],e},Tone.Transport.prototype._toTicks=function(e){var t=this.toSeconds(e),n=this.notationToSeconds("4n"),i=t/n,r=i*tatum;return Math.round(r)},Tone.Transport.prototype._ticksToSeconds=function(e,t,n){e=Math.floor(e);var i=this.notationToSeconds("4n",t,n);return i*e/tatum},Tone.Transport.prototype.nextBeat=function(e){e=this.defaultArg(e,"4n");var t=this._toTicks(e),n=transportTicks%t,i=n;return n>0&&(i=t-n),this._ticksToSeconds(i)},Tone.Transport.prototype.start=function(e,t){if(this.state===TransportState.STOPPED||this.state===TransportState.PAUSED){this.isUndef(t)||this._setTicks(this._toTicks(t)),this.state=TransportState.STARTED;var n=this.toSeconds(e);this._clock.start(n);for(var i=0;i<SyncedSources.length;i++){var r=SyncedSources[i].source,o=SyncedSources[i].delay;r.start(n+o)}}return this},Tone.Transport.prototype.stop=function(e){if(this.state===TransportState.STARTED||this.state===TransportState.PAUSED){var t=this.toSeconds(e);this._clock.stop(t,this._onended.bind(this));for(var n=0;n<SyncedSources.length;n++){var i=SyncedSources[n].source;i.stop(t)}}else this._onended();return this},Tone.Transport.prototype._onended=function(){transportTicks=0,this._setTicks(0),this.clearTimeouts(),this.state=TransportState.STOPPED},Tone.Transport.prototype.pause=function(e){if(this.state===TransportState.STARTED){this.state=TransportState.PAUSED;var t=this.toSeconds(e);this._clock.stop(t);for(var n=0;n<SyncedSources.length;n++){var i=SyncedSources[n].source;i.pause(t)}}return this},Object.defineProperty(Tone.Transport.prototype,"timeSignature",{get:function(){return transportTimeSignature},set:function(e){transportTimeSignature=e}}),Object.defineProperty(Tone.Transport.prototype,"loopStart",{get:function(){return this._ticksToSeconds(loopStart)},set:function(e){loopStart=this._toTicks(e)}}),Object.defineProperty(Tone.Transport.prototype,"loopEnd",{get:function(){return this._ticksToSeconds(loopEnd)},set:function(e){loopEnd=this._toTicks(e)}}),Tone.Transport.prototype.setLoopPoints=function(e,t){return this.loopStart=e,this.loopEnd=t,this},Object.defineProperty(Tone.Transport.prototype,"swing",{get:function(){return 2*swingAmount},set:function(e){swingAmount=.5*e}}),Object.defineProperty(Tone.Transport.prototype,"swingSubdivision",{get:function(){return swingSubdivision},set:function(e){swingSubdivision=e,
swingTatum=this._toTicks(e)}}),Object.defineProperty(Tone.Transport.prototype,"position",{get:function(){var e=timelineTicks/tatum,t=Math.floor(e/transportTimeSignature),n=Math.floor(e%1*4);e=Math.floor(e)%transportTimeSignature;var i=[t,e,n];return i.join(":")},set:function(e){var t=this._toTicks(e);this._setTicks(t)}}),Tone.Transport.prototype.syncSource=function(e,t){return SyncedSources.push({source:e,delay:this.toSeconds(this.defaultArg(t,0))}),this},Tone.Transport.prototype.unsyncSource=function(e){for(var t=0;t<SyncedSources.length;t++)SyncedSources[t].source===e&&SyncedSources.splice(t,1);return this},Tone.Transport.prototype.syncSignal=function(e,t){t||(t=0!==e._value.value?e._value.value/this.bpm.value:0);var n=this.context.createGain();return n.gain.value=t,this.bpm.chain(n,e._value),SyncedSignals.push({ratio:n,signal:e,initial:e._value.value}),e._value.value=0,this},Tone.Transport.prototype.unsyncSignal=function(e){for(var t=0;t<SyncedSignals.length;t++){var n=SyncedSignals[t];n.signal===e&&(n.ratio.disconnect(),n.signal._value.value=n.initial,SyncedSignals.splice(t,1))}return this},Tone.Transport.prototype.dispose=function(){return this._clock.dispose(),this._clock=null,this.bpm.dispose(),this.bpm=null,this._bpmMult.dispose(),this._bpmMult=null,this};var TimelineEventIDCounter=0,TimelineEvent=function(e,t,n,i){this.startTicks=i,this.tickTime=n,this.callback=e,this.context=t,this.id=TimelineEventIDCounter++};TimelineEvent.prototype.doCallback=function(e){this.callback.call(this.context,e)},TimelineEvent.prototype.callbackTick=function(){return this.startTicks+this.tickTime},TimelineEvent.prototype.testInterval=function(e){return(e-this.startTicks)%this.tickTime===0},Tone.prototype.isNotation=function(){var e=new RegExp(/[0-9]+[mnt]$/i);return function(t){return e.test(t)}}(),Tone.prototype.isTransportTime=function(){var e=new RegExp(/^\d+(\.\d+)?:\d+(\.\d+)?(:\d+(\.\d+)?)?$/i);return function(t){return e.test(t)}}(),Tone.prototype.notationToSeconds=function(e,t,n){t=this.defaultArg(t,Tone.Transport.bpm.value),n=this.defaultArg(n,transportTimeSignature);var i=60/t,r=parseInt(e,10),o=0;0===r&&(o=0);var s=e.slice(-1);return o="t"===s?4/r*2/3:"n"===s?4/r:"m"===s?r*n:0,i*o},Tone.prototype.transportTimeToSeconds=function(e,t,n){t=this.defaultArg(t,Tone.Transport.bpm.value),n=this.defaultArg(n,transportTimeSignature);var i=0,r=0,o=0,s=e.split(":");2===s.length?(i=parseFloat(s[0]),r=parseFloat(s[1])):1===s.length?r=parseFloat(s[0]):3===s.length&&(i=parseFloat(s[0]),r=parseFloat(s[1]),o=parseFloat(s[2]));var a=i*n+r+o/4;return a*this.notationToSeconds("4n")},Tone.prototype.toTransportTime=function(e,t,n){var i=this.toSeconds(e,t,n);t=this.defaultArg(t,Tone.Transport.bpm.value),n=this.defaultArg(n,transportTimeSignature);var r=this.notationToSeconds("4n"),o=i/r,s=Math.floor(o/n),a=Math.floor(o%1*4);o=Math.floor(o)%n;var l=[s,o,a];return l.join(":")},Tone.prototype.toFrequency=function(e,t){return this.isFrequency(e)?parseFloat(e):this.isNotation(e)||this.isTransportTime(e)?this.secondsToFrequency(this.toSeconds(e,t)):e},Tone.prototype.toSeconds=function(time,now){if(now=this.defaultArg(now,this.now()),"number"==typeof time)return time;if("string"==typeof time){var plusTime=0;"+"===time.charAt(0)&&(plusTime=now,time=time.slice(1));var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){for(var originalTime=time,i=0;i<components.length;i++){var symb=components[i].trim();if(""!==symb){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(e){throw new EvalError("problem evaluating Tone.Time: "+originalTime)}}else time=this.isNotation(time)?this.notationToSeconds(time):this.isTransportTime(time)?this.transportTimeToSeconds(time):this.isFrequency(time)?this.frequencyToSeconds(time):parseFloat(time);return time+plusTime}return now};var TransportConstructor=Tone.Transport;return Tone._initAudioContext(function(){if("function"==typeof Tone.Transport)Tone.Transport=new Tone.Transport;else{Tone.Transport.stop();var e=Tone.Transport.bpm.value;Tone.Transport._clock.dispose(),TransportConstructor.call(Tone.Transport),Tone.Transport.bpm.value=e}}),Tone.Transport}),ToneModule(function(e){e.Master=function(){e.call(this),this._unmutedVolume=1,this.volume=new e.Signal(this.output.gain,e.Signal.Units.Decibels),this.input.chain(this.output,this.context.destination)},e.extend(e.Master),e.Master.prototype.mute=function(){return this._unmutedVolume=this.volume.value,this.volume.value=-(1/0),this},e.Master.prototype.mute=function(){return this.volume.value=this._unmutedVolume,this},e.Master.prototype.send=function(e){return this.input.disconnect(),this.input.connect(e),this},e.Master.prototype.receive=function(e){return e.connect(this.output),this},e.prototype.toMaster=function(){return this.connect(e.Master),this},AudioNode.prototype.toMaster=function(){return this.connect(e.Master),this};var t=e.Master;return e._initAudioContext(function(){e.prototype.isUndef(e.Master)?(t.prototype.dispose.call(e.Master),t.call(e.Master)):e.Master=new t}),e.Master}),ToneModule(function(e){return e.Source=function(t){e.call(this,0,1),t=this.defaultArg(t,e.Source.defaults),this.onended=t.onended,this._nextStart=1/0,this._nextStop=1/0,this.volume=new e.Signal(this.output.gain,e.Signal.Units.Decibels),this._timeout=-1},e.extend(e.Source),e.Source.defaults={onended:function(){},volume:0},e.Source.State={STARTED:"started",PAUSED:"paused",STOPPED:"stopped"},Object.defineProperty(e.Source.prototype,"state",{get:function(){return this._stateAtTime(this.now())}}),e.Source.prototype._stateAtTime=function(t){return t=this.toSeconds(t),this._nextStart<=t&&this._nextStop>t?e.Source.State.STARTED:this._nextStop<=t?e.Source.State.STOPPED:e.Source.State.STOPPED},e.Source.prototype.start=function(t){return t=this.toSeconds(t),(this._stateAtTime(t)!==e.Source.State.STARTED||this.retrigger)&&(this._nextStart=t,this._nextStop=1/0,this._start.apply(this,arguments)),this},e.Source.prototype.stop=function(t){var n=this.now();if(t=this.toSeconds(t,n),this._stateAtTime(t)===e.Source.State.STARTED){this._nextStop=this.toSeconds(t),clearTimeout(this._timeout);var i=t-n;i>0?this._timeout=setTimeout(this.onended,1e3*i+20):this.onended(),this._stop.apply(this,arguments)}return this},e.Source.prototype.pause=function(e){return this.stop(e),this},e.Source.prototype.sync=function(t){return e.Transport.syncSource(this,t),this},e.Source.prototype.unsync=function(){return e.Transport.unsyncSource(this),this},e.Source.prototype.dispose=function(){e.prototype.dispose.call(this),this.stop(),clearTimeout(this._timeout),this.onended=function(){},this.volume.dispose(),this.volume=null},e.Source}),ToneModule(function(e){return e.Oscillator=function(){var t=this.optionsObject(arguments,["frequency","type"],e.Oscillator.defaults);e.Source.call(this,t),this._oscillator=null,this.frequency=new e.Signal(t.frequency,e.Signal.Units.Frequency),this.detune=new e.Signal(t.detune),this._wave=null,this._phase=t.phase,this._type=null,this.type=t.type,this.phase=this._phase},e.extend(e.Oscillator,e.Source),e.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0},e.Oscillator.prototype._start=function(e){this._oscillator=this.context.createOscillator(),this._oscillator.setPeriodicWave(this._wave),this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(this.toSeconds(e))},e.Oscillator.prototype._stop=function(e){return this._oscillator&&(this._oscillator.stop(this.toSeconds(e)),this._oscillator=null),this},e.Oscillator.prototype.syncFrequency=function(){return e.Transport.syncSignal(this.frequency),this},e.Oscillator.prototype.unsyncFrequency=function(){return e.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(e.Oscillator.prototype,"type",{get:function(){return this._type},set:function(e){if(this.type!==e){var t=4096,n=t/2,i=new Float32Array(n),r=new Float32Array(n);i[0]=0,r[0]=0;for(var o=this._phase,s=1;n>s;++s){var a,l=2/(s*Math.PI);switch(e){case"sine":a=1===s?1:0;break;case"square":a=1&s?2*l:0;break;case"sawtooth":a=l*(1&s?1:-1);break;case"triangle":a=1&s?2*l*l*(s-1>>1&1?-1:1):0;break;default:throw new TypeError("invalid oscillator type: "+e)}0!==a?(i[s]=-a*Math.sin(o),r[s]=a*Math.cos(o)):(i[s]=0,r[s]=0)}var h=this.context.createPeriodicWave(i,r);this._wave=h,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),this._type=e}}}),Object.defineProperty(e.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(e){this._phase=e*Math.PI/180,this.type=this._type}}),e.Oscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.disconnect(),this._oscillator=null),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._wave=null,this},e.Oscillator}),ToneModule(function(e){return e.AudioToGain=function(){this._norm=this.input=this.output=new e.WaveShaper([0,1])},e.extend(e.AudioToGain,e.SignalBase),e.AudioToGain.prototype.dispose=function(){return e.prototype.dispose.call(this),this._norm.disconnect(),this._norm=null,this},e.AudioToGain}),ToneModule(function(e){return e.LFO=function(){var t=this.optionsObject(arguments,["frequency","min","max"],e.LFO.defaults);this.oscillator=new e.Oscillator({frequency:t.frequency,type:t.type,phase:t.phase}),this.frequency=this.oscillator.frequency,this.amplitude=this.oscillator.volume,this.amplitude.units=e.Signal.Units.Normal,this.amplitude.value=t.amplitude,this._a2g=new e.AudioToGain,this._scaler=this.output=new e.Scale(t.min,t.max),this.oscillator.chain(this._a2g,this._scaler)},e.extend(e.LFO,e.Oscillator),e.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1},e.LFO.prototype.start=function(e){return this.oscillator.start(e),this},e.LFO.prototype.stop=function(e){return this.oscillator.stop(e),this},e.LFO.prototype.sync=function(e){return this.oscillator.sync(e),this.oscillator.syncFrequency(),this},e.LFO.prototype.unsync=function(){return this.oscillator.unsync(),this.oscillator.unsyncFrequency(),this},Object.defineProperty(e.LFO.prototype,"min",{get:function(){return this._scaler.min},set:function(e){this._scaler.min=e}}),Object.defineProperty(e.LFO.prototype,"max",{get:function(){return this._scaler.max},set:function(e){this._scaler.max=e}}),Object.defineProperty(e.LFO.prototype,"type",{get:function(){return this.oscillator.type},set:function(e){this.oscillator.type=e}}),Object.defineProperty(e.LFO.prototype,"phase",{get:function(){return this.oscillator.phase},set:function(e){this.oscillator.phase=e}}),e.LFO.prototype.connect=e.Signal.prototype.connect,e.LFO.prototype.dispose=function(){return e.prototype.dispose.call(this),this.oscillator.dispose(),this.oscillator=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},e.LFO}),ToneModule(function(e){return e.Limiter=function(t){this._compressor=this.input=this.output=new e.Compressor({attack:1e-4,decay:1e-4,threshold:t}),this.threshold=this._compressor.threshold},e.extend(e.Limiter),e.Limiter.prototype.dispose=function(){return e.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this.threshold=null,this},e.Limiter}),ToneModule(function(e){e.LowpassCombFilter=function(){e.call(this);var n=this.optionsObject(arguments,["minDelay","maxDelay"],e.LowpassCombFilter.defaults),i=Math.ceil(this.bufferSize/(n.minDelay*this.context.sampleRate));i=Math.min(i,10),i=Math.max(i,1),this._filterDelayCount=i,this._filterDelays=new Array(this._filterDelayCount),this.dampening=new e.Signal(n.dampening,e.Signal.Units.Frequency),this.resonance=new e.Signal(n.resonance,e.Signal.Units.Normal),this._resScale=new e.ScaleExp(.01,1/this._filterDelayCount-.001,.5),this._highFrequencies=!1,this._delayTime=n.delayTime,this._feedback=this.context.createGain();for(var r=0;r<this._filterDelayCount;r++){var o=new t(n.minDelay,this.dampening);o.connect(this._feedback),this._filterDelays[r]=o}this.input.connect(this._filterDelays[0]),this._feedback.connect(this._filterDelays[0]),this.connectSeries.apply(this,this._filterDelays),this.resonance.chain(this._resScale,this._feedback.gain),this._feedback.connect(this.output),this.delayTime=n.delayTime},e.extend(e.LowpassCombFilter),e.LowpassCombFilter.defaults={resonance:.5,dampening:3e3,minDelay:.1,maxDelay:1,delayTime:.1},Object.defineProperty(e.LowpassCombFilter.prototype,"delayTime",{get:function(){return this._delayTime},set:function(e){this.setDelayTimeAtTime(e)}}),e.LowpassCombFilter.prototype.setDelayTimeAtTime=function(e,t){this._delayTime=this.toSeconds(e);var n=this.context.sampleRate,i=n*this._delayTime;t=this.toSeconds(t);var r=100;if(r>i){this._highFrequencies=!0;for(var o=Math.round(i/r*this._filterDelayCount),s=0;o>s;s++)this._filterDelays[s].setDelay(1/n+this._delayTime,t);this._delayTime=Math.floor(i)/n}else if(this._highFrequencies){this._highFrequencies=!1;for(var a=0;a<this._filterDelays.length;a++)this._filterDelays[a].setDelay(this._delayTime,t)}},e.LowpassCombFilter.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0;t<this._filterDelays.length;t++)this._filterDelays[t].dispose(),this._filterDelays[t]=null;return this._filterDelays=null,this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._resScale.dispose(),this._resScale=null,this._feedback.disconnect(),this._feedback=null,this};var t=function(e,t){this.delay=this.input=this.context.createDelay(e),this.delay.delayTime.value=e,this.filter=this.output=this.context.createBiquadFilter(),t.connect(this.filter.frequency),this.filter.type="lowpass",this.filter.Q.value=0,this.delay.connect(this.filter)};return e.extend(t),t.prototype.setDelay=function(e,t){this.delay.delayTime.setValueAtTime(e,t)},t.prototype.dispose=function(){this.delay.disconnect(),this.delay=null,this.filter.disconnect(),this.filter=null},e.LowpassCombFilter}),ToneModule(function(e){return e.Merge=function(){e.call(this,2,0),this.left=this.input[0]=this.context.createGain(),this.right=this.input[1]=this.context.createGain(),this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1)},e.extend(e.Merge),e.Merge.prototype.dispose=function(){return e.prototype.dispose.call(this),this.left.disconnect(),this.left=null,this.right.disconnect(),this.right=null,this._merger.disconnect(),this._merger=null,this},e.Merge}),ToneModule(function(e){return e.Meter=function(t,n,i){e.call(this),this._channels=this.defaultArg(t,1),this._smoothing=this.defaultArg(n,.8),this._clipMemory=1e3*this.defaultArg(i,.5),this._volume=new Array(this._channels),this._values=new Array(this._channels);for(var r=0;r<this._channels;r++)this._volume[r]=0,this._values[r]=0;this._lastClip=0,this._jsNode=this.context.createScriptProcessor(this.bufferSize,this._channels,1),this._jsNode.onaudioprocess=this._onprocess.bind(this),this._jsNode.noGC(),this.input.connect(this.output),this.input.connect(this._jsNode)},e.extend(e.Meter),e.Meter.prototype._onprocess=function(e){for(var t=this._jsNode.bufferSize,n=this._smoothing,i=0;i<this._channels;i++){for(var r,o=e.inputBuffer.getChannelData(i),s=0,a=0,l=!1,h=0;t>h;h++)r=o[h],!l&&r>.95&&(l=!0,this._lastClip=Date.now()),a+=r,s+=r*r;var u=a/t,c=Math.sqrt(s/t);this._volume[i]=Math.max(c,this._volume[i]*n),this._values[i]=u}},e.Meter.prototype.getLevel=function(e){e=this.defaultArg(e,0);var t=this._volume[e];return 1e-5>t?0:t},e.Meter.prototype.getValue=function(e){return e=this.defaultArg(e,0),this._values[e]},e.Meter.prototype.getDb=function(e){return this.gainToDb(this.getLevel(e))},e.Meter.prototype.isClipped=function(){return Date.now()-this._lastClip<this._clipMemory},e.Meter.prototype.dispose=function(){return e.prototype.dispose.call(this),this._jsNode.disconnect(),this._jsNode.onaudioprocess=null,this._volume=null,this._values=null,this},e.Meter}),ToneModule(function(e){return e.Mono=function(){e.call(this,1,0),this._merge=this.output=new e.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1),this.input.gain.value=this.dbToGain(-10)},e.extend(e.Mono),e.Mono.prototype.dispose=function(){return e.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},e.Mono}),ToneModule(function(e){return e.MultibandCompressor=function(t){t=this.defaultArg(arguments,e.MultibandCompressor.defaults),this._splitter=this.input=new e.MultibandSplit({lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=this.context.createGain(),this.low=new e.Compressor(t.low),this.mid=new e.Compressor(t.mid),this.high=new e.Compressor(t.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output)},e.extend(e.MultibandCompressor),e.MultibandCompressor.defaults={low:e.Compressor.defaults,mid:e.Compressor.defaults,high:e.Compressor.defaults,lowFrequency:250,highFrequency:2e3},e.MultibandCompressor.prototype.dispose=function(){return e.prototype.dispose.call(this),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},e.MultibandCompressor}),ToneModule(function(e){return e.Split=function(){e.call(this,1,2),this._splitter=this.context.createChannelSplitter(2),this.left=this.output[0]=this.context.createGain(),this.right=this.output[1]=this.context.createGain(),this.input.connect(this._splitter),this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},e.extend(e.Split),e.Split.prototype.dispose=function(){return e.prototype.dispose.call(this),this._splitter.disconnect(),this.left.disconnect(),this.right.disconnect(),this.left=null,this.right=null,this._splitter=null,this},e.Split}),ToneModule(function(e){return e.Panner=function(t){e.call(this,1,0),this._crossFade=new e.CrossFade,this._merger=this.output=new e.Merge,this._splitter=new e.Split,this.pan=this._crossFade.fade,this.input.connect(this._splitter.left),this.input.connect(this._splitter.right),this._splitter.connect(this._crossFade,0,0),this._splitter.connect(this._crossFade,1,1),this._crossFade.a.connect(this._merger.left),this._crossFade.b.connect(this._merger.right),this.pan.value=this.defaultArg(t,.5)},e.extend(e.Panner),e.Panner.prototype.dispose=function(){return e.prototype.dispose.call(this),this._crossFade.dispose(),this._crossFade=null,this._splitter.dispose(),this._splitter=null,this._merger.dispose(),this._merger=null,this.pan=null,this},e.Panner}),ToneModule(function(e){return e.PanVol=function(t,n){this._panner=this.input=new e.Panner(t),this.output=this.context.createGain(),this.volume=new e.Signal(this.output.gain,e.Signal.Units.Decibels),this.volume.value=this.defaultArg(n,0),this.pan=this._panner.pan,this._panner.connect(this.output)},e.extend(e.PanVol),e.PanVol.prototype.dispose=function(){return e.prototype.dispose.call(this),this._panner.dispose(),this._panner=null,this.volume.dispose(),this.volume=null,this.pan=null,this},e.PanVol}),ToneModule(function(e){e.Recorder=function(n){console.warn("Tone.Recorder is deprecated. It will be removed in next version"),e.call(this),this.channels=this.defaultArg(n,1),this._jsNode=this.context.createScriptProcessor(this.bufferSize,this.channels,1),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._recordBuffers=new Array(this.channels),this._recordStartSample=0,this._recordEndSample=0,this._recordDuration=0,this.state=t.STOPPED,this._recordBufferOffset=0,this._callback=function(){},this.input.connect(this._jsNode),this.input.connect(this.output),this._jsNode.noGC(),this.clear()},e.extend(e.Recorder),e.Recorder.prototype._audioprocess=function(e){if(this.state!==t.STOPPED&&this.state===t.RECORDING){var n,i,r=this.defaultArg(e.playbackTime,this.now()),o=this.toSamples(r),s=this._jsNode.bufferSize,a=o+s;o>this._recordEndSample?(this.state=t.STOPPED,this._callback(this._recordBuffers)):o>this._recordStartSample?(n=0,i=Math.min(this._recordEndSample-o,s),this._recordChannels(e.inputBuffer,n,i,s)):a>this._recordStartSample&&(i=a-this._recordStartSample,n=s-i,this._recordChannels(e.inputBuffer,n,i,s))}},e.Recorder.prototype._recordChannels=function(e,t,n,i){for(var r=this._recordBufferOffset,o=this._recordBuffers,s=0;s<e.numberOfChannels;s++){var a=e.getChannelData(s);if(0===t&&n===i)this._recordBuffers[s].set(a,r);else for(var l=t;t+n>l;l++){var h=l-t;o[s][h+r]=a[l]}}this._recordBufferOffset+=n},e.Recorder.prototype.record=function(e,n,i){if(this.state===t.STOPPED){this.clear(),this._recordBufferOffset=0,n=this.defaultArg(n,0),this._recordDuration=this.toSamples(e),this._recordStartSample=this.toSamples("+"+n),this._recordEndSample=this._recordStartSample+this._recordDuration;for(var r=0;r<this.channels;r++)this._recordBuffers[r]=new Float32Array(this._recordDuration);this.state=t.RECORDING,this._callback=this.defaultArg(i,function(){})}return this},e.Recorder.prototype.clear=function(){for(var e=0;e<this.channels;e++)this._recordBuffers[e]=null;return this._recordBufferOffset=0,this},e.Recorder.prototype.isEmpty=function(){return null===this._recordBuffers[0]},e.Recorder.prototype.getFloat32Array=function(){return this.isEmpty()?null:this._recordBuffers},e.Recorder.prototype.getAudioBuffer=function(){if(this.isEmpty())return null;for(var e=this.context.createBuffer(this.channels,this._recordBuffers[0].length,this.context.sampleRate),t=0;t<e.numberOfChannels;t++){var n=e.getChannelData(t);n.set(this._recordBuffers[t])}return e},e.Recorder.prototype.dispose=function(){return e.prototype.dispose.call(this),this._jsNode.disconnect(),this._jsNode.onaudioprocess=void 0,this._jsNode=null,this._recordBuffers=null,this};var t={STOPPED:"stopped",SCHEDULED:"scheduled",RECORDING:"recording"};return e.Recorder}),ToneModule(function(e){return e.ScaledEnvelope=function(){var t=this.optionsObject(arguments,["attack","decay","sustain","release"],e.Envelope.defaults);e.Envelope.call(this,t),t=this.defaultArg(t,e.ScaledEnvelope.defaults),this._exp=this.output=new e.Pow(t.exponent),this._scale=this.output=new e.Scale(t.min,t.max),this._sig.chain(this._exp,this._scale)},e.extend(e.ScaledEnvelope,e.Envelope),e.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(e.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(e){this._scale.min=e}}),Object.defineProperty(e.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(e){this._scale.max=e}}),Object.defineProperty(e.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),e.ScaledEnvelope.prototype.dispose=function(){return e.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},e.ScaledEnvelope}),ToneModule(function(e){return e.Buffer=function(){var t=this.optionsObject(arguments,["url","onload"],e.Buffer.defaults);this._buffer=null,this.url=void 0,this.loaded=!1,this.onload=t.onload.bind(this,this),t.url instanceof AudioBuffer?(this._buffer.set(t.url),this.onload(this)):"string"==typeof t.url&&(this.url=t.url,e.Buffer._addToQueue(t.url,this))},e.extend(e.Buffer),e.Buffer.defaults={url:void 0,onload:function(){}},e.Buffer.prototype.set=function(t){return this._buffer=t instanceof e.Buffer?t.get():t,this.loaded=!0,this},e.Buffer.prototype.get=function(){return this._buffer},e.Buffer.prototype.load=function(t,n){return this.url=t,this.onload=this.defaultArg(n,this.onload),e.Buffer._addToQueue(t,this),this},e.Buffer.prototype.dispose=function(){return e.prototype.dispose.call(this),e.Buffer._removeFromQueue(this),this._buffer=null,this.onload=null,this},Object.defineProperty(e.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),e.Buffer._queue=[],e.Buffer._currentDownloads=[],e.Buffer._totalDownloads=0,e.Buffer.MAX_SIMULTANEOUS_DOWNLOADS=6,e.Buffer._addToQueue=function(t,n){e.Buffer._queue.push({url:t,Buffer:n,progress:0,xhr:null}),this._totalDownloads++,e.Buffer._next()},e.Buffer._removeFromQueue=function(t){var n;for(n=0;n<e.Buffer._queue.length;n++){var i=e.Buffer._queue[n];i.Buffer===t&&e.Buffer._queue.splice(n,1)}for(n=0;n<e.Buffer._currentDownloads.length;n++){var r=e.Buffer._currentDownloads[n];r.Buffer===t&&(e.Buffer._currentDownloads.splice(n,1),r.xhr.abort(),r.xhr.onprogress=null,r.xhr.onload=null,r.xhr.onerror=null)}},e.Buffer._next=function(){if(e.Buffer._queue.length>0){if(e.Buffer._currentDownloads.length<e.Buffer.MAX_SIMULTANEOUS_DOWNLOADS){var t=e.Buffer._queue.shift();e.Buffer._currentDownloads.push(t),t.xhr=e.Buffer.load(t.url,function(n){var i=e.Buffer._currentDownloads.indexOf(t);e.Buffer._currentDownloads.splice(i,1),t.Buffer.set(n),t.Buffer.onload(t.Buffer),e.Buffer._onprogress(),e.Buffer._next()}),t.xhr.onprogress=function(n){t.progress=n.loaded/n.total,e.Buffer._onprogress()},t.xhr.onerror=e.Buffer.onerror}}else 0===e.Buffer._currentDownloads.length&&(e.Buffer.onload(),e.Buffer._totalDownloads=0)},e.Buffer._onprogress=function(){var t=0,n=e.Buffer._currentDownloads.length,i=0;if(n>0){for(var r=0;n>r;r++){var o=e.Buffer._currentDownloads[r];t+=o.progress}i=t}var s=n-i,a=e.Buffer._totalDownloads-e.Buffer._queue.length-s;e.Buffer.onprogress(a/e.Buffer._totalDownloads)},e.Buffer.load=function(t,n){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e.context.decodeAudioData(i.response,function(e){if(!e)throw new Error("could not decode audio data:"+t);n(e)})},i.send(),i},e.Buffer.onload=function(){},e.Buffer.onprogress=function(){},e.Buffer.onerror=function(){},e.Buffer}),ToneModule(function(e){var t={};return e.prototype.send=function(e,n){t.hasOwnProperty(e)||(t[e]=this.context.createGain());var i=this.context.createGain();return i.gain.value=this.defaultArg(n,1),this.output.chain(i,t[e]),i},e.prototype.receive=function(e,n){return t.hasOwnProperty(e)||(t[e]=this.context.createGain()),this.isUndef(n)&&(n=this.input),t[e].connect(n),this},e}),ToneModule(function(e){function t(e,t,i){if(n.hasOwnProperty(e))for(var r=n[e],o=0,s=r.length;s>o;o++){var a=r[o];Array.isArray(i)?a.apply(window,[t].concat(i)):a(t,i)}}e.Note=function(t,n,i){this.value=i,this._channel=t,this._timelineID=e.Transport.setTimeline(this._trigger.bind(this),n)},e.Note.prototype._trigger=function(e){t(this._channel,e,this.value)},e.Note.prototype.dispose=function(){return e.Tranport.clearTimeline(this._timelineID),this.value=null,this};var n={};e.Note.route=function(e,t){n.hasOwnProperty(e)?n[e].push(t):n[e]=[t]},e.Note.unroute=function(e,t){if(n.hasOwnProperty(e)){var i=n[e],r=i.indexOf(t);-1!==r&&n[e].splice(r,1)}},e.Note.parseScore=function(t){var n=[];for(var i in t){var r=t[i];if("tempo"===i)e.Transport.bpm.value=r;else if("timeSignature"===i)e.Transport.timeSignature=r[0]/(r[1]/4);else{if(!Array.isArray(r))throw new TypeError("score parts must be Arrays");for(var o=0;o<r.length;o++){var s,a=r[o];if(Array.isArray(a)){var l=a[0],h=a.slice(1);s=new e.Note(i,l,h)}else s=new e.Note(i,a);n.push(s)}}}return n};var i={c:0,"c#":1,db:1,d:2,"d#":3,eb:3,e:4,f:5,"f#":6,gb:6,g:7,"g#":8,ab:8,a:9,"a#":10,bb:10,b:11},r=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o=261.6255653005986;return e.prototype.noteToFrequency=function(e){var t=e.split(/(\d+)/);if(3===t.length){var n=i[t[0].toLowerCase()],r=t[1],s=n+12*parseInt(r,10);return Math.pow(2,(s-48)/12)*o}return 0},e.prototype.isNote=function(){var e=new RegExp(/[a-g]{1}([b#]{1}|[b#]{0})[0-9]+$/i);return function(t){return"string"==typeof t&&(t=t.toLowerCase()),e.test(t)}}(),e.prototype._overwrittenToFrequency=e.prototype.toFrequency,e.prototype.toFrequency=function(e,t){return this.isNote(e)&&(e=this.noteToFrequency(e)),this._overwrittenToFrequency(e,t)},e.prototype.frequencyToNote=function(e){var t=Math.log(e/o)/Math.LN2,n=Math.round(12*t)+48,i=Math.floor(n/12),s=r[n%12];return s+i.toString()},e.prototype.intervalToFrequencyRatio=function(e){return Math.pow(2,e/12)},e.prototype.midiToNote=function(e){var t=Math.floor(e/12)-2,n=e%12;return r[n]+t},e.prototype.noteToMidi=function(e){var t=e.split(/(\d+)/);if(3===t.length){var n=i[t[0].toLowerCase()],r=t[1];return n+12*(parseInt(r,10)+2)}return 0},e.Note}),ToneModule(function(e){return e.Effect=function(){e.call(this);var t=this.optionsObject(arguments,["wet"],e.Effect.defaults);this._dryWet=new e.CrossFade(t.wet),this.wet=this._dryWet.fade,this.effectSend=this.context.createGain(),this.effectReturn=this.context.createGain(),this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output)},e.extend(e.Effect),e.Effect.defaults={wet:1},e.Effect.prototype.bypass=function(){return this.wet.value=0,this},e.Effect.prototype.connectEffect=function(e){return this.effectSend.chain(e,this.effectReturn),this},e.Effect.prototype.dispose=function(){return e.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.disconnect(),this.effectSend=null,this.effectReturn.disconnect(),this.effectReturn=null,this.wet=null,this},e.Effect}),ToneModule(function(e){return e.AutoPanner=function(){var t=this.optionsObject(arguments,["frequency"],e.AutoPanner.defaults);e.Effect.call(this,t),this._lfo=new e.LFO(t.frequency,0,1),this.amount=this._lfo.amplitude,this._panner=new e.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=t.type},e.extend(e.AutoPanner,e.Effect),e.AutoPanner.defaults={frequency:1,type:"sine",amount:1},e.AutoPanner.prototype.start=function(e){return this._lfo.start(e),this},e.AutoPanner.prototype.stop=function(e){return this._lfo.stop(e),this},e.AutoPanner.prototype.sync=function(){return this._lfo.sync(),this},e.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(e.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),e.AutoPanner.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this.frequency=null,this.amount=null,this},e.AutoPanner}),ToneModule(function(e){return e.AutoWah=function(){var t=this.optionsObject(arguments,["baseFrequency","octaves","sensitivity"],e.AutoWah.defaults);e.Effect.call(this,t),this.follower=new e.Follower(t.follower),this._sweepRange=new e.ScaleExp(0,1,.5),this._baseFrequency=t.baseFrequency,this._octaves=t.octaves,this._inputBoost=this.context.createGain(),this._bandpass=new e.Filter({rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new e.Filter(0,"peaking"),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity},e.extend(e.AutoWah,e.Effect),e.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(e.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._setSweepRange()}}),Object.defineProperty(e.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=e,this._setSweepRange()}}),Object.defineProperty(e.AutoWah.prototype,"sensitivity",{get:function(){return this.gainToDb(1/this._inputBoost.gain.value)},set:function(e){this._inputBoost.gain.value=1/this.dbToGain(e);

}}),e.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},e.AutoWah.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.disconnect(),this._inputBoost=null,this.gain=null,this.Q=null,this},e.AutoWah}),ToneModule(function(e){return e.BitCrusher=function(){var t=this.optionsObject(arguments,["bits"],e.BitCrusher.defaults);e.Effect.call(this,t);var n=1/Math.pow(2,t.bits-1);this._subtract=new e.Subtract,this._modulo=new e.Modulo(n),this._bits=t.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},e.extend(e.BitCrusher,e.Effect),e.BitCrusher.defaults={bits:4},Object.defineProperty(e.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(e){this._bits=e;var t=1/Math.pow(2,e-1);this._modulo.value=t}}),e.BitCrusher.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},e.BitCrusher}),ToneModule(function(e){return e.Chebyshev=function(){var t=this.optionsObject(arguments,["order"],e.Chebyshev.defaults);e.Effect.call(this),this._shaper=new e.WaveShaper(4096),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample},e.extend(e.Chebyshev,e.Effect),e.Chebyshev.defaults={order:1,oversample:"none"},e.Chebyshev.prototype._getCoefficient=function(e,t,n){return n.hasOwnProperty(t)?n[t]:(n[t]=0===t?0:1===t?e:2*e*this._getCoefficient(e,t-1,n)-this._getCoefficient(e,t-2,n),n[t])},Object.defineProperty(e.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(e){this._order=e;for(var t=new Array(4096),n=t.length,i=0;n>i;++i){var r=2*i/n-1;t[i]=0===r?0:this._getCoefficient(r,e,{})}this._shaper.curve=t}}),Object.defineProperty(e.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),e.Chebyshev.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},e.Chebyshev}),ToneModule(function(e){return e.StereoEffect=function(){e.call(this);var t=this.optionsObject(arguments,["wet"],e.Effect.defaults);this._dryWet=new e.CrossFade(t.wet),this.wet=this._dryWet.fade,this._split=new e.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new e.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output)},e.extend(e.StereoEffect,e.Effect),e.StereoEffect.prototype.dispose=function(){return e.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this.wet=null,this},e.StereoEffect}),ToneModule(function(e){return e.FeedbackEffect=function(){var t=this.optionsObject(arguments,["feedback"]);t=this.defaultArg(t,e.FeedbackEffect.defaults),e.Effect.call(this,t),this.feedback=new e.Signal(t.feedback,e.Signal.Units.Normal),this._feedbackGain=this.context.createGain(),this.effectReturn.chain(this._feedbackGain,this.effectSend),this.feedback.connect(this._feedbackGain.gain)},e.extend(e.FeedbackEffect,e.Effect),e.FeedbackEffect.defaults={feedback:.125},e.FeedbackEffect.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this.feedback.dispose(),this.feedback=null,this._feedbackGain.disconnect(),this._feedbackGain=null,this},e.FeedbackEffect}),ToneModule(function(e){return e.StereoXFeedbackEffect=function(){var t=this.optionsObject(arguments,["feedback"],e.FeedbackEffect.defaults);e.StereoEffect.call(this,t),this.feedback=new e.Signal(t.feedback),this._feedbackLR=this.context.createGain(),this._feedbackRL=this.context.createGain(),this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain)},e.extend(e.StereoXFeedbackEffect,e.FeedbackEffect),e.StereoXFeedbackEffect.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this.feedback.dispose(),this.feedback=null,this._feedbackLR.disconnect(),this._feedbackLR=null,this._feedbackRL.disconnect(),this._feedbackRL=null,this},e.StereoXFeedbackEffect}),ToneModule(function(e){return e.Chorus=function(){var t=this.optionsObject(arguments,["frequency","delayTime","depth"],e.Chorus.defaults);e.StereoXFeedbackEffect.call(this,t),this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new e.LFO(t.rate,0,1),this._lfoR=new e.LFO(t.rate,0,1),this._lfoR.phase=180,this._delayNodeL=this.context.createDelay(),this._delayNodeR=this.context.createDelay(),this.frequency=this._lfoL.frequency,this.connectSeries(this.effectSendL,this._delayNodeL,this.effectReturnL),this.connectSeries(this.effectSendR,this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=t.frequency,this.type=t.type},e.extend(e.Chorus,e.StereoXFeedbackEffect),e.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,feedback:.1,type:"sine"},Object.defineProperty(e.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(e){this._depth=e;var t=this._delayTime*e;this._lfoL.min=this._delayTime-t,this._lfoL.max=this._delayTime+t,this._lfoR.min=this._delayTime-t,this._lfoR.max=this._delayTime+t}}),Object.defineProperty(e.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(e){this._delayTime=e/1e3,this.depth=this._depth}}),Object.defineProperty(e.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}}),e.Chorus.prototype.dispose=function(){return e.StereoXFeedbackEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.disconnect(),this._delayNodeL=null,this._delayNodeR.disconnect(),this._delayNodeR=null,this.frequency=null,this},e.Chorus}),ToneModule(function(e){return e.Convolver=function(t){e.Effect.apply(this,arguments),this._convolver=this.context.createConvolver(),this._buffer=new e.Buffer(t,function(e){this.buffer=e}.bind(this)),this.connectEffect(this._convolver)},e.extend(e.Convolver,e.Effect),Object.defineProperty(e.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(e){this._buffer.set(e),this._convolver.buffer=e}}),e.Convolver.prototype.load=function(e,t){return this._buffer.load(e,function(e){this.buffer=e,t&&t()}.bind(this)),this},e.Convolver.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},e.Convolver}),ToneModule(function(e){return e.Distortion=function(){var t=this.optionsObject(arguments,["distortion"],e.Distortion.defaults);e.Effect.call(this),this._shaper=new e.WaveShaper(4096),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample},e.extend(e.Distortion,e.Effect),e.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(e.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(e){this._distortion=e;var t=100*e,n=Math.PI/180;this._shaper.setMap(function(e){return Math.abs(e)<.001?0:(3+t)*e*20*n/(Math.PI+t*Math.abs(e))})}}),Object.defineProperty(e.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),e.Distortion.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},e.Distortion}),ToneModule(function(e){return e.FeedbackDelay=function(){var t=this.optionsObject(arguments,["delayTime","feedback"],e.FeedbackDelay.defaults);e.FeedbackEffect.call(this,t),this.delayTime=new e.Signal(t.delayTime,e.Signal.Units.Time),this._delayNode=this.context.createDelay(4),this.connectEffect(this._delayNode),this.delayTime.connect(this._delayNode.delayTime)},e.extend(e.FeedbackDelay,e.FeedbackEffect),e.FeedbackDelay.defaults={delayTime:.25},e.FeedbackDelay.prototype.dispose=function(){return e.FeedbackEffect.prototype.dispose.call(this),this.delayTime.dispose(),this._delayNode.disconnect(),this._delayNode=null,this.delayTime=null,this},e.FeedbackDelay}),ToneModule(function(e){var t=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],n=[225,556,441,341];return e.Freeverb=function(){var i=this.optionsObject(arguments,["roomSize","dampening"],e.Freeverb.defaults);e.StereoEffect.call(this,i),this.roomSize=new e.Signal(i.roomSize),this.dampening=new e.Signal(i.dampening),this._dampeningScale=new e.ScaleExp(100,8e3,.5),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var r=0;r<n.length;r++){var o=this.context.createBiquadFilter();o.type="allpass",o.frequency.value=n[r],this._allpassFiltersL.push(o)}for(var s=0;s<n.length;s++){var a=this.context.createBiquadFilter();a.type="allpass",a.frequency.value=n[s],this._allpassFiltersR.push(a)}for(var l=0;l<t.length;l++){var h=new e.LowpassCombFilter(t[l]);l<t.length/2?this.effectSendL.chain(h,this._allpassFiltersL[0]):this.effectSendR.chain(h,this._allpassFiltersR[0]),this.roomSize.connect(h.resonance),this._dampeningScale.connect(h.dampening),this._combFilters.push(h)}this.connectSeries.apply(this,this._allpassFiltersL),this.connectSeries.apply(this,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this.dampening.connect(this._dampeningScale)},e.extend(e.Freeverb,e.StereoEffect),e.Freeverb.defaults={roomSize:.7,dampening:.5},e.Freeverb.prototype.dispose=function(){e.StereoEffect.prototype.dispose.call(this);for(var t=0;t<this._allpassFiltersL.length;t++)this._allpassFiltersL[t].disconnect(),this._allpassFiltersL[t]=null;this._allpassFiltersL=null;for(var n=0;n<this._allpassFiltersR.length;n++)this._allpassFiltersR[n].disconnect(),this._allpassFiltersR[n]=null;this._allpassFiltersR=null;for(var i=0;i<this._combFilters.length;i++)this._combFilters[i].dispose(),this._combFilters[i]=null;return this._combFilters=null,this.roomSize.dispose(),this.dampening.dispose(),this._dampeningScale.dispose(),this.roomSize=null,this.dampening=null,this._dampeningScale=null,this},e.Freeverb}),ToneModule(function(e){var t=[.06748,.06404,.08212,.09004],n=[.773,.802,.753,.733],i=[347,113,37];return e.JCReverb=function(){var r=this.optionsObject(arguments,["roomSize"],e.JCReverb.defaults);e.StereoEffect.call(this,r),this.roomSize=new e.Signal(r.roomSize,e.Signal.Units.Normal),this._scaleRoomSize=new e.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var o=0;o<i.length;o++){var s=this.context.createBiquadFilter();s.type="allpass",s.frequency.value=i[o],this._allpassFilters.push(s)}for(var a=0;a<t.length;a++){var l=new e.FeedbackCombFilter(t[a],.1);this._scaleRoomSize.connect(l.resonance),l.resonance.value=n[a],this._allpassFilters[this._allpassFilters.length-1].connect(l),l.connect(a<t.length/2?this.effectReturnL:this.effectReturnR),this._feedbackCombFilters.push(l)}this.roomSize.connect(this._scaleRoomSize),this.connectSeries.apply(this,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0])},e.extend(e.JCReverb,e.StereoEffect),e.JCReverb.defaults={roomSize:.5},e.JCReverb.prototype.dispose=function(){e.StereoEffect.prototype.dispose.call(this);for(var t=0;t<this._allpassFilters.length;t++)this._allpassFilters[t].disconnect(),this._allpassFilters[t]=null;this._allpassFilters=null;for(var n=0;n<this._feedbackCombFilters.length;n++)this._feedbackCombFilters[n].dispose(),this._feedbackCombFilters[n]=null;return this._feedbackCombFilters=null,this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},e.JCReverb}),ToneModule(function(e){return e.MidSideEffect=function(){e.StereoEffect.call(this),this._sqrtTwo=new e.Signal(1/Math.sqrt(2)),this.midSend=new e.Expr("($0 + $1) * $2"),this.sideSend=new e.Expr("($0 - $1) * $2"),this._left=new e.Expr("($0 + $1) * $2"),this._right=new e.Expr("($0 - $1) * $2"),this.midReturn=this.context.createGain(),this.sideReturn=this.context.createGain(),this.effectSendL.connect(this.midSend,0,0),this.effectSendR.connect(this.midSend,0,1),this.effectSendL.connect(this.sideSend,0,0),this.effectSendR.connect(this.sideSend,0,1),this._left.connect(this.effectReturnL),this._right.connect(this.effectReturnR),this.midReturn.connect(this._left,0,0),this.sideReturn.connect(this._left,0,1),this.midReturn.connect(this._right,0,0),this.sideReturn.connect(this._right,0,1),this._sqrtTwo.connect(this.midSend,0,2),this._sqrtTwo.connect(this.sideSend,0,2),this._sqrtTwo.connect(this._left,0,2),this._sqrtTwo.connect(this._right,0,2)},e.extend(e.MidSideEffect,e.StereoEffect),e.MidSideEffect.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this._sqrtTwo.dispose(),this._sqrtTwo=null,this.midSend.dispose(),this.midSend=null,this.sideSend.dispose(),this.sideSend=null,this._left.dispose(),this._left=null,this._right.dispose(),this._right=null,this.midReturn.disconnect(),this.midReturn=null,this.sideReturn.disconnect(),this.sideReturn=null,this},e.MidSideEffect}),ToneModule(function(e){return e.Phaser=function(){var t=this.optionsObject(arguments,["frequency","depth","baseFrequency"],e.Phaser.defaults);e.StereoEffect.call(this,t),this._lfoL=new e.LFO(t.frequency,0,1),this._lfoR=new e.LFO(t.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=t.baseFrequency,this._depth=t.depth,this._filtersL=this._makeFilters(t.stages,this._lfoL,t.Q),this._filtersR=this._makeFilters(t.stages,this._lfoR,t.Q),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[t.stages-1].connect(this.effectReturnL),this._filtersR[t.stages-1].connect(this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.depth=t.depth,this._lfoL.start(),this._lfoR.start()},e.extend(e.Phaser,e.StereoEffect),e.Phaser.defaults={frequency:.5,depth:10,stages:4,Q:100,baseFrequency:400},e.Phaser.prototype._makeFilters=function(e,t,n){for(var i=new Array(e),r=0;e>r;r++){var o=this.context.createBiquadFilter();o.type="allpass",o.Q.value=n,t.connect(o.frequency),i[r]=o}return this.connectSeries.apply(this,i),i},Object.defineProperty(e.Phaser.prototype,"depth",{get:function(){return this._depth},set:function(e){this._depth=e;var t=this._baseFrequency+this._baseFrequency*e;this._lfoL.max=t,this._lfoR.max=t}}),Object.defineProperty(e.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=e,this._lfoL.min=e,this._lfoR.min=e,this.depth=this._depth}}),e.Phaser.prototype.dispose=function(){e.StereoEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var t=0;t<this._filtersL.length;t++)this._filtersL[t].disconnect(),this._filtersL[t]=null;this._filtersL=null;for(var n=0;n<this._filtersR.length;n++)this._filtersR[n].disconnect(),this._filtersR[n]=null;return this._filtersR=null,this.frequency=null,this},e.Phaser}),ToneModule(function(e){return e.PingPongDelay=function(){var t=this.optionsObject(arguments,["delayTime","feedback"],e.PingPongDelay.defaults);e.StereoXFeedbackEffect.call(this,t),this._leftDelay=this.context.createDelay(t.maxDelayTime),this._rightDelay=this.context.createDelay(t.maxDelayTime),this._rightPreDelay=this.context.createDelay(t.maxDelayTime),this.delayTime=new e.Signal(t.delayTime,e.Signal.Units.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay)},e.extend(e.PingPongDelay,e.StereoXFeedbackEffect),e.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},e.PingPongDelay.prototype.dispose=function(){return e.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.disconnect(),this._leftDelay=null,this._rightDelay.disconnect(),this._rightDelay=null,this._rightPreDelay.disconnect(),this._rightPreDelay=null,this.delayTime.dispose(),this.delayTime=null,this},e.PingPongDelay}),ToneModule(function(e){return e.StereoFeedbackEffect=function(){var t=this.optionsObject(arguments,["feedback"],e.FeedbackEffect.defaults);e.StereoEffect.call(this,t),this.feedback=new e.Signal(t.feedback),this._feedbackL=this.context.createGain(),this._feedbackR=this.context.createGain(),this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain)},e.extend(e.StereoFeedbackEffect,e.FeedbackEffect),e.StereoFeedbackEffect.prototype.dispose=function(){return e.StereoEffect.prototype.dispose.call(this),this.feedback.dispose(),this.feedback=null,this._feedbackL.disconnect(),this._feedbackL=null,this._feedbackR.disconnect(),this._feedbackR=null,this},e.StereoFeedbackEffect}),ToneModule(function(e){return e.StereoWidener=function(){var t=this.optionsObject(arguments,["width"],e.StereoWidener.defaults);e.MidSideEffect.call(this,t),this.width=new e.Signal(.5,e.Signal.Units.Normal),this._midMult=new e.Expr("$0 * ($1 * (1 - $2))"),this._sideMult=new e.Expr("$0 * ($1 * $2)"),this._two=new e.Signal(2),this._two.connect(this._midMult,0,1),this.width.connect(this._midMult,0,2),this._two.connect(this._sideMult,0,1),this.width.connect(this._sideMult,0,2),this.midSend.chain(this._midMult,this.midReturn),this.sideSend.chain(this._sideMult,this.sideReturn)},e.extend(e.StereoWidener,e.MidSideEffect),e.StereoWidener.defaults={width:.5},e.StereoWidener.prototype.dispose=function(){return e.MidSideEffect.prototype.dispose.call(this),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._two.dispose(),this._two=null,this},e.StereoWidener}),ToneModule(function(e){return e.PulseOscillator=function(){var t=this.optionsObject(arguments,["frequency","width"],e.Oscillator.defaults);e.Source.call(this,t),this.width=new e.Signal(t.width,e.Signal.Units.Normal),this._widthGate=this.context.createGain(),this._sawtooth=new e.Oscillator({frequency:t.frequency,detune:t.detune,type:"sawtooth",phase:t.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new e.WaveShaper(function(e){return 0>e?-1:1}),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh)},e.extend(e.PulseOscillator,e.Oscillator),e.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},e.PulseOscillator.prototype._start=function(e){e=this.toSeconds(e),this._sawtooth.start(e),this._widthGate.gain.setValueAtTime(1,e)},e.PulseOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._sawtooth.stop(e),this._widthGate.gain.setValueAtTime(0,e)},Object.defineProperty(e.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(e){this._sawtooth.phase=e}}),Object.defineProperty(e.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),e.PulseOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this.width.dispose(),this.width=null,this._widthGate.disconnect(),this._widthGate=null,this._thresh.disconnect(),this._thresh=null,this.frequency=null,this.detune=null,this},e.PulseOscillator}),ToneModule(function(e){return e.PWMOscillator=function(){var t=this.optionsObject(arguments,["frequency","modulationFrequency"],e.PWMOscillator.defaults);e.Source.call(this,t),this._pulse=new e.PulseOscillator(t.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new e.Oscillator({frequency:t.frequency,detune:t.detune}),this._scale=new e.Multiply(1.01),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output)},e.extend(e.PWMOscillator,e.Oscillator),e.PWMOscillator.defaults={frequency:440,detune:0,modulationFrequency:.4},e.PWMOscillator.prototype._start=function(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)},e.PWMOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)},Object.defineProperty(e.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(e.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(e){this._modulator.phase=e}}),e.PWMOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this.frequency=null,this.detune=null,this.modulationFrequency=null,this},e.PWMOscillator}),ToneModule(function(e){e.OmniOscillator=function(){var t=this.optionsObject(arguments,["frequency","type"],e.OmniOscillator.defaults);e.Source.call(this,t),this.frequency=new e.Signal(t.frequency,e.Signal.Units.Frequency),this.detune=new e.Signal(t.detune),this._sourceType=void 0,this._oscillator=null,this.type=t.type},e.extend(e.OmniOscillator,e.Oscillator),e.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",width:.4,modulationFrequency:.4};var t={PulseOscillator:"PulseOscillator",PWMOscillator:"PWMOscillator",Oscillator:"Oscillator"};return e.OmniOscillator.prototype._start=function(e){this._oscillator.start(e)},e.OmniOscillator.prototype._stop=function(e){this._oscillator.stop(e)},Object.defineProperty(e.OmniOscillator.prototype,"type",{get:function(){return this._oscillator.type},set:function(n){if("sine"===n||"square"===n||"triangle"===n||"sawtooth"===n)this._sourceType!==t.Oscillator&&(this._sourceType=t.Oscillator,this._createNewOscillator(e.Oscillator)),this._oscillator.type=n;else if("pwm"===n)this._sourceType!==t.PWMOscillator&&(this._sourceType=t.PWMOscillator,this._createNewOscillator(e.PWMOscillator));else{if("pulse"!==n)throw new TypeError("Tone.OmniOscillator does not support type "+n);this._sourceType!==t.PulseOscillator&&(this._sourceType=t.PulseOscillator,this._createNewOscillator(e.PulseOscillator))}}}),e.OmniOscillator.prototype._createNewOscillator=function(t){var n=this.now()+this.bufferTime;if(null!==this._oscillator){var i=this._oscillator;i.stop(n),i.onended=function(){i.dispose(),i=null}}this._oscillator=new t,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===e.Source.State.STARTED&&this._oscillator.start(n)},Object.defineProperty(e.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e}}),Object.defineProperty(e.OmniOscillator.prototype,"width",{get:function(){return this._sourceType===t.PulseOscillator?this._oscillator.width:void 0}}),Object.defineProperty(e.OmniOscillator.prototype,"modulationFrequency",{get:function(){return this._sourceType===t.PWMOscillator?this._oscillator.modulationFrequency:void 0}}),e.OmniOscillator.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},e.OmniOscillator}),ToneModule(function(e){return e.Instrument=function(){this.output=this.context.createGain(),this.volume=new e.Signal(this.output.gain,e.Signal.Units.Decibels)},e.extend(e.Instrument),e.Instrument.prototype.triggerAttack=function(){},e.Instrument.prototype.triggerRelease=function(){},e.Instrument.prototype.triggerAttackRelease=function(e,t,n,i){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(e,n,i),this.triggerRelease(n+t),this},e.Instrument.prototype.dispose=function(){return e.prototype.dispose.call(this),this.volume.dispose(),this.volume=null,this},e.Instrument}),ToneModule(function(e){return e.Monophonic=function(t){e.Instrument.call(this),t=this.defaultArg(t,e.Monophonic.defaults),this.portamento=t.portamento},e.extend(e.Monophonic,e.Instrument),e.Monophonic.defaults={portamento:0},e.Monophonic.prototype.triggerAttack=function(e,t,n){return t=this.toSeconds(t),this.triggerEnvelopeAttack(t,n),this.setNote(e,t),this},e.Monophonic.prototype.triggerRelease=function(e){return this.triggerEnvelopeRelease(e),this},e.Monophonic.prototype.triggerEnvelopeAttack=function(){},e.Monophonic.prototype.triggerEnvelopeRelease=function(){},e.Monophonic.prototype.setNote=function(e,t){if(t=this.toSeconds(t),this.portamento>0){var n=this.frequency.value;this.frequency.setValueAtTime(n,t);var i=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(e,t+i)}else this.frequency.setValueAtTime(e,t);return this},e.Monophonic}),ToneModule(function(e){return e.MonoSynth=function(t){t=this.defaultArg(t,e.MonoSynth.defaults),e.Monophonic.call(this,t),this.oscillator=new e.OmniOscillator(t.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new e.Filter(t.filter),this.filterEnvelope=new e.ScaledEnvelope(t.filterEnvelope),this.envelope=new e.AmplitudeEnvelope(t.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.oscillator.start(),this.filterEnvelope.connect(this.filter.frequency)},e.extend(e.MonoSynth,e.Monophonic),e.MonoSynth.defaults={oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,min:20,max:4e3,exponent:2}},e.MonoSynth.prototype.triggerEnvelopeAttack=function(e,t){return this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this},e.MonoSynth.prototype.triggerEnvelopeRelease=function(e){return this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this},e.MonoSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},e.MonoSynth}),ToneModule(function(e){return e.AMSynth=function(t){t=this.defaultArg(t,e.AMSynth.defaults),e.Monophonic.call(this,t),this.carrier=new e.MonoSynth(t.carrier),this.carrier.volume.value=-10,this.modulator=new e.MonoSynth(t.modulator),this.modulator.volume.value=-10,this.frequency=new e.Signal(440,e.Signal.Units.Frequency),this._harmonicity=new e.Multiply(t.harmonicity),this._modulationScale=new e.AudioToGain,this._modulationNode=this.context.createGain(),this.frequency.connect(this.carrier.frequency),this.frequency.chain(this._harmonicity,this.modulator.frequency),this.modulator.chain(this._modulationScale,this._modulationNode.gain),this.carrier.chain(this._modulationNode,this.output)},e.extend(e.AMSynth,e.Monophonic),e.AMSynth.defaults={harmonicity:3,carrier:{volume:-10,portamento:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5,min:2e4,max:2e4}},modulator:{volume:-10,portamento:0,oscillator:{type:"square"},envelope:{attack:2,decay:0,sustain:1,release:.5},filterEnvelope:{attack:4,decay:.2,sustain:.5,release:.5,min:20,max:1500}}},e.AMSynth.prototype.triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.carrier.envelope.triggerAttack(e,t),this.modulator.envelope.triggerAttack(e),this.carrier.filterEnvelope.triggerAttack(e),this.modulator.filterEnvelope.triggerAttack(e),this},e.AMSynth.prototype.triggerEnvelopeRelease=function(e){return this.carrier.triggerRelease(e),this.modulator.triggerRelease(e),this},Object.defineProperty(e.AMSynth.prototype,"harmonicity",{get:function(){return this._harmonicity.value},set:function(e){this._harmonicity.value=e}}),e.AMSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this.carrier.dispose(),this.carrier=null,this.modulator.dispose(),this.modulator=null,this.frequency.dispose(),this.frequency=null,this._harmonicity.dispose(),this._harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.disconnect(),this._modulationNode=null,this},e.AMSynth}),ToneModule(function(e){return e.DuoSynth=function(t){t=this.defaultArg(t,e.DuoSynth.defaults),e.Monophonic.call(this,t),this.voice0=new e.MonoSynth(t.voice0),this.voice0.volume.value=-10,this.voice1=new e.MonoSynth(t.voice1),this.voice1.volume.value=-10,this._vibrato=new e.LFO(t.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=this.context.createGain(),this.vibratoAmount=new e.Signal(this._vibratoGain.gain,e.Signal.Units.Gain),this.vibratoAmount.value=t.vibratoAmount,this._vibratoDelay=this.toSeconds(t.vibratoDelay),this.frequency=new e.Signal(440,e.Signal.Units.Frequency),this._harmonicity=new e.Multiply(t.harmonicity),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this._harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output)},e.extend(e.DuoSynth,e.Monophonic),e.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,vibratoDelay:1,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},e.DuoSynth.prototype.triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.voice0.envelope.triggerAttack(e,t),this.voice1.envelope.triggerAttack(e,t),this.voice0.filterEnvelope.triggerAttack(e),this.voice1.filterEnvelope.triggerAttack(e),this},e.DuoSynth.prototype.triggerEnvelopeRelease=function(e){return this.voice0.triggerRelease(e),this.voice1.triggerRelease(e),this},Object.defineProperty(e.DuoSynth.prototype,"harmonicity",{get:function(){return this._harmonicity.value},set:function(e){this._harmonicity.value=e}}),e.DuoSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibrato.dispose(),this._vibrato=null,this._vibratoGain.disconnect(),this._vibratoGain=null,this._harmonicity.dispose(),this._harmonicity=null,this.vibratoAmount.dispose(),
this.vibratoAmount=null,this.vibratoRate=null,this},e.DuoSynth}),ToneModule(function(e){return e.FMSynth=function(t){t=this.defaultArg(t,e.FMSynth.defaults),e.Monophonic.call(this,t),this.carrier=new e.MonoSynth(t.carrier),this.carrier.volume.value=-10,this.modulator=new e.MonoSynth(t.modulator),this.modulator.volume.value=-10,this.frequency=new e.Signal(440,e.Signal.Units.Frequency),this._harmonicity=new e.Multiply(t.harmonicity),this._modulationIndex=new e.Multiply(t.modulationIndex),this._modulationNode=this.context.createGain(),this.frequency.connect(this.carrier.frequency),this.frequency.chain(this._harmonicity,this.modulator.frequency),this.frequency.chain(this._modulationIndex,this._modulationNode),this.modulator.connect(this._modulationNode.gain),this._modulationNode.gain.value=0,this._modulationNode.connect(this.carrier.frequency),this.carrier.connect(this.output)},e.extend(e.FMSynth,e.Monophonic),e.FMSynth.defaults={harmonicity:3,modulationIndex:10,carrier:{volume:-10,portamento:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:0,sustain:1,release:.5},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5,min:2e4,max:2e4}},modulator:{volume:-10,portamento:0,oscillator:{type:"triangle"},envelope:{attack:.01,decay:0,sustain:1,release:.5},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5,min:2e4,max:2e4}}},e.FMSynth.prototype.triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.carrier.envelope.triggerAttack(e,t),this.modulator.envelope.triggerAttack(e),this.carrier.filterEnvelope.triggerAttack(e),this.modulator.filterEnvelope.triggerAttack(e),this},e.FMSynth.prototype.triggerEnvelopeRelease=function(e){return this.carrier.triggerRelease(e),this.modulator.triggerRelease(e),this},Object.defineProperty(e.FMSynth.prototype,"harmonicity",{get:function(){return this._harmonicity.value},set:function(e){this._harmonicity.value=e}}),Object.defineProperty(e.FMSynth.prototype,"modulationIndex",{get:function(){return this._modulationIndex.value},set:function(e){this._modulationIndex.value=e}}),e.FMSynth.prototype.dispose=function(){return e.Monophonic.prototype.dispose.call(this),this.carrier.dispose(),this.carrier=null,this.modulator.dispose(),this.modulator=null,this.frequency.dispose(),this.frequency=null,this._modulationIndex.dispose(),this._modulationIndex=null,this._harmonicity.dispose(),this._harmonicity=null,this._modulationNode.disconnect(),this._modulationNode=null,this},e.FMSynth}),ToneModule(function(e){return e.Player=function(){var t=this.optionsObject(arguments,["url","onload"],e.Player.defaults);e.Source.call(this,t),this._source=null,this._buffer=new e.Buffer(t.url,t.onload.bind(null,this)),this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.retrigger=t.retrigger},e.extend(e.Player,e.Source),e.Player.defaults={onload:function(){},playbackRate:1,loop:!1,loopStart:0,loopEnd:0,retrigger:!1},e.Player.prototype.load=function(e,t){return this._buffer.load(e,t.bind(this,this)),this},e.Player.prototype._start=function(e,t,n){if(!this._buffer.loaded)throw Error("tried to start Player before the buffer was loaded");return this._loop?(t=this.defaultArg(t,this._loopStart),t=this.toSeconds(t)):t=this.defaultArg(t,0),n=this.defaultArg(n,this._buffer.duration-t),e=this.toSeconds(e),n=this.toSeconds(n),this._source=this.context.createBufferSource(),this._source.buffer=this._buffer.get(),this._loop?(this._source.loop=this._loop,this._source.loopStart=this.toSeconds(this._loopStart),this._source.loopEnd=this.toSeconds(this._loopEnd)):this._nextStop=e+n,this._source.playbackRate.value=this._playbackRate,this._source.onended=this.onended,this._source.connect(this.output),this._source.start(e,t,n),this},e.Player.prototype._stop=function(e){return this._source&&(this._source.stop(this.toSeconds(e)),this._source=null),this},e.Player.prototype.setLoopPoints=function(e,t){return this.loopStart=e,this.loopEnd=t,this},Object.defineProperty(e.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(e){this._loopStart=e,this._source&&(this._source.loopStart=this.toSeconds(e))}}),Object.defineProperty(e.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(e){this._loopEnd=e,this._source&&(this._source.loopEnd=this.toSeconds(e))}}),Object.defineProperty(e.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(e){this._buffer.set(e)}}),Object.defineProperty(e.Player.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this._source&&(this._source.loop=e)}}),Object.defineProperty(e.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}}),e.Player.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer.dispose(),this._buffer=null,this},e.Player}),ToneModule(function(e){return e.Sampler=function(t,n){e.Instrument.call(this),n=this.defaultArg(n,e.Sampler.defaults),this.player=new e.Player(n.player),this.player.retrigger=!0,this._buffers={},this.envelope=new e.AmplitudeEnvelope(n.envelope),this.filterEnvelope=new e.ScaledEnvelope(n.filterEnvelope),this._sample=n.sample,this._pitch=n.pitch,this.filter=new e.Filter(n.filter),this._loadBuffers(t),this.pitch=n.pitch,this.player.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency)},e.extend(e.Sampler,e.Instrument),e.Sampler.defaults={sample:0,pitch:0,player:{loop:!1},envelope:{attack:.001,decay:0,sustain:1,release:.1},filterEnvelope:{attack:.001,decay:.001,sustain:1,release:.5,min:20,max:2e4,exponent:2},filter:{type:"lowpass"}},e.Sampler.prototype._loadBuffers=function(t){if("string"==typeof t)this._buffers[0]=new e.Buffer(t,function(){this.sample="0"}.bind(this));else{t=this._flattenUrls(t);for(var n in t){this._sample=n;var i=t[n];this._buffers[n]=new e.Buffer(i)}}},e.Sampler.prototype._flattenUrls=function(e){var t={};for(var n in e)if(e.hasOwnProperty(n))if("object"==typeof e[n]){var i=this._flattenUrls(e[n]);for(var r in i)i.hasOwnProperty(r)&&(t[n+"."+r]=i[r])}else t[n]=e[n];return t},e.Sampler.prototype.triggerAttack=function(e,t,n){return t=this.toSeconds(t),e&&(this.sample=e),this.player.start(t,0),this.envelope.triggerAttack(t,n),this.filterEnvelope.triggerAttack(t),this},e.Sampler.prototype.triggerRelease=function(e){return e=this.toSeconds(e),this.filterEnvelope.triggerRelease(e),this.envelope.triggerRelease(e),this.player.stop(this.toSeconds(this.envelope.release)+e),this},Object.defineProperty(e.Sampler.prototype,"sample",{get:function(){return this._sample},set:function(e){if(!this._buffers.hasOwnProperty(e))throw new Error("Sampler does not have a sample named "+e);this._sample=e,this.player.buffer=this._buffers[e]}}),Object.defineProperty(e.Sampler.prototype,"pitch",{get:function(){return this._pitch},set:function(e){this._pitch=e,this.player.playbackRate=this.intervalToFrequencyRatio(e)}}),e.Sampler.prototype.dispose=function(){e.Instrument.prototype.dispose.call(this),this.player.dispose(),this.filterEnvelope.dispose(),this.envelope.dispose(),this.filter.dispose(),this.player=null,this.filterEnvelope=null,this.envelope=null,this.filter=null;for(var t in this._buffers)this._buffers[t].dispose(),this._buffers[t]=null;return this._buffers=null,this},e.Sampler}),ToneModule(function(e){return e.MultiSampler=function(t,n){console.warn("Tone.MultiSampler is deprecated - use Tone.PolySynth with Tone.Sampler as the voice"),e.Instrument.call(this),this.samples={},this._createSamples(t,n)},e.extend(e.MultiSampler,e.Instrument),e.MultiSampler.prototype._createSamples=function(t,n){var i={total:0,loaded:0};for(var r in t)i.total++;var o=function(){i.loaded++,i.loaded===i.total&&n&&n()};for(var s in t){var a=t[s],l=new e.Sampler(a,o);l.connect(this.output),this.samples[s]=l}},e.MultiSampler.prototype.triggerAttack=function(e,t,n){this.samples.hasOwnProperty(e)&&this.samples[e].triggerAttack(0,t,n)},e.MultiSampler.prototype.triggerRelease=function(e,t){this.samples.hasOwnProperty(e)&&this.samples[e].triggerRelease(t)},e.MultiSampler.prototype.triggerAttackRelease=function(e,t,n,i){if(this.samples.hasOwnProperty(e)){n=this.toSeconds(n),t=this.toSeconds(t);var r=this.samples[e];r.triggerAttack(0,n,i),r.triggerRelease(n+t)}},e.MultiSampler.prototype.set=function(e){for(var t in this.samples)this.samples[t].set(e)},e.MultiSampler.prototype.dispose=function(){e.Instrument.prototype.dispose.call(this);for(var t in this.samples)this.samples[t].dispose(),this.samples[t]=null;this.samples=null},e.MultiSampler}),ToneModule(function(e){e.Noise=function(){var t=this.optionsObject(arguments,["type"],e.Noise.defaults);e.Source.call(this,t),this._source=null,this._buffer=null,this.type=t.type},e.extend(e.Noise,e.Source),e.Noise.defaults={type:"white"},Object.defineProperty(e.Noise.prototype,"type",{get:function(){return this._buffer===i?"white":this._buffer===n?"brown":this._buffer===t?"pink":void 0},set:function(r){if(this.type!==r){switch(r){case"white":this._buffer=i;break;case"pink":this._buffer=t;break;case"brown":this._buffer=n;break;default:this._buffer=i}if(this.state===e.Source.State.STARTED){var o=this.now()+this.bufferTime;this._source.onended=void 0,this._stop(o),this._start(o)}}}}),e.Noise.prototype._start=function(e){this._source=this.context.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this.connectSeries(this._source,this.output),this._source.start(this.toSeconds(e)),this._source.onended=this.onended},e.Noise.prototype._stop=function(e){this._source&&this._source.stop(this.toSeconds(e))},e.Noise.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var t=null,n=null,i=null;return e._initAudioContext(function(e){var r=e.sampleRate,o=4*r;t=function(){for(var t=e.createBuffer(2,o,r),n=0;n<t.numberOfChannels;n++){var i,s,a,l,h,u,c,p=t.getChannelData(n);i=s=a=l=h=u=c=0;for(var d=0;o>d;d++){var f=2*Math.random()-1;i=.99886*i+.0555179*f,s=.99332*s+.0750759*f,a=.969*a+.153852*f,l=.8665*l+.3104856*f,h=.55*h+.5329522*f,u=-.7616*u-.016898*f,p[d]=i+s+a+l+h+u+c+.5362*f,p[d]*=.11,c=.115926*f}}return t}(),n=function(){for(var t=e.createBuffer(2,o,r),n=0;n<t.numberOfChannels;n++)for(var i=t.getChannelData(n),s=0,a=0;o>a;a++){var l=2*Math.random()-1;i[a]=(s+.02*l)/1.02,s=i[a],i[a]*=3.5}return t}(),i=function(){for(var t=e.createBuffer(2,o,r),n=0;n<t.numberOfChannels;n++)for(var i=t.getChannelData(n),s=0;o>s;s++)i[s]=2*Math.random()-1;return t}()}),e.Noise}),ToneModule(function(e){return e.NoiseSynth=function(t){t=this.defaultArg(t,e.NoiseSynth.defaults),e.Instrument.call(this),this.noise=new e.Noise,this.filter=new e.Filter(t.filter),this.filterEnvelope=new e.ScaledEnvelope(t.filterEnvelope),this.envelope=new e.AmplitudeEnvelope(t.envelope),this.noise.chain(this.filter,this.envelope,this.output),this.noise.start(),this.filterEnvelope.connect(this.filter.frequency)},e.extend(e.NoiseSynth,e.Instrument),e.NoiseSynth.defaults={noise:{type:"white"},filter:{Q:6,type:"highpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:0},filterEnvelope:{attack:.06,decay:.2,sustain:0,release:2,min:20,max:4e3,exponent:2}},e.NoiseSynth.prototype.triggerAttack=function(e,t){return this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this},e.NoiseSynth.prototype.triggerRelease=function(e){return this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this},e.NoiseSynth.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),console.log(t+e),this.triggerRelease(t+e),this},e.NoiseSynth.prototype.dispose=function(){return e.Instrument.prototype.dispose.call(this),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this},e.NoiseSynth}),ToneModule(function(e){return e.PluckSynth=function(t){t=this.defaultArg(t,e.PluckSynth.defaults),e.Instrument.call(this),this._noise=new e.Noise("pink"),this.attackNoise=1,this._lfcf=new e.LowpassCombFilter(1/440),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)},e.extend(e.PluckSynth,e.Instrument),e.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.5},e.PluckSynth.prototype.triggerAttack=function(e,t){e=this.toFrequency(e),t=this.toSeconds(t);var n=1/e;return this._lfcf.setDelayTimeAtTime(n,t),this._noise.start(t),this._noise.stop(t+n*this.attackNoise),this},e.PluckSynth.prototype.dispose=function(){return e.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this.dampening=null,this.resonance=null,this},e.PluckSynth}),ToneModule(function(e){return e.PolySynth=function(){e.Instrument.call(this);var t=this.optionsObject(arguments,["polyphony","voice"],e.PolySynth.defaults);this.voices=new Array(t.polyphony),this._freeVoices=[],this._activeVoices={};for(var n=0;n<t.polyphony;n++){var i=new t.voice(arguments[2],arguments[3]);this.voices[n]=i,i.connect(this.output)}this._freeVoices=this.voices.slice(0)},e.extend(e.PolySynth,e.Instrument),e.PolySynth.defaults={polyphony:4,voice:e.MonoSynth},e.PolySynth.prototype.triggerAttack=function(e,t,n){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var r=e[i],o=JSON.stringify(r);if(this._activeVoices[o])this._activeVoices[o].triggerAttack(r,t,n);else if(this._freeVoices.length>0){var s=this._freeVoices.shift();s.triggerAttack(r,t,n),this._activeVoices[o]=s}}return this},e.PolySynth.prototype.triggerAttackRelease=function(e,t,n,i){return n=this.toSeconds(n),this.triggerAttack(e,n,i),this.triggerRelease(e,n+this.toSeconds(t)),this},e.PolySynth.prototype.triggerRelease=function(e,t){Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var i=JSON.stringify(e[n]),r=this._activeVoices[i];r&&(r.triggerRelease(t),this._freeVoices.push(r),this._activeVoices[i]=null)}return this},e.PolySynth.prototype.set=function(e){for(var t=0;t<this.voices.length;t++)this.voices[t].set(e);return this},e.PolySynth.prototype.get=function(e){return this.voices[0].get(e)},e.PolySynth.prototype.setPreset=function(e){for(var t=0;t<this.voices.length;t++)this.voices[t].setPreset(e);return this},e.PolySynth.prototype.dispose=function(){e.Instrument.prototype.dispose.call(this);for(var t=0;t<this.voices.length;t++)this.voices[t].dispose(),this.voices[t]=null;return this.voices=null,this._activeVoices=null,this._freeVoices=null,this},e.PolySynth}),ToneModule(function(e){return e.Clip=function(t,n){if(t>n){var i=t;t=n,n=i}this.min=this.input=new e.Min(n),this.max=this.output=new e.Max(t),this.min.connect(this.max)},e.extend(e.Clip,e.SignalBase),e.Clip.prototype.dispose=function(){return e.prototype.dispose.call(this),this.min.dispose(),this.min=null,this.max.dispose(),this.max=null,this},e.Clip}),ToneModule(function(e){for(var t=Math.pow(2,13),n=new Array(t),i=0;i<n.length;i++){var r=i/(n.length-1)*2-1;n[i]=0===r?0:1/(r*t)}e.Inverse=function(i){console.warn("Tone.Inverse has been deprecated. Multiply is always more efficient than dividing."),e.call(this),i=this.defaultArg(i,3),this._two=new e.Signal(2),this._guessMult=new e.Multiply(1/t),this._guess=new e.WaveShaper(n),this.input.chain(this._guessMult,this._guess),this._inverses=new Array(i);for(var r=0;i>r;r++){var s;s=0===r?this._guess:this._inverses[r-1];var a=new o(s,this._two);this.input.connect(a),this._inverses[r]=a}this._inverses[i-1].connect(this.output)},e.extend(e.Inverse,e.SignalBase),e.Inverse.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0;t<this._inverses.length;t++)this._inverses[t].dispose(),this._inverses[t]=null;return this._inverses=null,this._two.dispose(),this._two=null,this._guessMult.dispose(),this._guessMult=null,this._guess.disconnect(),this._guess=null,this};var o=function(t,n){this._outerMultiply=new e.Multiply,this._innerMultiply=new e.Multiply,this._subtract=new e.Subtract,t.connect(this._innerMultiply,0,1),n.connect(this._subtract,0,0),this._innerMultiply.connect(this._subtract,0,1),this._subtract.connect(this._outerMultiply,0,1),t.connect(this._outerMultiply,0,0),this.output=this._outerMultiply,this.input=this._innerMultiply};return e.extend(o),o.prototype.dispose=function(){this._outerMultiply.dispose(),this._outerMultiply=null,this._innerMultiply.dispose(),this._innerMultiply=null,this._subtract.dispose(),this._subtract=null},e.Inverse}),ToneModule(function(e){return e.Divide=function(t,n){console.warn("Tone.Divide has been deprecated. If possible, it's much more efficient to multiply by the inverse value."),e.call(this,2,0),this._denominator=null,this._inverse=new e.Inverse(n),this._mult=new e.Multiply,isFinite(t)&&(this._denominator=new e.Signal(t),this._denominator.connect(this._inverse)),this.input[1]=this._inverse,this._inverse.connect(this._mult,0,1),this.input[0]=this.output=this._mult.input[0]},e.extend(e.Divide,e.SignalBase),Object.defineProperty(e.Divide.prototype,"value",{get:function(){if(null!==this._denominator)return this._denominator.value;throw new Error("cannot switch from signal to number")},set:function(e){if(null===this._denominator)throw new Error("cannot switch from signal to number");this._denominator.value=e}}),e.Divide.prototype.dispose=function(){return e.prototype.dispose.call(this),this._denominator&&(this._denominator.dispose(),this._denominator=null),this._inverse.dispose(),this._inverse=null,this._mult.dispose(),this._mult=null,this},e.Divide}),ToneModule(function(e){return e.Normalize=function(t,n){this._inputMin=this.defaultArg(t,0),this._inputMax=this.defaultArg(n,1),this._sub=this.input=new e.Add(0),this._div=this.output=new e.Multiply(1),this._sub.connect(this._div),this._setRange()},e.extend(e.Normalize,e.SignalBase),Object.defineProperty(e.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(e){this._inputMin=e,this._setRange()}}),Object.defineProperty(e.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(e){this._inputMax=e,this._setRange()}}),e.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},e.Normalize.prototype.dispose=function(){return e.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},e.Normalize}),ToneModule(function(e){e.Route=function(n){n=this.defaultArg(n,2),e.call(this,1,n),this.gate=new e.Signal(0);for(var i=0;n>i;i++){var r=new t(i);this.output[i]=r,this.gate.connect(r.selecter),this.input.connect(r)}},e.extend(e.Route,e.SignalBase),e.Route.prototype.select=function(e,t){return e=Math.floor(e),this.gate.setValueAtTime(e,this.toSeconds(t)),this},e.Route.prototype.dispose=function(){this.gate.dispose();for(var t=0;t<this.output.length;t++)this.output[t].dispose(),this.output[t]=null;return e.prototype.dispose.call(this),this.gate=null,this};var t=function(t){this.selecter=new e.Equal(t),this.gate=this.input=this.output=this.context.createGain(),this.selecter.connect(this.gate.gain)};return e.extend(t),t.prototype.dispose=function(){e.prototype.dispose.call(this),this.selecter.dispose(),this.gate.disconnect(),this.selecter=null,this.gate=null},e.Route}),ToneModule(function(e){return e.Switch=function(){e.call(this),this.gate=new e.Signal(0),this._thresh=new e.GreaterThan(.5),this.input.connect(this.output),this.gate.chain(this._thresh,this.output.gain)},e.extend(e.Switch,e.SignalBase),e.Switch.prototype.open=function(e){return this.gate.setValueAtTime(1,this.toSeconds(e)),this},e.Switch.prototype.close=function(e){return this.gate.setValueAtTime(0,this.toSeconds(e)),this},e.Switch.prototype.dispose=function(){return e.prototype.dispose.call(this),this.gate.dispose(),this._thresh.dispose(),this.gate=null,this._thresh=null,this},e.Switch}),ToneModule(function(e){return e.Microphone=function(t){e.Source.call(this),this._mediaStream=null,this._stream=null,this._constraints={audio:!0};var n=this;MediaStreamTrack.getSources(function(e){t<e.length&&(n.constraints.audio={optional:[{sourceId:e[t].id}]})})},e.extend(e.Microphone,e.Source),e.Microphone.prototype._start=function(){navigator.getUserMedia(this._constraints,this._onStream.bind(this),this._onStreamError.bind(this))},e.Microphone.prototype._stop=function(){return this._stream.stop(),this},e.Microphone.prototype._onStream=function(e){this._stream=e,this._mediaStream=this.context.createMediaStreamSource(e),this._mediaStream.connect(this.output)},e.Microphone.prototype._onStreamError=function(e){console.error(e)},e.Microphone.prototype.dispose=function(){return e.Source.prototype.dispose.call(this),this._mediaStream&&(this._mediaStream.disconnect(),this._mediaStream=null),this._stream=null,this._constraints=null,this},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.Microphone}),"function"==typeof define&&define.amd?define("Tone",[],function(){return Tone}):root.Tone=Tone}(this)},{}],51:[function(e,t,n){!function(e){function t(e){var t=e.length,i=n.type(e);return"function"===i||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e}if(!e.jQuery){var n=function(e,t){return new n.fn.init(e,t)};n.isWindow=function(e){return null!=e&&e==e.window},n.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?r[s.call(e)]||"object":typeof e},n.isArray=Array.isArray||function(e){return"array"===n.type(e)},n.isPlainObject=function(e){var t;if(!e||"object"!==n.type(e)||e.nodeType||n.isWindow(e))return!1;try{if(e.constructor&&!o.call(e,"constructor")&&!o.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}for(t in e);return void 0===t||o.call(e,t)},n.each=function(e,n,i){var r,o=0,s=e.length,a=t(e);if(i){if(a)for(;s>o&&(r=n.apply(e[o],i),r!==!1);o++);else for(o in e)if(r=n.apply(e[o],i),r===!1)break}else if(a)for(;s>o&&(r=n.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=n.call(e[o],o,e[o]),r===!1)break;return e},n.data=function(e,t,r){if(void 0===r){var o=e[n.expando],s=o&&i[o];if(void 0===t)return s;if(s&&t in s)return s[t]}else if(void 0!==t){var o=e[n.expando]||(e[n.expando]=++n.uuid);return i[o]=i[o]||{},i[o][t]=r,r}},n.removeData=function(e,t){var r=e[n.expando],o=r&&i[r];o&&n.each(t,function(e,t){delete o[t]})},n.extend=function(){var e,t,i,r,o,s,a=arguments[0]||{},l=1,h=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[l]||{},l++),"object"!=typeof a&&"function"!==n.type(a)&&(a={}),l===h&&(a=this,l--);h>l;l++)if(null!=(o=arguments[l]))for(r in o)e=a[r],i=o[r],a!==i&&(u&&i&&(n.isPlainObject(i)||(t=n.isArray(i)))?(t?(t=!1,s=e&&n.isArray(e)?e:[]):s=e&&n.isPlainObject(e)?e:{},a[r]=n.extend(u,s,i)):void 0!==i&&(a[r]=i));return a},n.queue=function(e,i,r){function o(e,n){var i=n||[];return null!=e&&(t(Object(e))?!function(e,t){for(var n=+t.length,i=0,r=e.length;n>i;)e[r++]=t[i++];if(n!==n)for(;void 0!==t[i];)e[r++]=t[i++];return e.length=r,e}(i,"string"==typeof e?[e]:e):[].push.call(i,e)),i}if(e){i=(i||"fx")+"queue";var s=n.data(e,i);return r?(!s||n.isArray(r)?s=n.data(e,i,o(r)):s.push(r),s):s||[]}},n.dequeue=function(e,t){n.each(e.nodeType?[e]:e,function(e,i){t=t||"fx";var r=n.queue(i,t),o=r.shift();"inprogress"===o&&(o=r.shift()),o&&("fx"===t&&r.unshift("inprogress"),o.call(i,function(){n.dequeue(i,t)}))})},n.fn=n.prototype={init:function(e){if(e.nodeType)return this[0]=e,this;throw new Error("Not a DOM node.")},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(){for(var e=this.offsetParent||document;e&&"html"===!e.nodeType.toLowerCase&&"static"===e.style.position;)e=e.offsetParent;return e||document}var t=this[0],e=e.apply(t),i=this.offset(),r=/^(?:body|html)$/i.test(e.nodeName)?{top:0,left:0}:n(e).offset();return i.top-=parseFloat(t.style.marginTop)||0,i.left-=parseFloat(t.style.marginLeft)||0,e.style&&(r.top+=parseFloat(e.style.borderTopWidth)||0,r.left+=parseFloat(e.style.borderLeftWidth)||0),{top:i.top-r.top,left:i.left-r.left}}};var i={};n.expando="velocity"+(new Date).getTime(),n.uuid=0;for(var r={},o=r.hasOwnProperty,s=r.toString,a="Boolean Number String Function Array Date RegExp Object Error".split(" "),l=0;l<a.length;l++)r["[object "+a[l]+"]"]=a[l].toLowerCase();n.fn.init.prototype=n.fn,e.Velocity={Utilities:n}}}(window),function(e){"object"==typeof t&&"object"==typeof t.exports?t.exports=e():"function"==typeof define&&define.amd?define(e):e()}(function(){return function(e,t,n,i){function r(e){for(var t=-1,n=e?e.length:0,i=[];++t<n;){var r=e[t];r&&i.push(r)}return i}function o(e){return m.isWrapped(e)?e=[].slice.call(e):m.isNode(e)&&(e=[e]),e}function s(e){var t=p.data(e,"velocity");return null===t?i:t}function a(e){return function(t){return Math.round(t*e)*(1/e)}}function l(e,n,i,r){function o(e,t){return 1-3*t+3*e}function s(e,t){return 3*t-6*e}function a(e){return 3*e}function l(e,t,n){return((o(t,n)*e+s(t,n))*e+a(t))*e}function h(e,t,n){return 3*o(t,n)*e*e+2*s(t,n)*e+a(t)}function u(t,n){for(var r=0;m>r;++r){var o=h(n,e,i);if(0===o)return n;var s=l(n,e,i)-t;n-=s/o}return n}function c(){for(var t=0;x>t;++t)S[t]=l(t*b,e,i)}function p(t,n,r){var o,s,a=0;do s=n+(r-n)/2,o=l(s,e,i)-t,o>0?r=s:n=s;while(Math.abs(o)>y&&++a<g);return s}function d(t){for(var n=0,r=1,o=x-1;r!=o&&S[r]<=t;++r)n+=b;--r;var s=(t-S[r])/(S[r+1]-S[r]),a=n+s*b,l=h(a,e,i);return l>=v?u(t,a):0==l?a:p(t,n,n+b)}function f(){M=!0,(e!=n||i!=r)&&c()}var m=4,v=.001,y=1e-7,g=10,x=11,b=1/(x-1),_="Float32Array"in t;if(4!==arguments.length)return!1;for(var w=0;4>w;++w)if("number"!=typeof arguments[w]||isNaN(arguments[w])||!isFinite(arguments[w]))return!1;e=Math.min(e,1),i=Math.min(i,1),e=Math.max(e,0),i=Math.max(i,0);var S=_?new Float32Array(x):new Array(x),M=!1,T=function(t){return M||f(),e===n&&i===r?t:0===t?0:1===t?1:l(d(t),n,r)};T.getControlPoints=function(){return[{x:e,y:n},{x:i,y:r}]};var E="generateBezier("+[e,n,i,r]+")";return T.toString=function(){return E},T}function h(e,t){var n=e;return m.isString(e)?x.Easings[e]||(n=!1):n=m.isArray(e)&&1===e.length?a.apply(null,e):m.isArray(e)&&2===e.length?b.apply(null,e.concat([t])):m.isArray(e)&&4===e.length?l.apply(null,e):!1,n===!1&&(n=x.Easings[x.defaults.easing]?x.defaults.easing:g),n}function u(e){if(e){var t=(new Date).getTime(),n=x.State.calls.length;n>1e4&&(x.State.calls=r(x.State.calls));for(var o=0;n>o;o++)if(x.State.calls[o]){var a=x.State.calls[o],l=a[0],h=a[2],d=a[3],f=!!d,v=null;d||(d=x.State.calls[o][3]=t-16);for(var y=Math.min((t-d)/h.duration,1),g=0,b=l.length;b>g;g++){var w=l[g],M=w.element;if(s(M)){var T=!1;if(h.display!==i&&null!==h.display&&"none"!==h.display){if("flex"===h.display){var E=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];p.each(E,function(e,t){_.setPropertyValue(M,"display",t)})}_.setPropertyValue(M,"display",h.display)}h.visibility!==i&&"hidden"!==h.visibility&&_.setPropertyValue(M,"visibility",h.visibility);for(var C in w)if("element"!==C){var A,P=w[C],F=m.isString(P.easing)?x.Easings[P.easing]:P.easing;if(1===y)A=P.endValue;else{var L=P.endValue-P.startValue;if(A=P.startValue+L*F(y,h,L),!f&&A===P.currentValue)continue}if(P.currentValue=A,"tween"===C)v=A;else{if(_.Hooks.registered[C]){var R=_.Hooks.getRoot(C),B=s(M).rootPropertyValueCache[R];B&&(P.rootPropertyValue=B)}var k=_.setPropertyValue(M,C,P.currentValue+(0===parseFloat(A)?"":P.unitType),P.rootPropertyValue,P.scrollData);_.Hooks.registered[C]&&(s(M).rootPropertyValueCache[R]=_.Normalizations.registered[R]?_.Normalizations.registered[R]("extract",null,k[1]):k[1]),"transform"===k[0]&&(T=!0)}}h.mobileHA&&s(M).transformCache.translate3d===i&&(s(M).transformCache.translate3d="(0px, 0px, 0px)",T=!0),T&&_.flushTransformCache(M)}}h.display!==i&&"none"!==h.display&&(x.State.calls[o][2].display=!1),h.visibility!==i&&"hidden"!==h.visibility&&(x.State.calls[o][2].visibility=!1),h.progress&&h.progress.call(a[1],a[1],y,Math.max(0,d+h.duration-t),d,v),1===y&&c(o)}}x.State.isTicking&&S(u)}function c(e,t){if(!x.State.calls[e])return!1;for(var n=x.State.calls[e][0],r=x.State.calls[e][1],o=x.State.calls[e][2],a=x.State.calls[e][4],l=!1,h=0,u=n.length;u>h;h++){var c=n[h].element;if(t||o.loop||("none"===o.display&&_.setPropertyValue(c,"display",o.display),"hidden"===o.visibility&&_.setPropertyValue(c,"visibility",o.visibility)),o.loop!==!0&&(p.queue(c)[1]===i||!/\.velocityQueueEntryFlag/i.test(p.queue(c)[1]))&&s(c)){s(c).isAnimating=!1,s(c).rootPropertyValueCache={};var d=!1;p.each(_.Lists.transforms3D,function(e,t){var n=/^scale/.test(t)?1:0,r=s(c).transformCache[t];s(c).transformCache[t]!==i&&new RegExp("^\\("+n+"[^.]").test(r)&&(d=!0,delete s(c).transformCache[t])}),o.mobileHA&&(d=!0,delete s(c).transformCache.translate3d),d&&_.flushTransformCache(c),_.Values.removeClass(c,"velocity-animating")}if(!t&&o.complete&&!o.loop&&h===u-1)try{o.complete.call(r,r)}catch(f){setTimeout(function(){throw f},1)}a&&o.loop!==!0&&a(r),s(c)&&o.loop===!0&&!t&&(p.each(s(c).tweensContainer,function(e,t){/^rotate/.test(e)&&360===parseFloat(t.endValue)&&(t.endValue=0,t.startValue=360),/^backgroundPosition/.test(e)&&100===parseFloat(t.endValue)&&"%"===t.unitType&&(t.endValue=0,t.startValue=100)}),x(c,"reverse",{loop:!0,delay:o.delay})),o.queue!==!1&&p.dequeue(c,o.queue)}x.State.calls[e]=!1;for(var m=0,v=x.State.calls.length;v>m;m++)if(x.State.calls[m]!==!1){l=!0;break}l===!1&&(x.State.isTicking=!1,delete x.State.calls,x.State.calls=[])}var p,d=function(){if(n.documentMode)return n.documentMode;for(var e=7;e>4;e--){var t=n.createElement("div");if(t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",t.getElementsByTagName("span").length)return t=null,e}return i}(),f=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var n,i=(new Date).getTime();return n=Math.max(0,16-(i-e)),e=i+n,setTimeout(function(){t(i+n)},n)}}(),m={isString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNode:function(e){return e&&e.nodeType},isNodeList:function(e){return"object"==typeof e&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(e))&&e.length!==i&&(0===e.length||"object"==typeof e[0]&&e[0].nodeType>0)},isWrapped:function(e){return e&&(e.jquery||t.Zepto&&t.Zepto.zepto.isZ(e))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e)return!1;return!0}},v=!1;if(e.fn&&e.fn.jquery?(p=e,v=!0):p=t.Velocity.Utilities,8>=d&&!v)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=d)return void(jQuery.fn.velocity=jQuery.fn.animate);var y=400,g="swing",x={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:n.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:p,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:y,easing:g,begin:i,complete:i,progress:i,display:i,visibility:i,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(e){p.data(e,"velocity",{isSVG:m.isSVG(e),isAnimating:!1,computedStyle:null,
tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};t.pageYOffset!==i?(x.State.scrollAnchor=t,x.State.scrollPropertyLeft="pageXOffset",x.State.scrollPropertyTop="pageYOffset"):(x.State.scrollAnchor=n.documentElement||n.body.parentNode||n.body,x.State.scrollPropertyLeft="scrollLeft",x.State.scrollPropertyTop="scrollTop");var b=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,n,i){var r={x:t.x+i.dx*n,v:t.v+i.dv*n,tension:t.tension,friction:t.friction};return{dx:r.v,dv:e(r)}}function n(n,i){var r={dx:n.v,dv:e(n)},o=t(n,.5*i,r),s=t(n,.5*i,o),a=t(n,i,s),l=1/6*(r.dx+2*(o.dx+s.dx)+a.dx),h=1/6*(r.dv+2*(o.dv+s.dv)+a.dv);return n.x=n.x+l*i,n.v=n.v+h*i,n}return function i(e,t,r){var o,s,a,l={x:-1,v:0,tension:null,friction:null},h=[0],u=0,c=1e-4,p=.016;for(e=parseFloat(e)||500,t=parseFloat(t)||20,r=r||null,l.tension=e,l.friction=t,o=null!==r,o?(u=i(e,t),s=u/r*p):s=p;;)if(a=n(a||l,s),h.push(1+a.x),u+=16,!(Math.abs(a.x)>c&&Math.abs(a.v)>c))break;return o?function(e){return h[e*(h.length-1)|0]}:u}}();x.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},p.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){x.Easings[t[0]]=l.apply(null,t[1])});var _=x.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e<_.Lists.colors.length;e++){var t="color"===_.Lists.colors[e]?"0 0 0 1":"255 255 255 1";_.Hooks.templates[_.Lists.colors[e]]=["Red Green Blue Alpha",t]}var n,i,r;if(d)for(n in _.Hooks.templates){i=_.Hooks.templates[n],r=i[0].split(" ");var o=i[1].match(_.RegEx.valueSplit);"Color"===r[0]&&(r.push(r.shift()),o.push(o.shift()),_.Hooks.templates[n]=[r.join(" "),o.join(" ")])}for(n in _.Hooks.templates){i=_.Hooks.templates[n],r=i[0].split(" ");for(var e in r){var s=n+r[e],a=e;_.Hooks.registered[s]=[n,a]}}},getRoot:function(e){var t=_.Hooks.registered[e];return t?t[0]:e},cleanRootPropertyValue:function(e,t){return _.RegEx.valueUnwrap.test(t)&&(t=t.match(_.RegEx.valueUnwrap)[1]),_.Values.isCSSNullValue(t)&&(t=_.Hooks.templates[e][1]),t},extractValue:function(e,t){var n=_.Hooks.registered[e];if(n){var i=n[0],r=n[1];return t=_.Hooks.cleanRootPropertyValue(i,t),t.toString().match(_.RegEx.valueSplit)[r]}return t},injectValue:function(e,t,n){var i=_.Hooks.registered[e];if(i){var r,o,s=i[0],a=i[1];return n=_.Hooks.cleanRootPropertyValue(s,n),r=n.toString().match(_.RegEx.valueSplit),r[a]=t,o=r.join(" ")}return n}},Normalizations:{registered:{clip:function(e,t,n){switch(e){case"name":return"clip";case"extract":var i;return _.RegEx.wrappedValueAlreadyExtracted.test(n)?i=n:(i=n.toString().match(_.RegEx.valueUnwrap),i=i?i[1].replace(/,(\s+)?/g," "):n),i;case"inject":return"rect("+n+")"}},blur:function(e,t,n){switch(e){case"name":return x.State.isFirefox?"filter":"-webkit-filter";case"extract":var i=parseFloat(n);if(!i&&0!==i){var r=n.toString().match(/blur\(([0-9]+[A-z]+)\)/i);i=r?r[1]:0}return i;case"inject":return parseFloat(n)?"blur("+n+")":"none"}},opacity:function(e,t,n){if(8>=d)switch(e){case"name":return"filter";case"extract":var i=n.toString().match(/alpha\(opacity=(.*)\)/i);return n=i?i[1]/100:1;case"inject":return t.style.zoom=1,parseFloat(n)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(n),10)+")"}else switch(e){case"name":return"opacity";case"extract":return n;case"inject":return n}}},register:function(){9>=d||x.State.isGingerbread||(_.Lists.transformsBase=_.Lists.transformsBase.concat(_.Lists.transforms3D));for(var e=0;e<_.Lists.transformsBase.length;e++)!function(){var t=_.Lists.transformsBase[e];_.Normalizations.registered[t]=function(e,n,r){switch(e){case"name":return"transform";case"extract":return s(n)===i||s(n).transformCache[t]===i?/^scale/i.test(t)?1:0:s(n).transformCache[t].replace(/[()]/g,"");case"inject":var o=!1;switch(t.substr(0,t.length-1)){case"translate":o=!/(%|px|em|rem|vw|vh|\d)$/i.test(r);break;case"scal":case"scale":x.State.isAndroid&&s(n).transformCache[t]===i&&1>r&&(r=1),o=!/(\d)$/i.test(r);break;case"skew":o=!/(deg|\d)$/i.test(r);break;case"rotate":o=!/(deg|\d)$/i.test(r)}return o||(s(n).transformCache[t]="("+r+")"),s(n).transformCache[t]}}}();for(var e=0;e<_.Lists.colors.length;e++)!function(){var t=_.Lists.colors[e];_.Normalizations.registered[t]=function(e,n,r){switch(e){case"name":return t;case"extract":var o;if(_.RegEx.wrappedValueAlreadyExtracted.test(r))o=r;else{var s,a={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(r)?s=a[r]!==i?a[r]:a.black:_.RegEx.isHex.test(r)?s="rgb("+_.Values.hexToRgb(r).join(" ")+")":/^rgba?\(/i.test(r)||(s=a.black),o=(s||r).toString().match(_.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=d||3!==o.split(" ").length||(o+=" 1"),o;case"inject":return 8>=d?4===r.split(" ").length&&(r=r.split(/\s+/).slice(0,3).join(" ")):3===r.split(" ").length&&(r+=" 1"),(8>=d?"rgb":"rgba")+"("+r.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(d||x.State.isAndroid&&!x.State.isChrome)&&(t+="|transform"),new RegExp("^("+t+")$","i").test(e)},prefixCheck:function(e){if(x.State.prefixMatches[e])return[x.State.prefixMatches[e],!0];for(var t=["","Webkit","Moz","ms","O"],n=0,i=t.length;i>n;n++){var r;if(r=0===n?e:t[n]+e.replace(/^\w/,function(e){return e.toUpperCase()}),m.isString(x.State.prefixElement.style[r]))return x.State.prefixMatches[e]=r,[r,!0]}return[e,!1]}},Values:{hexToRgb:function(e){var t,n=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return e=e.replace(n,function(e,t,n,i){return t+t+n+n+i+i}),t=i.exec(e),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]},isCSSNullValue:function(e){return 0==e||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){return/^(rotate|skew)/i.test(e)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)?"":"px"},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)?"inline":/^(li)$/i.test(t)?"list-item":/^(tr)$/i.test(t)?"table-row":/^(table)$/i.test(t)?"table":/^(tbody)$/i.test(t)?"table-row-group":"block"},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=(e.className.length?" ":"")+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(e,n,r,o){function a(e,n){function r(){h&&_.setPropertyValue(e,"display","none")}var l=0;if(8>=d)l=p.css(e,n);else{var h=!1;if(/^(width|height)$/.test(n)&&0===_.getPropertyValue(e,"display")&&(h=!0,_.setPropertyValue(e,"display",_.Values.getDisplayType(e))),!o){if("height"===n&&"border-box"!==_.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var u=e.offsetHeight-(parseFloat(_.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(_.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(_.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(_.getPropertyValue(e,"paddingBottom"))||0);return r(),u}if("width"===n&&"border-box"!==_.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var c=e.offsetWidth-(parseFloat(_.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(_.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(_.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(_.getPropertyValue(e,"paddingRight"))||0);return r(),c}}var f;f=s(e)===i?t.getComputedStyle(e,null):s(e).computedStyle?s(e).computedStyle:s(e).computedStyle=t.getComputedStyle(e,null),"borderColor"===n&&(n="borderTopColor"),l=9===d&&"filter"===n?f.getPropertyValue(n):f[n],(""===l||null===l)&&(l=e.style[n]),r()}if("auto"===l&&/^(top|right|bottom|left)$/i.test(n)){var m=a(e,"position");("fixed"===m||"absolute"===m&&/top|left/i.test(n))&&(l=p(e).position()[n]+"px")}return l}var l;if(_.Hooks.registered[n]){var h=n,u=_.Hooks.getRoot(h);r===i&&(r=_.getPropertyValue(e,_.Names.prefixCheck(u)[0])),_.Normalizations.registered[u]&&(r=_.Normalizations.registered[u]("extract",e,r)),l=_.Hooks.extractValue(h,r)}else if(_.Normalizations.registered[n]){var c,f;c=_.Normalizations.registered[n]("name",e),"transform"!==c&&(f=a(e,_.Names.prefixCheck(c)[0]),_.Values.isCSSNullValue(f)&&_.Hooks.templates[n]&&(f=_.Hooks.templates[n][1])),l=_.Normalizations.registered[n]("extract",e,f)}if(!/^[\d-]/.test(l))if(s(e)&&s(e).isSVG&&_.Names.SVGAttribute(n))if(/^(height|width)$/i.test(n))try{l=e.getBBox()[n]}catch(m){l=0}else l=e.getAttribute(n);else l=a(e,_.Names.prefixCheck(n)[0]);return _.Values.isCSSNullValue(l)&&(l=0),x.debug>=2&&console.log("Get "+n+": "+l),l},setPropertyValue:function(e,n,i,r,o){var a=n;if("scroll"===n)o.container?o.container["scroll"+o.direction]=i:"Left"===o.direction?t.scrollTo(i,o.alternateValue):t.scrollTo(o.alternateValue,i);else if(_.Normalizations.registered[n]&&"transform"===_.Normalizations.registered[n]("name",e))_.Normalizations.registered[n]("inject",e,i),a="transform",i=s(e).transformCache[n];else{if(_.Hooks.registered[n]){var l=n,h=_.Hooks.getRoot(n);r=r||_.getPropertyValue(e,h),i=_.Hooks.injectValue(l,i,r),n=h}if(_.Normalizations.registered[n]&&(i=_.Normalizations.registered[n]("inject",e,i),n=_.Normalizations.registered[n]("name",e)),a=_.Names.prefixCheck(n)[0],8>=d)try{e.style[a]=i}catch(u){x.debug&&console.log("Browser does not support ["+i+"] for ["+a+"]")}else s(e)&&s(e).isSVG&&_.Names.SVGAttribute(n)?e.setAttribute(n,i):e.style[a]=i;x.debug>=2&&console.log("Set "+n+" ("+a+"): "+i)}return[a,i]},flushTransformCache:function(e){function t(t){return parseFloat(_.getPropertyValue(e,t))}var n="";if((d||x.State.isAndroid&&!x.State.isChrome)&&s(e).isSVG){var i={translate:[t("translateX"),t("translateY")],skewX:[t("skewX")],skewY:[t("skewY")],scale:1!==t("scale")?[t("scale"),t("scale")]:[t("scaleX"),t("scaleY")],rotate:[t("rotateZ"),0,0]};p.each(s(e).transformCache,function(e){/^translate/i.test(e)?e="translate":/^scale/i.test(e)?e="scale":/^rotate/i.test(e)&&(e="rotate"),i[e]&&(n+=e+"("+i[e].join(" ")+") ",delete i[e])})}else{var r,o;p.each(s(e).transformCache,function(t){return r=s(e).transformCache[t],"transformPerspective"===t?(o=r,!0):(9===d&&"rotateZ"===t&&(t="rotate"),void(n+=t+r+" "))}),o&&(n="perspective"+o+" "+n)}_.setPropertyValue(e,"transform",n)}};_.Hooks.register(),_.Normalizations.register(),x.hook=function(e,t,n){var r=i;return e=o(e),p.each(e,function(e,o){if(s(o)===i&&x.init(o),n===i)r===i&&(r=x.CSS.getPropertyValue(o,t));else{var a=x.CSS.setPropertyValue(o,t,n);"transform"===a[0]&&x.CSS.flushTransformCache(o),r=a}}),r};var w=function(){function e(){return a?C.promise||null:l}function r(){function e(e){function c(e,t){var n=i,r=i,s=i;return m.isArray(e)?(n=e[0],!m.isArray(e[1])&&/^[\d-]/.test(e[1])||m.isFunction(e[1])||_.RegEx.isHex.test(e[1])?s=e[1]:(m.isString(e[1])&&!_.RegEx.isHex.test(e[1])||m.isArray(e[1]))&&(r=t?e[1]:h(e[1],a.duration),e[2]!==i&&(s=e[2]))):n=e,t||(r=r||a.easing),m.isFunction(n)&&(n=n.call(o,M,S)),m.isFunction(s)&&(s=s.call(o,M,S)),[n||0,r,s]}function d(e,t){var n,i;return i=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){return n=e,""}),n||(n=_.Values.getUnitType(e)),[i,n]}function y(){var e={myParent:o.parentNode||n.body,position:_.getPropertyValue(o,"position"),fontSize:_.getPropertyValue(o,"fontSize")},i=e.position===k.lastPosition&&e.myParent===k.lastParent,r=e.fontSize===k.lastFontSize;k.lastParent=e.myParent,k.lastPosition=e.position,k.lastFontSize=e.fontSize;var a=100,l={};if(r&&i)l.emToPx=k.lastEmToPx,l.percentToPxWidth=k.lastPercentToPxWidth,l.percentToPxHeight=k.lastPercentToPxHeight;else{var h=s(o).isSVG?n.createElementNS("http://www.w3.org/2000/svg","rect"):n.createElement("div");x.init(h),e.myParent.appendChild(h),p.each(["overflow","overflowX","overflowY"],function(e,t){x.CSS.setPropertyValue(h,t,"hidden")}),x.CSS.setPropertyValue(h,"position",e.position),x.CSS.setPropertyValue(h,"fontSize",e.fontSize),x.CSS.setPropertyValue(h,"boxSizing","content-box"),p.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){x.CSS.setPropertyValue(h,t,a+"%")}),x.CSS.setPropertyValue(h,"paddingLeft",a+"em"),l.percentToPxWidth=k.lastPercentToPxWidth=(parseFloat(_.getPropertyValue(h,"width",null,!0))||1)/a,l.percentToPxHeight=k.lastPercentToPxHeight=(parseFloat(_.getPropertyValue(h,"height",null,!0))||1)/a,l.emToPx=k.lastEmToPx=(parseFloat(_.getPropertyValue(h,"paddingLeft"))||1)/a,e.myParent.removeChild(h)}return null===k.remToPx&&(k.remToPx=parseFloat(_.getPropertyValue(n.body,"fontSize"))||16),null===k.vwToPx&&(k.vwToPx=parseFloat(t.innerWidth)/100,k.vhToPx=parseFloat(t.innerHeight)/100),l.remToPx=k.remToPx,l.vwToPx=k.vwToPx,l.vhToPx=k.vhToPx,x.debug>=1&&console.log("Unit ratios: "+JSON.stringify(l),o),l}if(a.begin&&0===M)try{a.begin.call(f,f)}catch(b){setTimeout(function(){throw b},1)}if("scroll"===A){var w,T,E,P=/^x$/i.test(a.axis)?"Left":"Top",F=parseFloat(a.offset)||0;a.container?m.isWrapped(a.container)||m.isNode(a.container)?(a.container=a.container[0]||a.container,w=a.container["scroll"+P],E=w+p(o).position()[P.toLowerCase()]+F):a.container=null:(w=x.State.scrollAnchor[x.State["scrollProperty"+P]],T=x.State.scrollAnchor[x.State["scrollProperty"+("Left"===P?"Top":"Left")]],E=p(o).offset()[P.toLowerCase()]+F),l={scroll:{rootPropertyValue:!1,startValue:w,currentValue:w,endValue:E,unitType:"",easing:a.easing,scrollData:{container:a.container,direction:P,alternateValue:T}},element:o},x.debug&&console.log("tweensContainer (scroll): ",l.scroll,o)}else if("reverse"===A){if(!s(o).tweensContainer)return void p.dequeue(o,a.queue);"none"===s(o).opts.display&&(s(o).opts.display="auto"),"hidden"===s(o).opts.visibility&&(s(o).opts.visibility="visible"),s(o).opts.loop=!1,s(o).opts.begin=null,s(o).opts.complete=null,g.easing||delete a.easing,g.duration||delete a.duration,a=p.extend({},s(o).opts,a);var L=p.extend(!0,{},s(o).tweensContainer);for(var R in L)if("element"!==R){var B=L[R].startValue;L[R].startValue=L[R].currentValue=L[R].endValue,L[R].endValue=B,m.isEmptyObject(g)||(L[R].easing=a.easing),x.debug&&console.log("reverse tweensContainer ("+R+"): "+JSON.stringify(L[R]),o)}l=L}else if("start"===A){var L;s(o).tweensContainer&&s(o).isAnimating===!0&&(L=s(o).tweensContainer),p.each(v,function(e,t){if(RegExp("^"+_.Lists.colors.join("$|^")+"$").test(e)){var n=c(t,!0),r=n[0],o=n[1],s=n[2];if(_.RegEx.isHex.test(r)){for(var a=["Red","Green","Blue"],l=_.Values.hexToRgb(r),h=s?_.Values.hexToRgb(s):i,u=0;u<a.length;u++){var p=[l[u]];o&&p.push(o),h!==i&&p.push(h[u]),v[e+a[u]]=p}delete v[e]}}});for(var N in v){var O=c(v[N]),V=O[0],z=O[1],U=O[2];N=_.Names.camelCase(N);var I=_.Hooks.getRoot(N),j=!1;if(s(o).isSVG||"tween"===I||_.Names.prefixCheck(I)[1]!==!1||_.Normalizations.registered[I]!==i){(a.display!==i&&null!==a.display&&"none"!==a.display||a.visibility!==i&&"hidden"!==a.visibility)&&/opacity|filter/.test(N)&&!U&&0!==V&&(U=0),a._cacheValues&&L&&L[N]?(U===i&&(U=L[N].endValue+L[N].unitType),j=s(o).rootPropertyValueCache[I]):_.Hooks.registered[N]?U===i?(j=_.getPropertyValue(o,I),U=_.getPropertyValue(o,N,j)):j=_.Hooks.templates[I][1]:U===i&&(U=_.getPropertyValue(o,N));var G,q,H,W=!1;if(G=d(N,U),U=G[0],H=G[1],G=d(N,V),V=G[0].replace(/^([+-\/*])=/,function(e,t){return W=t,""}),q=G[1],U=parseFloat(U)||0,V=parseFloat(V)||0,"%"===q&&(/^(fontSize|lineHeight)$/.test(N)?(V/=100,q="em"):/^scale/.test(N)?(V/=100,q=""):/(Red|Green|Blue)$/i.test(N)&&(V=V/100*255,q="")),/[\/*]/.test(W))q=H;else if(H!==q&&0!==U)if(0===V)q=H;else{r=r||y();var X=/margin|padding|left|right|width|text|word|letter/i.test(N)||/X$/.test(N)||"x"===N?"x":"y";switch(H){case"%":U*="x"===X?r.percentToPxWidth:r.percentToPxHeight;break;case"px":break;default:U*=r[H+"ToPx"]}switch(q){case"%":U*=1/("x"===X?r.percentToPxWidth:r.percentToPxHeight);break;case"px":break;default:U*=1/r[q+"ToPx"]}}switch(W){case"+":V=U+V;break;case"-":V=U-V;break;case"*":V=U*V;break;case"/":V=U/V}l[N]={rootPropertyValue:j,startValue:U,currentValue:U,endValue:V,unitType:q,easing:z},x.debug&&console.log("tweensContainer ("+N+"): "+JSON.stringify(l[N]),o)}else x.debug&&console.log("Skipping ["+I+"] due to a lack of browser support.")}l.element=o}l.element&&(_.Values.addClass(o,"velocity-animating"),D.push(l),""===a.queue&&(s(o).tweensContainer=l,s(o).opts=a),s(o).isAnimating=!0,M===S-1?(x.State.calls.push([D,f,a,null,C.resolver]),x.State.isTicking===!1&&(x.State.isTicking=!0,u())):M++)}var r,o=this,a=p.extend({},x.defaults,g),l={};switch(s(o)===i&&x.init(o),parseFloat(a.delay)&&a.queue!==!1&&p.queue(o,a.queue,function(e){x.velocityQueueEntryFlag=!0,s(o).delayTimer={setTimeout:setTimeout(e,parseFloat(a.delay)),next:e}}),a.duration.toString().toLowerCase()){case"fast":a.duration=200;break;case"normal":a.duration=y;break;case"slow":a.duration=600;break;default:a.duration=parseFloat(a.duration)||1}x.mock!==!1&&(x.mock===!0?a.duration=a.delay=1:(a.duration*=parseFloat(x.mock)||1,a.delay*=parseFloat(x.mock)||1)),a.easing=h(a.easing,a.duration),a.begin&&!m.isFunction(a.begin)&&(a.begin=null),a.progress&&!m.isFunction(a.progress)&&(a.progress=null),a.complete&&!m.isFunction(a.complete)&&(a.complete=null),a.display!==i&&null!==a.display&&(a.display=a.display.toString().toLowerCase(),"auto"===a.display&&(a.display=x.CSS.Values.getDisplayType(o))),a.visibility!==i&&null!==a.visibility&&(a.visibility=a.visibility.toString().toLowerCase()),a.mobileHA=a.mobileHA&&x.State.isMobile&&!x.State.isGingerbread,a.queue===!1?a.delay?setTimeout(e,a.delay):e():p.queue(o,a.queue,function(t,n){return n===!0?(C.promise&&C.resolver(f),!0):(x.velocityQueueEntryFlag=!0,void e(t))}),""!==a.queue&&"fx"!==a.queue||"inprogress"===p.queue(o)[0]||p.dequeue(o)}var a,l,d,f,v,g,b=arguments[0]&&(arguments[0].p||p.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||m.isString(arguments[0].properties));if(m.isWrapped(this)?(a=!1,d=0,f=this,l=this):(a=!0,d=1,f=b?arguments[0].elements||arguments[0].e:arguments[0]),f=o(f)){b?(v=arguments[0].properties||arguments[0].p,g=arguments[0].options||arguments[0].o):(v=arguments[d],g=arguments[d+1]);var S=f.length,M=0;if(!/^(stop|finish)$/i.test(v)&&!p.isPlainObject(g)){var T=d+1;g={};for(var E=T;E<arguments.length;E++)m.isArray(arguments[E])||!/^(fast|normal|slow)$/i.test(arguments[E])&&!/^\d/.test(arguments[E])?m.isString(arguments[E])||m.isArray(arguments[E])?g.easing=arguments[E]:m.isFunction(arguments[E])&&(g.complete=arguments[E]):g.duration=arguments[E]}var C={promise:null,resolver:null,rejecter:null};a&&x.Promise&&(C.promise=new x.Promise(function(e,t){C.resolver=e,C.rejecter=t}));var A;switch(v){case"scroll":A="scroll";break;case"reverse":A="reverse";break;case"finish":case"stop":p.each(f,function(e,t){s(t)&&s(t).delayTimer&&(clearTimeout(s(t).delayTimer.setTimeout),s(t).delayTimer.next&&s(t).delayTimer.next(),delete s(t).delayTimer)});var P=[];return p.each(x.State.calls,function(e,t){t&&p.each(t[1],function(n,r){var o=g===i?"":g;return o===!0||t[2].queue===o||g===i&&t[2].queue===!1?void p.each(f,function(n,i){i===r&&((g===!0||m.isString(g))&&(p.each(p.queue(i,m.isString(g)?g:""),function(e,t){m.isFunction(t)&&t(null,!0)}),p.queue(i,m.isString(g)?g:"",[])),"stop"===v?(s(i)&&s(i).tweensContainer&&o!==!1&&p.each(s(i).tweensContainer,function(e,t){t.endValue=t.currentValue}),P.push(e)):"finish"===v&&(t[2].duration=1))}):!0})}),"stop"===v&&(p.each(P,function(e,t){c(t,!0)}),C.promise&&C.resolver(f)),e();default:if(!p.isPlainObject(v)||m.isEmptyObject(v)){if(m.isString(v)&&x.Redirects[v]){var F=p.extend({},g),L=F.duration,R=F.delay||0;return F.backwards===!0&&(f=p.extend(!0,[],f).reverse()),p.each(f,function(e,t){parseFloat(F.stagger)?F.delay=R+parseFloat(F.stagger)*e:m.isFunction(F.stagger)&&(F.delay=R+F.stagger.call(t,e,S)),F.drag&&(F.duration=parseFloat(L)||(/^(callout|transition)/.test(v)?1e3:y),F.duration=Math.max(F.duration*(F.backwards?1-e/S:(e+1)/S),.75*F.duration,200)),x.Redirects[v].call(t,t,F||{},e,S,f,C.promise?C:i)}),e()}var B="Velocity: First argument ("+v+") was not a property map, a known action, or a registered redirect. Aborting.";return C.promise?C.rejecter(new Error(B)):console.log(B),e()}A="start"}var k={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},D=[];p.each(f,function(e,t){m.isNode(t)&&r.call(t)});var N,F=p.extend({},x.defaults,g);if(F.loop=parseInt(F.loop),N=2*F.loop-1,F.loop)for(var O=0;N>O;O++){var V={delay:F.delay,progress:F.progress};O===N-1&&(V.display=F.display,V.visibility=F.visibility,V.complete=F.complete),w(f,"reverse",V)}return e()}};x=p.extend(w,x),x.animate=w;var S=t.requestAnimationFrame||f;return x.State.isMobile||n.hidden===i||n.addEventListener("visibilitychange",function(){n.hidden?(S=function(e){return setTimeout(function(){e(!0)},16)},u()):S=t.requestAnimationFrame||f}),e.Velocity=x,e!==t&&(e.fn.velocity=w,e.fn.velocity.defaults=x.defaults),p.each(["Down","Up"],function(e,t){x.Redirects["slide"+t]=function(e,n,r,o,s,a){var l=p.extend({},n),h=l.begin,u=l.complete,c={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},d={};l.display===i&&(l.display="Down"===t?"inline"===x.CSS.Values.getDisplayType(e)?"inline-block":"block":"none"),l.begin=function(){h&&h.call(s,s);for(var n in c){d[n]=e.style[n];var i=x.CSS.getPropertyValue(e,n);c[n]="Down"===t?[i,0]:[0,i]}d.overflow=e.style.overflow,e.style.overflow="hidden"},l.complete=function(){for(var t in d)e.style[t]=d[t];u&&u.call(s,s),a&&a.resolver(s)},x(e,c,l)}}),p.each(["In","Out"],function(e,t){x.Redirects["fade"+t]=function(e,n,r,o,s,a){var l=p.extend({},n),h={opacity:"In"===t?1:0},u=l.complete;l.complete=r!==o-1?l.begin=null:function(){u&&u.call(s,s),a&&a.resolver(s)},l.display===i&&(l.display="In"===t?"auto":"none"),x(this,h,l)}}),x}(window.jQuery||window.Zepto||window,window,document)})},{}],52:[function(e,t,n){"use strict";function i(e){for(var t=[],n=0,i=e.length;i>n;n++){var r=e[n],o=r.x,s=r.y,a=r.z;t.push(o),t.push(s),t.push(a)}return t}function r(e){for(var t=[],n=0,i=e.length;i>n;n++){var r=e[n],o=r.a,s=r.b,a=r.c;t.push(o),t.push(s),t.push(a)}return t}function o(e){var t=e.mesh,n=e.body;e.passed=!1,t.visible=!0,n.collisionFilterGroup=1,n.collisionFilterMask=1}function s(e){var t=e.mesh,n=e.body;e.passed=!1,t.visible=!1,n.collisionFilterGroup=0,n.collisionFilterMask=0}var a=function(e){return e&&e.__esModule?e:{"default":e}},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function j(e,t,n){var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:j(r,t,n)}if("value"in i)return i.value;var o=i.get;return void 0===o?void 0:o.call(n)},c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)};Object.defineProperty(n,"__esModule",{value:!0});var p=e(9),d=a(p),f=e(39),m=(a(f),e(8)),v=a(m),y=e(47),g=a(y),x=e(49),b=a(x),_=e(3),w=a(_),S=e(50),M=e(2),T=e(53),E=e(56),C=a(E),A=e(54),P=a(A),F=e(59),L=a(F),R=e(62),B=(a(R),new b["default"].Vector2),k=new b["default"].Vector3,D=!1;D&&console.log("DEBUG MODE");var N=[.0025,.003,.0035,.004,.0045,.005,.0055,.006,.0065,.007,.0075,.008].map(function(e){return e*=6e3}),O=[0,500,2e3,4e3,6500,9500,13e3,18e3,24e3,31e3,39e3,48e3],V=[6,7,8,9,10,11,12,13,14,15,16,18],z=function(){var e=S.Tone.context.createGain(),t=new S.Tone.EQ(4,-20,0).toMaster(),n=new S.Tone.FMSynth;return n.carrier.oscillator.type="sine",n.modulator.oscillator.type="sawtooth",n.volume.value=-10,n.connect(e),e.connect(t),function(){return n.triggerAttackRelease("F#3","2n")}}(),U=new S.Tone.Noise;U.type="brown",U.volume.value=-40,U.toMaster();var I=function(e){function t(e){var n=this;l(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var o=16768494;this.render=C["default"](e),this.renderer=this.render.renderer,this.renderer.setClearColor(o);var a=new b["default"].Scene,h=new b["default"].PerspectiveCamera(60,window.innerWidth/window.innerHeight);h.position.set(0,0,4),a.add(h),a.fog=new b["default"].FogExp2(o,.02);var c=new P["default"],p=new b["default"].MeshPhongMaterial({color:"#f87",side:b["default"].DoubleSide,shading:b["default"].FlatShading}),d=new b["default"].Mesh(c.geometry,p);a.add(d),d.rotation.x=Math.PI/2;var f=new b["default"].Mesh(c.geometry,p);a.add(f),f.rotation.x=-Math.PI/2,f.rotation.y=Math.PI;var m=new b["default"].Mesh(c.geometry,p);a.add(m),m.rotation.x=-Math.PI/2,m.rotation.y=Math.PI,this.light=new b["default"].PointLight("#acf"),a.add(new b["default"].AmbientLight("#556")),this.scene=a,this.camera=h,this.cylinder=c,this.cylinderMeshes=[d,f,m],this.clock=new b["default"].Clock(!0),this.dt=1/60;var v=new w["default"].World;this.world=v,this.trees=[];var y=new b["default"].MeshPhongMaterial({skinning:!0,color:"#000",ambient:"#000",shading:b["default"].FlatShading}),x=.6,_=(new b["default"].Matrix4).makeScale(x,x,x);g["default"](24,function(){var e=new L["default"](y),t=e.mesh;t.geometry.applyMatrix(_),t.geometry.computeFaceNormals(),t.geometry.computeVertexNormals(),a.add(t);var o=e.geometry,l=new w["default"].Body({mass:0,shape:new w["default"].Trimesh(i(o.vertices),r(o.faces))});v.addBody(l),e.body=l,s(e),n.trees.push(e)}),this.activeTrees=[],this.inactiveTrees=this.trees.slice(),this.createPlayer(),this.player.add(this.light),a.add(this.player),a.add(this.wireframe),v.addBody(this.playerBody),this.running=!1,this.tick=this.tick.bind(this),this.keys=[],this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),window.addEventListener("resize",function(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix()}),this.reset()}return c(t,e),h(t,[{key:"tick",value:function(){this.update(),this.render(this.scene,this.camera),this.running&&requestAnimationFrame(this.tick)}},{key:"toggle",value:function(){this.running?(this.running=!1,this.clock.stop(),U.stop()):(this.running=!0,this.clock.start(),this.emit("start",!0),this.reset(),this.tick(),U.start())}},{key:"update",value:function(){var e=this;this.cylinder.update(),this.cylinderMeshes.map(function(t){var n=e.cylinder.length;e.player.position.z<t.position.z-.6*n&&(t.position.z-=e.cylinderMeshes.length*n)}),this.activeTrees.map(function(t){!t.passed&&e.player.position.z<t.mesh.position.z&&(e.score+=100,t.passed=!0,e.emit("score",e.score),T.songG())});var t=this.activeTrees.map(function(t){return e.camera.position.z<t.mesh.position.z?(s(t),e.inactiveTrees.push(t),t):void 0}).filter(Boolean);v["default"](this.activeTrees,function(e){return d["default"](t,e)}),this.activeTrees.length||(this.emit("level"),this.checkLevel(),this.changeLevel());var n=Math.min(this.clock.getDelta(),.1);this.world.step(this.dt,n);var i=120*n,r=void 0,o=void 0;this.keys[0]&&(o=i),this.keys[1]&&(o=-i),this.keys[2]&&(r=-i),this.keys[3]&&(r=i),D?(this.keys[4]&&(this.player.position.z-=this.speed*n),this.keys[5]&&(this.player.position.z+=this.speed*n)):this.player.position.z-=this.speed*n;var a=4;r?this.playerVelocity.x=r:this.playerVelocity.x*=1-a*n,o?this.playerVelocity.y=o:this.playerVelocity.y*=1-a*n,this.player.position.x+=this.playerVelocity.x*n,this.player.position.y+=this.playerVelocity.y*n;var l=B.copy(this.player.position).length();l>.6*this.cylinder.radius-this.playerRadius&&(B.setLength(.6*this.cylinder.radius-this.playerRadius),this.player.position.x=B.x,this.player.position.y=B.y,this.playerVelocity.set(0,0));var h=5;this.player.rotation.y+=h*this.playerVelocity.x*n,this.player.rotation.x+=-h*this.playerVelocity.y*n,this.playerBody.position.copy(this.player.position),this.updateCamera();var u=Math.sqrt(3);this.activeTrees.forEach(function(t){var n=t.mesh.position.distanceTo(e.player.position),i=e.cylinder.length,r=b["default"].Math.clamp(Math.abs(i-n)/i,0,1),o=r*u;t.mesh.skeleton.bones.forEach(function(e,t){e.scale.setLength(o),t>1&&(e.rotation.z=e.startAngle*(1-r)),e.updateMatrixWorld()})})}},{key:"createPlayer",value:function(){var e=this,t=.3,n=new b["default"].IcosahedronGeometry(t,1),i=new b["default"].MeshBasicMaterial({color:"#111"}),r=new b["default"].Mesh(n,i);this.wireframe=new b["default"].WireframeHelper(r,16777215),this.wireframe.material.linewidth=3,this.player=r,this.playerRadius=t,this.playerVelocity=new b["default"].Vector2,this.playerBody=new w["default"].Body({mass:1,shape:new w["default"].Sphere(t)}),this.playerBody.addEventListener("collide",function(){return e.end()})}},{key:"checkLevel",value:function(){for(var e=O.length-1;e>=0;e--)if(this.score>O[e]&&this.level<e+1){this.level=e+1;break}}},{key:"end",value:function(){this.isGameOver||(this.emit("end",this.score),this.isGameOver=!0,this.running=!1,U.stop(),z())}},{key:"getNextScore",value:function(e){return O[e]||0}},{key:"reset",value:function(){var e=this;this.player.position.set(0,-1,0),this.playerVelocity.set(0,0,0),this.playerBody.position.copy(this.player.position),this.speed=N[0],this.isGameOver=!1,this.score=0,this.level=1,this.cylinderMeshes.map(function(t,n){return t.position.z=-e.cylinder.length*n}),this.changeLevel(),this.updateCamera()}},{key:"changeLevel",value:function(){this.speed=N[this.level-1];var e=V[this.level-1];this.trees.map(s),this.activeTrees=[],this.inactiveTrees=this.trees.slice();for(var t=e;t--&&this.inactiveTrees.length;){var n=this.inactiveTrees.pop();o(n),this.activeTrees.push(n);var i=n.mesh,r=n.body,a=2*Math.random()*Math.PI;

i.rotation.z=a+Math.PI/2,i.position.set(.75*this.cylinder.radius*Math.cos(a),.75*this.cylinder.radius*Math.sin(a),this.player.position.z-this.cylinder.length-t*this.cylinder.length/e),r.position.copy(i.position),r.quaternion.copy(i.quaternion)}}},{key:"updateCamera",value:function(){this.camera.position.z=this.player.position.z+4,k.copy(this.player.position).multiplyScalar(.25),k.z=this.player.position.z,this.camera.lookAt(k)}},{key:"onKeyDown",value:function(e){var t=e.keyCode;(38===t||87===t)&&(e.preventDefault(),this.keys[0]=!0),(40===t||83===t)&&(e.preventDefault(),this.keys[1]=!0),(37===t||65===t)&&(e.preventDefault(),this.keys[2]=!0),(39===t||68===t)&&(e.preventDefault(),this.keys[3]=!0),32===t&&(this.keys[4]=!0),16===t&&(this.keys[5]=!0)}},{key:"onKeyUp",value:function(e){var t=e.keyCode;(38===t||87===t)&&(e.preventDefault(),this.keys[0]=!1),(40===t||83===t)&&(e.preventDefault(),this.keys[1]=!1),(37===t||65===t)&&(e.preventDefault(),this.keys[2]=!1),(39===t||68===t)&&(e.preventDefault(),this.keys[3]=!1),32===t&&(this.keys[4]=!1),16===t&&(this.keys[5]=!1)}}]),t}(M.EventEmitter);n["default"]=I,t.exports=n["default"]},{2:2,3:3,39:39,47:47,49:49,50:50,53:53,54:54,56:56,59:59,62:62,8:8,9:9}],53:[function(e,t,n){"use strict";function i(){var e=new u.Tone.MonoSynth;e.toMaster(),e.volume.value=-10,u.Tone.Transport.setInterval(function(t){e.triggerAttackRelease("C4","8n",t)},"4n"),u.Tone.Transport.start(),setTimeout(function(){return u.Tone.Transport.stop()},2e3)}function r(){var e=new u.Tone.MonoSynth;e.toMaster(),e.volume.value=-10,y(e),g(e)}function o(){var e=new u.Tone.PolySynth(4,u.Tone.MonoSynth);e.toMaster(),e.volume.value=-10,y(e),g(e)}function s(){var e=new u.Tone.PolySynth(4,u.Tone.FMSynth);e.toMaster(),e.volume.value=-10,e.voices.forEach(function(e){e.carrier.oscillator.type="square",e.modulator.oscillator.type="sine"}),y(e),g(e)}function a(){var e=new u.Tone.PolySynth(4,u.Tone.FMSynth),t=new u.Tone.LFO(8,.1,1);t.oscillator.type="square",t.start();var n=u.Tone.context.createGain(),i=new u.Tone.EQ(4,-20,0).toMaster();n.connect(i),e.connect(n),t.connect(n.gain),e.volume.value=-10,e.voices.forEach(function(e){e.carrier.oscillator.type="square",e.modulator.oscillator.type="sine"}),y(e),g(e)}function l(){function e(e){var n=void 0===arguments[1]?{}:arguments[1],i=n.filterEnvelope;t.add(e.envelope,"attack",.001,2),t.add(e.envelope,"decay",0,2),t.add(e.envelope,"sustain",0,1),t.add(e.envelope,"release",.001,4),i&&(t.add(e.filterEnvelope,"attack",.001,2),t.add(e.filterEnvelope,"decay",0,2),t.add(e.filterEnvelope,"sustain",0,1),t.add(e.filterEnvelope,"release",.001,4))}u.Tone.Transport.bpm.value=90;var t=new p["default"].GUI,n=new u.Tone.NoiseSynth({filter:{type:"lowpass",frequency:0,rolloff:-24,Q:3.7,gain:0},envelope:{attack:.024,decay:.111,sustain:0,release:.22},filterEnvelope:{min:200.2,max:3510.98,exponent:2,attack:.002,decay:.02,sustain:.02,release:.013}}).toMaster();n.volume.value=4,n.noise.type="brown",e(n,{filterEnvelope:!0});var i=new u.Tone.MonoSynth({portamento:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.2,sustain:0,release:.2},filterEnvelope:{attack:.01,decay:.2,sustain:1,release:.2,min:3e3,max:30}}),r=new u.Tone.FMSynth({carrier:{oscillator:{type:"sine"},envelope:{attack:.01,decay:.5,sustain:.1,release:.1}},modulator:{oscillator:{type:"sine"},envelope:{attack:.01,decay:.1,sustain:.005,release:.2}}}),o=new u.Tone.NoiseSynth({filter:{type:"highpass",frequency:0,rolloff:-12,Q:3.7,gain:0},envelope:{attack:.01,decay:.111,sustain:0,release:.22},filterEnvelope:{min:819.2,max:3510.98,exponent:2,attack:.002,decay:.02,sustain:.02,release:.013}});o.noise.type="brown";var s=new u.Tone.EQ(4,-20,0),a=new u.Tone.Compressor({threshold:-30,ratio:6,attack:.001,release:.01}).toMaster();i.connect(s),r.connect(s),o.connect(s),s.connect(a),document.addEventListener("keydown",function(e){var t=e.keyCode;49===t&&n.triggerAttackRelease("8n"),50===t&&r.triggerAttackRelease("C2","4n"),51===t&&i.triggerAttackRelease("C2","8n"),52===t&&o.triggerAttackRelease("4n")})}var h=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(n,"__esModule",{value:!0});var u=e(50),c=e(4),p=h(c),d=4,f=[],m=0,v=function(){var e={65:"Cl",87:"C#l",83:"Dl",69:"D#l",68:"El",70:"Fl",84:"F#l",71:"Gl",89:"G#l",72:"Al",85:"A#l",74:"Bl",75:"Cu",79:"C#u",76:"Du",80:"D#u",59:"Eu",186:"Eu",222:"Fu",221:"F#u",220:"Gu"},t=u.Tone.prototype.noteToFrequency;return function(n){var i=e[n];if(i)return t(i.replace("l",d).replace("u",d+1))}}(),y=function(){var e=void 0;return function(t){document.removeEventListener("keydown",e),e=function(e){var n=e.keyCode;if(!f[n]){f[n]=!0;var i=v(n);i&&(t.triggerAttack(i),m=n)}},document.addEventListener("keydown",e)}}(),g=function(){var e=void 0,t=void 0;return function(n){t&&t.triggerRelease(),document.removeEventListener("keyup",e),t=n,e=function(e){var t=e.keyCode;if(f[t]){f[t]=!1;var i=v(t);n instanceof u.Tone.PolySynth?n.triggerRelease(i):i&&t===m&&n.triggerRelease()}},document.addEventListener("keyup",e)}}();document.addEventListener("keydown",function(e){90===e.keyCode&&(d=Math.max(d-1,0)),88===e.keyCode&&(d=Math.min(d+1,9))});var x=function(){var e=new u.Tone.PolySynth(3,u.Tone.FMSynth);e.volume.value=-15,e.voices.forEach(function(e){e.carrier.oscillator.type="square",e.modulator.oscillator.type="sine"});var t=new u.Tone.LFO(8,.1,1);t.oscillator.type="square",t.start();var n=u.Tone.context.createGain(),i=new u.Tone.EQ(4,-20,0).toMaster();e.connect(n),t.connect(n.gain),n.connect(i);var r=["A5","C5","E5"],o=["E4","G4","B5"],s=["F4","A5","C5"],a=["C4","E4","G4"],l=["G4","B5","D5"],h=["B5","D5","F5"],c=[r,o,s,a,s,a,s,l,r,s,l,a,r,s,a,l,r,h,s,l,o,a,s,l],p=0;return function(){var t=c[p];e.triggerAttackRelease(t[0],"4t"),e.triggerAttackRelease(t[1],"4t","+16n"),e.triggerAttackRelease(t[2],"4t","+8n"),p++,p%=c.length}}();n.songG=x;var b={songA:i,songB:r,songC:o,songD:s,songE:a,songF:l,songG:x};n["default"]=b},{4:4,50:50}],54:[function(e,t,n){"use strict";function i(e,t,n,i){for(var r=i.octaves,o=void 0===r?6:r,s=i.period,a=void 0===s?4:s,l=i.lacunarity,h=void 0===l?2:l,u=i.gain,c=void 0===u?.5:u,d=1/a,f=c,m=0,v=0;o>v;v++)m+=f*p(e*d,t*d,n*d),d*=h,f*=c;return m}var r=function(e){return e&&e.__esModule?e:{"default":e}},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.fbm=i;var a=e(49),l=r(a),h=e(48),u=r(h),c=new u["default"],p=c.noise3D.bind(c),d=function(){function e(){o(this,e),this.radius=4,this.length=64,this.count=16,this.scale=.5;var t=new l["default"].CylinderGeometry(this.radius,this.radius,this.length,this.count-1,this.count-1,!0);this.geometry=t,this.staticGeometry=t.clone(),this.angles=[];for(var n=0,i=this.geometry.vertices.length;i>n;n++){var r=this.geometry.vertices[n];this.angles.push(Math.atan2(r.x,r.z))}}return s(e,[{key:"update",value:function(){for(var e=2e-4*Date.now(),t=0,n=this.geometry.vertices.length;n>t;t++){var r=this.geometry.vertices[t],o=this.staticGeometry.vertices[t],s=o.x,a=o.y,l=o.z;Math.abs(a)===this.length/2&&(a=0,s>0&&(s=-s));var h=i(s,a,l+e,{period:2}),u=this.radius*(this.scale*h+1)/(this.scale+1),c=this.angles[t];r.x=u*Math.sin(c),r.z=u*Math.cos(c)}this.geometry.computeFaceNormals(),this.geometry.computeVertexNormals(),this.geometry.verticesNeedUpdate=!0}}]),e}();n["default"]=d},{48:48,49:49}],55:[function(e,t,n){"use strict";function i(){var e=document.createElement("link");return e.rel="icon",document.querySelector("head").appendChild(e),e}var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(l){r=!0,o=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(r)throw o}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};Object.defineProperty(n,"__esModule",{value:!0});var o=2*Math.PI,s=function(){for(var e=document.createElement("canvas"),t=e.getContext("2d"),n=8,s=.9,a=[],l=[],h=0;n>h;h++)a.push([s*Math.cos(o*h/n),s*Math.sin(o*h/n)]),l.push([h,(h+1)%n]),l.push([h,(h+2)%n]),l.push([h,(h+3)%n]);return function(){var n=void 0===arguments[0]?32:arguments[0];e.width=n,e.height=n,t.save();var o=n/2;t.translate(o,o),t.scale(o,o),t.beginPath();for(var s=0,h=l.length;h>s;s++){var u=r(l[s],2),c=u[0],p=u[1],d=a[c],f=a[p];t.moveTo(d[0],d[1]),t.lineTo(f[0],f[1])}t.restore(),t.lineWidth=.5,t.stroke();var m=i();m.href=e.toDataURL("image/png")}}();n["default"]=s,t.exports=n["default"]},{}],56:[function(e,t,n){"use strict";function i(){function e(e,t){i.reset(),i.render(e,t),i.pass(r),i.pass(o),i.toScreen()}var t=void 0===arguments[0]?document.body:arguments[0],n=new s["default"].WebGLRenderer({antialias:!0});n.setPixelRatio(window.devicePixelRatio),n.setSize(window.innerWidth,window.innerHeight),t.appendChild(n.domElement);var i=new l["default"].Composer(n,{useRGBA:!1});i.setSize(n.domElement.width,n.domElement.height);var r=new l["default"].FXAAPass,o=new l["default"].RGBSplitPass;return o.params.delta.set(32,32),window.addEventListener("resize",function(){n.setSize(window.innerWidth,window.innerHeight),i.setSize(n.domElement.width,n.domElement.height)}),e.renderer=n,e}var r=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var o=e(49),s=r(o),a=e(61),l=r(a);e(60),t.exports=n["default"]},{49:49,60:60,61:61}],57:[function(e,t,n){"use strict";function i(){var e=void 0===arguments[0]?8:arguments[0],t=new c;for(t.insert(.5),e--;e-->0;)t.insert(Math.random()+1e-8);return t.toObject3D(1.25,2)}var r=function(e){return e&&e.__esModule?e:{"default":e}},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=i;var a=e(39),l=r(a),h=e(58),u=function(){function e(t){o(this,e),this.value=t,this.parent=void 0,this.left=void 0,this.right=void 0}return s(e,[{key:"toObject3D",value:function(){var e=void 0===arguments[0]?1:arguments[0],t=void 0===arguments[1]?1:arguments[1];if(!this.left&&!this.right)return new h.Pyramid(l["default"](1.5,3.5));var n=e*l["default"](.6,.9),i=t*l["default"](.5,.75),r=this.left&&this.left.toObject3D(n,i),o=this.right&&this.right.toObject3D(n,i),s=new h.TrapezoidalPrism(n,l["default"](2,3.5),i),a=new h.EquilateralTriangularPrism(n,i);return s.add(a),r&&a.add(r,"left"),o&&a.add(o,"right"),s}}]),e}(),c=function(){function e(){o(this,e),this.root=void 0}return s(e,[{key:"insert",value:function(e){for(var t=this.root,n=void 0;t;)n=t,t=e<t.value?t.left:t.right;var i=new u(e);return i.parent=n,n?e<n.value?n.left=i:n.right=i:this.root=i,i}},{key:"toObject3D",value:function(e,t){var n=this.root;if(n)return n.toObject3D(e,t)}}]),e}();t.exports=n["default"]},{39:39,58:58}],58:[function(e,t,n){"use strict";function i(e,t){var n=e.parent;return n?("EquilateralTriangularPrism"===n.type&&(e===n.left&&n.transformLeft(),e===n.right&&n.transformRight()),t.applyMatrix4(v.extractRotation(n.matrixWorld))):t}function r(e){var t=e.parent;if(!t)return 0;if("EquilateralTriangularPrism"===t.type){if(e===t.left)return t.leftIndex;if(e===t.right)return t.rightIndex}return t.index}function o(e,t){var n=e.parent;if(!n)return t;"EquilateralTriangularPrism"===n.type&&(e===n.left&&n.transformLeft(),e===n.right&&n.transformRight());var i=n.parent,r=n.matrix,o=n.matrixWorld;return i?o.multiplyMatrices(i.matrixWorld,r):o.copy(r),t.applyMatrix(o),t}function s(e,t){var n=e.parent;if(!n)return t;var i=e.offset-4,r=n.offset,o=void 0;if("EquilateralTriangularPrism"===n.type){var s=n.parent;s&&!function(){var t=s.offset,a=void 0;e===n.left&&(a=[t,r,r+1,t+3]),e===n.right&&(a=[r,t+1,t+2,r+1]),a&&(o=function(e){return 4>e?a[e]:e+i})}()}return o=o||function(e){return e+(4>e?r:i)},t.faces.forEach(function(e){e.a=o(e.a),e.b=o(e.b),e.c=o(e.c)}),t}var a=function(e){return e&&e.__esModule?e:{"default":e}},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=function w(e,t,n){var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:w(r,t,n)}if("value"in i)return i.value;var o=i.get;return void 0===o?void 0:o.call(n)},c=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)};Object.defineProperty(n,"__esModule",{value:!0});var p=e(47),d=a(p),f=e(49),m=a(f),v=new m["default"].Matrix4,y=new m["default"].Vector3,g=function(e){function t(e){l(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="Base",this.size=e,this.offset=0,this.index=0}return c(t,e),h(t,[{key:"createGeometry",value:function(){var e=new m["default"].Geometry,t=this.size/2;return e.vertices=[new m["default"].Vector3(-t,0,t),new m["default"].Vector3(t,0,t),new m["default"].Vector3(t,0,-t),new m["default"].Vector3(-t,0,-t)],e}},{key:"createBone",value:function(e){return e.bones=[{parent:-1,name:"root",pos:[0,0,0],rotq:[0,0,0,1]}],d["default"](4,function(){e.skinIndices.push(new m["default"].Vector4(0,0,0,0)),e.skinWeights.push(new m["default"].Vector4(1,0,0,0))}),e}}]),t}(m["default"].Object3D);n.Base=g;var x=function(e){function t(){var e=void 0===arguments[0]?1:arguments[0],n=void 0===arguments[1]?1:arguments[1],i=void 0===arguments[2]?1:arguments[2];l(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="TrapezoidalPrism",this.width=e,this.height=n,this.depth=i,this.offset=0,this.index=0,this.position.set(0,n,0),this.updateMatrixWorld()}return c(t,e),h(t,[{key:"createGeometry",value:function(){var e=void 0===arguments[0]?0:arguments[0],t=new m["default"].Geometry,n=this.width,i=this.height,r=this.depth,a=n/2,l=r/2;return this.offset=e,t.vertices=[new m["default"].Vector3(-a,i,l),new m["default"].Vector3(a,i,l),new m["default"].Vector3(a,i,-l),new m["default"].Vector3(-a,i,-l)],t.faces=[new m["default"].Face3(0,1,5),new m["default"].Face3(0,5,4),new m["default"].Face3(0,4,3),new m["default"].Face3(4,7,3),new m["default"].Face3(2,3,7),new m["default"].Face3(2,7,6),new m["default"].Face3(1,2,6),new m["default"].Face3(1,6,5)],o(this,t),s(this,t),t}},{key:"createBone",value:function(e){y.set(0,this.height,0),i(this,y);var t=e.bones.push({parent:r(this),name:"trapezoidal",pos:y.toArray(),rotq:[0,0,0,1]})-1;return this.index=t,d["default"](4,function(){e.skinIndices.push(new m["default"].Vector4(t,0,0,0)),e.skinWeights.push(new m["default"].Vector4(1,0,0,0))}),e}}]),t}(m["default"].Object3D);n.TrapezoidalPrism=x;var b=function(e){function t(){var e=void 0===arguments[0]?1:arguments[0],n=void 0===arguments[1]?1:arguments[1];l(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="EquilateralTriangularPrism",this.width=e,this.depth=n,this.halfWidth=e/2,this.halfDepth=n/2,this.height=Math.sqrt(3)*this.halfWidth,this.halfHeight=this.height/2,this.x=0,this.angle=0,this.offset=0,this.left=void 0,this.right=void 0,this.leftIndex=void 0,this.rightIndex=void 0,this.transformLeft()}return c(t,e),h(t,[{key:"add",value:function(e,n){u(Object.getPrototypeOf(t.prototype),"add",this).call(this,e),"left"===n&&(this.left=e),"right"===n&&(this.right=e)}},{key:"updateTransform",value:function(){this.position.set(this.x,this.halfHeight,0),this.rotation.z=this.angle,this.updateMatrixWorld()}},{key:"setLeft",value:function(){this.x=-this.halfWidth/2,this.angle=Math.PI/3}},{key:"setRight",value:function(){this.x=this.halfWidth/2,this.angle=-Math.PI/3}},{key:"transformLeft",value:function(){this.setLeft(),this.updateTransform()}},{key:"transformRight",value:function(){this.setRight(),this.updateTransform()}},{key:"createGeometry",value:function(){var e=void 0===arguments[0]?0:arguments[0],t=new m["default"].Geometry,n=this.height,i=this.halfDepth;return this.offset=e,t.vertices=[new m["default"].Vector3(0,n,i),new m["default"].Vector3(0,n,-i)],t.faces=[new m["default"].Face3(0,1,4),new m["default"].Face3(2,3,5)],this.left||(t.faces.push(new m["default"].Face3(0,4,3)),t.faces.push(new m["default"].Face3(4,5,3))),this.right||(t.faces.push(new m["default"].Face3(1,2,5)),t.faces.push(new m["default"].Face3(1,5,4))),o(this,t),s(this,t),t}},{key:"createDirectionalBone",value:function(e){return y.set(this.x,this.halfHeight,0),i(this,y),e.bones.push({parent:r(this),name:"equilateral-triangular",pos:y.toArray(),rotq:[0,0,0,1]})-1}},{key:"createBone",value:function(e){this.left&&(this.setLeft(),this.leftIndex=this.createDirectionalBone(e)),this.right&&(this.setRight(),this.rightIndex=this.createDirectionalBone(e));var t=0,n=0,i=isFinite(this.leftIndex),r=isFinite(this.rightIndex);i&&r?(t=.5,n=.5):i?t=1:r&&(n=1);var o=this.leftIndex,s=void 0===o?0:o,a=this.rightIndex,l=void 0===a?0:a;return d["default"](2,function(){e.skinIndices.push(new m["default"].Vector4(s,l,0,0)),e.skinWeights.push(new m["default"].Vector4(t,n,0,0))}),e}}]),t}(m["default"].Object3D);n.EquilateralTriangularPrism=b;var _=function(e){function t(){var e=void 0===arguments[0]?1:arguments[0];l(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.type="Pyramid",this.height=e,this.offset=0,this.index=0}return c(t,e),h(t,[{key:"createGeometry",value:function(){var e=void 0===arguments[0]?0:arguments[0],t=new m["default"].Geometry,n=this.height;return this.offset=e,t.vertices=[new m["default"].Vector3(0,n,0)],t.faces=[new m["default"].Face3(0,1,4),new m["default"].Face3(1,2,4),new m["default"].Face3(2,3,4),new m["default"].Face3(3,0,4)],o(this,t),s(this,t),t}},{key:"createBone",value:function(e){y.set(0,this.height,0),i(this,y);var t=e.bones.push({parent:r(this),name:"pyramid",pos:y.toArray(),rotq:[0,0,0,1]})-1;return this.index=t,d["default"](1,function(){e.skinIndices.push(new m["default"].Vector4(t,0,0)),e.skinWeights.push(new m["default"].Vector4(1,0,0,0))}),e}}]),t}(m["default"].Object3D);n.Pyramid=_},{47:47,49:49}],59:[function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e(49),l=i(a),h=e(57),u=i(h),c=e(58),p=new l["default"].Vector3,d=function(){function e(t){o(this,e);var n=new l["default"].Geometry;n.bones=[];var i=new c.Base(2),s=u["default"]();i.add(s),i.traverse(function(e){var t,i,o=n.vertices.length,s=e.createGeometry(o);(t=n.vertices).push.apply(t,r(s.vertices)),(i=n.faces).push.apply(i,r(s.faces)),e.createBone(n)}),n.computeFaceNormals(),n.computeVertexNormals(),n.computeBoundingSphere(),t=t||new l["default"].MeshPhongMaterial({skinning:!0,shading:l["default"].FlatShading});var a=new l["default"].SkinnedMesh(n,t);a.skeleton.bones.forEach(function(e){e.startAngle=0;var t=e.parent;if(t){var n=t.parent;if(n){var i=p.setFromMatrixPosition(e.matrixWorld),r=i.x,o=i.y,s=p.setFromMatrixPosition(t.matrixWorld),a=s.x,l=s.y,h=p.setFromMatrixPosition(n.matrixWorld),u=h.x,c=h.y,d=(r-u)*(l-c)-(o-c)*(a-u);0>d&&(e.startAngle=-Math.PI/3),d>0&&(e.startAngle=Math.PI/3)}}}),this.geometry=n,this.material=t,this.mesh=a,this.sphere=n.boundingSphere.clone()}return s(e,[{key:"collides",value:function(e){var t=this.mesh.matrixWorld;if(this.sphere.applyMatrix4(t),!this.sphere.intersectsSphere(e))return!1;for(var n=this.geometry.vertices,i=0,r=n.length;r>i;i++)if(p.copy(n[i]).applyMatrix4(t),e.containsPoint(p))return!0;return!1}},{key:"update",value:function(){}}]),e}();n["default"]=d,t.exports=n["default"]},{49:49,57:57,58:58}],60:[function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=e(49),o=i(r),s=e(61),a=i(s);a["default"].BlendPass=function(){a["default"].Pass.call(this),a["default"].log("BlendPass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform sampler2D tInput2;\nuniform vec2 resolution;\nuniform vec2 resolution2;\nuniform float aspectRatio;\nuniform float aspectRatio2;\nuniform int mode;\nuniform int sizeMode;\nuniform float opacity;\n\nvec2 vUv2;\n\nfloat applyOverlayToChannel( float base, float blend ) {\n\n	return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n\n}\n\nfloat applySoftLightToChannel( float base, float blend ) {\n\n	return ((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)));\n\n}\n\nfloat applyColorBurnToChannel( float base, float blend ) {\n\n	return ((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0));\n\n}\n\nfloat applyColorDodgeToChannel( float base, float blend ) {\n\n	return ((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0));\n\n}\n\nfloat applyLinearBurnToChannel( float base, float blend ) {\n\n	return max(base + blend - 1., 0.0 );\n\n}\n\nfloat applyLinearDodgeToChannel( float base, float blend ) {\n\n	return min( base + blend, 1. );\n\n}\n\nfloat applyLinearLightToChannel( float base, float blend ) {\n\n	return ( blend < .5 ) ? applyLinearBurnToChannel( base, 2. * blend ) : applyLinearDodgeToChannel( base, 2. * ( blend - .5 ) );\n\n}\n\nvoid main() {\n\n	vUv2 = vUv;\n	\n	if( sizeMode == 1 ) {\n		\n		if( aspectRatio2 > aspectRatio ) {\n			vUv2.x = vUv.x * aspectRatio / aspectRatio2;\n			vUv2.x += .5 * ( 1. - aspectRatio / aspectRatio2 );	\n			vUv2.y = vUv.y;\n		}\n\n		if( aspectRatio2 < aspectRatio ) {\n			vUv2.x = vUv.x;\n			vUv2.y = vUv.y * aspectRatio2 / aspectRatio;\n			vUv2.y += .5 * ( 1. - aspectRatio2 / aspectRatio );\n		}\n\n	}\n\n	vec4 base = texture2D( tInput, vUv );\n	vec4 blend = texture2D( tInput2, vUv2 );\n\n	if( mode == 1 ) { // normal\n\n		gl_FragColor = base;\n		gl_FragColor.a *= opacity;\n		return;\n\n	}\n\n	if( mode == 2 ) { // dissolve\n\n	}\n\n	if( mode == 3 ) { // darken\n\n		gl_FragColor = min( base, blend );\n		return;\n\n	}\n\n	if( mode == 4 ) { // multiply\n\n		gl_FragColor = base * blend;\n		return;\n\n	}\n\n	if( mode == 5 ) { // color burn\n\n		gl_FragColor = vec4(\n			applyColorBurnToChannel( base.r, blend.r ),\n			applyColorBurnToChannel( base.g, blend.g ),\n			applyColorBurnToChannel( base.b, blend.b ),\n			applyColorBurnToChannel( base.a, blend.a )\n		);\n		return;\n\n	}\n\n	if( mode == 6 ) { // linear burn\n\n		gl_FragColor = max(base + blend - 1.0, 0.0);\n		return;\n\n	}\n\n	if( mode == 7 ) { // darker color\n\n	}\n\n	if( mode == 8 ) { // lighten\n\n		gl_FragColor = max( base, blend );\n		return;\n\n	}\n\n	if( mode == 9 ) { // screen\n\n		gl_FragColor = (1.0 - ((1.0 - base) * (1.0 - blend)));\n		gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n		return;\n\n	}\n\n	if( mode == 10 ) { // color dodge\n\n		gl_FragColor = vec4(\n			applyColorDodgeToChannel( base.r, blend.r ),\n			applyColorDodgeToChannel( base.g, blend.g ),\n			applyColorDodgeToChannel( base.b, blend.b ),\n			applyColorDodgeToChannel( base.a, blend.a )\n		);\n		return;\n\n	}\n\n	if( mode == 11 ) { // linear dodge\n\n		gl_FragColor = min(base + blend, 1.0);\n		return;\n\n	}\n\n	if( mode == 12 ) { // lighter color\n\n	}\n\n	if( mode == 13 ) { // overlay\n\n		gl_FragColor = gl_FragColor = vec4( \n			applyOverlayToChannel( base.r, blend.r ),\n			applyOverlayToChannel( base.g, blend.g ),\n			applyOverlayToChannel( base.b, blend.b ),\n			applyOverlayToChannel( base.a, blend.a )\n		);\n		gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n	\n		return;\n\n	}\n\n	if( mode == 14 ) { // soft light\n\n		gl_FragColor = vec4( \n			applySoftLightToChannel( base.r, blend.r ),\n			applySoftLightToChannel( base.g, blend.g ),\n			applySoftLightToChannel( base.b, blend.b ),\n			applySoftLightToChannel( base.a, blend.a )\n		);\n		return;\n\n	}\n\n	if( mode == 15 ) { // hard light\n\n		gl_FragColor = vec4( \n			applyOverlayToChannel( base.r, blend.r ),\n			applyOverlayToChannel( base.g, blend.g ),\n			applyOverlayToChannel( base.b, blend.b ),\n			applyOverlayToChannel( base.a, blend.a )\n		);\n		gl_FragColor = gl_FragColor * opacity + base * ( 1. - opacity );\n		return;\n\n	}\n\n	if( mode == 16 ) { // vivid light\n\n	}\n\n	if( mode == 17 ) { // linear light\n\n		gl_FragColor = vec4( \n			applyLinearLightToChannel( base.r, blend.r ),\n			applyLinearLightToChannel( base.g, blend.g ),\n			applyLinearLightToChannel( base.b, blend.b ),\n			applyLinearLightToChannel( base.a, blend.a )\n		);\n		return;\n\n	}\n\n	if( mode == 18 ) { // pin light\n\n	}\n\n	if( mode == 19 ) { // hard mix\n\n	}\n\n	if( mode == 20 ) { // difference\n\n		gl_FragColor = abs( base - blend );\n		gl_FragColor.a = base.a + blend.b;\n		return;\n\n	}\n\n	if( mode == 21 ) { // exclusion\n\n		gl_FragColor = base + blend - 2. * base * blend;\n		\n	}\n\n	if( mode == 22 ) { // substract\n\n	}\n\n	if( mode == 23 ) { // divide\n\n	}\n\n	gl_FragColor = vec4( 1., 0., 1., 1. );\n\n}"),this.params.mode=1,this.params.opacity=1,this.params.tInput2=null,this.params.resolution2=new o["default"].Vector2,this.params.sizeMode=1,this.params.aspectRatio=1,this.params.aspectRatio2=1},a["default"].BlendMode={Normal:1,Dissolve:2,Darken:3,Multiply:4,ColorBurn:5,LinearBurn:6,DarkerColor:7,Lighten:8,Screen:9,ColorDodge:10,LinearDodge:11,LighterColor:12,Overlay:13,SoftLight:14,HardLight:15,VividLight:16,LinearLight:17,PinLight:18,HardMix:19,Difference:20,Exclusion:21,Substract:22,Divide:23},a["default"].BlendPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].BlendPass.prototype.run=function(e){this.shader.uniforms.mode.value=this.params.mode,this.shader.uniforms.opacity.value=this.params.opacity,this.shader.uniforms.tInput2.value=this.params.tInput2,this.shader.uniforms.sizeMode.value=this.params.sizeMode,this.shader.uniforms.aspectRatio.value=this.params.aspectRatio,this.shader.uniforms.aspectRatio2.value=this.params.aspectRatio2,e.pass(this.shader)},a["default"].InvertPass=function(){a["default"].Pass.call(this),a["default"].log("InvertPass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/invert-fs.glsl"))},a["default"].InvertPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].SymetricPass=function(){a["default"].Pass.call(this),a["default"].log("SymetricPass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/symetric-fs.glsl")),this.params.xReverse=!1,this.params.yReverse=!1,this.params.xMirror=!1,this.params.yMirror=!1,this.params.mirrorCenter=new o["default"].Vector2(.5,.5),this.params.angle=0},a["default"].SymetricPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].SymetricPass.prototype.run=function(e){this.shader.uniforms.xReverse.value=this.params.xReverse,this.shader.uniforms.yReverse.value=this.params.yReverse,this.shader.uniforms.xMirror.value=this.params.xMirror,this.shader.uniforms.yMirror.value=this.params.yMirror,this.shader.uniforms.mirrorCenter.value=this.params.mirrorCenter,this.shader.uniforms.angle.value=this.params.angle,e.pass(this.shader)},a["default"].SepiaPass=function(){a["default"].Pass.call(this),a["default"].log("SepiaPass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/sepia-fs.glsl")),this.params.amount=1},a["default"].SepiaPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].SepiaPass.prototype.run=function(e){this.shader.uniforms.amount.value=this.params.amount,e.pass(this.shader)},a["default"].BrightnessContrastPass=function(){a["default"].Pass.call(this),a["default"].log("BrightnessContrastPass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/brightness-contrast-fs.glsl")),this.params.brightness=1,this.params.contrast=1},a["default"].BrightnessContrastPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].BrightnessContrastPass.prototype.run=function(e){this.shader.uniforms.brightness.value=this.params.brightness,this.shader.uniforms.contrast.value=this.params.contrast,e.pass(this.shader)},a["default"].Pass.prototype.bindUniform=function(e,t,n,i){Object.defineProperty(e,n,{get:function(){return t.uniforms[id].value},set:i,configurable:!1})},a["default"].NoisePass=function(){a["default"].Pass.call(this),a["default"].log("Noise Pass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/noise-fs.glsl")),this.params.amount=.1,this.params.speed=0},a["default"].NoisePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].NoisePass.prototype.run=function(e){this.shader.uniforms.amount.value=this.params.amount,this.shader.uniforms.speed.value=this.params.speed,e.pass(this.shader)},a["default"].VignettePass=function(){a["default"].Pass.call(this),a["default"].log("Vignette Pass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/vignette-fs.glsl")),this.params.amount=1,this.params.falloff=.1},a["default"].VignettePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].VignettePass.prototype.run=function(e){this.shader.uniforms.amount.value=this.params.amount,this.shader.uniforms.falloff.value=this.params.falloff,e.pass(this.shader)},a["default"].Vignette2Pass=function(){a["default"].Pass.call(this),a["default"].log("Vignette Pass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/vignette2-fs.glsl")),this.params.boost=2,this.params.reduction=2},a["default"].Vignette2Pass.prototype=Object.create(a["default"].Pass.prototype),a["default"].Vignette2Pass.prototype.run=function(e){this.shader.uniforms.boost.value=this.params.boost,this.shader.uniforms.reduction.value=this.params.reduction,e.pass(this.shader)},a["default"].DenoisePass=function(){a["default"].Pass.call(this),a["default"].log("Denoise Pass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/denoise-fs.glsl")),this.params.exponent=5,this.params.strength=10},a["default"].DenoisePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].DenoisePass.prototype.run=function(e){this.shader.uniforms.exponent.value=this.params.exponent,this.shader.uniforms.strength.value=this.params.strength,e.pass(this.shader)},a["default"].BoxBlurPass=function(){a["default"].Pass.call(this),a["default"].log("BoxBlurPass Pass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/box-blur2-fs.glsl")),this.params.delta=new o["default"].Vector2(0,0),this.params.taps=1},a["default"].BoxBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].BoxBlurPass.prototype.run=function(e){this.shader.uniforms.delta.value.copy(this.params.delta),e.pass(this.shader)},a["default"].FullBoxBlurPass=function(){a["default"].Pass.call(this),a["default"].log("FullBoxBlurPass Pass constructor"),this.boxPass=new a["default"].BoxBlurPass,
this.params.amount=20,this.params.taps=1},a["default"].FullBoxBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].FullBoxBlurPass.prototype.isLoaded=function(){return this.boxPass.isLoaded()&&(this.loaded=!0),a["default"].Pass.prototype.isLoaded.call(this)},a["default"].FullBoxBlurPass.prototype.run=function(e){var t=this.params.amount;this.boxPass.params.delta.set(t,0),this.boxPass.params.taps=this.params.taps,e.pass(this.boxPass),this.boxPass.params.delta.set(0,t),e.pass(this.boxPass)},a["default"].ZoomBlurPass=function(){a["default"].Pass.call(this),a["default"].log("ZoomBlurPass Pass constructor"),this.loadShader(glslify(a["default"].__dirname+"/fragment-shaders/zoom-blur-fs.glsl")),this.params.center=new o["default"].Vector2(.5,.5),this.params.strength=2},a["default"].ZoomBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].ZoomBlurPass.prototype.run=function(e){this.shader.uniforms.center.value.copy(this.params.center),this.shader.uniforms.strength.value=this.params.strength,e.pass(this.shader)},a["default"].MultiPassBloomPass=function(e,t){a["default"].Pass.call(this),a["default"].log("MultiPassBloomPass Pass constructor"),this.composer=null,this.tmpTexture=this.getOfflineTexture(e,t,!0),this.blurPass=new a["default"].FullBoxBlurPass,this.blendPass=new a["default"].BlendPass,this.zoomBlur=new a["default"].ZoomBlurPass,this.brightnessContrastPass=new a["default"].BrightnessContrastPass,this.width=e||512,this.height=t||512,this.params.blurAmount=20,this.params.applyZoomBlur=!1,this.params.zoomBlurStrength=2,this.params.useTexture=!1,this.params.zoomBlurCenter=new o["default"].Vector2(0,0),this.params.blendMode=a["default"].BlendMode.Screen},a["default"].MultiPassBloomPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].MultiPassBloomPass.prototype.isLoaded=function(){return this.blurPass.isLoaded()&&this.blendPass.isLoaded()&&this.zoomBlur.isLoaded()&&(this.loaded=!0),a["default"].Pass.prototype.isLoaded.call(this)},a["default"].MultiPassBloomPass.prototype.run=function(e){this.composer||(this.composer=new a["default"].Composer(e.renderer,{useRGBA:!0}),this.composer.setSize(this.width,this.height)),this.composer.reset(),this.composer.setSource(this.params.useTexture===!0?this.params.glowTexture:e.output),this.blurPass.params.amount=this.params.blurAmount,this.composer.pass(this.blurPass),this.params.applyZoomBlur&&(this.zoomBlur.params.center.set(.5*this.composer.width,.5*this.composer.height),this.zoomBlur.params.strength=this.params.zoomBlurStrength,this.composer.pass(this.zoomBlur)),this.params.useTexture===!0&&(this.blendPass.params.mode=a["default"].BlendMode.Screen,this.blendPass.params.tInput=this.params.glowTexture,e.pass(this.blendPass)),this.blendPass.params.mode=this.params.blendMode,this.blendPass.params.tInput2=this.composer.output,e.pass(this.blendPass)},a["default"].CGAPass=function(){a["default"].Pass.call(this),a["default"].log("CGA Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform sampler2D cgaMap;\nuniform float pixelDensity;\n\nvoid main() {\n\n	float size = 2. * pixelDensity;\n	float dSize = 2. * size;\n\n	float amount = resolution.x / size;\n	float d = 1.0 / amount;\n	float ar = resolution.x / resolution.y;\n	float sx = floor( vUv.x / d ) * d;\n	d = ar / amount;\n	float sy = floor( vUv.y / d ) * d;\n\n	vec4 base = texture2D( tInput, vec2( sx, sy ) );\n\n	float lum = .2126 * base.r + .7152 * base.g + .0722 * base.b;\n	float o = floor( 6. * lum );\n\n	vec3 c1;\n	vec3 c2;\n	\n	vec3 black = vec3( 0. );\n	vec3 light = vec3( 85., 255., 255. ) / 255.;\n	vec3 dark = vec3( 254., 84., 255. ) / 255.;\n	vec3 white = vec3( 1. );\n\n	/*dark = vec3( 89., 255., 17. ) / 255.;\n	light = vec3( 255., 87., 80. ) / 255.;\n	white = vec3( 255., 255., 0. ) / 255.;*/\n\n	/*light = vec3( 85., 255., 255. ) / 255.;\n	dark = vec3( 255., 86., 80. ) / 255.;*/\n\n	if( o == 0. ) { c1 = black; c2 = c1; }\n	if( o == 1. ) { c1 = black; c2 = dark; }\n	if( o == 2. ) { c1 = dark;  c2 = c1; }\n	if( o == 3. ) { c1 = dark;  c2 = light; }\n	if( o == 4. ) { c1 = light; c2 = c1; }\n	if( o == 5. ) { c1 = light; c2 = white; }\n	if( o == 6. ) { c1 = white; c2 = c1; }\n\n	if( mod( gl_FragCoord.x, dSize ) > size ) {\n		if( mod( gl_FragCoord.y, dSize ) > size ) {\n			base.rgb = c1;\n		} else {\n			base.rgb = c2;	\n		}\n	} else {\n		if( mod( gl_FragCoord.y, dSize ) > size ) {\n			base.rgb = c2;\n		} else {\n			base.rgb = c1;		\n		}\n	}\n\n	gl_FragColor = vec4( base.rgb, base.a );\n\n}",function(){this.shader.uniforms.pixelDensity.value=window.devicePixelRatio})},a["default"].CGAPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].SobelEdgeDetectionPass=function(){a["default"].Pass.call(this),a["default"].log("SobelEdgeDetectionPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nvoid main(void) {\n\n	float x = 1.0 / resolution.x;\n	float y = 1.0 / resolution.y;\n	vec4 horizEdge = vec4( 0.0 );\n	horizEdge -= texture2D( tInput, vec2( vUv.x - x, vUv.y - y ) ) * 1.0;\n	horizEdge -= texture2D( tInput, vec2( vUv.x - x, vUv.y     ) ) * 2.0;\n	horizEdge -= texture2D( tInput, vec2( vUv.x - x, vUv.y + y ) ) * 1.0;\n	horizEdge += texture2D( tInput, vec2( vUv.x + x, vUv.y - y ) ) * 1.0;\n	horizEdge += texture2D( tInput, vec2( vUv.x + x, vUv.y     ) ) * 2.0;\n	horizEdge += texture2D( tInput, vec2( vUv.x + x, vUv.y + y ) ) * 1.0;\n	vec4 vertEdge = vec4( 0.0 );\n	vertEdge -= texture2D( tInput, vec2( vUv.x - x, vUv.y - y ) ) * 1.0;\n	vertEdge -= texture2D( tInput, vec2( vUv.x    , vUv.y - y ) ) * 2.0;\n	vertEdge -= texture2D( tInput, vec2( vUv.x + x, vUv.y - y ) ) * 1.0;\n	vertEdge += texture2D( tInput, vec2( vUv.x - x, vUv.y + y ) ) * 1.0;\n	vertEdge += texture2D( tInput, vec2( vUv.x    , vUv.y + y ) ) * 2.0;\n	vertEdge += texture2D( tInput, vec2( vUv.x + x, vUv.y + y ) ) * 1.0;\n	vec3 edge = sqrt((horizEdge.rgb * horizEdge.rgb) + (vertEdge.rgb * vertEdge.rgb));\n	\n	gl_FragColor = vec4( edge, texture2D( tInput, vUv ).a );\n\n}")},a["default"].SobelEdgeDetectionPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].FreiChenEdgeDetectionPass=function(){a["default"].Pass.call(this),a["default"].log("FreiChenEdgeDetectionPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\n/**\n * @author zz85 / https://github.com/zz85 | https://www.lab4games.net/zz85/blog\n *\n * Edge Detection Shader using Frei-Chen filter\n * Based on http://rastergrid.com/blog/2011/01/frei-chen-edge-detector\n *\n */\n\nuniform sampler2D tInput;\nvarying vec2 vUv;\nuniform vec2 resolution;\nvec2 texel = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nmat3 G[9];\n// hard coded matrix values!!!! as suggested in https://github.com/neilmendoza/ofxPostProcessing/blob/master/src/EdgePass.cpp#L45\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\n\nvoid main(void) {\n\n	G[0] = g0,\n	G[1] = g1,\n	G[2] = g2,\n	G[3] = g3,\n	G[4] = g4,\n	G[5] = g5,\n	G[6] = g6,\n	G[7] = g7,\n	G[8] = g8;\n\n	mat3 I;\n	float cnv[9];\n	vec3 sample;\n\n	/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */\n	for (float i=0.0; i<3.0; i++) {\n		for (float j=0.0; j<3.0; j++) {\n			sample = texture2D(tInput, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;\n			I[int(i)][int(j)] = length(sample);\n		}\n	}\n\n	/* calculate the convolution values for all the masks */\n	for (int i=0; i<9; i++) {\n		float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\n		cnv[i] = dp3 * dp3;\n	}\n\n	float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\n	float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\n\n	gl_FragColor = vec4(vec3(sqrt(M/S)), texture2D( tInput, vUv ).a );\n\n}\n")},a["default"].FreiChenEdgeDetectionPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].DirtPass=function(){a["default"].Pass.call(this),this.blendPass=new a["default"].BlendPass,this.dirtTexture=o["default"].ImageUtils.loadTexture(a["default"].assetsPath+"/textures/dirt8.jpg"),this.params.blendMode=a["default"].BlendMode.SoftLight},a["default"].DirtPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].DirtPass.prototype.isLoaded=function(){return this.blendPass.isLoaded()&&(this.loaded=!0),a["default"].Pass.prototype.isLoaded.call(this)},a["default"].DirtPass.prototype.run=function(e){this.blendPass.params.sizeMode=1,this.blendPass.params.mode=this.params.blendMode,this.blendPass.params.tInput2=this.dirtTexture,this.dirtTexture.image&&(this.blendPass.params.resolution2.set(this.dirtTexture.image.width,this.dirtTexture.image.height),this.blendPass.params.aspectRatio2=this.dirtTexture.image.width/this.dirtTexture.image.height),this.blendPass.params.aspectRatio=e.read.width/e.read.height,e.pass(this.blendPass)},a["default"].GuidedBoxBlurPass=function(){a["default"].Pass.call(this),a["default"].log("GuidedBoxBlurPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform sampler2D tBias;\nuniform vec2 delta;\nuniform float invertBiasMap;\nuniform float isPacked;\nuniform float from;\nuniform float to;\n\nfloat random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}\n\nfloat unpack_depth(const in vec4 color) {\n	return ( color.r * 256. * 256. * 256. + color.g * 256. * 256. + color.b * 256. + color.a ) / ( 256. * 256. * 256. );\n}\n\nfloat sampleBias( vec2 uv ) {\n	float b = ( texture2D( tBias, uv ).r - from ) / ( to - from );\n	b = clamp( b, 0., 1. );\n	if( invertBiasMap == 1. ) b = 1. - b;\n	return b;\n	//return unpack_depth( texture2D( tBias, uv ) );\n}\n\nvoid main() {\n\n	vec4 sum = vec4( 0. );\n	float bias = sampleBias( vUv );\n\n	sum += texture2D( tInput, ( vUv - bias * delta * 4. ) ) * 0.051;\n	sum += texture2D( tInput, ( vUv - bias * delta * 3. ) ) * 0.0918;\n	sum += texture2D( tInput, ( vUv - bias * delta * 2. ) ) * 0.12245;\n	sum += texture2D( tInput, ( vUv - bias * delta * 1. ) ) * 0.1531;\n	sum += texture2D( tInput, ( vUv + bias * delta * 0. ) ) * 0.1633;\n	sum += texture2D( tInput, ( vUv + bias * delta * 1. ) ) * 0.1531;\n	sum += texture2D( tInput, ( vUv + bias * delta * 2. ) ) * 0.12245;\n	sum += texture2D( tInput, ( vUv + bias * delta * 3. ) ) * 0.0918;\n	sum += texture2D( tInput, ( vUv + bias * delta * 4. ) ) * 0.051;\n\n	gl_FragColor = sum;\n	\n}"),this.params.tBias=null,this.params.delta=new o["default"].Vector2(1,0),this.params.invertBiasMap=!1,this.params.isPacked=0,this.params.from=0,this.params.to=1},a["default"].GuidedBoxBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].GuidedBoxBlurPass.prototype.run=function(e){this.shader.uniforms.tBias.value=this.params.tBias,this.shader.uniforms.delta.value.copy(this.params.delta),this.shader.uniforms.delta.value.multiplyScalar(1e-4),this.shader.uniforms.invertBiasMap.value=this.params.invertBiasMap,this.shader.uniforms.isPacked.value=this.params.isPacked,this.shader.uniforms.from.value=this.params.from,this.shader.uniforms.to.value=this.params.to,e.pass(this.shader)},a["default"].GuidedFullBoxBlurPass=function(){a["default"].Pass.call(this),a["default"].log("FullBoxBlurPass Pass constructor"),this.guidedBoxPass=new a["default"].GuidedBoxBlurPass,this.params.tBias=null,this.params.invertBiasMap=!1,this.params.isPacked=0,this.params.amount=10,this.params.from=0,this.params.to=1,this.params.taps=1},a["default"].GuidedFullBoxBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].GuidedFullBoxBlurPass.prototype.isLoaded=function(){return this.guidedBoxPass.isLoaded()&&(this.loaded=!0),a["default"].Pass.prototype.isLoaded.call(this)},a["default"].GuidedFullBoxBlurPass.prototype.run=function(e){this.guidedBoxPass.params.invertBiasMap=this.params.invertBiasMap,this.guidedBoxPass.params.isPacked=this.params.isPacked,this.guidedBoxPass.params.tBias=this.params.tBias,this.guidedBoxPass.params.from=this.params.from,this.guidedBoxPass.params.to=this.params.to;for(var t=this.params.amount,n=0;n<this.params.taps;n++)this.guidedBoxPass.params.delta.set(t,0),e.pass(this.guidedBoxPass),this.guidedBoxPass.params.delta.set(0,t),e.pass(this.guidedBoxPass)},a["default"].PixelatePass=function(){a["default"].Pass.call(this),a["default"].log("PixelatePass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform float amount;\n\nvoid main() {\n\n	float d = 1.0 / amount;\n	float ar = resolution.x / resolution.y;\n	float u = floor( vUv.x / d ) * d;\n	d = ar / amount;\n	float v = floor( vUv.y / d ) * d;\n	gl_FragColor = texture2D( tInput, vec2( u, v ) );\n\n}"),this.params.amount=320},a["default"].PixelatePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].PixelatePass.prototype.run=function(e){this.shader.uniforms.amount.value=this.params.amount,e.pass(this.shader)},a["default"].RGBSplitPass=function(){a["default"].Pass.call(this),a["default"].log("RGBSplitPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 delta;\nuniform vec2 resolution;\n\nvoid main() {\n\n	vec2 dir = vUv - vec2( .5 );\n	float d = .7 * length( dir );\n	normalize( dir );\n	vec2 value = d * dir * delta;\n\n	vec4 c1 = texture2D( tInput, vUv - value / resolution.x );\n	vec4 c2 = texture2D( tInput, vUv );\n	vec4 c3 = texture2D( tInput, vUv + value / resolution.y );\n	\n	gl_FragColor = vec4( c1.r, c2.g, c3.b, c1.a + c2.a + c3.b );\n\n}\n",function(){}),this.params.delta=new o["default"].Vector2},a["default"].RGBSplitPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].RGBSplitPass.prototype.run=function(e){this.shader.uniforms.delta.value.copy(this.params.delta),e.pass(this.shader)},a["default"].ChromaticAberrationPass=function(){a["default"].Pass.call(this),a["default"].log("ChromaticAberrationPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\n\nvec2 barrelDistortion(vec2 coord, float amt) {\n	vec2 cc = coord - 0.5;\n	float dist = dot(cc, cc);\n	return coord + cc * dist * amt;\n}\n\nfloat sat( float t )\n{\n	return clamp( t, 0.0, 1.0 );\n}\n\nfloat linterp( float t ) {\n	return sat( 1.0 - abs( 2.0*t - 1.0 ) );\n}\n\nfloat remap( float t, float a, float b ) {\n	return sat( (t - a) / (b - a) );\n}\n\nvec4 spectrum_offset( float t ) {\n	vec4 ret;\n	float lo = step(t,0.5);\n	float hi = 1.0-lo;\n	float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );\n	ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);\n\n	return pow( ret, vec4(1.0/2.2) );\n}\n\nconst float max_distort = 2.2;\nconst int num_iter = 12;\nconst float reci_num_iter_f = 1.0 / float(num_iter);\n\nvoid main()\n{	\n	vec2 uv=(gl_FragCoord.xy/resolution.xy*.5)+.25;\n\n	vec4 sumcol = vec4(0.0);\n	vec4 sumw = vec4(0.0);	\n	for ( int i=0; i<num_iter;++i )\n	{\n		float t = float(i) * reci_num_iter_f;\n		vec4 w = spectrum_offset( t );\n		sumw += w;\n		sumcol += w * texture2D( tInput, barrelDistortion(uv, .6 * max_distort*t ) );\n	}\n		\n	gl_FragColor = sumcol / sumw;\n}")},a["default"].ChromaticAberrationPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].BarrelBlurPass=function(){a["default"].Pass.call(this),a["default"].log("BarrelBlurPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nvec2 barrelDistortion(vec2 coord, float amt) {\n	\n	vec2 cc = coord - 0.5;\n	float dist = dot(cc, cc);\n	//return coord + cc * (dist*dist)  * amt;\n	return coord + cc * dist * amt;\n\n}\n\nvoid main() {\n\n	//vec2 uv=(gl_FragCoord.xy/iResolution.xy);\n\n	vec2 uv=(gl_FragCoord.xy/resolution.xy*.5)+.25;\n	//uv.y +=.1;\n	vec4 a1=texture2D(tInput, barrelDistortion(uv,0.0));\n	vec4 a2=texture2D(tInput, barrelDistortion(uv,0.2));\n	vec4 a3=texture2D(tInput, barrelDistortion(uv,0.4));\n	vec4 a4=texture2D(tInput, barrelDistortion(uv,0.6));\n	\n	vec4 a5=texture2D(tInput, barrelDistortion(uv,0.8));\n	vec4 a6=texture2D(tInput, barrelDistortion(uv,1.0));\n	vec4 a7=texture2D(tInput, barrelDistortion(uv,1.2));\n	vec4 a8=texture2D(tInput, barrelDistortion(uv,1.4));\n	\n	vec4 a9=texture2D(tInput, barrelDistortion(uv,1.6));\n	vec4 a10=texture2D(tInput, barrelDistortion(uv,1.8));\n	vec4 a11=texture2D(tInput, barrelDistortion(uv,2.0));\n	vec4 a12=texture2D(tInput, barrelDistortion(uv,2.2));\n\n	vec4 tx=(a1+a2+a3+a4+a5+a6+a7+a8+a9+a10+a11+a12)/12.;\n	gl_FragColor = vec4(tx.rgb, tx.a );\n\n}")},a["default"].BarrelBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].OldVideoPass=function(){a["default"].Pass.call(this),a["default"].log("OldVideoPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\n#define BLACK_AND_WHITE\n#define LINES_AND_FLICKER\n#define BLOTCHES\n#define GRAIN\n\n#define FREQUENCY 15.0\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform float time;\n\nvec2 uv;\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nfloat rand(float c){\n	return rand(vec2(c,1.0));\n}\n\nfloat randomLine(float seed)\n{\n	float b = 0.01 * rand(seed);\n	float a = rand(seed+1.0);\n	float c = rand(seed+2.0) - 0.5;\n	float mu = rand(seed+3.0);\n	\n	float l = 1.0;\n	\n	if ( mu > 0.2)\n		l = pow(  abs(a * uv.x + b * uv.y + c ), 1.0/8.0 );\n	else\n		l = 2.0 - pow( abs(a * uv.x + b * uv.y + c), 1.0/8.0 );				\n	\n	return mix(0.5, 1.0, l);\n}\n\n// Generate some blotches.\nfloat randomBlotch(float seed)\n{\n	float x = rand(seed);\n	float y = rand(seed+1.0);\n	float s = 0.01 * rand(seed+2.0);\n	\n	vec2 p = vec2(x,y) - uv;\n	p.x *= resolution.x / resolution.y;\n	float a = atan(p.y,p.x);\n	float v = 1.0;\n	float ss = s*s * (sin(6.2831*a*x)*0.1 + 1.0);\n	\n	if ( dot(p,p) < ss ) v = 0.2;\n	else\n		v = pow(dot(p,p) - ss, 1.0/16.0);\n	\n	return mix(0.3 + 0.2 * (1.0 - (s / 0.02)), 1.0, v);\n}\n\n\nvoid main(void)\n{\n	uv = gl_FragCoord.xy / resolution.xy;\n	\n	// Set frequency of global effect to 20 variations per second\n	float t = float(int(time * FREQUENCY));\n	\n	// Get some image movement\n	vec2 suv = uv + 0.002 * vec2( rand(t), rand(t + 23.0));\n	\n	// Get the image\n	vec3 image = texture2D( tInput, vec2(suv.x, suv.y) ).xyz;\n	\n	#ifdef BLACK_AND_WHITE\n	// Pass it to B/W\n	float luma = dot( vec3(0.2126, 0.7152, 0.0722), image );\n	vec3 oldImage = luma * vec3(0.7, 0.7, 0.7);\n	#else\n	vec3 oldImage = image;\n	#endif\n	\n	// Create a time-varyting vignetting effect\n	float vI = 16.0 * (uv.x * (1.0-uv.x) * uv.y * (1.0-uv.y));\n	vI *= mix( 0.7, 1.0, rand(t + 0.5));\n	\n	// Add additive flicker\n	vI += 1.0 + 0.4 * rand(t+8.);\n	\n	// Add a fixed vignetting (independent of the flicker)\n	vI *= pow(16.0 * uv.x * (1.0-uv.x) * uv.y * (1.0-uv.y), 0.4);\n	\n	// Add some random lines (and some multiplicative flicker. Oh well.)\n	#ifdef LINES_AND_FLICKER\n	int l = int(8.0 * rand(t+7.0));\n	\n	if ( 0 < l ) vI *= randomLine( t+6.0+17.* float(0));\n	if ( 1 < l ) vI *= randomLine( t+6.0+17.* float(1));\n	if ( 2 < l ) vI *= randomLine( t+6.0+17.* float(2));		\n	if ( 3 < l ) vI *= randomLine( t+6.0+17.* float(3));\n	if ( 4 < l ) vI *= randomLine( t+6.0+17.* float(4));\n	if ( 5 < l ) vI *= randomLine( t+6.0+17.* float(5));\n	if ( 6 < l ) vI *= randomLine( t+6.0+17.* float(6));\n	if ( 7 < l ) vI *= randomLine( t+6.0+17.* float(7));\n	\n	#endif\n	\n	// Add some random blotches.\n	#ifdef BLOTCHES\n	int s = int( max(8.0 * rand(t+18.0) -2.0, 0.0 ));\n\n	if ( 0 < s ) vI *= randomBlotch( t+6.0+19.* float(0));\n	if ( 1 < s ) vI *= randomBlotch( t+6.0+19.* float(1));\n	if ( 2 < s ) vI *= randomBlotch( t+6.0+19.* float(2));\n	if ( 3 < s ) vI *= randomBlotch( t+6.0+19.* float(3));\n	if ( 4 < s ) vI *= randomBlotch( t+6.0+19.* float(4));\n	if ( 5 < s ) vI *= randomBlotch( t+6.0+19.* float(5));\n\n	#endif\n\n	// Show the image modulated by the defects\n    gl_FragColor.xyz = oldImage * vI;\n	\n	// Add some grain (thanks, Jose!)\n	#ifdef GRAIN\n    gl_FragColor.xyz *= (1.0+(rand(uv+t*.01)-.2)*.15);		\n    #endif		\n\n}")},a["default"].OldVideoPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].DotScreenPass=function(){a["default"].Pass.call(this),a["default"].log("DotScreenPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\n/**\n * @author alteredq / http://alteredqualia.com/\n *\n * Dot screen shader\n * based on glfx.js sepia shader\n * https://github.com/evanw/glfx.js\n */\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nvec2 center = .5 * resolution;\nfloat angle = 1.57;\nfloat scale = 1.;\n\nfloat pattern() {\n	float s = sin( angle ), c = cos( angle );\n	vec2 tex = vUv * resolution - center;\n	vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n	return ( sin( point.x ) * sin( point.y ) ) * 4.0;\n}\n\nvoid main() {\n	vec4 color = texture2D( tInput, vUv );\n	float average = ( color.r + color.g + color.b ) / 3.0;\n	gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n}")},a["default"].DotScreenPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].PoissonDiscBlurPass=function(){a["default"].Pass.call(this),a["default"].log("PoissonDiscBlurPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nfloat nrand( vec2 n ) {\n	return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\nvec2 rot2d( vec2 p, float a ) {\n	vec2 sc = vec2(sin(a),cos(a));\n	return vec2( dot( p, vec2(sc.y, -sc.x) ), dot( p, sc.xy ) );\n}\n\nvoid main(void)\n{\n	const int NUM_TAPS = 12;\n	float max_siz = 42.0;// * (0.5+0.5*sin(iGlobalTime));\n	\n	vec2 fTaps_Poisson[NUM_TAPS];\n	fTaps_Poisson[0]  = vec2(-.326,-.406);\n	fTaps_Poisson[1]  = vec2(-.840,-.074);\n	fTaps_Poisson[2]  = vec2(-.696, .457);\n	fTaps_Poisson[3]  = vec2(-.203, .621);\n	fTaps_Poisson[4]  = vec2( .962,-.195);\n	fTaps_Poisson[5]  = vec2( .473,-.480);\n	fTaps_Poisson[6]  = vec2( .519, .767);\n	fTaps_Poisson[7]  = vec2( .185,-.893);\n	fTaps_Poisson[8]  = vec2( .507, .064);\n	fTaps_Poisson[9]  = vec2( .896, .412);\n	fTaps_Poisson[10] = vec2(-.322,-.933);\n	fTaps_Poisson[11] = vec2(-.792,-.598);\n	\n	vec2 uv = gl_FragCoord.xy / resolution.xy;\n	//uv.x += 0.05*iGlobalTime;\n	vec4 sum = vec4(0);\n	float rnd = 6.28 * nrand( uv /*+fract(iGlobalTime)*/ );\n	\n	vec4 basis = vec4( rot2d(vec2(1,0),rnd), rot2d(vec2(0,1),rnd) );\n	for (int i=0; i < NUM_TAPS; i++)\n	{\n		vec2 ofs = fTaps_Poisson[i]; ofs = vec2(dot(ofs,basis.xz),dot(ofs,basis.yw) );\n		//vec2 ofs = rot2d( fTaps_Poisson[i], rnd );\n		vec2 texcoord = uv + max_siz * ofs / resolution.xy;\n		sum += texture2D(tInput, texcoord, -10.0);\n	}\n	gl_FragColor = sum / vec4(NUM_TAPS);\n}")},a["default"].PoissonDiscBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].CircularBlurPass=function(){a["default"].Pass.call(this),a["default"].log("CircularBlurPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nfloat nrand( vec2 n ) {\n	return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\nvec2 rot2d( vec2 p, float a ) {\n	vec2 sc = vec2(sin(a),cos(a));\n	return vec2( dot( p, vec2(sc.y, -sc.x) ), dot( p, sc.xy ) );\n}\n\nvoid main(void)\n{\n	vec2 uv = gl_FragCoord.xy / resolution.xy;\n	uv.x += 0.1;//*iGlobalTime;\n\n	float maxofs = 12.0;// * (0.5+0.5*sin( iGlobalTime ));\n	const int NUM_SAMPLES = 16;\n	const int NUM_SAMPLES2 = NUM_SAMPLES/2;\n	const float NUM_SAMPLES_F = float(NUM_SAMPLES);\n	const float anglestep = 6.28 / NUM_SAMPLES_F;\n	const float MIPBIAS = -8.0; //note: make sure we always pick mip0\n\n	//note: rand\n	float rnd = nrand( 0.01*gl_FragCoord.xy );//+ fract(iGlobalTime) );\n	\n	//note: ordered dither\n	//float rnd = texture2D( iChannel1, gl_FragCoord.xy / 8.0 ).r;\n\n	//note: create halfcircle of offsets\n	vec2 ofs[NUM_SAMPLES];\n	{\n		float angle = 3.1416*rnd;\n		for( int i=0;i<NUM_SAMPLES2;++i )\n		{\n			ofs[i] = rot2d( vec2(maxofs,0.0), angle ) / resolution.xy;\n			angle += anglestep;\n		}\n	}\n	\n	vec4 sum = vec4(0.0);\n	//note: sample positive half-circle\n	for( int i=0;i<NUM_SAMPLES2;++i )\n		sum += texture2D( tInput, vec2(uv.x, uv.y)+ofs[i], MIPBIAS );\n\n	//note: sample negative half-circle\n	for( int i=0;i<NUM_SAMPLES2;++i )\n		sum += texture2D( tInput, vec2(uv.x, uv.y)-ofs[i], MIPBIAS );\n\n	gl_FragColor.rgb = sum.rgb / NUM_SAMPLES_F;\n	gl_FragColor.a = texture2D( tInput, vUv ).a;\n}\n")},a["default"].CircularBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].ToonPass=function(){a["default"].Pass.call(this),a["default"].log("ToonPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\n// Based on http://coding-experiments.blogspot.sg/2011/01/toon-pixel-shader.html\n\nuniform vec3 resolution;\nuniform sampler2D tInput;\nvarying vec2 vUv;\n\n#define HueLevCount 6\n#define SatLevCount 7\n#define ValLevCount 4\nfloat HueLevels[HueLevCount];\nfloat SatLevels[SatLevCount];\nfloat ValLevels[ValLevCount];\n \nvec3 RGBtoHSV( float r, float g, float b) {\n   float minv, maxv, delta;\n   vec3 res;\n \n   minv = min(min(r, g), b);\n   maxv = max(max(r, g), b);\n   res.z = maxv;            // v\n   \n   delta = maxv - minv;\n \n   if( maxv != 0.0 )\n      res.y = delta / maxv;      // s\n   else {\n      // r = g = b = 0      // s = 0, v is undefined\n      res.y = 0.0;\n      res.x = -1.0;\n      return res;\n   }\n \n   if( r == maxv )\n      res.x = ( g - b ) / delta;      // between yellow & magenta\n   else if( g == maxv )\n      res.x = 2.0 + ( b - r ) / delta;   // between cyan & yellow\n   else\n      res.x = 4.0 + ( r - g ) / delta;   // between magenta & cyan\n \n   res.x = res.x * 60.0;            // degrees\n   if( res.x < 0.0 )\n      res.x = res.x + 360.0;\n      \n   return res;\n}\n \nvec3 HSVtoRGB(float h, float s, float v ) {\n   int i;\n   float f, p, q, t;\n   vec3 res;\n \n   if( s == 0.0 ) {\n      // achromatic (grey)\n      res.x = v;\n      res.y = v;\n      res.z = v;\n      return res;\n   }\n \n   h /= 60.0;         // sector 0 to 5\n   i = int(floor( h ));\n   f = h - float(i);         // factorial part of h\n   p = v * ( 1.0 - s );\n   q = v * ( 1.0 - s * f );\n   t = v * ( 1.0 - s * ( 1.0 - f ) );\n \n   if (i==0) {\n		res.x = v;\n		res.y = t;\n		res.z = p;\n   	} else if (i==1) {\n         res.x = q;\n         res.y = v;\n         res.z = p;\n	} else if (i==2) {\n         res.x = p;\n         res.y = v;\n         res.z = t;\n	} else if (i==3) {\n         res.x = p;\n         res.y = q;\n         res.z = v;\n	} else if (i==4) {\n         res.x = t;\n         res.y = p;\n         res.z = v;\n	} else if (i==5) {\n         res.x = v;\n         res.y = p;\n         res.z = q;\n   }\n   \n   return res;\n}\n \nfloat nearestLevel(float col, int mode) {\n \n   if (mode==0) {\n   		for (int i =0; i<HueLevCount-1; i++ ) {\n		    if (col >= HueLevels[i] && col <= HueLevels[i+1]) {\n		      return HueLevels[i+1];\n		    }\n		}\n	 }\n \n	if (mode==1) {\n		for (int i =0; i<SatLevCount-1; i++ ) {\n			if (col >= SatLevels[i] && col <= SatLevels[i+1]) {\n	          return SatLevels[i+1];\n	        }\n		}\n	}\n \n \n	if (mode==2) {\n		for (int i =0; i<ValLevCount-1; i++ ) {\n			if (col >= ValLevels[i] && col <= ValLevels[i+1]) {\n	          return ValLevels[i+1];\n	        }\n		}\n	}\n \n \n}\n \n// averaged pixel intensity from 3 color channels\nfloat avg_intensity(vec4 pix) {\n return (pix.r + pix.g + pix.b)/3.;\n}\n \nvec4 get_pixel(vec2 coords, float dx, float dy) {\n return texture2D(tInput,coords + vec2(dx, dy));\n}\n \n// returns pixel color\nfloat IsEdge(in vec2 coords){\n  float dxtex = 1.0 / resolution.x ;\n  float dytex = 1.0 / resolution.y ;\n  \n  float pix[9];\n  \n  int k = -1;\n  float delta;\n \n  // read neighboring pixel intensities\nfloat pix0 = avg_intensity(get_pixel(coords,-1.0*dxtex, -1.0*dytex));\nfloat pix1 = avg_intensity(get_pixel(coords,-1.0*dxtex, 0.0*dytex));\nfloat pix2 = avg_intensity(get_pixel(coords,-1.0*dxtex, 1.0*dytex));\nfloat pix3 = avg_intensity(get_pixel(coords,0.0*dxtex, -1.0*dytex));\nfloat pix4 = avg_intensity(get_pixel(coords,0.0*dxtex, 0.0*dytex));\nfloat pix5 = avg_intensity(get_pixel(coords,0.0*dxtex, 1.0*dytex));\nfloat pix6 = avg_intensity(get_pixel(coords,1.0*dxtex, -1.0*dytex));\nfloat pix7 = avg_intensity(get_pixel(coords,1.0*dxtex, 0.0*dytex));\nfloat pix8 = avg_intensity(get_pixel(coords,1.0*dxtex, 1.0*dytex)); \n  // average color differences around neighboring pixels\n  delta = (abs(pix1-pix7)+\n          abs(pix5-pix3) +\n          abs(pix0-pix8)+\n          abs(pix2-pix6)\n           )/4.;\n \n  return clamp(5.5*delta,0.0,1.0);\n}\n \nvoid main(void)\n{\n \n	HueLevels[0] = 0.0;\n	HueLevels[1] = 80.0;\n	HueLevels[2] = 160.0;\n	HueLevels[3] = 240.0;\n	HueLevels[4] = 320.0;\n	HueLevels[5] = 360.0; \n \n	SatLevels[0] = 0.0;\n	SatLevels[1] = 0.1;\n	SatLevels[2] = 0.3;\n	SatLevels[3] = 0.5;\n	SatLevels[4] = 0.6;\n	SatLevels[5] = 0.8;\n	SatLevels[6] = 1.0;\n \n	ValLevels[0] = 0.0;\n	ValLevels[1] = 0.3;\n	ValLevels[2] = 0.6;\n	ValLevels[3] = 1.0; \n \n    vec4 colorOrg = texture2D( tInput, vUv );\n    vec3 vHSV =  RGBtoHSV(colorOrg.r,colorOrg.g,colorOrg.b);\n    vHSV.x = nearestLevel(vHSV.x, 0);\n    vHSV.y = nearestLevel(vHSV.y, 1);\n    vHSV.z = nearestLevel(vHSV.z, 2);\n    float edg = IsEdge(vUv);\n    vec3 vRGB = (edg >= 0.3)? vec3(0.0,0.0,0.0):HSVtoRGB(vHSV.x,vHSV.y,vHSV.z);\n    gl_FragColor = vec4(vRGB.x,vRGB.y,vRGB.z,1.0);\n}")},a["default"].ToonPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].FXAAPass=function(){a["default"].Pass.call(this),a["default"].log("FXAA Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\n\nvoid main() {\n\n    vec2 res = 1. / resolution;\n\n    vec3 rgbNW = texture2D( tInput, ( vUv.xy + vec2( -1.0, -1.0 ) * res ) ).xyz;\n    vec3 rgbNE = texture2D( tInput, ( vUv.xy + vec2( 1.0, -1.0 ) * res ) ).xyz;\n    vec3 rgbSW = texture2D( tInput, ( vUv.xy + vec2( -1.0, 1.0 ) * res ) ).xyz;\n    vec3 rgbSE = texture2D( tInput, ( vUv.xy + vec2( 1.0, 1.0 ) * res ) ).xyz;\n    vec4 rgbaM  = texture2D( tInput,  vUv.xy  * res );\n    vec3 rgbM  = rgbaM.xyz;\n    vec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n    float lumaNW = dot( rgbNW, luma );\n    float lumaNE = dot( rgbNE, luma );\n    float lumaSW = dot( rgbSW, luma );\n    float lumaSE = dot( rgbSE, luma );\n    float lumaM  = dot( rgbM,  luma );\n    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n\n    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n    dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\n          max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                dir * rcpDirMin)) * res;\n    vec4 rgbA = (1.0/2.0) * (\n    texture2D(tInput,  vUv.xy + dir * (1.0/3.0 - 0.5)) +\n    texture2D(tInput,  vUv.xy + dir * (2.0/3.0 - 0.5)));\n    vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n    texture2D(tInput,  vUv.xy + dir * (0.0/3.0 - 0.5)) +\n    texture2D(tInput,  vUv.xy + dir * (3.0/3.0 - 0.5)));\n    float lumaB = dot(rgbB, vec4(luma, 0.0));\n\n    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\n        gl_FragColor = rgbA;\n    } else {\n        gl_FragColor = rgbB;\n    }\n\n    //gl_FragColor = vec4( texture2D( tInput,vUv ).xyz, 1. );\n}");

},a["default"].FXAAPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].HighPassPass=function(){a["default"].Pass.call(this),a["default"].log("HighPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\n// from: http://www.ozone3d.net/smf/index.php?topic=68.0\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\n\n//uniform float kernel[9];\n\nvarying vec2 vUv;\n\nfloat step_w = 1.0/resolution.x;\nfloat step_h = 1.0/resolution.y;\n\nvoid main(void)\n{\n\n	vec2 offset[9];\n	float kernel[ 9 ];\n\n	offset[ 0 ] = vec2(-step_w, -step_h);\n	offset[ 1 ] = vec2(0.0, -step_h);\n	offset[ 2 ] = vec2(step_w, -step_h);\n\n	offset[ 3 ] = vec2(-step_w, 0.0);\n	offset[ 4 ] = vec2(0.0, 0.0);\n	offset[ 5 ] = vec2(step_w, 0.0);\n\n	offset[ 6 ] = vec2(-step_w, step_h);\n	offset[ 7 ] = vec2(0.0, step_h);\n	offset[ 8 ] = vec2(step_w, step_h);\n\n	kernel[ 0 ] = -1.;\n	kernel[ 1 ] = -1.;\n	kernel[ 2 ] = -1.;\n	\n	kernel[ 3 ] = -1.;\n	kernel[ 4 ] = 8.;\n	kernel[ 5 ] = -1.;\n	\n	kernel[ 6 ] = -1.;\n	kernel[ 7 ] = -1.;\n	kernel[ 8 ] = -1.;\n\n\n   int i = 0;\n   vec4 sum = vec4(0.0);\n\n   for( int i=0; i<9; i++ )\n   {\n    vec4 tmp = texture2D(tInput, vUv + offset[i]);\n    sum += tmp * kernel[i];\n    sum.a = 1.0;\n   }\n\n   gl_FragColor = sum;\n}")},a["default"].HighPassPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].GrayscalePass=function(){a["default"].Pass.call(this),a["default"].log("GrayscalePass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 resolution;\n\nvoid main() {\n\n	vec3 luma = vec3( .299, 0.587, 0.114 );\n	vec4 color = texture2D( tInput, vUv );\n	gl_FragColor = vec4( vec3( dot( color.rgb, luma ) ), color.a );\n\n}")},a["default"].GrayscalePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].ASCIIPass=function(){a["default"].Pass.call(this),a["default"].log("ASCIIPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform vec2 resolution;\nuniform sampler2D tInput;\nuniform sampler2D tAscii;\nconst vec2 fontSize = vec2(8.0,16.0);\n\nvec4 lookupASCII(float asciiValue){\n\n	vec2 pos = mod(gl_FragCoord.xy,fontSize.xy);\n\n	pos = pos / vec2(2048.0,16.0);\n	pos.x += asciiValue;\n	return vec4(texture2D(tAscii,pos).rgb,1.0);\n	\n}\n\nvoid main(void) {\n\n	vec2 invViewport = vec2(1.0) / resolution;\n	vec2 pixelSize = fontSize;\n	vec4 sum = vec4(0.0);\n	vec2 uvClamped = vUv-mod(vUv,pixelSize * invViewport);\n	for (float x=0.0;x<fontSize.x;x++){\n		for (float y=0.0;y<fontSize.y;y++){\n			vec2 offset = vec2(x,y);\n			sum += texture2D(tInput,uvClamped+(offset*invViewport));\n		}\n	}\n	vec4 avarage = sum / vec4(fontSize.x*fontSize.y);\n	float brightness = (avarage.x+avarage.y+avarage.z)*0.33333;\n	vec4 clampedColor = floor(avarage*8.0)/8.0;\n	float asciiChar = floor((1.0-brightness)*256.0)/256.0;\n	gl_FragColor = clampedColor*lookupASCII(asciiChar);\n\n}\n",function(){this.shader.uniforms.tAscii.value=o["default"].ImageUtils.loadTexture(a["default"].assetsPath+"/ascii/8x16_ascii_font_sorted.gif")})},a["default"].ASCIIPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].LEDPass=function(){a["default"].Pass.call(this),a["default"].log("LEDPass Pass constructor"),this.loadShader('#define GLSLIFY 1\n\n/*************************************************************\n*Shader by: Jason Gorski\n*Email: jasejc@aol.com\n*CS594 University of Illinios at Chicago\n*\n*LED Billboard Tutorial\n*For more information about this shader view the tutorial page\n*at http://www2.uic.edu/~jgorsk2 or email me\n*************************************************************/ \n\n#define KERNEL_SIZE 9\n\nuniform int pixelSize; //size of bigger "pixel regions". These regions are forced to be square\nuniform vec2 resolution; //dimensions in pixels of tInput\nuniform sampler2D tInput; //texure to be applied to billboard quad\n\n//uniforms added since billboard1\nuniform float tolerance; //a tolerance used to determine the amount of blurring along the edge of the circle defining our "pixel region"\nuniform float pixelRadius; //the radius of the circle that will be our "pixel region", values > 0.5 hit the edge of the "pixel region"\n\n//uniforms added since billboard2\nuniform int luminanceSteps; //number of shades of color our LED billboard will display\nuniform float luminanceBoost; //used to brighten or darken image\n\n//uniforms added since billboard3\nuniform float colorBoost; //used to adjust the color intensity\nuniform float burntOutPercent; //not exactly a "percent", but it determines how many LEDs are burnt out\nuniform sampler2D noiseTexture; //noise texture used with burntOutPercent\n\nvarying vec2 vUv;\n\nvec2 texCoords[KERNEL_SIZE]; //stores texture lookup offsets from a base case\n\n//gets the light intensity of the color (same as luminance in applyLuminanceStepping)\nfloat getIntensity(in vec4 color)\n{	return (color.r + color.g + color.b)/3.0;	}\n\n//apply colorBoost\nvec4 applyColorBoost(in vec4 color)\n{\n	vec4 boostedColor = color;\n	float max = max(color.r,max(color.g, color.b)); //determine max intensity of channels\n	bvec3 maxes = equal(vec3(color),vec3(max)); //contains which channels == max\n	\n	//any channels == max are boosted by the colorBoost\n	if(maxes.r)\n		boostedColor += vec4(2.0*colorBoost,-colorBoost,-colorBoost,0.0);\n		\n	if(maxes.g) \n		boostedColor += vec4(-colorBoost,2.0*colorBoost,-colorBoost,0.0);\n	\n	if(maxes.b) \n		boostedColor += vec4(-colorBoost,-colorBoost,2.0*colorBoost,0.0);\n	\n	return boostedColor;\n}\n\n//apply luminanceSteps & luminanceBoost\nvec4 applyLuminanceStepping(in vec4 color)\n{\n	float sum = color.r + color.g + color.b;\n	float luminance = sum/3.0; //brightness or luminance of color\n	vec3 ratios = vec3(color.r/luminance, color.g/luminance, color.b/luminance); //ratio stores each channel\'s contribution to the luminance\n	\n	float luminanceStep = 1.0/float(luminanceSteps); //how big each luminance bin is\n	float luminanceBin = ceil(luminance/luminanceStep); //figure out which bin the color is in\n	float luminanceFactor = luminanceStep * luminanceBin + luminanceBoost; //store the luminance of the color we are making including luminanceBoost\n	\n	return vec4(ratios * luminanceFactor,1.0); //use ratios * luminanceFactor as our new color so that original color hue is maintained\n}\n                         \nvoid main(void)\n{\n	vec4 avgColor; //will hold our averaged color from our sample points\n	vec2 texCoordsStep = 1.0/(vec2(float(resolution.x),float(resolution.y))/float(pixelSize)); //width of "pixel region" in texture coords\n	vec2 pixelRegionCoords = fract( vUv/texCoordsStep); //x and y coordinates within "pixel region"\n	vec2 pixelBin = floor( vUv/texCoordsStep); //"pixel region" number counting away from base case\n	vec2 inPixelStep = texCoordsStep/3.0; //width of "pixel region" divided by 3 (for KERNEL_SIZE = 9, 3x3 square)\n	vec2 inPixelHalfStep = inPixelStep/2.0;\n\n	//the center of our "pixel region" is computed earlier now so we don\'t waste time computing other colors if we are in a burnt out region\n	texCoords[4] = vec2(inPixelStep.x + inPixelHalfStep.x, inPixelStep.y + inPixelHalfStep.y) + pixelBin * texCoordsStep;\n			\n	//if light intensity of our noise texture <= burntOutPercent we are burnt out, otherwise continue computing "pixel region" color\n/*	if(getIntensity(texture2D(noiseTexture, texCoords[4].st)) <= burntOutPercent) {\n		gl_FragColor = vec4(0.1,0.1,0.1,1.0) + (0.3*(tolerance + luminanceBoost)); //try to match up color-wise with the edge of our "pixel region"\n	} else {*/\n		//use offset (pixelBin * texCoordsStep) from base case (the lower left corner of billboard) to compute texCoords\n		texCoords[0] = vec2(inPixelHalfStep.x, inPixelStep.y*2.0 + inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		texCoords[1] = vec2(inPixelStep.x + inPixelHalfStep.x, inPixelStep.y*2.0 + inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		texCoords[2] = vec2(inPixelStep.x*2.0 + inPixelHalfStep.x, inPixelStep.y*2.0 + inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		texCoords[3] = vec2(inPixelHalfStep.x, inPixelStep.y + inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		//texCoords[4] moved to top. See note above.\n		texCoords[5] = vec2(inPixelStep.x*2.0 + inPixelHalfStep.x, inPixelStep.y + inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		texCoords[6] = vec2(inPixelHalfStep.x, inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		texCoords[7] = vec2(inPixelStep.x + inPixelHalfStep.x, inPixelHalfStep.y) + pixelBin * texCoordsStep;\n		texCoords[8] = vec2(inPixelStep.x*2.0 + inPixelHalfStep.x, inPixelHalfStep.y) + pixelBin * texCoordsStep;\n			\n		//take average of 9 pixel samples\n		avgColor = texture2D(tInput, texCoords[0]) +\n					texture2D(tInput, texCoords[1]) +\n					texture2D(tInput, texCoords[2]) +\n					texture2D(tInput, texCoords[3]) +\n					texture2D(tInput, texCoords[4]) +\n					texture2D(tInput, texCoords[5]) +\n					texture2D(tInput, texCoords[6]) +\n					texture2D(tInput, texCoords[7]) +\n					texture2D(tInput, texCoords[8]);\n			\n		avgColor /= float(KERNEL_SIZE);\n		\n		//get a new color with the discretized luminance value\n		avgColor = applyLuminanceStepping(avgColor);\n		//adjust the color\n		avgColor = applyColorBoost(avgColor);\n		\n		//blend between fragments in the circle and out of the circle defining our "pixel region"\n		//Equation of a circle: (x - h)^2 + (y - k)^2 = r^2\n		vec2 powers = pow(abs(pixelRegionCoords - 0.5),vec2(2.0));\n		float radiusSqrd = pow(pixelRadius,2.0);\n		float gradient = smoothstep(radiusSqrd-tolerance, radiusSqrd+tolerance, powers.x+powers.y);\n		\n		gl_FragColor = mix(avgColor, vec4(0.1,0.1,0.1,1.0), gradient);\n//	}\n\n}\n',function(){}),this.params.pixelSize=10,this.params.tolerance=.25,this.params.pixelRadius=.25,this.params.luminanceSteps=100,this.params.luminanceBoost=.2,this.params.colorBoost=.01,this.params.burntOutPercent=50},a["default"].LEDPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].LEDPass.prototype.run=function(e){this.shader.uniforms.pixelSize.value=this.params.pixelSize,this.shader.uniforms.tolerance.value=this.params.tolerance,this.shader.uniforms.pixelRadius.value=this.params.pixelRadius,this.shader.uniforms.luminanceSteps.value=this.params.luminanceSteps,this.shader.uniforms.luminanceBoost.value=this.params.luminanceBoost,this.shader.uniforms.colorBoost.value=this.params.colorBoost,this.shader.uniforms.burntOutPercent.value=this.params.burntOutPercent,e.pass(this.shader)},a["default"].HalftonePass=function(){a["default"].Pass.call(this),a["default"].log("HalftonePass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform float pixelSize;\n\nvoid main(void) {\n\n	vec2 p = vUv;\n\n	float pixelsPerRow = resolution.x / pixelSize;\n	float pixelsPerCol = resolution.y / pixelSize;\n\n	float pixelSizeX = 1.0 / pixelsPerRow;	\n	float dx = mod(p.x, pixelSizeX ) - pixelSizeX *0.5;\n	float pixelSizeY = 1.0 / pixelsPerCol;	\n	float dy = mod(p.y, pixelSizeY ) - pixelSizeY * 0.5;\n	float pixelSize = pixelSizeX;//sqrt( pixelSizeX * pixelSizeX + pixelSizeY + pixelSizeY );\n\n	p.x -= dx;\n	p.y -= dy;\n	vec3 col = texture2D(tInput, p).rgb;\n	vec3 luma = vec3( .299, 0.587, 0.114 );\n	float bright = dot( col.rgb, luma );\n	\n	float dist = sqrt(dx*dx + dy*dy);\n	float rad = bright * pixelSize * 1.;\n	float m = step( dist, rad );\n\n	vec3 col2 = mix(vec3(0.0), vec3(1.0), m);\n	gl_FragColor = vec4(col2, 1.0);\n\n}\n",function(){this.shader.uniforms.pixelSize.value=6})},a["default"].HalftonePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].Halftone2Pass=function(){a["default"].Pass.call(this),a["default"].log("Halftone2Pass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\n// adapted from http://www.is-real.net/experiments/webgl/wwdc2014/\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform float pixelSize;\nuniform float amount;\nuniform float smoothness;\n\nfloat antialiasStep( float threshold, float value ) {\n\n  float afwidth = amount * ( 1.0 / 200.0 );\n  return smoothstep( threshold - afwidth, threshold, value );\n\n}\n\nfloat roundedBox( vec2 position, vec2 size, float radius ) {\n\n  return length( max( abs( position ) - size, 0.0 ) ) - radius;\n\n}\n\nvoid main(void) {\n\n  float ar = resolution.x / resolution.y;\n  vec2 nearest = 2.0 * fract( amount * vec2( 1., 1. / ar ) * vUv ) - 1.0;\n  float distX = length( nearest.x );\n  float distY = length( nearest.y );\n  float dist = length( nearest );\n\n  vec2 d = vec2( 1. / amount ) * vec2( 1., ar );\n  vec2 tUv = floor( vUv / d ) * d;\n  vec3 dotColorCalculation = texture2D( tInput, tUv ).rgb;\n  vec3 luma = vec3( .299, 0.587, 0.114 );\n  vec3 gradientColor = dotColorCalculation ;//texture2D( tInput, vUv ).rgb;\n  float radius = sqrt( dot( dotColorCalculation, luma ) );\n\n  vec3 bkgColor = vec3( 0. );//1.0, 1.0, 1.0 );\n\n  vec4 halfToneDotColor = vec4( mix( gradientColor.rgb, bkgColor, antialiasStep( radius, dist ) ), 1.0 );\n\n  float b = roundedBox( vec2( distX+0.02, distY+0.02 ), vec2( .5 * radius ), 0.4 * radius );\n  vec4 halfToneSquircleColor = vec4( mix( bkgColor, gradientColor.rgb, smoothstep( smoothness, 0.0, b) ), 1.0 );\n\n  gl_FragColor = halfToneSquircleColor;\n\n}\n"),this.params.amount=128,this.params.smoothness=.25},a["default"].Halftone2Pass.prototype=Object.create(a["default"].Pass.prototype),a["default"].Halftone2Pass.prototype.run=function(e){this.shader.uniforms.amount.value=this.params.amount,this.shader.uniforms.smoothness.value=this.params.smoothness,e.pass(this.shader)},a["default"].CrossFadePass=function(){a["default"].Pass.call(this),a["default"].log("CrossFadePass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform sampler2D tInput2;\nuniform sampler2D tFadeMap;\nuniform vec2 resolution;\nuniform float time;\nuniform float amount;\n\nvarying vec2 vUv;\n\nvoid main( void ) {\n\n	float range = .2;\n	vec4 from = texture2D( tInput, vUv );\n	vec4 to = texture2D( tInput2, vUv );\n	vec3 luma = vec3( .299, 0.587, 0.114 );\n	float v = clamp( dot( luma, texture2D( tFadeMap, vUv ).rgb ), 0., 1. - range );\n\n	float threshold = 0.1;\n	float r = amount * (1.0 + threshold * 2.0) - threshold;\n	float m = clamp((v - r)*(1.0/threshold), 0.0, 1.0);\n\n	gl_FragColor = mix( from, to, m );\n\n}"),this.params.tInput2=null,this.params.tFadeMap=null,this.params.amount=0},a["default"].CrossFadePass.prototype=Object.create(a["default"].Pass.prototype),a["default"].CrossFadePass.prototype.run=function(e){this.shader.uniforms.tInput2.value=this.params.tInput2,this.shader.uniforms.tFadeMap.value=this.params.tFadeMap,this.shader.uniforms.amount.value=this.params.amount,e.pass(this.shader)},a["default"].SSAOPass=function(){a["default"].Pass.call(this),a["default"].log("SSAOPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tDepth;\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform float isPacked;\nuniform float onlyOcclusion;\n\nfloat random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}\n\nfloat unpack_depth(const in vec4 color) {\n	return ( color.r * 256. * 256. * 256. + color.g * 256. * 256. + color.b * 256. + color.a ) / ( 256. * 256. * 256. );\n}\n\nfloat sampleDepth( vec2 uv ) {\n	if( isPacked == 1. ) {\n		return unpack_depth( texture2D( tDepth, uv ) );\n	} else {\n		return texture2D( tDepth, uv ).r;\n	}\n}\n\nfloat occlusion = 0.;\nfloat depth = sampleDepth( vUv );\nfloat ac = 0.;\n\nvoid checkDepth( vec2 uv ) { // from iq's tutorial\n	float zd = 10.0 * min( depth - sampleDepth( uv ), 0.0 );\n	ac += zd;\n    occlusion += 1.0 / ( 1. + zd * zd );\n}\n\nvoid main() {\n	\n	float r = 4.;\n	float xi = r / resolution.x;\n	float yi = r / resolution.y;\n\n	checkDepth( vUv + vec2( - 2. * xi, - 2. * yi ) );\n	checkDepth( vUv + vec2(      - xi, - 2. * yi ) );\n	checkDepth( vUv + vec2(        0., - 2. * yi ) );\n	checkDepth( vUv + vec2(        xi, - 2. * yi ) );\n	checkDepth( vUv + vec2(   2. * xi, - 2. * yi ) );\n\n	checkDepth( vUv + vec2( - 2. * xi, - yi ) );\n	checkDepth( vUv + vec2(      - xi, - yi ) );\n	checkDepth( vUv + vec2(        0., - yi ) );\n	checkDepth( vUv + vec2(        xi, - yi ) );\n	checkDepth( vUv + vec2(   2. * xi, - yi ) );\n\n	checkDepth( vUv + vec2( - 2. * xi, 0. ) );\n	checkDepth( vUv + vec2(      - xi, 0. ) );\n	checkDepth( vUv + vec2(        xi, 0. ) );\n	checkDepth( vUv + vec2(   2. * xi, 0. ) );\n\n	checkDepth( vUv + vec2( - 2. * xi, yi ) );\n	checkDepth( vUv + vec2(      - xi, yi ) );\n	checkDepth( vUv + vec2(        0., yi ) );\n	checkDepth( vUv + vec2(        xi, yi ) );\n	checkDepth( vUv + vec2(   2. * xi, yi ) );\n\n	checkDepth( vUv + vec2( - 2. * xi, 2. * yi ) );\n	checkDepth( vUv + vec2(      - xi, 2. * yi ) );\n	checkDepth( vUv + vec2(        0., 2. * yi ) );\n	checkDepth( vUv + vec2(        xi, 2. * yi ) );\n	checkDepth( vUv + vec2(   2. * xi, 2. * yi ) );\n\n	occlusion /= 24.;\n	occlusion += .02 * random( vec3( gl_FragCoord.xy, depth ), length( gl_FragCoord ) );\n\n	/*if( onlyOcclusion == 1. ) {\n		gl_FragColor = vec4( vec3( occlusion ), 1. );\n	} else {\n		vec3 color = texture2D( tInput, vUv ).rgb;\n		color = mix( vec3( 0. ), color, occlusion );\n		gl_FragColor = vec4( color, 1. );\n	}*/\n\n\n	float inBlack = 0.;\n	float inWhite = 255.;\n	float inGamma = 10.;\n	float outBlack = 0.;\n	float outWhite = 255.;\n\n	//occlusion = ( pow( ( ( occlusion * 255.0) - inBlack) / (inWhite - inBlack), inGamma) * (outWhite - outBlack) + outBlack) / 255.0;\n\n	gl_FragColor = vec4( vec3( occlusion ), 1. );\n\n}",function(e){}),this.params.texture=null,this.params.isPacked=!1,this.params.onlyOcclusion=!1,this.blurPass=new a["default"].FullBoxBlurPass,this.blendPass=new a["default"].BlendPass,this.composer=null},a["default"].SSAOPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].SSAOPass.prototype.run=function(e){if(!this.composer){var t=4;this.composer=new a["default"].Composer(e.renderer,{useRGBA:!0}),this.composer.setSize(e.width/t,e.height/t)}this.composer.reset(),this.composer.setSource(e.output),this.shader.uniforms.tDepth.value=this.params.texture,this.shader.uniforms.onlyOcclusion.value=this.params.onlyOcclusion,this.composer.pass(this.shader),this.blurPass.params.amount=.1,this.composer.pass(this.blurPass),this.params.onlyOcclusion?e.setSource(this.composer.output):(this.blendPass.params.mode=a["default"].BlendMode.Multiply,this.blendPass.params.tInput2=this.composer.output,e.pass(this.blendPass))},a["default"].SimpleSSAOPass=function(){a["default"].Pass.call(this),a["default"].log("SimpleSSAOPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\n\nuniform sampler2D tDepth;\nuniform vec2 resolution;\nuniform float zNear;\nuniform float zFar;\nuniform float strength;\n\n// -------------\n\n/*\nSSAO GLSL shader v1.2\nassembled by Martins Upitis (martinsh) (devlog-martinsh.blogspot.com)\noriginal technique is made by Arkano22 (www.gamedev.net/topic/550699-ssao-no-halo-artifacts/)\n\nchangelog:\n1.2 - added fog calculation to mask AO. Minor fixes.\n1.1 - added spiral sampling method from here:\n(http://www.cgafaq.info/wiki/Evenly_distributed_points_on_sphere)\n*/\n//uniform sampler2D bgl_RenderedTexture;\n\n#define PI    3.14159265\n\nfloat width = resolution.x; //texture width\nfloat height = resolution.y; //texture height\n\nvec2 texCoord = vUv;\n\n//------------------------------------------\n//general stuff\n\n//user variables\nuniform int samples; //ao sample count //64.0\nuniform float radius; //ao radius //5.0\n\nfloat aoclamp = 0.125; //depth clamp - reduces haloing at screen edges\nbool noise = true; //use noise instead of pattern for sample dithering\nfloat noiseamount = 0.0002; //dithering amount\n\nfloat diffarea = 0.3; //self-shadowing reduction\nfloat gdisplace = 0.4; //gauss bell center //0.4\n\nbool mist = false; //use mist?\nfloat miststart = 0.0; //mist start\nfloat mistend = zFar; //mist end\n\nbool onlyAO = false; //use only ambient occlusion pass?\nfloat lumInfluence = 0.7; //how much luminance affects occlusion\n\n//--------------------------------------------------------\n\nvec2 rand(vec2 coord) //generating noise/pattern texture for dithering\n{\n  float noiseX = ((fract(1.0-coord.s*(width/2.0))*0.25)+(fract(coord.t*(height/2.0))*0.75))*2.0-1.0;\n  float noiseY = ((fract(1.0-coord.s*(width/2.0))*0.75)+(fract(coord.t*(height/2.0))*0.25))*2.0-1.0;\n\n  if (noise)\n  {\n    noiseX = clamp(fract(sin(dot(coord ,vec2(12.9898,78.233))) * 43758.5453),0.0,1.0)*2.0-1.0;\n    noiseY = clamp(fract(sin(dot(coord ,vec2(12.9898,78.233)*2.0)) * 43758.5453),0.0,1.0)*2.0-1.0;\n  }\n  return vec2(noiseX,noiseY)*noiseamount;\n}\n\nfloat doMist()\n{\n  float zdepth = texture2D(tDepth,texCoord.xy).x;\n  float depth = -zFar * zNear / (zdepth * (zFar - zNear) - zFar);\n  return clamp((depth-miststart)/mistend,0.0,1.0);\n}\n\nfloat readDepth(vec2 coord)\n{\n  if (vUv.x<0.0||vUv.y<0.0) return 1.0;\n  else {\n    float z_b = texture2D(tDepth, coord ).x;\n    float z_n = 2.0 * z_b - 1.0;\n    return (2.0 * zNear) / (zFar + zNear - z_n * (zFar-zNear));\n  }\n}\n\nint compareDepthsFar(float depth1, float depth2) {\n  float garea = 2.0; //gauss bell width\n  float diff = (depth1 - depth2)*100.0; //depth difference (0-100)\n  //reduce left bell width to avoid self-shadowing\n  if (diff<gdisplace)\n  {\n    return 0;\n  } else {\n    return 1;\n  }\n}\n\nfloat compareDepths(float depth1, float depth2)\n{\n  float garea = 2.0; //gauss bell width\n  float diff = (depth1 - depth2)*100.0; //depth difference (0-100)\n  //reduce left bell width to avoid self-shadowing\n  if (diff<gdisplace)\n  {\n    garea = diffarea;\n  }\n\n  float gauss = pow(2.7182,-2.0*(diff-gdisplace)*(diff-gdisplace)/(garea*garea));\n  return gauss;\n}\n\nfloat calAO(float depth,float dw, float dh)\n{\n  float dd = (1.0-depth)*radius;\n\n  float temp = 0.0;\n  float temp2 = 0.0;\n  float coordw = vUv.x + dw*dd;\n  float coordh = vUv.y + dh*dd;\n  float coordw2 = vUv.x - dw*dd;\n  float coordh2 = vUv.y - dh*dd;\n\n  vec2 coord = vec2(coordw , coordh);\n  vec2 coord2 = vec2(coordw2, coordh2);\n\n  float cd = readDepth(coord);\n  int far = compareDepthsFar(depth, cd);\n  temp = compareDepths(depth, cd);\n  //DEPTH EXTRAPOLATION:\n  if (far > 0)\n  {\n    temp2 = compareDepths(readDepth(coord2),depth);\n    temp += (1.0-temp)*temp2;\n  }\n\n  return temp;\n}\n\nvoid main(void)\n{\n  vec2 noise = rand(texCoord);\n  float depth = readDepth(texCoord);\n\n  float w = (1.0 / width)/clamp(depth,aoclamp,1.0)+(noise.x*(1.0-noise.x));\n  float h = (1.0 / height)/clamp(depth,aoclamp,1.0)+(noise.y*(1.0-noise.y));\n\n  float pw = 0.0;\n  float ph = 0.0;\n\n  float ao = 0.0;\n\n  float dl = PI * (3.0 - sqrt(5.0));\n  float dz = 1.0 / float(samples);\n  float l = 0.0;\n  float z = 1.0 - dz/2.0;\n\n  for (int i = 0; i < 64; i++)\n  {\n    if (i > samples) break;\n    float r = sqrt(1.0 - z);\n\n    pw = cos(l) * r;\n    ph = sin(l) * r;\n    ao += calAO(depth,pw*w,ph*h);\n    z = z - dz;\n    l = l + dl;\n  }\n\n\n  ao /= float(samples);\n  ao *= strength;\n  ao = 1.0-ao;\n\n  if (mist)\n  {\n    ao = mix(ao, 1.0, doMist());\n  }\n\n  /*\n  vec3 color = texture2D(bgl_RenderedTexture,texCoord).rgb;\n\n  vec3 lumcoeff = vec3(0.299,0.587,0.114);\n  float lum = dot(color.rgb, lumcoeff);\n  vec3 luminance = vec3(lum, lum, lum);\n\n  vec3 final = vec3(color*mix(vec3(ao),vec3(1.0),luminance*lumInfluence));//mix(color*ao, white, luminance)\n\n  if (onlyAO)\n  {\n  final = vec3(mix(vec3(ao),vec3(1.0),luminance*lumInfluence)); //ambient occlusion only\n  }\n  */\n  //vec3 final = vec3(depth/1.0);\n  vec3 final = vec3(depth);\n\n  gl_FragColor = vec4(final,1.0);\n\n}",function(e){}),this.params.texture=null,this.params.onlyOcclusion=0,this.params.zNear=1,this.params.zFar=1e4,this.params.strength=1},a["default"].SimpleSSAOPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].SimpleSSAOPass.prototype.run=function(e){this.shader.uniforms.tDepth.value=this.params.texture,this.shader.uniforms.zNear.value=this.params.zNear,this.shader.uniforms.zFar.value=this.params.zFar,this.shader.uniforms.strength.value=this.params.strength,e.pass(this.shader)},a["default"].DirectionalBlurPass=function(){a["default"].Pass.call(this),a["default"].log("Directional Blur Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform sampler2D tBias;\nuniform float delta;\n\nfloat random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}\n\nfloat sampleBias( vec2 uv ) {\n	//return texture2D( tBias, uv ).r;\n	vec3 luma = vec3( .299, 0.587, 0.114 );\n	return dot( texture2D( tBias, uv ).rgb, luma );\n}\n\nvoid main() {\n\n	float f = sampleBias( vUv );\n	float a = - f * 3.14159;\n	vec4 o = texture2D( tInput,vUv );\n	vec4 color=vec4(0.0);\n	float total=0.0;\n	vec2 tDelta = delta * vec2( cos( a ), sin( a ) );\n	float offset=random(vec3(12.9898,78.233,151.7182),0.0);\n	for(float t=-30.0;t<=30.0;t++){\n		float percent=(t+offset-0.5)/30.0;\n		float weight=1.0-abs(percent);\n		vec4 sample=texture2D(tInput,vUv+tDelta*percent);\n		sample.rgb*=sample.a;\n		color+=sample*weight;\n		total+=weight;\n	}\n	\n	if( total == 0. ) total = 1.;\n	gl_FragColor = color / total;\n	gl_FragColor.rgb/=gl_FragColor.a+0.00001;\n\n}",function(e){}),this.params.tBias=null,this.params.delta=.1},a["default"].DirectionalBlurPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].DirectionalBlurPass.prototype.run=function(e){this.shader.uniforms.tBias.value=this.params.tBias,this.shader.uniforms.delta.value=this.params.delta,e.pass(this.shader)},a["default"].BleachPass=function(){a["default"].Pass.call(this),a["default"].log("Bleach Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nuniform sampler2D tInput;\nuniform vec2 resolution;\nuniform float amount;\n\nvarying vec2 vUv;\n\nconst vec4 one = vec4(1.0);\nconst vec4 two = vec4(2.0);\nconst vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);\n\nvec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {\n	float luminance = dot(previousmix,lumcoeff);\n	float mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);\n\n	vec4 branch1 = two * previousmix * myInput;\n	vec4 branch2 = one - (two * (one - previousmix) * (one - myInput));\n\n	vec4 result = mix(branch1, branch2, vec4(mixamount) );\n\n	return mix(previousmix, result, amount);\n}\n\nvoid main (void)  {\n	vec4 pixel = texture2D(tInput, vUv);\n	vec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);\n	gl_FragColor = overlay(luma, pixel, vec4(amount));\n}\n",function(e){}),this.params.amount=1},a["default"].BleachPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].BleachPass.prototype.run=function(e){this.shader.uniforms.amount.value=this.params.amount,e.pass(this.shader)},a["default"].DOFPass=function(){a["default"].Pass.call(this),a["default"].log("DOFPass Pass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\nuniform sampler2D tBias;\nuniform float focalDistance;\nuniform float aperture;\nuniform float blurAmount;\nuniform vec2 delta;\n\nfloat random(vec3 scale,float seed){return fract(sin(dot(gl_FragCoord.xyz+seed,scale))*43758.5453+seed);}\n\nfloat unpack_depth(const in vec4 color) {\n	return ( color.r * 256. * 256. * 256. + color.g * 256. * 256. + color.b * 256. + color.a ) / ( 256. * 256. * 256. );\n}\n\nfloat sampleBias( vec2 uv ) {\n	float d = abs( texture2D( tBias, uv ).r - focalDistance );\n	return min( d * aperture, .005 );\n	//return unpack_depth( texture2D( tBias, uv ) );\n}\n\nvoid main() {\n\n	vec4 sum = vec4( 0. );\n	float bias = sampleBias( vUv );\n\n	sum += texture2D( tInput, ( vUv - bias * delta * 4. ) ) * 0.051;\n	sum += texture2D( tInput, ( vUv - bias * delta * 3. ) ) * 0.0918;\n	sum += texture2D( tInput, ( vUv - bias * delta * 2. ) ) * 0.12245;\n	sum += texture2D( tInput, ( vUv - bias * delta * 1. ) ) * 0.1531;\n	sum += texture2D( tInput, ( vUv + bias * delta * 0. ) ) * 0.1633;\n	sum += texture2D( tInput, ( vUv + bias * delta * 1. ) ) * 0.1531;\n	sum += texture2D( tInput, ( vUv + bias * delta * 2. ) ) * 0.12245;\n	sum += texture2D( tInput, ( vUv + bias * delta * 3. ) ) * 0.0918;\n	sum += texture2D( tInput, ( vUv + bias * delta * 4. ) ) * 0.051;\n\n	gl_FragColor = sum;\n	\n}"),this.params.focalDistance=0,this.params.aperture=.005,this.params.tBias=null,this.params.blurAmount=1},a["default"].DOFPass.prototype=Object.create(a["default"].Pass.prototype),a["default"].DOFPass.prototype.run=function(e){this.shader.uniforms.tBias.value=this.params.tBias,this.shader.uniforms.focalDistance.value=this.params.focalDistance,this.shader.uniforms.aperture.value=this.params.aperture,this.shader.uniforms.blurAmount.value=this.params.blurAmount,this.shader.uniforms.delta.value.set(1,0),e.pass(this.shader),this.shader.uniforms.delta.value.set(0,1),e.pass(this.shader)}},{49:49,61:61}],61:[function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(n,"__esModule",{value:!0});var r=e(49),o=i(r),s={};n["default"]=s,s.assetsPath="./assets",s.log=function(){},s.Composer=function(e,t){this.width=1,this.height=1,this.settings=t||{},this.useRGBA=this.settings.useRGBA||!1,this.renderer=e,this.copyPass=new s.CopyPass(this.settings),this.scene=new o["default"].Scene,this.quad=new o["default"].Mesh(new o["default"].PlaneBufferGeometry(1,1),this.defaultMaterial),this.scene.add(this.quad),this.camera=new o["default"].OrthographicCamera(1,1,1,1,-1e4,1e4),this.front=new o["default"].WebGLRenderTarget(1,1,{minFilter:void 0!==this.settings.minFilter?this.settings.minFilter:o["default"].LinearFilter,magFilter:void 0!==this.settings.magFilter?this.settings.magFilter:o["default"].LinearFilter,wrapS:void 0!==this.settings.wrapS?this.settings.wrapS:o["default"].ClampToEdgeWrapping,wrapT:void 0!==this.settings.wrapT?this.settings.wrapT:o["default"].ClampToEdgeWrapping,format:this.useRGBA?o["default"].RGBAFormat:o["default"].RGBFormat,type:void 0!==this.settings.type?this.settings.type:o["default"].UnsignedByteType,stencilBuffer:void 0!==this.settings.stencilBuffer?this.settings.stencilBuffer:!0}),this.back=this.front.clone(),this.startTime=Date.now(),this.passes={}},s.Composer.prototype.linkPass=function(e,t){function n(t){this.message='Pass "'+e+'" already loaded.',this.name="WagnerLoadPassException",this.toString=function(){return this.message}}if(this.passes[e])throw new n(e,t);this.passes[e]=t},s.Composer.prototype.swapBuffers=function(){this.output=this.write,this.input=this.read;var e=this.write;this.write=this.read,this.read=e},s.Composer.prototype.render=function(e,t,n,i){this.copyPass.isLoaded()&&(n&&this.swapBuffers(),this.renderer.render(e,t,i?i:this.write,!0),i||this.swapBuffers())},s.Composer.prototype.toScreen=function(){this.copyPass.isLoaded()&&(this.quad.material=this.copyPass.shader,this.quad.material.uniforms.tInput.value=this.read,this.quad.material.uniforms.resolution.value.set(this.width,this.height),this.renderer.render(this.scene,this.camera))},s.Composer.prototype.toTexture=function(e){this.copyPass.isLoaded()&&(this.quad.material=this.copyPass.shader,this.quad.material.uniforms.tInput.value=this.read,this.renderer.render(this.scene,this.camera,e,!1))},s.Composer.prototype.pass=function(e){if(e instanceof s.Stack)this.passStack(e);else{if("string"==typeof e&&(this.quad.material=this.passes[e]),e instanceof o["default"].ShaderMaterial&&(this.quad.material=e),e instanceof s.Pass){if(!e.isLoaded())return;return void e.run(this)}e.isSim||(this.quad.material.uniforms.tInput.value=this.read),this.quad.material.uniforms.resolution.value.set(this.width,this.height),this.quad.material.uniforms.time.value=.001*(Date.now()-this.startTime),
this.renderer.render(this.scene,this.camera,this.write,!1),this.swapBuffers()}},s.Composer.prototype.passStack=function(e){e.getPasses().forEach(function(e){this.pass(e)}.bind(this))},s.Composer.prototype.reset=function(){this.read=this.front,this.write=this.back,this.output=this.write,this.input=this.read},s.Composer.prototype.setSource=function(e){this.copyPass.isLoaded()&&(this.quad.material=this.copyPass.shader,this.quad.material.uniforms.tInput.value=e,this.renderer.render(this.scene,this.camera,this.write,!0),this.swapBuffers())},s.Composer.prototype.setSize=function(e,t){this.width=e,this.height=t,this.camera.projectionMatrix.makeOrthographic(e/-2,e/2,t/2,t/-2,this.camera.near,this.camera.far),this.quad.scale.set(e,t,1);var n=this.front.clone();n.width=e,n.height=t,this.quad.material instanceof s.Pass&&(this.quad.material.uniforms.tInput.value=n),this.front=n,n=this.back.clone(),n.width=e,n.height=t,this.back=n},s.Composer.prototype.defaultMaterial=new o["default"].MeshBasicMaterial,s.processShader=function(e,t){s.log("Processing Shader | Performing uniform Reflection...");for(var n,i,r,a,l=/uniform\s+([^\s]+)\s+([^\s]+)\s*;/gi,h=/uniform\s+([^\s]+)\s+([^\s]+)\s*\[\s*(\w+)\s*\]*\s*;/gi,u={sampler2D:{type:"t",value:function(){return new o["default"].Texture}},samplerCube:{type:"t",value:function(){}},bool:{type:"b",value:function(){return 0}},"int":{type:"i",value:function(){return 0}},"float":{type:"f",value:function(){return 0}},vec2:{type:"v2",value:function(){return new o["default"].Vector2}},vec3:{type:"v3",value:function(){return new o["default"].Vector3}},vec4:{type:"v4",value:function(){return new o["default"].Vector4}},bvec2:{type:"v2",value:function(){return new o["default"].Vector2}},bvec3:{type:"v3",value:function(){return new o["default"].Vector3}},bvec4:{type:"v4",value:function(){return new o["default"].Vector4}},ivec2:{type:"v2",value:function(){return new o["default"].Vector2}},ivec3:{type:"v3",value:function(){return new o["default"].Vector3}},ivec4:{type:"v4",value:function(){return new o["default"].Vector4}},mat2:{type:"v2",value:function(){return new o["default"].Matrix2}},mat3:{type:"v3",value:function(){return new o["default"].Matrix3}},mat4:{type:"v4",value:function(){return new o["default"].Matrix4}}},c={"float":{type:"fv",value:function(){return[]}},vec3:{type:"v3v",value:function(){return[]}}},p={resolution:{type:"v2",value:new o["default"].Vector2(1,1),"default":!0},time:{type:"f",value:Date.now(),"default":!0},tInput:{type:"t",value:new o["default"].Texture,"default":!0}};null!==(n=l.exec(t));)n.index===l.lastIndex&&l.lastIndex++,i=n[1],r=n[2],s.log("  > SINGLE",i,r),p[r]={type:u[i].type,value:u[i].value()};for(;null!==(n=h.exec(t));)n.index===l.lastIndex&&l.lastIndex++,i=n[1],r=n[2],a=n[3],s.log("  > ARRAY",a,i,r),p[r]={type:c[i].type,value:c[i].value()};s.log("Uniform reflection completed. Compiling...");var d=new o["default"].ShaderMaterial({uniforms:p,vertexShader:e,fragmentShader:t,shading:o["default"].FlatShading,depthWrite:!1,depthTest:!1,transparent:!0});return s.log("Compiled"),d},s.Pass=function(){s.log("Pass constructor"),this.shader=null,this.loaded=null,this.params={},this.isSim=!1},s.Pass.prototype.loadShader=function(e,t){var n="varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); }";this.shader=s.processShader(n,e),t&&t.apply(this)},s.Pass.prototype.mapUniforms=function(e){var t=this.params;for(var n in e)e[n]["default"]||!function(n){Object.defineProperty(t,n,{get:function(){return e[n].value},set:function(t){e[n].value=t},configurable:!1})}(n)},s.Pass.prototype.run=function(e){e.pass(this.shader)},s.Pass.prototype.isLoaded=function(){return null!==this.loaded?this.loaded:void(this.shader instanceof o["default"].ShaderMaterial&&(this.loaded=!0))},s.Pass.prototype.getOfflineTexture=function(e,t,n){var i=new o["default"].WebGLRenderTarget(e,t,{minFilter:o["default"].LinearFilter,magFilter:o["default"].LinearFilter,format:n?o["default"].RGBAFormat:o["default"].RGBFormat});return i},s.CopyPass=function(){s.Pass.call(this),s.log("CopyPass constructor"),this.loadShader("#define GLSLIFY 1\n\nvarying vec2 vUv;\nuniform sampler2D tInput;\n\nvoid main() {\n\n	gl_FragColor = texture2D( tInput, vUv );\n\n}")},s.CopyPass.prototype=Object.create(s.Pass.prototype),s.Stack=function(e){this.passItems=[],this.shadersPool=e,this.passes=[]},s.Stack.prototype.addPass=function(e,t,n,i){var r,o={shaderName:e,enabled:t||!1};return this.passItems.push(o),r=this.passItems.length,this.updatePasses(),i?this.movePassToIndex(this.passItems[r],i):r-1},s.Stack.prototype.removePass=function(e){this.passItems.splice(e,1),this.updatePasses()},s.Stack.prototype.enablePass=function(e){this.passItems[e].enabled=!0,this.updatePasses()},s.Stack.prototype.disablePass=function(e){this.passItems[e].enabled=!1,this.updatePasses()},s.Stack.prototype.isPassEnabled=function(e){return this.passItems[e].enabled},s.Stack.prototype.movePassToIndex=function(e,t){return this.passItems.splice(t,0,this.passItems.splice(e,1)[0]),this.updatePasses(),t},s.Stack.prototype.reverse=function(){this.passItems.reverse(),this.updatePasses()},s.Stack.prototype.updatePasses=function(){this.passes=this.shadersPool.getPasses(this.passItems),this.passItems.forEach(function(e,t){void 0===e.params&&(e.params=JSON.parse(JSON.stringify(this.passes[t].params)))}.bind(this))},s.Stack.prototype.getPasses=function(){return this.passes},s.ShadersPool=function(){this.availableShaders=[]},s.ShadersPool.prototype.getPasses=function(e){var t,n=[];return this.availableShaders.forEach(function(e){e.used=!1}),e&&e.forEach(function(e,i){e.enabled&&(t=this.getShaderFromPool(e.shaderName),e.params&&(t.params=this.extendParams(t.params,e.params)),n.push(t))}.bind(this)),n},s.ShadersPool.prototype.getShaderFromPool=function(e){var t,n;if(e&&s[e]){for(var i=this.availableShaders.length-1;i>=0;i--)if(n=this.availableShaders[i],!n.used&&n.name===e){n.used=!0,t=n.pass;break}return t||(t=new s[e],n={pass:t,name:e,used:!0},this.availableShaders.push(n)),t}},s.ShadersPool.prototype.extendParams=function(e,t){for(var n,i={},r=0,o=arguments.length;o>r;r++)for(n in arguments[r])arguments[r].hasOwnProperty(n)&&(i[n]=arguments[r][n]);return i},t.exports=n["default"]},{49:49}],62:[function(e,t,n){"use strict";var i=function(e){return e&&e.__esModule?e:{"default":e}},r=e(49),o=i(r);o["default"].OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*m.autoRotateSpeed}function i(){return Math.pow(.95,m.zoomSpeed)}function r(e){if(m.enabled!==!1){if(e.preventDefault(),e.button===m.mouseButtons.ORBIT){if(m.noRotate===!0)return;D=k.ROTATE,y.set(e.clientX,e.clientY)}else if(e.button===m.mouseButtons.ZOOM){if(m.noZoom===!0)return;D=k.DOLLY,T.set(e.clientX,e.clientY)}else if(e.button===m.mouseButtons.PAN){if(m.noPan===!0)return;D=k.PAN,b.set(e.clientX,e.clientY)}D!==k.NONE&&(document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),m.dispatchEvent(z))}}function s(e){if(m.enabled!==!1){e.preventDefault();var t=m.domElement===document?m.domElement.body:m.domElement;if(D===k.ROTATE){if(m.noRotate===!0)return;g.set(e.clientX,e.clientY),x.subVectors(g,y),m.rotateLeft(2*Math.PI*x.x/t.clientWidth*m.rotateSpeed),m.rotateUp(2*Math.PI*x.y/t.clientHeight*m.rotateSpeed),y.copy(g)}else if(D===k.DOLLY){if(m.noZoom===!0)return;E.set(e.clientX,e.clientY),C.subVectors(E,T),C.y>0?m.dollyIn():C.y<0&&m.dollyOut(),T.copy(E)}else if(D===k.PAN){if(m.noPan===!0)return;_.set(e.clientX,e.clientY),w.subVectors(_,b),m.pan(w.x,w.y),b.copy(_)}D!==k.NONE&&m.update()}}function a(){m.enabled!==!1&&(document.removeEventListener("mousemove",s,!1),document.removeEventListener("mouseup",a,!1),m.dispatchEvent(U),D=k.NONE)}function l(e){if(m.enabled!==!1&&m.noZoom!==!0&&D===k.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?m.dollyOut():0>t&&m.dollyIn(),m.update(),m.dispatchEvent(z),m.dispatchEvent(U)}}function h(e){if(m.enabled!==!1&&m.noKeys!==!0&&m.noPan!==!0)switch(e.keyCode){case m.keys.UP:m.pan(0,m.keyPanSpeed),m.update();break;case m.keys.BOTTOM:m.pan(0,-m.keyPanSpeed),m.update();break;case m.keys.LEFT:m.pan(m.keyPanSpeed,0),m.update();break;case m.keys.RIGHT:m.pan(-m.keyPanSpeed,0),m.update()}}function u(e){if(m.enabled!==!1){switch(e.touches.length){case 1:if(m.noRotate===!0)return;D=k.TOUCH_ROTATE,y.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(m.noZoom===!0)return;D=k.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);T.set(0,i);break;case 3:if(m.noPan===!0)return;D=k.TOUCH_PAN,b.set(e.touches[0].pageX,e.touches[0].pageY);break;default:D=k.NONE}D!==k.NONE&&m.dispatchEvent(z)}}function c(e){if(m.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=m.domElement===document?m.domElement.body:m.domElement;switch(e.touches.length){case 1:if(m.noRotate===!0)return;if(D!==k.TOUCH_ROTATE)return;g.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(g,y),m.rotateLeft(2*Math.PI*x.x/t.clientWidth*m.rotateSpeed),m.rotateUp(2*Math.PI*x.y/t.clientHeight*m.rotateSpeed),y.copy(g),m.update();break;case 2:if(m.noZoom===!0)return;if(D!==k.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(n*n+i*i);E.set(0,r),C.subVectors(E,T),C.y>0?m.dollyOut():C.y<0&&m.dollyIn(),T.copy(E),m.update();break;case 3:if(m.noPan===!0)return;if(D!==k.TOUCH_PAN)return;_.set(e.touches[0].pageX,e.touches[0].pageY),w.subVectors(_,b),m.pan(w.x,w.y),b.copy(_),m.update();break;default:D=k.NONE}}}function p(){m.enabled!==!1&&(m.dispatchEvent(U),D=k.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new o["default"].Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:o["default"].MOUSE.LEFT,ZOOM:o["default"].MOUSE.MIDDLE,PAN:o["default"].MOUSE.RIGHT};var d,f,m=this,v=1e-6,y=new o["default"].Vector2,g=new o["default"].Vector2,x=new o["default"].Vector2,b=new o["default"].Vector2,_=new o["default"].Vector2,w=new o["default"].Vector2,S=new o["default"].Vector3,M=new o["default"].Vector3,T=new o["default"].Vector2,E=new o["default"].Vector2,C=new o["default"].Vector2,A=0,P=0,F=1,L=new o["default"].Vector3,R=new o["default"].Vector3,B=new o["default"].Quaternion,k={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},D=k.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var N=(new o["default"].Quaternion).setFromUnitVectors(e.up,new o["default"].Vector3(0,1,0)),O=N.clone().inverse(),V={type:"change"},z={type:"start"},U={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=n()),P-=e},this.rotateUp=function(e){void 0===e&&(e=n()),A-=e},this.panLeft=function(e){var t=this.object.matrix.elements;S.set(t[0],t[1],t[2]),S.multiplyScalar(-e),L.add(S)},this.panUp=function(e){var t=this.object.matrix.elements;S.set(t[4],t[5],t[6]),S.multiplyScalar(e),L.add(S)},this.pan=function(e,t){var n=m.domElement===document?m.domElement.body:m.domElement;if(m.object instanceof o["default"].PerspectiveCamera){var i=m.object.position,r=i.clone().sub(m.target),s=r.length();s*=Math.tan(m.object.fov/2*Math.PI/180),m.panLeft(2*e*s/n.clientHeight),m.panUp(2*t*s/n.clientHeight)}else m.object instanceof o["default"].OrthographicCamera?(m.panLeft(e*(m.object.right-m.object.left)/n.clientWidth),m.panUp(t*(m.object.top-m.object.bottom)/n.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=i()),m.object instanceof o["default"].PerspectiveCamera?F/=e:m.object instanceof o["default"].OrthographicCamera?(m.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),m.object.updateProjectionMatrix(),m.dispatchEvent(V)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){void 0===e&&(e=i()),m.object instanceof o["default"].PerspectiveCamera?F*=e:m.object instanceof o["default"].OrthographicCamera?(m.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),m.object.updateProjectionMatrix(),m.dispatchEvent(V)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var e=this.object.position;M.copy(e).sub(this.target),M.applyQuaternion(N),d=Math.atan2(M.x,M.z),f=Math.atan2(Math.sqrt(M.x*M.x+M.z*M.z),M.y),this.autoRotate&&D===k.NONE&&this.rotateLeft(n()),d+=P,f+=A,d=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,d)),f=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,f)),f=Math.max(v,Math.min(Math.PI-v,f));var t=M.length()*F;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(L),M.x=t*Math.sin(f)*Math.sin(d),M.y=t*Math.cos(f),M.z=t*Math.sin(f)*Math.cos(d),M.applyQuaternion(O),e.copy(this.target).add(M),this.object.lookAt(this.target),P=0,A=0,F=1,L.set(0,0,0),(R.distanceToSquared(this.object.position)>v||8*(1-B.dot(this.object.quaternion))>v)&&(this.dispatchEvent(V),R.copy(this.object.position),B.copy(this.object.quaternion))},this.reset=function(){D=k.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(V),this.update()},this.getPolarAngle=function(){return f},this.getAzimuthalAngle=function(){return d},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",l,!1),this.domElement.addEventListener("DOMMouseScroll",l,!1),this.domElement.addEventListener("touchstart",u,!1),this.domElement.addEventListener("touchend",p,!1),this.domElement.addEventListener("touchmove",c,!1),window.addEventListener("keydown",h,!1),this.update()},o["default"].OrbitControls.prototype=Object.create(o["default"].EventDispatcher.prototype),o["default"].OrbitControls.prototype.constructor=o["default"].OrbitControls},{49:49}]},{},[1]);